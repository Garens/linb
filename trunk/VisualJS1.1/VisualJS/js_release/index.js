Class("VisualJS","linb.Com",{Constructor:function(){var A=this,B=linb.message;arguments.callee.upper.apply(A,arguments);SPA=this;A.curProject=null;A.Message=[];linb.message=function(C){if(A.Message.length>20){A.Message.pop()}if(typeof C!="string"){C=String(C)}if(/</.test(C)){C=C.replace(/</g,"&lt; ")}A.Message.unshift({id:_.id(),caption:C});A.toolbar.updateItem("info",C.left(50));B.apply(null,arguments)}},Instance:{events:{beforeCreated:function(){linb.dom.setCover("Created",true)},onLoadBaseClass:function(A,C,B){linb.dom.setCover("Load Base Class: "+B,true)},onLoadResource:function(){linb.dom.setCover("Load Resource",true)},onLoadWidgets:function(A,C,B){linb.dom.setCover("Load widgets: "+A.KEY+B)},onReady:function(A){linb.ComFactory.setProfile(CONF.ComFactoryProfile);this.menubar.setItems([{id:"file",caption:"$VisualJS.menu.file",sub:[{id:"newproject",caption:"$VisualJS.menu.newproject",icon:"img/App.gif",iconPos:"-32px top"},{id:"openproject",caption:"$VisualJS.menu.openproject",add:"Ctrl+Alt+O",icon:"img/App.gif",iconPos:"-48px top"},{id:"closeproject",caption:"$VisualJS.menu.closeproject"},{type:"split"},{id:"saveall",caption:"$VisualJS.menu.saveall",add:"Ctrl+Alt+S",icon:"img/App.gif",iconPos:"-96px top"}]},{id:"build",caption:"$VisualJS.menu.build",sub:[{id:"debug",caption:"$VisualJS.menu.debug",icon:"img/App.gif",iconPos:"top left",add:"F9"},{id:"release",caption:"$VisualJS.menu.release",icon:"img/App.gif",iconPos:"-64px top",add:"Ctrl+F9"}]},{id:"help",caption:"$VisualJS.menu.help",sub:[{id:"forum",caption:"$VisualJS.menu.forum"},{id:"download",caption:"$VisualJS.menu.download",icon:"img/App.gif",iconPos:"-144px 0px"},{type:"split"},{id:"license",caption:"$VisualJS.menu.license",sub:[{id:"gpllicense",caption:"$VisualJS.menu.gpllicense"},{id:"clicense",caption:"$VisualJS.menu.clicense"},{id:"purchase",caption:"$VisualJS.menu.purchase"}]},{type:"split"},{id:"flash",icon:"img/App.gif",iconPos:"-128px -17px",caption:"$VisualJS.tool.flash"},{id:"demo",icon:"img/App.gif",iconPos:"-48px -64px ",caption:"$VisualJS.tool.demo"},{type:"split"},{id:"about",caption:"$VisualJS.menu.about"}]}]);this.toolbar.setItems([{id:"only",sub:[{id:"newproject",icon:"img/App.gif",iconPos:"-32px top",tips:"$VisualJS.tool.newp"},{id:"openproject",icon:"img/App.gif",iconPos:"-48px top",tips:"$VisualJS.tool.open"},{type:"split"},{id:"saveall",icon:"img/App.gif",iconPos:"-96px top",tips:"$VisualJS.tool.saveall"},{type:"split"},{id:"debug",icon:"img/App.gif",iconPos:"top left",tips:"$VisualJS.tool.debug"},{id:"release",icon:"img/App.gif",iconPos:"-64px top",tips:"$VisualJS.tool.release"},{type:"split"},{id:"download",tips:"$VisualJS.menu.download",icon:"img/App.gif",iconPos:"-144px 0px"},{id:"flash",icon:"img/App.gif",iconPos:"-128px -17px",tips:"$VisualJS.tool.flash"},{id:"demo",icon:"img/App.gif",iconPos:"-48px -64px ",tips:"$VisualJS.tool.demo"},{type:"split"},{id:"ec",icon:"img/App.gif",iconPos:"-98px -16px",tips:"$VisualJS.tool.ec"},{type:"split"},{id:"info",icon:"img/App.gif",iconPos:"-286px -64px ",caption:"$VisualJS.noMessage",tips:"$VisualJS.message"}]}])},afterShow:function(E){var C="prj",D="([&|?|#]|\\b)("+C+"=)([^&]*)([&]?)",A=location.href.match(new RegExp(D)),B=_.isNull(A)?"":decodeURIComponent(A[3]);if(B){B=CONF.prjPath+B;linb.request(CONF.phpPath,_.serialize({key:CONF.requestKey,para:{action:"open",hashCode:_.id(),path:B}}),function(F){var G=_.unserialize(F);if(G&&!G.error){E._openproject(B,G)}else{linb.message(F)}})}E.proxy=new linb.UI.IFrame({height:1,left:-10000,top:-10000,src:"javascript:;"});linb(document.body).attach(E.proxy);E.$infoList=new linb.UI.List({shadow:true,resizable:true,width:400}).setCustomAppearance("ITEM","border-bottom:dashed 1px gray").create()}},base:["linb.UI"],required:["linb.UI.List","linb.UI.PopMenu","linb.UI.MenuBar","linb.UI.ToolBar","linb.UI.Layout","linb.UI.Tabs","linb.UI.TreeBar","linb.UI.Dialog","linb.UI.PanelBar","linb.UI.IFrame","linb.UI.Tips","linb.UI.Shadow","linb.UI.Resizer","linb.UI.Edge","linb.UI.Div"],background:["VisualJS.ProjectSelector","VisualJS.ProjectPro","VisualJS.PageEditor","VisualJS.ClassTool","VisualJS.ClassEditor","VisualJS.ClassStruct","VisualJS.ObjectEditor","VisualJS.Designer","VisualJS.AddFile","VisualJS.DelFile","VisualJS.About","linb.coder","linb.UI.Label","linb.UI.Button","linb.UI.CheckBox","linb.UI.Input","linb.UI.ComboInput","linb.UI.Group","linb.UI.IconList","linb.UI.RadioBox","linb.UI.Block","linb.UI.Stacks","linb.UI.ButtonViews","linb.UI.TextEditor","linb.UI.TreeGrid"],_addfile:function(F,E,B,C){var A=this.treebarPrj,D;if(C!="/"){B=B+C;D=E+"/"+B}else{D=E=E+"/"+B}linb.request(CONF.phpPath,_.serialize({key:CONF.requestKey,para:{action:"add",hashCode:_.id(),type:C=="/"?"dir":"file",path:E,filename:B}}),function(G){var J=_.unserialize(G);if(J&&J.OK){var I;if(C=="/"){I="-48px top"}else{var H=B.split(".");switch(H[1].toLowerCase()){case"html":I="-112px -48px";break;case"js":I="-16px -48px";break;default:I="-96px -48px"}}A.insertItems([{id:D,caption:B,icon:"img/App.gif",iconPos:I,value:D,sub:C=="/"?[]:null}],F)}else{linb.message(G)}})},_delfile:function(C){var A=this.treebarPrj,B=this.tabsMain;arr=C.split(";"),a=[];arr.each(function(E,D){a[D]=E});linb.request(CONF.phpPath,_.serialize({key:CONF.requestKey,para:{action:"del",hashCode:_.id(),path:a}}),function(E){var G=_.unserialize(E);if(G&&G.OK){A.removeItems(arr);var F=B.getItems(),D=[];F.each(function(H){if(!A.getSubSerialIdByItemId(H.id)){D.push(H.id)}},null,true);B.removeItems(D)}else{linb.message(E)}})},_projecttool_onclick:function(C,E,B,D){var A=this;switch(E){case"new":linb.ComFactory.getCom("addFile",null,function(){this.host=A;this.setProperties({icon:"img/App.gif",iconPos:"-0px -16px",caption:"$VisualJS.tool2.new",onOK:A._addfile,fromRegion:linb(D).getRegion(true),items:A.curPrjFiles});this.show(linb([document.body]))});break;case"delete":linb.ComFactory.getCom("delFile",null,function(){this.host=A;this.setProperties({fromRegion:linb(D).getRegion(true),icon:"img/App.gif",iconPos:"-80px -16px",caption:"$VisualJS.tool2.del",items:A.curPrjFiles,onOK:A._delfile});this.show(linb([document.body]))});break;case"refresh":linb.request(CONF.phpPath,_.serialize({key:CONF.requestKey,para:{action:"open",hashCode:_.id(),path:A.curProject}}),function(F){var G=_.unserialize(F);if(!G||G.error){linb.message(F)}else{_.tryF(A._openproject,[A.curProject,G],A);linb.message(linb.getRes("VisualJS.tool2.refreshOK"))}});break}},_closeproject:function(G){var E=this,F,C=this.tabsMain,D=C.getItems(),A=this.treebarPrj;D.each(function(H){if(H._dirty){return !(F=true)}});var B=function(){C.clearItems();A.clearItems();E.curProject=null;this.curPrjFiles=[];E.projecttool.setDisabled(true);if(typeof G=="function"){G()}};if(F){linb.UI.Dialog.confirm(linb.getRes("VisualJS.notsave"),linb.getRes("VisualJS.notsave2"),B)}else{B()}},_tabsmain_beforepageclose:function(A,B,C){if(B._dirty){linb.UI.Dialog.confirm(linb.getRes("VisualJS.notsave"),linb.getRes("VisualJS.notsave2"),function(){A.boxing().removeItems(B.id)});return false}},_tabsmain_afterpageclose:function(A,B,C){if(B.$obj){B.$obj.destroy()}},_tabsmain_beforeValueUpdated:function(C,B,A){var D=this.tabsMain.getItemByItemId(B);if(!D){return }if(t=D.$obj){if(t.getText()===false){return false}}},_tabmain_onitemselected:function(A,B,C){_.tryF(function(){if(B.$obj){B.$obj.activate()}})},_treebarprj_onitemselected:function(C,M,A){if(!M.id){return }var G=this,I=M.caption.split(".")[1];if(I!="js"&&I!="html"&&I!="php"){linb.dom.submit(M.id);return }var J=M.value,E=J.split("/"),B=E[E.length-1],F=B.split(".")[1],H=F=="js"?"-16px -48px":"-128px -48px";F=F=="js"?"class":F;var D=G.tabsMain,L=linb([A],false).getRegion(true),K=D.reBoxing().getRegion(true);if(D.getItemByItemId(J)){D.fireItemClickEvent(J)}else{linb.dom.fxProxy(L,K,null,function(){var P={id:J,tips:J,caption:B,closeBtn:true,icon:"img/App.gif",iconPos:H},O=D.getItems();D.insertItems([P],O.length?O[O.length-1].id:null);D.fireItemClickEvent(J);var N=function(Q){var R=P.id;var S=function(U,V,T){D.markDirty(U.properties.keyId,T)};P.newText=P.text=Q;if(F!="class"){linb.ComFactory.newCom("VisualJS.PageEditor",function(){this.host=G;this.setProperties({text:Q,checkType:F,keyId:R});this.setEvents("onValueChanged",S);this.show(null,D.getCurPanel());P.$obj=this})}else{linb.ComFactory.newCom("VisualJS.ClassEditor",function(){this.host=G;this.setProperties({$design:G.curProject,checkType:"js",text:Q,keyId:R});this.setEvents("onValueChanged",S);this.show(null,D.getCurPanel());P.$obj=this})}};if(F!="php"){linb.request(J,"",N)}else{linb.request(CONF.phpPath,_.serialize({key:CONF.requestKey,para:{action:"getfile",hashCode:_.id(),path:J}}),N)}},240,8,"inexp").start()}},iniComponents:function(){var B=this,D=B._nodes=[],A=linb.UI,C=function(E){D.push(E.get(0))};C((new A.ToolBar).host(B,"toolbar").setDockOrder("2").setItems([]).onClick("_toolbar_onclick"));C((new A.MenuBar).host(B,"menubar").setDockOrder("1").setItems([]).onMenuSelected("_menubar_onclick"));C((new A.Div).host(B,"float").afterCreated(function(E){E.root.onClick(function(){linb.dom.submit("http://www.linb.net")})}).setCustomAppearance({"KEY":"background-image:url(img/logo.gif);position:absolute;top:0px;right:0px;width:120px;height:60px;z-index:100;cursor:pointer;"}));C((new A.Layout).host(B,"layout").setLeft(0).setTop(0).setItems([{"id":"before","pos":"before","locked":false,"size":150,"min":50,"max":300,"cmd":true,"hide":false},{"id":"main","min":10}]).setType("horizontal"));B.layout.attach((new A.PanelBar).host(B,"panelbar2").setCaption("$VisualJS.pm.title").setIcon("img/App.gif").setIconPos("-128px -48px"),"before");B.panelbar2.attach((new A.TreeBar).host(B,"treebarPrj").setSelMode("none").setPosition("relative").setDock("none").setItems([]).setIniFold(false).setGroup(true).onItemSelected("_treebarprj_onitemselected"));B.layout.attach((new A.Tabs).host(B,"tabsMain").setLeft(0).setTop(0).setItems([]).beforeValueUpdated("_tabsmain_beforeValueUpdated").beforePageClose("_tabsmain_beforepageclose").afterPageClose("_tabsmain_afterpageclose").onItemSelected("_tabmain_onitemselected"),"main");B.layout.attach((new A.ToolBar).host(B,"projecttool").setDock("bottom").setHandler(false).setAlign("right").setDisabled(true).setItems([{id:"only",sub:[{id:"refresh",icon:"img/App.gif",iconPos:"-113px -16px",tips:"$VisualJS.tool2.refresh"},{type:"split"},{id:"new",icon:"img/App.gif",iconPos:"-0px -16px",tips:"$VisualJS.tool2.new"},{id:"delete",icon:"img/App.gif",iconPos:"-80px -16px",tips:"$VisualJS.tool2.del"}]}]).afterCreated(function(E){E.getSubNode("ITEMS").setStyle({borderLeftWidth:0,borderRightWidth:0,borderBottomWidth:0})}).onClick("_projecttool_onclick"),"before");return D},_toolbar_onclick:function(B,D,A,C){this._menubar_onclick(this.menubar.get(0),D,null,C)},_openproject:function(E,H){this.curProject=E;var B=this.treebarPrj;H.sort(function(I,J){return I.layer<J.layer?1:I.layer==J.layer?(I.type>J.type?1:I.type==J.type?(I.location>J.location?1:-1):-1):-1});var G=E.split("/"),D=G[G.length-1],C,F={"*":{id:E,caption:D,icon:"img/App.gif",iconPos:"-128px -48px",value:E,sub:[]}},A=[F["*"]];H.each(function(J){if(!J.type){C="-48px top"}else{var I=J.name.split(".");switch(I[1].toLowerCase()){case"html":C="-112px -48px";break;case"js":C="-16px -48px";break;default:C="-96px -48px"}}F[J.id]={id:J.location,caption:J.name,icon:"img/App.gif",iconPos:C,value:J.location};if(!J.type){F[J.id].sub=[]}F[J.pid].sub.push(F[J.id])});B.clearItems();B.insertItems(A);this.curPrjFiles=B.getItems();this.projecttool.setDisabled(false)},_menubar_onclick:function(D,B,L,A){var M=this;switch(B){case"newproject":var K=function(){linb.ComFactory.getCom("prjPro",null,function(){this.host=M;this.setProperties({caption:"$VisualJS.dialog.newone",projectName:"linbApp",jsLINBPath:"",className:"App",readonly:false,icon:"img/App.gif",iconPos:"-32px top",fromRegion:linb(A).getRegion(true),onOK:M._openproject});this.show(linb([document.body]))})};if(this.curProject){this._closeproject(K)}else{K()}break;case"closeproject":if(!this.curProject){linb.message(linb.getRes("VisualJS.ps.noprj"));return }this._closeproject();break;case"openproject":var K=function(){linb.ComFactory.getCom("prjSel",null,function(){this.host=M;this.setProperties({caption:linb.getRes("VisualJS.dialog.select"),icon:"img/App.gif",iconPos:"-48px top",fromRegion:linb(A).getRegion(true),onOK:M._openproject});this.show(linb([document.body]))})};if(this.curProject){this._closeproject(K)}else{K()}break;case"saveall":if(!this.curProject){linb.message(linb.getRes("VisualJS.ps.noprj"));return }var F=this.tabsMain,G=0,E;var I=F.getItems();I.each(function(O){if(O._dirty){G++;var N=O.$obj.getText();if(false===N){E="err";return false}linb.request(CONF.phpPath,_.serialize({key:CONF.requestKey,para:{action:"save",hashCode:_.id(),path:O.id,content:N}}),function(P){if(_.unserialize(P).OK){O.$obj.resetEnv(N);F.markDirty(O,false,true)}},function(P){linb.message(P)},null,{method:"POST"})}},this);if(!E){if(G){linb.message(linb.getRes("VisualJS.ps.saved",G))}else{linb.message(linb.getRes("VisualJS.ps.noSaved"))}}break;case"ec":linb.reLang(linb.lang=="en"?"cn":"en",function(){M.menubar.reset()});break;case"flash":linb.dom.submit("http://linb.googlecode.com/files/video.html");break;case"demo":linb.dom.submit("demo.html");break;case"info":if(!this.Message.length){return }var H=this.$infoList,C=H.reBoxing();H.setItems(this.Message.copy());C.popToTop(A,null,4);var J=function(){C.hide();linb.event.hookKey("esc",0,0,0,null)};C.setBlurTrigger(H.get(0).$id,J);linb.event.hookKey("esc",0,0,0,J);break;case"debug":if(!this.curProject){linb.message(linb.getRes("VisualJS.ps.noprj"));return }linb.dom.submit(this.curProject);break;case"release":if(!this.curProject){linb.message(linb.getRes("VisualJS.ps.noprj"));return }this.proxy.submit(CONF.phpPath,{key:CONF.requestKey,para:{path:this.curProject,action:"release"}},null,"POST");break;case"forum":linb.dom.submit("http://groups.google.com/group/linb");break;case"download":linb.dom.submit("http://code.google.com/p/linb/downloads/list");break;case"gpllicense":linb.dom.submit("http://www.gnu.org/licenses/gpl-3.0.txt");break;case"clicense":linb.dom.submit("license.txt");break;case"purchase":linb.dom.submit("http://linb.googlecode.com/files/purchase.html");break;case"about":linb.ComFactory.getCom("about",null,function(){this.show(linb([document.body]))});break;default:linb.message(linb.getRes("VisualJS.soon"))}}},Initialize:function(){linb.BookMark.hookLinkClick(null);window.onbeforeunload=function(A){if(linb.browser.ie6&&linb.temp.cancelBeforeload){delete linb.temp.cancelBeforeload;return }return" "}}});Class("VisualJS.PageEditor","linb.Com",{Instance:{iniUI:function(){var A=this;if(A.properties.checkType!="js"){A.toolbar.hideItem("check")}A.setText(A.properties.text)},eval2:function(txt){var r=true,iframe=document.createElement("iframe");iframe.style.display="none";document.body.appendChild(iframe);frames[frames.length-1].document.write("<script>var Class=function(a,b,c){}, _={}, linb={};var MSIE/*@cc_on =1@*/;parent.sandbox=MSIE?this:{eval:function(s){return eval(s)}}<\/script>");txt=txt.trim();try{try{sandbox.eval(txt)}catch(a){sandbox.eval("("+txt+")")}}catch(e){linb.message(_.Error(e));r=false}finally{document.body.removeChild(iframe)}return r},check:function(A){switch(this.properties.checkType){case"js":return this.eval2(A);break}return true},getText:function(B){var C=this,A=C.texteditor.getUIValue().replace(/\r\n/g,"\n");if(C.properties.text!=A){if(false!==B){if(C.check(A)===false){return false}}return A}else{return C.properties.text}},activate:function(){if(this.texteditor){var A=this;_.asyRun(function(){A.texteditor.activate();A=null})}},setReadonly:function(A){this.texteditor.setReadonly(A)},setText:function(A,B){var C=this;A=A||"";C.properties.text=A.replace(/\r\n/g,"\n");C.texteditor.setValue(A,true);C._dirty=false;return C},resetEnv:function(A){this._dirty=false;this.properties.text=A||txt.replace(/\r\n/g,"\n")},_texteditor_onKeyPress:function(E,G,H){var C=this,D=C._dirty,B,A,F=H.value.replace(/\r\n/g,"\n");C._dirty=C.properties.text!==F;if(D!=C._dirty){_.tryF(C.events.onValueChanged,[C,E,C._dirty,F],C.host)}},iniComponents:function(){var B=this,D=B._nodes=[],A=linb.UI,C=function(E){D.push(E.get(0))};C((new A.Panel).host(B,"panel").setDock("fill"));B.panel.attach((new A.ToolBar).host(B,"toolbar").setItems([{"id":"only","sub":[{"id":"format","caption":"$VisualJS.pageEditor.format","icon":"img/App.gif","iconPos":"-32px -48px","type":"button","tips":"$VisualJS.pageEditor.formattips"},{"id":"check","caption":"$VisualJS.pageEditor.check","icon":"img/App.gif","iconPos":"0 -48px","type":"button","tips":"$VisualJS.pageEditor.checktips"}]}]).onClick("_toolbar_onclick"));B.panel.attach((new A.TextEditor).host(B,"texteditor").setDock("fill").setCaption("texteditor").onKeyPress("_texteditor_onKeyPress"));return D},_toolbar_onclick:function(B,C){var A=this;linb.dom.UIAction(function(){switch(C){case"format":var F=linb.coder.parse(A.texteditor.getUIValue(),A.properties.checkType,["plain"]);var E=new linb.UI.Dialog();E.setLeft(100).setTop(100).setWidth(300).setHeight(200).setStatus("max").setMinBtn(false).setMaxBtn(false).setCaption("$VisualJS.pageEditor.formatted").create();E.html(F);E.show(linb(document.body),true);break;case"check":var D=A.getText();if(D!==false){linb.message(linb.getRes("VisualJS.checkOK"))}break}})}}});Class("VisualJS.ClassTool",null,{Static:{isClassText:function(B){var A=new RegExp("^(\\s*\\/\\*[^*@]*\\*+([^\\/][^*]*\\*+)*\\/\\s*)|^(\\s*\\/\\/[^\\n]*\\s*)");while(A.test(B)){B=B.replace(A,"")}return/^\s*Class\(/.test(B)},getClassObject:function(str){str=str.slice(str.indexOf("{")+1,str.lastIndexOf("}"));return eval("({"+str+"})")},getCodeFromStruct:function(D){try{var B=arguments.callee,A=[];if(D){if(D.sub){if(D.frame){_.each(D.sub,function(F,E){if(!_.isNull(F.comments)){A.push((F.comments||"")+E+":"+(F.code?F.code:F.sub?B.call(this,F):""))}},this);return D.frame.replace("*1",D.name||"").replace("*2",D.pname||"").replace("*3",A.join(",").replace(/\$/g,"$$$"))}else{return""}}else{return(D.code||"").replace(/^[\r\n]*/,"")}}else{return""}}catch(C){linb.message(linb.getRes("VisualJS.classtool.err2"))+":"+_.Error(C);return false}},parseSingleBlock:function(A){try{var C=new RegExp("^(\\s*\\/\\*[^*@]*\\*+([^\\/][^*]*\\*+)*\\/\\s*)|^(\\s*\\/\\/[^\\n]*\\s*)"),B=new RegExp("(\\s*\\/\\*[^*@]*\\*+([^\\/][^*]*\\*+)*\\/\\s*)|^(\\s*\\/\\/[^\\n]*\\s*)$"),G,F,D;while(B.test(A)){A=A.replace(B,"")}G=A;while(C.test(G)){G=G.replace(C,"")}G=G.replace(/\s*/,"");if(!G){return{comments:null,code:null}}F="\n"+A.replace(G,"");D=G.replace(/\s*$/,"");G=linb.coder.replace(G,[["(^|\\n)\\s*\\/\\*[^*@]*\\*+([^\\/][^*]*\\*+)*\\/\\s*",""],["\\n\\s*\\/\\/[^\\n]*\\s*",""],[/\s+(\/[^\/\n\r\*][^\/\n\r]*\/m?g?i?)\s*[:,;\r\n]/,""],[/[^\w\x24\/'"*)\]\?:]\/[^\/\n\r\*][^\/\n\r]*\/m?g?i?\s*[:,;\r\n]/,""]]);D=D.replace(/([}\]])[^}\]]*$/,"$1");G=linb.coder.replace(D,[["'(\\\\.|[^'\\\\])*'",""],['"(\\\\.|[^"\\\\])*"',""]]);while(/(\{([^\{\}]*)\})|(\[([^\[\]]*)\])/.test(G)){G=G.replace(/\s*(((function\s*([\w$]+\s*)?\(\s*([\w$\s,]*)\s*\)\s*)?(\{([^\{\}]*)\}))|(\[([^\[\]]*)\]))/g,"")}if(G.trim()!=""){return false}return{comments:F,code:D}}catch(E){linb.message(linb.getRes("VisualJS.classtool.err3")+":"+_.Error(E));return false}},getClassStruct:function(str){str=str.replace(/(\r\n|\r)/g,"\n").replace(/( +)(\n)/g,"$2").replace(/\t/g,"    ");var t,index=1,index1=1,cache={},cache1={},result,result2,code=function(str,i){var ret="#"+(index++)+"#";cache[ret]=str[0];return ret},code1=function(str){var ret="`"+(index1++);cache1[ret]=str[0];return ret},restore=function(str){return str.replace(/#(\d+)#/g,function(m){return cache[m]})},restore1=function(str){return str.replace(/`(\d+)/g,function(m){return cache1[m]})};str=linb.coder.replace(str,[["(^|\\n)\\s*\\/\\*[^*@]*\\*+([^\\/][^*]*\\*+)*\\/[^\\n]*",code],["(^|\\n)\\s*\\/\\/[^\\n]*",code],[/\s+(\/[^\/\n\r\*][^\/\n\r]*\/m?g?i?)\s*[:,;\r\n]/,code],[/[^\w\x24\/'"*)\]\?:]\/[^\/\n\r\*][^\/\n\r]*\/m?g?i?\s*[:,;\r\n]/,code]]);str=linb.coder.replace(str,[["'(\\\\.|[^'\\\\])*'",code1],['"(\\\\.|[^"\\\\])*"',code1]]);var frame=str.replace(/(^[^{]*\{)\s*((.|[\r\n])*)([^\s])(\s*}[^}]*$)/,"$1*3$5").replace(/(#\d+#)+/g,""),o={sub:{}};if(t=str.match(/^((#\d+#)+)/)){o.comments=restore(t[0])}else{o.comments=""}t=str.split(",");o.name=restore1(cache1["`1"].replace(/[\'\" ]*/g,""));o.pname=restore(restore1(t[1]).replace(/[\'\" ]*/g,""));o.frame=restore1(frame.replace(o.name,"*1").replace(o.pname,"*2"));str=str.slice(str.indexOf("{")+1,str.lastIndexOf("}"));result=o.sub;var index2=1,cache2={},code2=function(str){var ret="'~"+index2+++"'";cache2[ret]=str;return ret},code3=function(a,b,str){if(a.indexOf("~")!=-1){return a}var ret="'~"+index2+++"'";cache2[ret]=str;return b+ret},restore2=function(str){if(str.indexOf("~")==-1){return str}str=cache2["'"+str+"'"];while(/'~\d+'/.test(str)){str=str.replace(/'~\d+'/g,function(m){return cache2[m]})}return str};while(/(\{([^\{\}]*)\})|(\[([^\[\]]*)\])/.test(str)){str=str.replace(/\s*(((function\s*([\w$]+\s*)?\(\s*([\w$\s,]*)\s*\)\s*)?(\{([^\{\}\[\]]*)\}))|(\[([^\[\]\{\}]*)\]))/g,code2)}str=linb.coder.replace(str,["\\s+",code]);str=str.replace(/((#\d+#)+)([\w]+)((#\d+#)*):/g,function(z,a,b,c){result[c]={comments:restore(a)};return c+":"});str=str.replace(/(#\d+#)/g,"");var obj=eval("({"+str+"})");["Constructor","Initialize","Before","After"].each(function(i){if(obj[i]){result[i]=result[i]||{};result[i].code=restore(restore1(restore2(obj[i])))}else{result[i]={}}"code,comments".toArr().each(function(j){result[i][j]=_.exists(result[i][j])?result[i][j]:null})});var obj2;["Instance","Static"].each(function(i){if(obj[i]){var temp=cache2["'"+obj[i]+"'"];var frame=temp.replace(/(^[^{]*\{)\s*((.|[\r\n])*)([^\s])(\s*}[^}]*$)/,"$1*3$5");temp=temp.replace(/(#\d+#)*\s*(\})$/g,"$2");temp="("+temp+")";temp=linb.coder.replace(temp,["\\s+",code]);result[i]=result[i]||{};result2=result[i].sub={};result[i].frame=frame;temp=temp.replace(/(:)([^,\}]+)/g,code3);temp=restore1(temp);temp=temp.replace(/((#\d+#)+)([\w]+)((#\d+#)*):/g,function(z,a,b,c){result2[c]={comments:restore(a)};return c+":"});temp=temp.replace(/(#\d+#)/g,"");obj2=eval(temp);_.each(obj2,function(o,j){result2[j]=result2[j]||{};result2[j].code=restore(restore1(restore2(o)))})}else{result[i]={}}"code,comments,sub,frame".toArr().each(function(j){result[i][j]=_.exists(result[i][j])?result[i][j]:null})});return o}}});Class("VisualJS.ClassEditor","linb.Com",{Instance:{views:null,events:{afterCreated:function(B,C){var A=B;B.views={};linb.ComFactory.newCom("VisualJS.PageEditor",function(){var D=this;D.host=B;D.setProperties({text:B.properties.text,checkType:"js"});D.setEvents("onValueChanged",function(H,F,E,G){_.tryF(B.events.onValueChanged,[B,H,A.properties.textO!=G],B.host)});D.show(null,B.buttonview,"normal");B.views["normal"]=D},C)}},activate:function(){var B=this,C;if(!B.views){return }var A=B.buttonview.getUIValue();if(C=B.views[A]){if(C.created){C.activate()}}},beforeDestroy:function(){_.each(this.views,function(A){A.destroy()})},getText:function(){var A=this.buttonview.getUIValue();return this.views[A].getText()},setText:function(A,B){var C=this,D=C.properties;A=A.replace(/\r\n/g,"\n");D.textO=D.text=A;D.clsStruct=D.clsObject=null;C.views[C.buttonview.getUIValue()].setText(A,B);return C},resetEnv:function(C){var A=this,B=A.properties;if(!C){C=A.getText()}B.clsStruct=B.clsObject=null;B.textO=B.text=C;A.views[A.buttonview.getUIValue()].resetEnv(C)},_buttonview_aftercreated:function(A){A.getSubNode("PANEL",true).setStyle({borderBottom:"0",borderLeft:"0",borderRight:"0"})},_buttonview_beforeValueUpdated:function(D,E,G){var I=this,B=I.properties,H;if(!I.views){return }if((H=I.views[E])&&H.created){var A=H.getText();if(false===A){return false}else{if(E=="normal"){if(!VisualJS.ClassTool.isClassText(A)){B.clsStruct=B.clsObject=null;linb.message(linb.getRes("VisualJS.classtool.noClass"));return false}}if(B.text!=A||!B.clsStruct||!B.clsObject){try{B.clsStruct=VisualJS.ClassTool.getClassStruct(A);B.clsObject=VisualJS.ClassTool.getClassObject(A)}catch(F){B.clsStruct=B.clsObject=null;linb.message(linb.getRes("VisualJS.classEditor.codeerr",_.Error(F)));return false}B.text=A}if(E!="normal"){var C=H.properties;C.text=A;C.clsStruct=B.clsStruct;C.clsObject=B.clsObject}}}else{return false}},_buttonview_onitemselected:function(C,D,F){var A=this,E=A.properties,B;if(!A.views){return }if(!(B=A.views[D.id])){if(D.id=="struct"){linb.ComFactory.newCom("VisualJS.ClassStruct",function(){this.setHost(A).setProperties({text:E.text,clsStruct:E.clsStruct,clsObject:E.clsObject}).setEvents({onValueChanged:function(I,H,G){_.tryF(A.events.onValueChanged,[this,I,(E.textO!=E.text)||G],A.host)}});this.show(null,A.buttonview,"struct");A.views["struct"]=this})}else{if(D.id=="design"){linb.ComFactory.newCom("VisualJS.Designer",function(){this.setHost(A).setProperties({$design:E.$design,text:E.text,clsStruct:E.clsStruct,clsObject:E.clsObject}).setEvents({onValueChanged:function(I,H,G){_.tryF(A.events.onValueChanged,[this,I,(E.textO!=E.text)||G],A.host)}});this.show(null,A.buttonview,"design");A.views["design"]=this})}}}else{linb([F],false).UIAction(function(G){if(B.created){if(D.id=="struct"||D.id=="design"){B.properties.clsStruct=E.clsStruct;B.properties.clsObject=E.clsObject}B.setText(E.text,false,G).activate()}})}},base:["linb.UI"],required:["linb.UI.Tabs","linb.UI.ButtonViews","VisualJS.ClassTool"],parepareData:function(A){A.textO=A.text},iniComponents:function(){var B=this,D=B._nodes=[],A=linb.UI,C=function(E){D.push(E.get(0))};C((new A.ButtonViews).host(B,"buttonview").setLeft(0).setTop(0).setItems([{"id":"normal","caption":"$VisualJS.classEditor.nv","icon":"img/App.gif","iconPos":"-80px -48px","tips":"$VisualJS.classEditor.nvtips"},{"id":"struct","caption":"$VisualJS.classEditor.sv","icon":"img/App.gif","iconPos":"-32px -48px","tips":"$VisualJS.classEditor.svtips"},{"id":"design","caption":"$VisualJS.classEditor.dv","icon":"img/App.gif","iconPos":"-192px -48px","tips":"$VisualJS.classEditor.dvtips"}]).setValue("normal").setHandleSize("28").beforeValueUpdated("_buttonview_beforeValueUpdated").afterCreated("_buttonview_aftercreated").onItemSelected("_buttonview_onitemselected"));return D}}});Class("VisualJS.ClassStruct","linb.Com",{Instance:{events:{afterShow:function(A){A.setText(A.properties.text,true)}},iniExComs:function(B){var A=this;linb.ComFactory.newCom("VisualJS.PageEditor",function(){var C=this;C.host=A;C.setProperties({checkType:"js"});C.setEvents("onValueChanged",function(E,F,D){_.tryF(A.events.onValueChanged,[E,F,A.$dirty||D],A.host)});C.show(null,A.layoutFill,"main");A.PageEditor=C},B)},activate:function(){this.PageEditor.activate()},check:function(A){return this.PageEditor.check(A)},getText:function(){var C=this,E=C.properties,D=C.refer,B=C.PageEditor.getText(false);if(B===false){return false}if(C.$dirty||E.temptext!=B){if(D){if(false===C.check(B)){return false}var A=VisualJS.ClassTool.parseSingleBlock(B);if(false===A){linb.message(linb.getRes("VisualJS.classtool.err1"));return false}E.temptext=B;D.comments=A.comments;D.code=A.code;B=VisualJS.ClassTool.getCodeFromStruct(E.clsStruct);return E.clsStruct.comments.replace(/^[\r\n]*/,"")+B}}return E.text},setText:function(E,H){var K=this,A=K.properties;E=E.replace(/\r\n/g,"\n");if(H||A.text!=E){A.text=E;var F=A.clsStruct,B=A.clsObject;value=K.treebarClass.getUIValue();K.treebarClass.setValue(null,true);var G=[{id:"Class",caption:"Class",caption:F.name,icon:"img/App.gif",iconPos:"-16px -48px",group:true,sub:[{id:"Constructor",caption:"Constructor",icon:"img/App.gif",iconPos:"-32px -32px"},{id:"Instance",caption:"Instance",icon:"img/App.gif",iconPos:"-16px -32px",sub:[]},{id:"Static",caption:"Static",icon:"img/App.gif",iconPos:"-16px -32px",sub:[]},{id:"Initialize",caption:"Initialize",icon:"img/App.gif",iconPos:"-32px -32px"},{id:"Before",caption:"Before",icon:"img/App.gif",iconPos:"-32px -32px"},{id:"After",caption:"After",icon:"img/App.gif",iconPos:"-32px -32px"}]}];var J,C,I,D=G[0].sub;J=A.clsStruct.sub;if(J){C=J.Instance;if(C&&(C=C.sub)){_.each(C,function(M,L){I="img/App.gif";iconPos=(typeof B.Instance[L]=="function")?"-32px -32px":"0 -32px";if(_.isHash(B.Instance[L])){I="block.gif"}D[1].sub.push({id:"Instance."+L,caption:L,icon:I,iconPos:iconPos})})}C=J.Static;if(C&&(C=C.sub)){_.each(C,function(M,L){I=(typeof B.Static[L]=="function")?"function.gif":"property.gif";if(_.isHash(B.Static[L])){I="block.gif"}D[2].sub.push({id:"Static."+L,caption:L,icon:"img/"+I})})}}delete K.refer;K.treebarClass.setItems(G);if(value){if(K.treebarClass.selectItem(value)){return K}}K.PageEditor.setText("").setReadonly(true)}K.resetEnv(E);return K},resetEnv:function(B){var A=this;if(!B){B=A.getText()}A.$dirty=false;A.properties.text=B;A.PageEditor.resetEnv(B)},_treebarclass_beforevalueupdated:function(F,E,D){var C=this,G=C.PageEditor;if(!C.refer){return }var B=G.getText();if(B===false){return false}if(C.properties.temptext!=B){if(false===C.check(B)){return false}var A=VisualJS.ClassTool.parseSingleBlock(B);if(false===A){linb.message(linb.getRes("VisualJS.classtool.err1"));return false}C.refer.comments=A.comments;C.refer.code=A.code;C.$dirty=true}},_treebarclass_onitemselected:function(B,D,C){if(!D.id){return }var A=this,F=A.PageEditor,E=D.id;linb([C],false).UIAction(function(K){var N=A.properties.clsStruct,I,H,G;var M,J;switch(E){case"Class":J=VisualJS.ClassTool.getCodeFromStruct(N);break;case"Static":case"Instance":case"Constructor":case"Initialize":case"Before":case"After":N=N.sub;if(N=N[E]){if(N.sub){J=VisualJS.ClassTool.getCodeFromStruct(N)}}break;default:N=N.sub;G=E.split(".");N=N[G[0]];N=N.sub;N=N[G[1]]}M=(N?(N.comments||""):"");if(M){M=M.replace(/^[\r\n]*/,"")}J=J||(N&&N.code)||"";linb.thread.suspend(K);var I=linb([C],false).getRegion(true),L=F.texteditor.reBoxing().getRegion(true);linb.dom.fxProxy(I,L,null,function(){F.setText(A.properties.temptext=M+J).activate();F.setReadonly(E=="Class"||E=="Instance"||E=="Static")},240,8,"inexp").start();A.refer=N;linb.thread.resume(K)})},iniComponents:function(){var B=this,D=B._nodes=[],A=linb.UI,C=function(E){D.push(E.get(0))};C((new A.Layout).host(B,"layoutFill").setLeft(0).setTop(0).setItems([{"id":"before","pos":"before","locked":false,"size":150,"min":50,"max":200,"cmd":false}]).setType("horizontal"));B.layoutFill.attach((new A.TreeBar).host(B,"treebarClass").setLeft(0).setTop(0).setGroup(false).setItems([]).setIniFold(false).onItemSelected("_treebarclass_onitemselected").beforeValueUpdated("_treebarclass_beforevalueupdated"),"before");return D}}});Class("VisualJS.ObjectEditor","linb.Com",{Instance:{iniExComs:function(B){var A=this;linb.ComFactory.newCom("VisualJS.PageEditor",function(){var C=this;C.host=A;C.setProperties({checkType:"js"});C.show(null,A.dialog,null,B);A.PageEditor=C},B)},check:function(A){return this.PageEditor.check(A)},_dialog_beforeclose:function(A){this.dialog.hide();return false},_btncancel_onclick:function(){this.dialog.close()},_btnok_onclick:function(){var B=this,C=B.properties,A=B.PageEditor.getText(false);if(A===false){return false}if(C.text!=A){if(false===B.check(A)){return false}C.result=VisualJS.ClassTool.parseSingleBlock(A);if(false===C.result){linb.message(linb.getRes("VisualJS.classtool.err1"));return false}C.text=A;C.object=_.unserialize(C.text)||null;_.tryF(C.onOK,[B],B.host)}B.dialog.close()},customAttach:function(A){var B=this,D=B.properties,C=B.dialog;C.setCaption(D.caption).setIcon(D.icon).setIconPos(D.iconPos);B.PageEditor.setText(D.text);if(D.fromRegion){C.setFromRegion(D.fromRegion)}if(!C.get(0).root){C.create()}C.show(A,true);return false},iniComponents:function(){var B=this,D=B._nodes=[],A=linb.UI,C=function(E){D.push(E.get(0))};C((new A.Dialog).host(B,"dialog").setLeft(216).setTop(80).setWidth(500).setMaxBtn(false).setMinBtn(false).setCaption("dialog").beforeClose("_dialog_beforeclose"));B.dialog.attach((new A.Panel).host(B,"panelB").setDock("bottom").setHeight(35));B.panelB.attach((new A.Panel).host(B,"panelR").setDock("right").setWidth(284));B.panelR.attach((new A.Button).host(B,"btnCancel").setLeft(64).setTop(8).setWidth("100").setCaption("Cancel").setIcon("img/App.gif").setIconPos("-16px -16px").onClick("_btncancel_onclick"));B.panelR.attach((new A.Button).host(B,"btnOK").setLeft(176).setTop(8).setWidth("100").setCaption("OK").setIcon("img/App.gif").setIconPos("-64px -16px").onClick("_btnok_onclick"));return D}}});Class("VisualJS.ProjectPro","linb.Com",{Instance:{customAttach:function(){var A=this,B=A.properties;A.dialog.setCaption(B.caption).setIcon(B.icon).setIconPos(B.iconPos);A.inputName.setValue(B.projectName,true);A.inputClassName.setValue(B.className,true);A._refreshLabel(B.projectName);if(B.fromRegion){A.dialog.setFromRegion(B.fromRegion)}A.inputName.setDisabled(B.readonly);A.inputClassName.setDisabled(B.readonly);A.dialog.show(A.parent,true)},iniComponents:function(){var B=this,D=B._nodes=[],A=linb.UI,C=function(E){D.push(E.get(0))};C((new A.Dialog).host(B,"dialog").setLeft(100).setTop(100).setWidth(540).setHeight(220).setMinBtn(false).setMaxBtn(false).setResizable(false).setCaption("dialog").onHotKeydown("_dialog_onhotkey").beforeClose("_dialog_beforeclose"));B.dialog.attach((new A.Input).host(B,"inputName").setLeft(126).setTop(16).setTipsErr("$VisualJS.projectPro.onlyword").setValueFormat("^\\w{3,15}$").afterValueUpdated("_inputname_aftervalueupdated"));B.dialog.attach((new A.Label).host(B,"label1").setLeft(14).setTop(18).setWidth(104).setCaption("$VisualJS.projectPro.name"));B.dialog.attach((new A.Label).host(B,"label3").setLeft(30).setTop(82).setWidth(88).setCaption("$VisualJS.projectPro.classfile"));B.dialog.attach((new A.Label).host(B,"label5").setLeft(38).setTop(50).setWidth(80).setCaption("$VisualJS.projectPro.class"));B.dialog.attach((new A.Button).host(B,"btnCancel").setLeft(262).setTop(152).setWidth(90).setTabindex("0").setCaption("$VisualJS.cancel").setIcon("img/App.gif").setIconPos("-16px -16px").onClick("_btncancel_onclick"));B.dialog.attach((new A.Input).host(B,"inputClassName").setLeft(126).setTop(48).setValueFormat("^\\w{3,15}$").setTipsErr("$VisualJS.projectPro.onlyword"));B.dialog.attach((new A.Label).host(B,"label7").setLeft(126).setTop(114).setWidth(384).setHAlign("left").setCaption("label7"));B.dialog.attach((new A.Label).host(B,"label2").setLeft(30).setTop(114).setWidth(88).setCaption("$VisualJS.projectPro.pagefile"));B.dialog.attach((new A.Label).host(B,"label8").setLeft(126).setTop(82).setWidth(384).setHAlign("left").setCaption("label8"));B.dialog.attach((new A.Button).host(B,"btnOK").setLeft(374).setTop(152).setWidth(90).setCaption("$VisualJS.ok").setIcon("img/App.gif").setIconPos("-64px -16px").onClick("_btnok_onclick"));return D},_dialog_beforeclose:function(A){this.dialog.hide();return false},_btncancel_onclick:function(){this.dialog.close()},_btnok_onclick:function(){var A=this;if(A.inputName.checkUIValueValid()===false||A.inputClassName.checkUIValueValid()===false){linb.message(linb.getRes("VisualJS.projectPro.invalid"));return }var B=A.projectName=A.inputName.updateValue().getValue();A.className=A.inputClassName.updateValue().getValue();linb.request(CONF.phpPath,_.serialize({key:CONF.requestKey,para:{action:"new",hashCode:_.id(),path:this.projectName,className:this.className}}),function(C){var D=_.unserialize(C);if(!D||D.error){linb.message(C)}else{_.tryF(A.properties.onOK,["projects/"+B,D],A.host)}A.dialog.close()},function(C){linb.message(C)})},_inputname_aftervalueupdated:function(B,A,C){this._refreshLabel(C)},_refreshLabel:function(C,B){var A=this;B=B||"index";A.label7.setCaption(linb.ini.appPath+"projects/"+C+"/"+B+".html");A.label8.setCaption(linb.ini.appPath+"projects/"+C+"/VisualJS/js/"+B+".js")},_dialog_onhotkey:function(C,B,E,A,D){if(B=="esc"){C.boxing().close()}}}});Class("VisualJS.ProjectSelector","linb.Com",{Instance:{customAttach:function(){var A=this,B=A.dialog,C=A.properties;B.setCaption(C.caption).setIcon(C.icon).setIconPos(C.iconPos);A.listName.setUIValue("").setItems([]);if(C.fromRegion){B.setFromRegion(C.fromRegion)}B.show(A.parent,true);linb.dom.setCover(linb.getRes("VisualJS.ps.getting"));linb.request(CONF.phpPath,_.serialize({key:CONF.requestKey,para:{action:"open",hashCode:_.id(),path:"projects",deep:"0"}}),function(E){var D=_.unserialize(E);if(!D||D.error){linb.message(E)}else{if(D&&D.length){A.properties.projectList=[];D.each(function(F){if(F.type===0){A.properties.projectList.push({id:F.location,caption:F.name})}})}A.listName.setItems(C.projectList);linb.dom.setCover(false)}},function(){linb.dom.setCover(false)})},iniComponents:function(){var B=this,D=B._nodes=[],A=linb.UI,C=function(E){D.push(E.get(0))};C((new A.Dialog).host(B,"dialog").setLeft(100).setTop(100).setWidth(340).setHeight(190).setMinBtn(false).setMaxBtn(false).setResizable(false).setCaption("dialog").onHotKeydown("_dialog_onhotkey").beforeClose("_dialog_beforeclose"));B.dialog.attach((new A.List).host(B,"listName").setDock("top").setHeight(120).setItems([]));B.dialog.attach((new A.Button).host(B,"btnCancel").setLeft(140).setTop(130).setWidth(90).setZIndex("1").setCaption("$VisualJS.cancel").setIcon("img/App.gif").setIconPos("-16px -16px").onClick("_btncancel_onclick"));B.dialog.attach((new A.Button).host(B,"btnOK").setLeft(230).setTop(130).setWidth(90).setZIndex("1").setCaption("$VisualJS.ok").setIcon("img/App.gif").setIconPos("-64px -16px").onClick("_btnok_onclick"));return D},_btncancel_onclick:function(){this.dialog.close()},_btnok_onclick:function(){var A=this,B=A.projectName=A.listName.getUIValue();if(!A.projectName){linb.message(linb.getRes("VisualJS.ps.noselected"));return }linb.request(CONF.phpPath,_.serialize({key:CONF.requestKey,para:{action:"open",hashCode:_.id(),path:this.projectName}}),function(C){var D=_.unserialize(C);if(!D||D.error){linb.message(C)}else{_.tryF(A.properties.onOK,[B,D],A.host)}A.dialog.close()})},_dialog_beforeclose:function(A){this.dialog.hide();return false},_dialog_onhotkey:function(C,B,E,A,D){if(B=="esc"){C.boxing().close()}}}});Class("VisualJS.Designer","linb.Com",{Instance:{panelHeight:600,panelWidth:800,dropPosition:"absolute",dropOffset:10,events:{afterShow:function(A,B){var D="img/designer/toolbar.gif",C="$VisualJS.designer.tool.";A.proxy=linb.create('<div style="position:absolute;border:dashed 1px blue;overflow:visible;left:-100px;top:-100px;z-index:1000"></div>');A.resizer=linb.create("Resizer",{dragArgs:{grid_width:this.dropOffset,grid_height:this.dropOffset},zIndex:linb.dom.top_zIndex});A.resizer.host(A).onItemsSelected(function(F,E){this.pProfile.setSelectFromResizer.call(this.pProfile,E)}).onActive(function(E){this._focus()}).onUpdate(function(I,J,H,F){A._change();var G=this;if(J){var E=false;J.each(function(P){P=linb([P],false);var L=linb.cache.dom[P.get(0).id],N=L.boxing(),K=L.properties,M=L.box.getDataModel();if(H){var S=null,O=null;if(H.width){if(K&&!M.width){E=true}else{switch(K.dock){case"top":case"bottom":case"fill":case"cover":case"width":E=true;break;case"left":case"right":case"height":E=true;default:P.widthBy(H.width,true);S=N.refreshWidth()}}}if(H.height){if(K&&!M.height){E=true}else{switch(K.dock){case"left":case"right":case"fill":case"cover":case"height":E=true;break;case"top":case"bottom":case"width":E=true;default:P.heightBy(H.height,true);O=N.refreshHeight()}}}G._sizeUpdated(P,{width:S,height:O})}if(F){var R=null,Q=null;if(F.left){if(K&&!M.left){E=true}else{switch(K.dock){case"top":case"bottom":case"left":case"right":case"fill":case"cover":case"width":E=true;break;case"height":E=true;default:P.leftBy(F.left);R=N.refreshLeft()}}}if(F.top){if(K&&!M.top){E=true}else{switch(K.dock){case"left":case"right":case"top":case"bottom":case"fill":case"cover":case"height":E=true;break;case"width":E=true;default:P.topBy(F.top);Q=N.refreshTop()}}}G._posUpdated(P,{left:R,top:Q})}});if(E){I.boxing().rePosSize()}}}).onFocusChange(function(F,E){if(this.tempSelected){this.SelectedFocus=E;_.resetRun("$profilegrid$",this._refreshProfileGrid,0,[this.tempSelected],this)}}).onRegionClick(function(K,L){var H=linb.event.getPos(L),F,J,E,I;var G=function(R,Y,W){var T=arguments.callee,N,O,U,X,Q,M={},S=W.absPos(),V=W.offsetWidth(),P=W.offsetHeight();M.left=Y.left-S.left;M.top=Y.top-S.top;R.each(function(Z){if(N=Z[0].root){if(Z[0].children.length){if(O=T(Z[0].children,Y,N)){return false}}U=N.absPos(null,W);X=N.offsetWidth();Q=N.offsetHeight();if(M.left>U.left&&M.top>U.top&&M.left<U.left+X&&M.top<U.top+Q&&M.left<V&&M.top<P){O=Z[0].$id;return false}}});return O};if(!(F=this.tempSelected)||!F.length){return }F.each(function(M){J=linb.UIProfile.getFromCacheId(M);I=G(J.children,H,J.root);if(I){return false}});if(I){this.selectWidget([I]);return false}});A.holder=linb.create('<div style="display:none;"></div>');A.panelDiv.reBoxing().addLast(A.holder);A.holder.addLast(A.resizer);A.holder.addLast(A.proxy);A.proxy.get(0).zIndexIgnore=true;A.toolbar.setItems([{id:"code",sub:[{id:"format",icon:"img/App.gif",iconPos:"-32px -48px",type:"button",tips:C+"tocode"},{id:"json",icon:"img/App.gif",iconPos:"-128px -64px",type:"button",tips:C+"tojson"}]},{id:"align",sub:[{id:"left",caption:"",icon:D,iconPos:"0 top",tips:C+"left"},{id:"center",caption:"",icon:D,iconPos:"-16px top",tips:C+"center"},{id:"right",caption:"",icon:D,iconPos:"-32px top",tips:C+"right"},{id:"s1",type:"split"},{id:"top",caption:"",icon:D,iconPos:"-48px top",tips:C+"top"},{id:"middle",caption:"",icon:D,iconPos:"-64px top",tips:C+"middle"},{id:"bottom",caption:"",icon:D,iconPos:"-80px top",tips:C+"bottom"},{id:"s2",type:"split"},{id:"w",caption:"",icon:D,iconPos:"-96px top",tips:C+"width"},{id:"wh",caption:"",icon:D,iconPos:"-112px top",tips:C+"wh"},{id:"h",caption:"",icon:D,iconPos:"-128px top",tips:C+"height"}]},{id:"pos",sub:[{id:"zindex1",caption:"",icon:D,iconPos:"-144px top",tips:C+"toplayer"},{id:"zindex2",caption:"",icon:D,iconPos:"-160px top",tips:C+"bottomlayer"},{id:"s1",type:"split"},{id:"repos",caption:"",icon:D,iconPos:"-176px top",tips:C+"gridxy"},{id:"resize",caption:"",icon:D,iconPos:"-192px top",tips:C+"gridwh"},{id:"s2",type:"split"},{id:"clone",caption:"",icon:D,iconPos:"-240px top",tips:C+"clone"}]},{id:"del",sub:[{id:"delete",caption:"",icon:D,iconPos:"-256px top",tips:C+"delete"}]}]);A.treebarCom.setItems(_.clone(CONF.widgets)).setCustomBehavior({BAR:{onMousedown:function(F,H,J){var L=J.id,I=F.getSubSerialId(L),E=F.properties,G=F.getItemByDom(L),K=linb.event.getPos(H);if(G.dragable){F.getSubNode("ICON",I).startDrag(H,{drop2:true,icon:linb.ini.path+"onDrag.gif",dragMode:"add",cursor:"pointer",target_left:K.left+12,target_top:K.top+12,move:false,key:G.dragKey||F.properties.dragKey,data:{type:G.id,iconPos:G.iconPos}});F.removeTagClass("BAR","-mouseover",linb([J]));A._clearSelect();A._setSelected([],true)}}}});A.focusBtn=linb.create('<a href="javascript;" style="position:absolute;left:-10000px;top:-10000px;width:1px;height:1px;">o</a>');A.focusBtn.onKeydown(function(K,T,J){if(!A.resizer){return }var V=linb.event.getKey(T),Q=V[0],L=V[1],S=V[2],I=1,P=A.resizer.reBoxing(),G=A.resizer.get(0),R=P.cssPos(),E=P.cssSize(),M=G.properties.dragArgs.grid_height,F=G.properties.dragArgs.grid_width;var N,U=false,O=null,H=null;switch(Q){case"up":U=true;if(L){I=-1}else{if(S){I=(N=(R.top+E.height)%M)?-N:-M}else{I=(N=R.top%M)?-N:-M}}if(S){P.heightBy(I);G.regions.heightBy(I);O={width:0,height:I}}else{P.topBy(I);H={left:0,top:I}}break;case"down":U=true;if(L){I=1}else{if(S){I=(N=(R.top+E.height)%M)?M-N:M}else{I=(N=R.top%M)?M-N:M}}if(S){P.heightBy(I);G.regions.heightBy(I);O={width:0,height:I}}else{P.topBy(I);H={left:0,top:I}}break;case"left":U=true;if(L){I=-1}else{if(S){I=(N=(R.left+E.width)%F)?-N:-F}else{I=(N=R.left%F)?-N:-F}}if(S){G.regions.widthBy(I);P.widthBy(I);O={width:I,height:null}}else{P.leftBy(I);H={left:I,top:0}}break;case"right":U=true;if(L){I=1}else{if(S){I=(N=(R.left+E.width)%F)?F-N:F}else{I=(N=R.left%F)?F-N:F}}if(S){P.widthBy(I);G.regions.widthBy(I);O={width:I,height:null}}else{P.leftBy(I);H={left:I,top:0}}break;case"delete":A._deleteSelected();A._focus();break;case"esc":A._clearSelect();A._setSelected([],true);break}if(U){G.boxing().onUpdate(G,G._target,O,H);return false}}).onFocus(function(G,E,F){clearTimeout(A.timer);A.resizer.active(false)}).onBlur(function(G,E,F){A.timer=_.asyRun(function(){if(A.resizer){A.resizer.inActive()}},200)});A.layoutBase.reBoxing().addFirst(A.focusBtn);A._enablePanelDesign(A.canvas.get(0));A.setText(A.properties.text,true,B)},onSelected:function(D,C,B){var A=null,F=B&&B[B.length-1];if(F){var E=linb.getObject(F);if(E){A=E}}D.listObject.setCtrlValue(A?A.alias:"page",true);_.resetRun("$profilegrid$",D._refreshProfileGrid,0,[B],D)},onReady:function(A){A.canvas.setWidth(A.panelWidth).setHeight(A.panelHeight);A.panelBG.setWidth(A.panelWidth).setHeight(A.panelHeight)}},_detatchResizer:function(){var A=this;A.holder.addLast(A.resizer);A.holder.addLast(A.proxy);A.pProfile=A.pNode=null},_attachResizer:function(B,C){var A=this;A.proxy.display("none");A.resizer.resetTarget(null,false);linb(C).addLast(A.resizer).addLast(A.proxy);A.pProfile=B;A.pNode=C;_.merge(A.resizer.get(0).properties.dragArgs,{grid_width:A.dropOffset,grid_height:A.dropOffset},"all")},_focus:function(){this.focusBtn.focus()},_setSelected:function(E,B){var C=this,A=C.toolbar,D;E=_.arr(E);C.tempSelected=E;C.SelectedFocus=E.length-1;A.disableGroup("align",E.length>1?false:true);if(E.length>0&&(D=linb.UIProfile.getFromCacheId(E[0]))){A.disableGroup("pos",!D.box.hasDomRoot)}else{A.disableGroup("pos",true)}A.disableGroup("del",E.length>0?false:true);if(B){C.events.onSelected.apply(C.parent,[C,C.pProfile,E])}C._focus();return C},_sizeUpdated:function(D,C){var B,A=this;if(!(B=A.profileGrid.get(0).$widget)){return }if(linb.cache.dom[D.get(0).id]==B.get(B.length()-1)){_.asyRun(function(){if(C.width!==null){A.profileGrid.updateCellbyRowCol("properties:width","value",C.width,true)}if(C.height!==null){A.profileGrid.updateCellbyRowCol("properties:height","value",C.height,true)}})}},_posUpdated:function(D,A){var C,B=this;if(!(C=B.profileGrid.get(0).$widget)){return }if(linb.cache.dom[D.get(0).id]==C.get(C.length()-1)){_.asyRun(function(){if(A.left!==null){B.profileGrid.updateCellbyRowCol("properties:left","value",A.left,true)}if(A.top!==null){B.profileGrid.updateCellbyRowCol("properties:top","value",A.top,true)}})}},parseFun:function(A){var C=A;var B=new RegExp("^(\\s*\\/\\*[^*@]*\\*+([^\\/][^*]*\\*+)*\\/\\s*)|^(\\s*\\/\\/[^\\n]*\\s*)");while(B.test(C)){C=C.replace(B,"")}C=C.replace(/\s*/,"");if(!C){return{comments:null,code:null}}if(false===this.check(C.replace(/\s*$/,""))){return false}return{comments:"\n"+A.replace(C,""),code:C.replace(/\s*$/,"")}},_designable:function(B){var C=arguments.callee,A=this;A._giveHandler(B);B.properties.$design=A.properties.$design;if(linb.cache.$dropPool[B.box.KEY]){A._enablePanelDesign(B)}if(B.children&&B.children.length){B.children.each(function(D){C.call(A,D[0])})}B.$addOns=C;B.$addOns.target=A},_WidgetsSelected:function(B){var A=this;this._setSelected(B,true);this.iconlist.updateUIValue(null)},_clearSelect:function(A){this.resizer.resetTarget(null,false);this._detatchResizer();this.iconlist.updateUIValue(null)},_deleteSelected:function(){if(!this.tempSelected||!this.tempSelected.length){return }var A=this;linb.UI.Dialog.confirm(linb.getRes("VisualJS.designer.confirmdel"),linb.getRes("VisualJS.designer.confirmdel2",this.tempSelected.length),function(){var D=linb.UI.getByCacheId(A.tempSelected);if(!D.isEmpty()){var C=[];var B=linb.UI.getByCacheId(A.tempSelected);B.each(function(F){if(!F.box.hasDomRoot){A.iconlist.removeItems(F.$id)}});B.destroy()}else{var E=linb.getObject(A.tempSelected[0]);if(E.box["linb.DataSource"]){A.iconlist.removeItems(A.tempSelected)}E.boxing().destroy()}A._clearSelect(A.pProfile);A._setSelected(null,true)})},_giveHandler:function(C){var D=function(F){var E=F.split(":");return E[0].split("-")[0]+":"+E[1]+":"},A=function(){return };var B=this;C.root.beforeClick(A).afterClick(A).onClick(function(K,I,J){var E=linb.event.getSrc(I),L=E.id;if(L==linb.langId){L=E.parentNode.id}if(D(L)!=(L=D(J.id))){return }var G,F=linb.event.currentKey,H=linb.cache.dom[L];if(!H){return }if(B.pProfile&&(B.pProfile!=H.parent)){B.pProfile.selected=[]}if(G=H.parent){if(F&&F[2]){G.reSelectObject.call(G,H,H.root.parent())}else{G.selectObject.call(G,H,H.root.parent())}}return false})},_enablePanelDesignFace:function(B,A){B.getSubNode(A,true).addClass("panel").addEventHandler("drop").addEventHandler("mousedown").addEventHandler("click").addEventHandler("drag").addEventHandler("dragstop").addEventHandler("mouseup")},_enablePanelDesign:function(A){var J,I=A.box.KEY,F=linb.cache.$dropPool,G=this,E,C,K=this,B={beforeMouseover:function(N,P,Q){var L=linb.dragDrop,M=L.dragKey,O=L.data;if(!M||!O||!(new RegExp("\\b"+M+"\\b")).test(N.box.getDropKeys(N,this))||O.parentId==N.$id||(O.data&&O.data.exists(N.$id))||(N.onDropTest&&(false===N.boxing().onDropTest(N,M,O)))){return }L._current=Q;_.resetRun("showDDMark",L.showDDMark,0,[this],L);var R=(R=N.getItemByDom(Q))&&R.id;if(N.onDragEnter){N.boxing().onDragEnter(N,P,this,R)}},beforeDrop:function(M,c,U){K._change();var f,Y=linb.dragDrop.x,X=linb.dragDrop.y,W=linb.dragDrop.dragKey,P=linb.dragDrop.dragData,O=P.type,T=P.iconPos,g=P.data,S=P.pos,Z,R=K.dropOffset,d=function(){var l=arguments.callee.page;if(!linb.SC(O).hasDomRoot){var q=linb.create(O,{$design:K.properties.$design}).get(0);l.iconlist.insertItems([{id:q.$id,icon:"img/widgets.gif",iconPos:T}],null,false);l.iconlist.updateUIValue(q.$id)}else{if(K.dropPosition=="absolute"){var h=linb(U).absPos(),e={left:parseInt((Y-h.left)/R)*R,top:parseInt((X-h.top)/R)*R};f=new (linb.SC(linb.iBox.$type[O]))({$design:K.properties.$design});f.create();var m=f.get(0).properties;if(!m.$left){f.setLeft(["top","bottom","width","fill","cover"].exists(m.dock)?0:e.left)}if(!m.$top){f.setTop(["left","right","height","fill","cover"].exists(m.dock)?0:e.top)}if(!m.$position){f.setPosition("absolute")}f.setZIndex(1)}else{f=new (linb.SC(linb.iBox.$type[O]))({$design:K.properties.$design});f.create()}var n=f.get(0);l._designable(n);n._host=l;var k=n.box.$EventHandlers;for(var j in k){n[j]=k[j]}Z=[f["linb.iBox"]?n.$id:f.$id];if(f["linb.UI"]){M.boxing().attach(f,M.getItemIdByDom(U))}M.setSelectFromPanel.call(M,U,Z);U=null}};d.page=G;if(O){if(linb.SC.evalPath(O)){d()}else{linb.dom.UIAction(function(){linb.dom.setCover(linb.getRes("VisualJS.designer.loading")+O);linb.SC(O,true,d)})}}else{var L=linb(U).absPos(),b={left:parseInt((Y-L.left)/R)*R,top:parseInt((X-L.top)/R)*R};var V;Z=g;f=linb.UI.getByCacheId(Z);var Q,N;f.each(function(h,e){if(e===0){Q=h.properties.left;N=h.properties.top}else{Q=Math.min(h.properties.left,Q);N=Math.min(h.properties.top,N)}});f.each(function(e){if(e.properties.dock!="none"){e.box.dock(e,true)}else{e.boxing().setLeft(e.properties.left-Q+b.left).setTop(e.properties.top-N+b.top)}});M.boxing().attach(f,M.getItemIdByDom(U));M.setSelectFromPanel.call(M,U,Z)}},onMousedown:function(O,P,R){if(linb.event.getSrc(P)!==R){return }var Q=linb(R),S=linb.event.getPos(P),L=Q.absPos(),M=Q.clientWidth(),N=Q.clientHeight();if(S.left-L.left>M){return }if(S.top-L.top>N){return }O._offsetPos=L;O._scrollTop=Q.scrollTop();O._scrollLeft=Q.scrollLeft();G._attachResizer(O,R);O._selregion={};var S=linb.event.getPos(P);linb(R).startDrag(P,{move:false,type:"blank",cursor:"crosshair",target_left:S.left,target_top:S.top,defer:1});O.$dragging=false},onClick:function(L,M,N){if(linb.event.getSrc(M)!==N){return }K._clearSelect(L);L.setSelectFromPanel.call(L,this,[])},beforeDrag:function(O,Q,R){var N,L=linb.dragDrop,S=L.getOffset(),M=G.proxy;var P=O._selregion;if((N=S.x)<0){S.x=-N}if((N=S.y)<0){S.y=-N}P.left=Math.min(L.ox,L.x)-O._offsetPos.left+O._scrollLeft;P.top=Math.min(L.oy,L.y)-O._offsetPos.top+O._scrollTop;P.width=S.x;P.height=S.y;M.setRegion(P);if(!O.$dragging){M.display("block");O.$dragging=true}},beforeDragstop:function(P,d,T){var R=P._selregion,Z=G.proxy,W=[],U,Y,X,c,O,b,N,S,M,Q,L,V=this;S=R.left;M=R.top;Q=S+R.width;L=M+R.height;if(Y=P.children){Y.each(function(e,f){e=e[0];if(e.domNode.parentNode===V){X=e.root;c=X.offsetLeft();O=X.offsetTop();b=c+X.width();N=O+X.height();if(Q>c&&b>S&&L>O&&N>M){W.push(e.$id)}}});P.setSelectFromPanel.call(P,this,W)}_.asyRun(function(){Z.display("none")})},onMouseup:function(L,M,N){_.asyRun(function(){G.proxy.display("none")})}};var H=A.properties.dropKeys.split(/[^\w]+/);H.filter(function(L){return !!L});if(H.indexOf("iDesign")==-1){H.push("iDesign")}A.properties.dropKeys=H.join(":");if(J=F[I]){var D=J[0];if(A.keys.KEY==A.keys[D]){E=B}else{E={};E[D]=B}A._CB=E;A.resetCache();G._enablePanelDesignFace(A,D)}_.merge(A,{selectObject:function(N,M){var L=this,O=N.$id;return this.setSelectFromPanel(M,[O])},reSelectObject:function(N,M){var L=this;id=N.$id;if(L.selected&&L.selected.exists(id)){L.selected.removeValue(id)}else{(L.selected||(L.selected=[])).push(id)}return this.setSelectFromPanel(M,L.selected)},setSelectFromResizer:function(M){var L=this;L.selected=M;return this.resetSelectRel()},setSelectFromPanel:function(N,M){var L=this;if(K.pProfile!==L||K.pNode!==N){K._clearSelect(L);K._attachResizer(L,N)}L.selected=M;K.resizer.resetTarget(linb.UI.getByCacheId(L.selected).reBoxing(),false);return this.resetSelectRel()},resetSelectRel:function(){var M=this;if(M.selected&&M.selected.length){var L=K.resizer.get(0).properties;L.dragArgs={key:"iDesign",grid_width:K.dropOffset,grid_height:K.dropOffset,data:{parentId:M.$id,data:M.selected}}}else{K._clearSelect(M)}_.tryF(K._WidgetsSelected,[M.selected],K);K._focus()}},"all")},_refreshProfileGrid:function(B){var L=this;this.profileGrid.resetContent();if(!B||!B.length){var M=this.canvas.get(0);var I=[];var G=_.get(this.properties.clsObject,["Static","EventHandlers"]);if(!G){G=linb.Com.EventHandlers}var E=_.get(this.properties.clsObject,["Instance","events"]);var D=function(T){var R;var S=_.get(T.clsStruct,["sub","Instance","sub","events","code"]);if(S){S=_.unserialize(S)}else{S={}}var Q=S[T.funName]||("_"+T.funName.toLowerCase());var Y=_.get(T.clsStruct,["sub","Instance","sub",Q]);var V=(Y?(Y.comments||""):"");if(V){V=V.replace(/^[\r\n]*/,"")}if(Y&&Y.code){R=Y&&Y.code;T.mapName=S[T.funName]}else{if(!T.ini){return""}R=" ".repeat(8)+T.ini.toString().replace(/\n/g,"\n"+" ".repeat(8));T.mapName="_"+T.funName.toLowerCase();var W=_.get(T.clsStruct,["sub","Instance","sub"]);if(W[T.mapName]){var U=1,X;while(W[X=T.mapName+"_"+(++U)]){}T.mapName=X}}return V+R};_.each(G,function(T,R){var Q=function(V,U){var X=U.$tagVar;var W=V.getSubNode("CELL",U._serialId);linb.ComFactory.newCom("VisualJS.ObjectEditor",function(){this.host=L;this.setProperties({icon:"img/App.gif",iconPos:"-32px -32px",text:D(X),caption:X.widgetName+" => "+X.funName,fromRegion:W.getRegion(true),tagVar:X,onOK:function(b){this._change();var Z=b.properties.tagVar;if(b.properties.result.code!==null){_.set(Z.clsStruct,["sub","Instance","sub",Z.mapName,"code"],b.properties.result.code);_.set(Z.clsStruct,["sub","Instance","sub",Z.mapName,"comments"],b.properties.result.comments);V.box.changeCellValue(V,U,Z.mapName,true)}else{_.set(Z.clsStruct,["sub","Instance","sub",Z.mapName,"code"],null);_.set(Z.clsStruct,["sub","Instance","sub",Z.mapName,"comments"],null);var Y=_.get(Z.clsStruct,["sub","Instance","sub","events","code"]);if(Y){Y=_.unserialize(Y);delete Y[Z.funName];_.set(Z.clsStruct,["sub","Instance","sub","events","code"],_.serialize(Y))}V.box.changeCellValue(V,U,"",true)}W.focus()}});this.show(linb([document.body]))})},S={widgetName:"page",obj:this.properties.clsObject,clsStruct:this.properties.clsStruct,clsObject:this.properties.clsObject,funName:R,mapName:(E&&E[R])||"",ini:T};I.push({id:"event:"+R,cells:[{value:R,type:null,$tagVar:null,event:null},{value:(E&&E[R])||"",type:"popbox",$tagVar:S,event:Q}]})},this);var P=[{id:"alias",cells:[{value:"alias",type:"label"},{value:"page",type:"label"}]},{id:"properties:width",cells:[{value:"width",type:"label"},{value:M.properties.width,type:""}]},{id:"properties:height",cells:[{value:"height",type:"label"},{value:M.properties.height,type:""}]},{id:"UIE",cells:[{value:"events",type:"label"},{value:"",type:"label"}],sub:I}];var K=[];this.profileGrid.insertRows(P);this.profileGrid.get(0).$widget=this.canvas}else{var O,J,N=linb.UI.getByCacheId(B);if(J=N.length()){var M=N.get(this.SelectedFocus);var A=[0,0,0,0,0,0,0,0],H=0;var F=function(R,Q){var U=Q.$tagVar;var S=R.getSubNode("CELL",Q._serialId);var T=U.profile[U.name];linb.ComFactory.newCom("VisualJS.ObjectEditor",function(){this.host=L;this.setProperties({caption:U.widgetName+" => "+U.name,icon:"img/App.gif",iconPos:T.constructor==Array?"-128px -32px":"-16px -32px",text:linb.coder.decode(_.serialize(linb.UI.pickObj(T))),fromRegion:S.getRegion(true),tagVar:U,onOK:function(W){this._change();var V=W.properties.tagVar;V.profile.boxing()[V.funName](W.properties.object);S.focus()}});this.show(linb([document.body]))})};var P=[{id:"key",cells:[{value:"class",type:"label"},{value:"<strong>"+M.key+"</strong>",type:"label"}]},{id:"alias",cells:[{value:"alias",type:"label"},{value:M.alias,type:""}]},{id:"template",cells:[{value:"template",type:""},{value:M.template._id,type:"listbox",listKey:M.box.KEY+":template"}]},{id:"appearance",cells:[{value:"appearance",type:""},{value:M.appearance,type:"listbox",listKey:M.box.KEY+":appearance"}]},{id:"behavior",cells:[{value:"behavior",type:""},{value:M.behavior._id,type:"listbox",listKey:M.box.KEY+":behavior"}]},{id:"properties",cells:[{value:"properties",type:"label"},{value:"",type:"label"}],sub:[]},{id:"UIE",cells:[{value:"events",type:"label"},{value:"",type:"label"}],sub:[]},{id:"CA",cells:[{value:"Custom Appearances",type:"label"},{value:"(Collection)",event:F,$tagVar:{name:"CA",funName:"setCustomAppearance",profile:M},type:"popbox:readonly"}]},{id:"CC",cells:[{value:"Custom Class",type:"label"},{value:"(Collection)",event:F,$tagVar:{name:"CC",funName:"setCustomClass",profile:M},type:"popbox:readonly"}]},{id:"CB",cells:[{value:"Custom Behaviors",type:"label"},{value:"(Collection)",event:F,$tagVar:{name:"CB",funName:"setCustomBehavior",profile:M},type:"popbox:readonly"}]},{id:"CF",cells:[{value:"Custom Functions",type:"label"},{value:"(Collection)",event:F,$tagVar:{name:"CF",funName:"setCustomFunction",profile:M},type:"popbox:readonly"}]}];var I=[],C=CONF.mapWidgets[M.box.KEY];O=C&&C.Templates;if(!O){O=[]}if(!O.exists("default")){O.insertAny("default",0)}O.each(function(Q){I.push({id:Q,caption:Q,value:Q})});linb.UI.setCacheList(M.box.KEY+":template",I);I=[];O=C&&C.Appearances;if(!O){O=[]}if(!O.exists("default")){O.insertAny("default",0)}O.each(function(Q){I.push({id:Q,caption:Q,value:Q})});linb.UI.setCacheList(M.box.KEY+":appearance",I);I=[];O=C&&C.Behaviors;if(!O){O=[]}if(!O.exists("default")){O.insertAny("default",0)}O.each(function(Q){I.push({id:Q,caption:Q,value:Q})});linb.UI.setCacheList(M.box.KEY+":behavior",I);I=[];N.each(function(R,Q){if(Q===J-1){return }if(!A[0]&&R.key!=M.key){A[0]=1;H++}if(!A[1]){P[1].cells[1].type="label";A[1]=1;H++}if(!A[2]&&R.template._id!=M.template._id){P[2].cells[1].type="label";A[2]=1;H++}if(!A[3]&&R.appearance!=M.appearance){P[3].cells[1].type="label";A[3]=1;H++}if(!A[4]&&R.behavior._id!=M.behavior._id){P[4].cells[1].type="label";A[4]=1;H++}if(!A[5]){P[5].cells[1].type="label";A[5]=1;H++}if(H==6){return false}});this.profileGrid.insertRows(P);this.profileGrid.get(0).$widget=N}else{N=linb.Base.getByCacheId(B[0]);M=N.profile;var P=[{id:"key",cells:[{value:"class",type:"label"},{value:M.key,type:"label"}]},{id:"alias",cells:[{value:"alias",type:"label"},{value:M.alias,type:""}]},{id:"properties",cells:[{value:"properties",type:"label"},{value:"",type:"label"}],sub:[]},{id:"UIE",cells:[{value:"events",type:"label"},{value:"",type:"label"}],sub:[]}];this.profileGrid.insertRows(P);this.profileGrid.get(0).$widget=N}}},_change:function(){this._dirty=true;_.tryF(this.events.onValueChanged,[this,null,this._dirty],this.host)},$toolbar_onclick:function(G,C,H,B){var K=this;switch(H){case"code":switch(C){case"format":case"json":linb.dom.UIAction(function(){var R=new linb.UI.Dialog();R.setLeft(100).setTop(100).setWidth(300).setHeight(200).setStatus("max").setMinBtn(false).setMaxBtn(false).setCaption("Formatted code");R.create();var Q,P;if(K.tempSelected&&K.tempSelected.length){P=[];K.tempSelected.each(function(T){P.push(linb.Profile.getFromCacheId(T))})}else{P=K.getWidgets()}var S;switch(C){case"format":S=linb.coder.parse(K.getJSCode(P),"js",["plain"]);break;case"json":S=linb.coder.format(K.getJSONCode(P),"js",["plain"]);break}R.html(S);R.show(linb(document.body),true)});break}break;case"align":this._change();var F=linb.UI.getByCacheId(this.tempSelected);var D=F.get(this.SelectedFocus),E=D.getSubNode("KEY"),O=E.cssSize(),M=E.cssPos();F.each(function(Q){if(Q.locked){return }var P=Q.getSubNode("KEY");switch(C){case"left":P.left(M.left);Q.boxing().refreshLeft();break;case"center":P.left(M.left+O.width/2-P.width()/2);Q.boxing().refreshLeft();break;case"right":P.left(M.left+O.width-P.width());Q.boxing().refreshLeft();break;case"top":P.top(M.top);Q.boxing().refreshTop();break;case"middle":P.top(M.top+O.height/2-P.height()/2);Q.boxing().refreshTop();break;case"bottom":P.top(M.top+O.height-P.height());Q.boxing().refreshTop();break;case"w":P.width(O.width);Q.boxing().refreshWidth();break;case"wh":P.width(O.width).height(O.height);Q.boxing().refreshWidth();Q.boxing().refreshHeight();break;case"h":P.height(O.height);Q.boxing().refreshHeight();break}});this.resizer.rePosSize();this._focus();break;case"pos":this._change();var F=linb.UI.getByCacheId(this.tempSelected);var K=this;if("clone"==C){var A=[];var N,A=[],I;var B=linb.UI.getByCacheId(this.tempSelected);var J=B.clone();B.get(0).parent.boxing().attach(J);I=B.get(0).parent.$id;J.each(function(P){A.push(P.$id)});J.each(function(P){K._designable(P)});this.resizer.resetTarget(linb(J));linb.message(linb.getRes("VisualJS.designer.colneOK",A.length));return }var L=0;F.each(function(W){var R=W.boxing();var U=R.reBoxing();switch(C){case"zindex1":if(W.locked){return }if(!L){L=U.topZindex()}U.zIndex(L+1);R.refreshZIndex();break;case"zindex2":if(W.locked){return }U.zIndex(0);R.refreshZIndex();break;case"repos":case"resize":if(W.locked){return }var Q=U.left(),S=U.top(),V=K.dropOffset;U.left(parseInt(Q/V)*V).top(parseInt(S/V)*V);if(C=="resize"){var P=U.width(),T=U.height();U.width((parseInt((P+V-1)/V))*V).height((parseInt((T+V-1)/V))*V)}K.resizer.rePosSize();R.refreshLeft();R.refreshTop();R.refreshWidth();R.refreshHeight();break}});this._focus();break;case"del":this._change();if("delete"==C){this._deleteSelected()}break}},$profilegrid_afterrowactive:function(A,B){A.box.editCellbyRowCol(A,B.id,"value");return false},$profilegrid_beforevalueupdated:function(C,N,D,H){this._change();var J=this;try{var I,O,K,A,M,L,G=C.$widget;L=H;if((I=N._row.id.split(":")).length>1){K=I[0];M=I[1]}else{M=N._row.id}switch(K){case"properties":A="set"+M.initial();if(G.get(0)==this.canvas.get(0)){this.canvas[A](L);this.panelBG[A](L)}else{G.each(function(P){P.boxing()[A](L)});if(["left","top","width","height","right","bottom","dock","dockOrder"].exists(M)){this.resizer.rePosSize()}}break;case"event":if(G.get(0)==this.canvas.get(0)){if(H){var B=_.get(J.properties.clsStruct,["sub","Instance","sub","events","code"]);if(B){B=_.unserialize(B)}else{B={}}B[M]=H;_.set(J.properties.clsStruct,["sub","Instance","sub","events","code"],_.serialize(B));_.set(J.properties.clsStruct,["sub","Instance","sub","events","comments"],_.get(J.properties.clsStruct,["sub","Instance","sub","events","comments"]||"\n"+" ".repeat(8)));_.set(J.properties.clsObject,["Instance","events",M],H)}}else{G.each(function(P){if(H){P[M]=H;_.set(J.properties.clsObject,["Instance",M],H)}else{delete P[M]}})}break;default:if(M=="alias"){var E=this.getNames();if(E[L]){linb.message(linb.getRes("VisualJS.designer.nameExists",L));return false}this.listObject.setCtrlValue(L,true)}G[M](L)}}catch(F){throw (F);return false}},$profilegrid_onrequestdata:function(C,S,I){var D,B=[],H,E=this,L=S.id,K=this,A=C.$widget,Q=A.length();var U=A.get(Q-1),N=U.box.$DataModel,P,T,R,G,F,O,M;if(L=="properties"){_.each(U.box.$DataStruct,function(X,V){if(["_","$"].exists(V.charAt(0))){return }if(N[V].hidden){return }R=null;G="";D="";if(N[V].readonly){T="";type="label"}else{if(N[V].listbox){type="listbox";R=[];T=U.key+":properties:"+V;if(_.isFun(N[V].listbox)){var W=N[V].listbox;R=function(){var Y=W.call(U),Z=[];Y.each(function(b){Z.push({id:b,caption:b,value:b})});return Z}}else{if(_.isObj(N[V].listbox[0])){R=N[V].listbox.copy()}else{N[V].listbox.each(function(Z,Y){R.push({id:Z,caption:Z})})}}linb.UI.setCacheList(T,R)}else{if(N[V].combobox){type="combobox";R=[];if(_.isFun(N[V].combobox)){var W=N[V].combobox;R=function(){var Y=W.call(U),Z=[];Y.each(function(b){Z.push({id:b,caption:b})});return Z}}else{if(_.isObj(N[V].combobox[0])){R=N[V].combobox.copy()}else{N[V].combobox.each(function(Z,Y){R.push({id:Z,caption:Z})})}}T=U.key+":properties:"+V;linb.UI.setCacheList(T,R)}else{if(N[V].helpinput){T=U.key+":properties:"+V;type="helpinput";R=N[V].helpinput.copy();linb.UI.setCacheList(T,R)}else{if(N[V].trigger){T="";type="getter";M=V;F=function(b,Y,e){var d=Y.$tagVar;var c=d.profile.boxing()["trigger"+d.name.initial()];_.tryF(c,null,d.profile.boxing());var Z="try again";e.boxing().updateUIValue(Z);b.box.changeCellValue(b,Y,Z,true)};O={profile:U,name:V}}else{if(_.isBool(X)){T="";type="checkbox";G=V}else{if(_.isObj(X)){T="";type="popbox:readonly";G=null;F=function(Z,Y){var d=Y.$tagVar;var b=Z.getSubNode("CELL",Y._serialId);var c=d.profile.boxing()["get"+d.name.initial()]();linb.ComFactory.newCom("VisualJS.ObjectEditor",function(){this.host=E;this.setProperties({caption:d.widgetName+" => "+d.name,icon:"img/App.gif",iconPos:c.constructor==Array?"-128px -32px":"-16px -32px",text:linb.coder.decode(_.serialize(linb.UI.pickObj(c))),fromRegion:b.getRegion(true),tagVar:d,onOK:function(h){this._change();var g,f=h.properties.tagVar;f.profile.boxing()["set"+d.name.initial()](h.properties.object);if(["dockMargin"].exists(d.name)){K.resizer.rePosSize()}b.focus();if(d.name=="items"){if(null===h.properties.object){f.profile.boxing().setItems([])}if(g=linb.cache.$dropPool[f.profile.box.KEY]){var e=g[0];K._enablePanelDesignFace(f.profile,e)}}}});this.show(linb([document.body]))})};O={widgetName:U.alias,profile:U,name:V};D="(Collection)"}else{T="";type=""}}}}}}}D=D||U.properties[V];if(_.isStr(D)){}B.push({id:"properties:"+V,cells:[{value:V,type:"",$tag:"",event:"",$tagVar:"",listKey:""},{value:D,type:type,$tag:G,event:F,$tagVar:O,listKey:T}]})})}B.sort(function(V,W){V=V.cells[0].value;W=W.cells[0].value;return V>W?1:V==W?0:-1});if(L=="UIE"){var J=function(d){var Z;var b=typeof d.profile[d.funName]=="string"?d.profile[d.funName]:("_"+d.widgetName.toLowerCase()+"_"+d.funName.toLowerCase());var Y=_.get(d.clsStruct,["sub","Instance","sub",b]);var c=(Y?(Y.comments||""):"");if(c){c=c.replace(/^[\r\n]*/,"")}if(Y&&Y.code){Z=Y&&Y.code;d.mapName=b}else{Z=" ".repeat(8)+d.ini.toString().replace(/\n/g,"\n"+" ".repeat(8));d.mapName="_"+d.widgetName.toLowerCase()+"_"+d.funName.toLowerCase();var X=_.get(d.clsStruct,["sub","Instance","sub"]);if(X[d.mapName]){var W=1,V;while(X[V=d.mapName+"_"+(++W)]){}d.mapName=V}}return c+Z};F=function(W,V){var Y=V.$tagVar;var X=W.getSubNode("CELL",V._serialId);linb.ComFactory.newCom("VisualJS.ObjectEditor",function(){this.host=E;this.setProperties({icon:"img/App.gif",iconPos:"-32px -32px",caption:Y.widgetName+" => "+Y.funName,text:J(Y),fromRegion:X.getRegion(true),tagVar:Y,onOK:function(b){this._change();var Z=b.properties.tagVar;if(b.properties.result.code!==null){_.set(Z.clsStruct,["sub","Instance","sub",Z.mapName,"code"],b.properties.result.code);_.set(Z.clsStruct,["sub","Instance","sub",Z.mapName,"comments"],b.properties.result.comments);Z.profile[Z.funName]=Z.mapName;W.box.changeCellValue(W,V,Z.mapName,true)}else{_.set(Z.clsStruct,["sub","Instance","sub",Z.mapName,"code"],null);_.set(Z.clsStruct,["sub","Instance","sub",Z.mapName,"comments"],null);Z.profile[Z.funName]=Z.profile.box.$EventHandlers[Z.funName];W.box.changeCellValue(W,V,"",true)}X.focus()}});this.show(linb([document.body]))})};_.each(U.box.$EventHandlers,function(W,V){O={profile:U,clsStruct:E.properties.clsStruct,widgetName:U.alias,funName:V,ini:W};B.push({id:"event:"+V,cells:[{value:V,type:null,$tagVar:null},{value:typeof U[V]=="string"?U[V]:"",type:"popbox",$tagVar:O,event:F}]})})}A.each(function(Y,X){if(X===(Q-1)){return }if(L=="properties"){var W=[],V=0;B.each(function(b,Z){if(V==B.length){return false}if(!W[Z]&&Y.properties[b.cells[0].value]!==U.properties[b.cells[0].value]){b.cells[1].type="label";W[Z]=1;V++}})}if(L=="UIE"){B.length=0}});linb.thread(I).setCache("response",B)},$iconlist_aftervalueupdated:function(C,B,A){if(A){this.resizer.resetTarget(null,false);this._setSelected([A],true)}},$listobject_onlistshow:function(C,G){var F=this;if(!F.objlistBlock){F.objlistBlock=new linb.UI.Block({width:200,height:200,shadow:true});F.frame=linb.create('<div style="z-index:2000;background-color:red;position:absolute;font-size:0;line-height:0;display:none;">').opacity(0.3);linb(document.body).addLast(F.frame);F.treebarObj=new linb.UI.TreeBar({group:false,selMode:"none",caption:null},{onItemSelected:function(H,I,J){F.selectWidget(I.id);H.parent.root.display("none");F.frame.display("none");H.boxing().clearItems();_.asyRun(function(){F._focus()})},beforeHoverEffect:function(I,J,K,H){if(!J){return }if(J.id==this.canvas.get(0).$id){return }if(H=="mouseover"){_.resetRun("",function(){var L=linb._object[J.id];if(L&&(L=L.root)){F.frame.setRegion(L.getRegion(true)).display("block")}},100)}else{_.resetRun("",function(){F.frame.display("none")},100)}}},F);F.objlistBlock.attach(F.treebarObj).create()}var B=[];var A=function(L,I,N){var H=arguments.callee,J,M={id:L.$id,caption:L.alias,icon:(J=N[L.box.KEY])?J.icon:"",iconPos:(J=N[L.box.KEY])?J.iconPos:""};I.push(M);if(L.children&&L.children.length){var K=[];M.sub=K;L.children.each(function(O){H.call(null,O[0],K,N)})}};A(F.canvas.get(0),B,CONF.mapWidgets);F.treebarObj.setItems(B).toggleNode(F.canvas.get(0).$id,true);var E=F.objlistBlock.reBoxing();E.popToTop(C.root);var D=function(){E.display("none");F.treebarObj.clearItems();F.frame.display("none");linb.event.hookKey("esc",0,0,0,null)};E.setBlurTrigger("design:pop:objecttree",D);linb.event.hookKey("esc",0,0,0,D)},getWidgets:function(B){if(!B){this._clearSelect(this.canvas.get(0))}var A=[],D=this.canvas.get(0).children;D.each(function(E){A.push(E[0])});var C=this.iconlist.getItems();if(C&&C.length){C.each(function(F,E){A.push(linb.Profile.getFromCacheId(F.id))})}A.clean();return A},getJSONCode:function(A){A.sort(function(B,C){B=parseInt(B.properties.tabindex)||0;C=parseInt(C.properties.tabindex)||0;return B>C?1:B==C?0:-1});return"return this._nodes = linb.create("+_.serialize(A)+").get();"},getJSCode:function(B){B.sort(function(E,F){E=parseInt(E.properties.tabindex)||0;F=parseInt(F.properties.tabindex)||0;return E>F?1:E==F?0:-1});var D=this,C,A=[];A.push("// [[code created by designer, don't change it manually\n");A.push("var t=this, n=t._nodes=[], u=linb.UI, f=function(c){n.push(c.get(0))};");fun=function(L,I,G,H){var M=arguments.callee,K=L.box["linb.UI"],F=L.beforeSerialized(),E=F.alias,J;delete F.id;if(F.properties&&F.properties.dropKeys){F.properties.dropKeys=F.properties.dropKeys.replace(/\biDesign\b/,"").replace(/[^\w]+/g,":").replace(/^[^\w]+/,"").replace(/[^\w]+$/,"");if(F.properties.dropKeys==L.box.$DataStruct.dropKeys){delete F.properties.dropKeys}}if(_.isEmpty(F.properties)){delete F.properties}if(_.isEmpty(F.events)){delete F.events}if(_.isEmpty(F.CA)){delete F.CA}if(_.isEmpty(F.CC)){delete F.CC}if(_.isEmpty(F.CB)){delete F.CB}if(_.isEmpty(F.CF)){delete F.CF}H.push("\n\n");if(I){H.push(I+".attach(")}else{H.push("f(")}H.push("\n(new "+F.key.replace("linb.UI","u")+")");H.push('\n.host(t,"'+E+'")');if(F.template){H.push('\n.template("'+F.template+'")')}if(F.behavior){H.push('\n.behavior("'+F.behavior+'")')}if(F.appearance){H.push('\n.appearance("'+F.appearance+'")')}if(F.properties){_.each(F.properties,function(O,N){H.push("\n.set"+N.initial()+"("+_.serialize(O)+")")})}if(F.events){_.each(F.events,function(O,N){H.push("\n."+N+"("+_.serialize(O)+")")})}if(F.CA){H.push("\n.setCustomAppearance("+_.serialize(F.CA)+")")}if(F.CC){H.push("\n.setCustomClass("+_.serialize(F.CC)+")")}if(F.CB){H.push("\n.setCustomBehavior("+_.serialize(F.CB)+")")}if(F.CF){H.push("\n.setCustomFunction("+_.serialize(F.CF)+")")}if(I){H.push("\n"+(G?(", "+G):"")+");")}else{H.push("\n);")}if(L.children&&L.children.length){L.children.each(function(R){var O=R[0],N=[],Q;for(var P=1;P<R.length;P++){switch(typeof R[P]){case"number":N.push(R[P]);break;case"string":N.push("'"+R[P]+"'");break}}if(N.length){Q=N.join(",")}else{Q=null}M.call(this,O,"t."+E,Q,H)},this)}};B.each(function(E){fun(E,null,null,A)});A.push("\n\n");A.push("return n;\n");A.push("// ]]code created by designer");return A.join("")},getClassList:function(B){var D=this,C,E={};var A=function(G){var F=arguments.callee;E[G.box.KEY]=1;if(G.children&&G.children.length){G.children.each(function(H){F.call(null,H[0])})}};B.each(function(F){A(F)});return _.toArr(E,true)},getNames:function(){var B=this.getWidgets(true);var D=this,C,E={};var A=function(G){var F=arguments.callee;E[G.alias]=1;if(G.children&&G.children.length){G.children.each(function(H){F.call(null,H[0])})}};B.each(function(F){A(F)});return E},selectWidget:function(C){var A=linb.UIProfile.getFromCacheId(C);var B=A.parent;if(B.setSelectFromPanel){B.setSelectFromPanel.call(B,A.root.parent(),C);this._setSelected([C],true)}else{this._clearSelect();this._setSelected(null,true)}},activate:function(){},resetEnv:function(A){this._dirty=false;this.properties.text=A||this.getText();this._clearSelect();this._setSelected([],true)},setText:function(A,B,G){A=A.replace(/\r\n/g,"\n");if(B||this.properties.text!=A){this.properties.text=A;var D=this.properties.clsStruct;var F=this.properties.clsObject;var C=_.get(D,["sub","Instance","sub","iniComponents","code"]);if(C==this.properties.comCode){return this}var E=this;linb.thread.asyUI(G,[function(){linb.dom.setCover(linb.getRes("VisualJS.designer.emptyContent"))},function(){E.canvas.reBoxing().empty().gc();linb.dom.setCover(linb.getRes("VisualJS.designer.prepare"))},function(H){linb.thread.suspend(H);linb.SC.group(F.Instance.required,function(I){linb.dom.setCover(linb.getRes("VisualJS.designer.loading")+" "+I+"...")},function(){linb.dom.setCover(linb.getRes("VisualJS.designer.createContent"));linb.thread.resume(H)})},function(){try{var H=F.Instance.iniComponents.call(null);E.iconlist.clearItems();var I=[];H.filter(function(K){if(!K.box.hasDomRoot){I.push(K);return false}});E.canvas.attach(linb.UI.pack(H,false));H.each(function(K){E._designable(K)});I.each(function(K){K.properties.$design=E.properties.$design;E.iconlist.insertItems([{id:K.$id,icon:"img/widgets.gif",iconPos:CONF.mapWidgets[K.box.KEY].iconPos}],null,false)});if(E.layoutBase.reBoxing().display()=="none"){E.layoutBase.reBoxing().display("block");E.layoutBase.reBoxing().parent().background("")}}catch(J){E.iconlist.clearItems();E.canvas.reBoxing().empty().gc();E.layoutBase.reBoxing().display("none");E.layoutBase.reBoxing().parent().background("url(img/error.gif)");linb.message(linb.getRes("VisualJS.designer.comCodeErr"));linb.message(_.Error(J))}}])}this.resetEnv(A);return this},getText:function(){if(this._dirty){var B=this.getWidgets(),C=this.properties.clsStruct.sub.Instance;if(!B.length){if(_.get(C,["sub","iniComponents","comments"])){_.set(C,["sub","iniComponents","comments"],null)}}else{if(!_.get(C,["sub","iniComponents","comments"])){_.set(C,["sub","iniComponents","comments"],"\n"+" ".repeat(8))}C.sub.iniComponents.code=("function(){\n"+this.getJSCode(B)).replace(/\n/g,"\n"+" ".repeat(12))+"\n"+" ".repeat(8)+"}"}var A=this.properties.clsObject.Instance.required||[];A.merge(this.getClassList(B));_.set(C,["sub","required","code"],_.serialize(A));if(!_.get(C,["sub","required","comments"])){_.set(C,["sub","required","comments"],"\n"+" ".repeat(8))}return VisualJS.ClassTool.getCodeFromStruct(this.properties.clsStruct)}return this.properties.text},iniComponents:function(){var B=this,D=B._nodes=[],A=linb.UI,C=function(E){D.push(E.get(0))};C((new A.Layout).host(B,"layoutBase").setLeft(0).setTop(0).setItems([{"id":"main","min":10},{"id":"after","pos":"after","locked":false,"cmd":false,"size":270,"min":100,"max":300,"hide":false}]).setType("horizontal"));B.layoutBase.attach((new A.IconList).host(B,"iconlist").setDock("bottom").setHeight(20).setItemWidth(16).setItemHeight(16).setItemPadding(1).setZIndex(10).setItems([]).setCustomAppearance({KEY:"background:#FFFACD","ITEMS":"padding:2px"}).afterValueUpdated("$iconlist_aftervalueupdated"),"main");B.layoutBase.attach((new A.ToolBar).host(B,"toolbar").onClick("$toolbar_onclick"),"main");B.layoutBase.attach((new A.Layout).host(B,"layoutLeft").setLeft(0).setTop(0).setItems([{"id":"main","min":10},{"id":"after","pos":"after","locked":false,"size":300,"min":100,"max":500,"cmd":true,"hide":false}]),"after");B.layoutLeft.attach((new A.ComboInput).host(B,"listObject").setDock("top").setType("popbox").setReadonly(true).setItems([]).onClickButton("$listobject_onlistshow"),"after");B.layoutLeft.attach((new A.TreeGrid).host(B,"profileGrid").setHeader([{"id":"name","caption":"$VisualJS.designer.gridcol1","width":80,"type":"label"},{"id":"value","caption":"$VisualJS.designer.gridcol2","width":130,"type":"input"}]).setRows([]).setRowHandlerWidth(30).setAltRowsBg(false).setRowDragable(false).setColSortable(false).beforeValueUpdated("$profilegrid_beforevalueupdated").onRequestData("$profilegrid_onrequestdata").afterRowActive("$profilegrid_afterrowactive"),"after");B.layoutLeft.attach((new A.TreeBar).host(B,"treebarCom").setLeft(0).setTop(0).setItems([]).setGroup(true).setSelMode("none").setDragKey("iDesign"),"main");B.layoutBase.attach((new A.Div).host(B,"panelDiv").setDock("fill").afterCreated(function(E){E.root.addClass("linbdesign")}).setCustomAppearance({"KEY":"overflow:auto;"}),"main");B.panelDiv.attach((new A.Div).host(B,"panelBG").setTop(5).setLeft(5).setCustomAppearance({"KEY":"background-color:#FFFEF6;"}));B.panelBG.attach((new A.Div).host(B,"panelBGl").setCustomAppearance({"KEY":"font-size:0;line-height:0;position:absolute;left:0;top:0;width:10px;height:100%;background:url(img/designer/left.gif) left top"}));B.panelBG.attach((new A.Div).host(B,"panelBGb").setCustomAppearance({"KEY":"font-size:0;line-height:0;position:absolute;left:0;bottom:0;height:10px;width:100%;background:url(img/designer/top.gif) left bottom"}));B.panelBG.attach((new A.Div).host(B,"panelBGt").setCustomAppearance({"KEY":"font-size:0;line-height:0;position:absolute;left:0;top:0;height:10px;width:100%;background:url(img/designer/top.gif) left top"}));B.panelBG.attach((new A.Div).host(B,"panelBGr").setCustomAppearance({"KEY":"font-size:0;line-height:0;position:absolute;right:0;top:0;width:10px;height:100%;background:url(img/designer/left.gif) top right"}));B.panelDiv.attach((new A.Panel).host(B,"canvas").setTop(5).setLeft(5).setZIndex(10).setCustomAppearance({"KEY":"overflow:hidden"}));return D}},Static:{destroy:function(){this.objlistBlock.destroy();arguments.callee.upper.apply(this,arguments)}},Initialize:function(){linb.css.add(linb.UI.buildCSSText({".linbdesign .panel":{"background-image":"url(img/designer/bg.gif)","background-position":"left top"}}),"linb.UI.design")}});Class("VisualJS.AddFile","linb.Com",{Instance:{customAttach:function(C){var B=this,E=B.dialog,F=B.properties;if(F.fromRegion){E.setFromRegion(F.fromRegion)}E.setCaption(F.caption).setIcon(F.icon).setIconPos(F.iconPos);if(!E.get(0).root){E.create()}B.treebar.resetValue();B.input.resetValue();B.inputTarget.resetValue();B.comboinput.setValue(".js",true);E.show(C,true);var A=linb.UI.pickObj(F.items||[]),D=function(H){var G=arguments.callee;H.filter(function(K,J){var I=K.sub;if(I){G(K.sub)}if(I&&!I.length){delete K.sub}return !!I})};D(A);B.treebar.clearItems().insertItems(A)},iniComponents:function(){var B=this,D=B._nodes=[],A=linb.UI,C=function(E){D.push(E.get(0))};C((new A.Dialog).host(B,"dialog").setLeft(240).setTop(80).setWidth(430).setHeight(270).setResizable(false).setMinBtn(false).setMaxBtn(false).setPinBtn(false).setCaption("dialog").onHotKeydown("_dialog_onhotkey").beforeClose("_dialog_beforeclose"));B.dialog.attach((new A.Button).host(B,"btnCancel").setLeft(80).setTop(210).setWidth(90).setCaption("$VisualJS.cancel").setIcon("img/App.gif").setIconPos("-16px -16px").onClick("_btncancel_onclick"));B.dialog.attach((new A.Label).host(B,"label4").setLeft(10).setTop(180).setWidth(70).setCaption("$VisualJS.addfile.target"));B.dialog.attach((new A.ComboInput).host(B,"comboinput").setValue(".js").setLeft(300).setTop(150).setWidth(110).setReadonly(true).setType("listbox").setItems([{"id":"/","caption":"$VisualJS.addfile.iDir"},{"id":".html","caption":"$VisualJS.addfile.iHtml"},{"id":".js","caption":"$VisualJS.addfile.iJs"},{"id":".php","caption":"$VisualJS.addfile.iPhp"}]).afterValueUpdated("_refresh"));B.dialog.attach((new A.PanelBar).host(B,"panelbar2").setDock("top").setHeight(140).setZIndex(1).setCaption("$VisualJS.addfile.sel"));B.panelbar2.attach((new A.TreeBar).host(B,"treebar").setDock("none").setPosition("relative").setItems([]).setIniFold(false).onItemSelected("_refresh"));B.dialog.attach((new A.Label).host(B,"label1").setLeft(10).setTop(150).setWidth(70).setCaption("$VisualJS.addfile.filename"));B.dialog.attach((new A.Button).host(B,"btnOK").setLeft(250).setTop(210).setWidth(90).setCaption("$VisualJS.ok").setIcon("img/App.gif").setIconPos("-64px -16px").onClick("_btnok_onclick"));B.dialog.attach((new A.Label).host(B,"label3").setLeft(230).setTop(150).setWidth(70).setCaption("$VisualJS.addfile.filetype"));B.dialog.attach((new A.Input).host(B,"input").setLeft(80).setTop(150).setWidth(140).setValueFormat("^[\\w_]{2,18}$").setTipsErr("$VisualJS.addfile.filenameformat").afterValueUpdated("_refresh"));B.dialog.attach((new A.Input).host(B,"inputTarget").setLeft(80).setTop(180).setWidth(330).setReadonly(true));return D},_dialog_beforeclose:function(A){this.dialog.hide();return false},_btncancel_onclick:function(A,C,B){this.dialog.close()},_refresh:function(){var B=this,D=B.treebar.getUIValue(),C=B.input.getUIValue(),A=B.comboinput.getUIValue();if(D&&C&&A){B.inputTarget.setValue(D+"/"+C+A,true)}},_btnok_onclick:function(C,E,D){var A=this,B=A.inputTarget.getValue();if(!B){linb.message(linb.getRes("VisualJS.addfile.notarget"))}else{_.tryF(A.properties.onOK,[A.treebar.getUIValue(),A.treebar.getUIValue(),A.input.getUIValue(),A.comboinput.getUIValue()],A.host);A.dialog.close()}},_dialog_onhotkey:function(C,B,E,A,D){if(B=="esc"){C.boxing().close()}}}});Class("VisualJS.DelFile","linb.Com",{Instance:{customAttach:function(C){var B=this,F=B.properties,E=B.dialog;if(F.fromRegion){E.setFromRegion(F.fromRegion)}E.setCaption(F.caption).setIcon(F.icon).setIconPos(F.iconPos);if(!E.get(0).root){E.create()}B.treebar.resetValue();E.show(C,true);var A=linb.UI.pickObj(F.items),D=function(H){var G=arguments.callee;H.filter(function(J,I){delete J.group;if(J.sub&&J.sub.length){G(J.sub)}})};D(A);B.treebar.clearItems().insertItems(A)},_dialog_beforeclose:function(A){this.dialog.hide();return false},iniComponents:function(){var B=this,D=B._nodes=[],A=linb.UI,C=function(E){D.push(E.get(0))};C((new A.Dialog).host(B,"dialog").setLeft(247).setTop(120).setWidth(433).setHeight(210).setResizable(false).setMinBtn(false).setMaxBtn(false).setPinBtn(false).setCaption("dialog").onHotKeydown("_dialog_onhotkey").beforeClose("_dialog_beforeclose"));B.dialog.attach((new A.Button).host(B,"btnCancel").setLeft(80).setTop(150).setWidth(90).setCaption("$VisualJS.cancel").setIcon("img/App.gif").setIconPos("-16px -16px").onClick("_btncancel_onclick"));B.dialog.attach((new A.Button).host(B,"btnOK").setLeft(250).setTop(150).setWidth(90).setCaption("$VisualJS.ok").setIcon("img/App.gif").setIconPos("-64px -16px").onClick("_btnok_onclick"));B.dialog.attach((new A.PanelBar).host(B,"panelbar2").setDock("top").setHeight(140).setZIndex(1).setCaption("$VisualJS.delfile.sel").setCloseBtn(false).setLandBtn(false));B.panelbar2.attach((new A.TreeBar).host(B,"treebar").setDock("none").setPosition("relative").setItems([]).setIniFold(false).setSelMode("multi").beforeValueUpdated("_treebar_beforevalueupdated").onItemSelected("_treebar_onitemselected"));return D},_btncancel_onclick:function(A,C,B){this.dialog.close()},_btnok_onclick:function(C,E,D){var B=this.treebar.getUIValue(),A=this;if(!B){linb.message(linb.getRes("VisualJS.delfile.notarget"))}else{linb.UI.Dialog.confirm(linb.getRes("VisualJS.delfile.confirmdel"),linb.getRes("VisualJS.delfile.confirmdel2",B.split(";").length),function(){_.tryF(A.properties.onOK,[B],A.host);A.dialog.close()})}},_treebar_beforevalueupdated:function(D,B,E,C){var A=E.split(";");A.sort();A.filter(function(I,G){for(var H=0,F=this.length;H<F;H++){if(H==G){break}if(this[G].startWith(this[H])){return false}}});return A.join(";")},_dialog_onhotkey:function(C,B,E,A,D){if(B=="esc"){C.boxing().close()}}}});Class("VisualJS.About","linb.Com",{Instance:{customAttach:function(B){var A=this,C=A.dialog,D=A.properties;if(!C.get(0).root){C.create()}C.show(B,true)},iniComponents:function(){var B=this,D=B._nodes=[],A=linb.UI,C=function(E){D.push(E.get(0))};C((new A.Dialog).host(B,"dialog").setLeft(250).setTop(150).setHeight(170).setCaption("$VisualJS.menu.about").setResizable(false).setMinBtn(false).setMaxBtn(false).setPinBtn(false).onHotKeydown("_dialog_onhotkey").beforeClose("_dialog2_beforeclose"));B.dialog.attach((new A.Div).host(B,"div12").setLeft(10).setTop(10).setWidth(260).setHeight(80).setHtml('Visual Js 1.0 <br /> Powered by jsLinb and phpLINB <br />&copy;2006-2007 All rights reserved by <a href="mailto:&#108;&#105;&#110;&#98;&#46;&#110;&#101;&#116;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;">Yingbo Li</a>'));B.dialog.attach((new A.Button).host(B,"button3").setLeft(120).setTop(100).setCaption("O K").setWidth(50).setZIndex("10").onClick("_button3_onclick"));B.dialog.attach((new A.Div).host(B,"div9").setLeft(90).setTop(65).setWidth("120").setHeight("60").setZIndex("8").afterCreated("_div9_aftercreated").setCustomAppearance({"KEY":"background:url(img/logo.gif);cursor:pointer;"}));return D},_div9_aftercreated:function(A){A.root.onClick(function(){linb.dom.submit("http://www.linb.net/VisualJS/")})},_dialog2_beforeclose:function(A){A.boxing().hide();return false},_dialog_onhotkey:function(C,B,E,A,D){if(B=="esc"){C.boxing().close()}},_button3_onclick:function(A,C,B){this.dialog.close()}}})