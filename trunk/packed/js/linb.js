new function(){_={version:'1.1',copyright:'all rights reserved by Yingbo Li',merge:function(target,source,type){var i,f;if(typeof type=="function"){f=type;type='fun'}switch(type){case'fun':for(i in source)if(true===f(source[i],i))target[i]=source[i];break;case'all':for(i in source)target[i]=source[i];break;case'with':for(i in source)if(i in target)target[i]=source[i];break;default:for(i in source)if(!(i in target))target[i]=source[i]}return target}};_.merge(_,{timeStamp:function(){return new Date().getTime()},exists:function(target){return target!==undefined},isNull:function(target){return(typeof target=='object')&&!target},isEmpty:function(hash){for(var i in hash)return false;return true},isObj:function(target){return!!target&&(typeof target=='object'||typeof target=='function')},isBool:function(target){return typeof target=='boolean'},isNumb:function(target){return typeof target=='number'&&isFinite(target)},isDate:function(target){return!!target&&target.constructor==Date},isFun:function(target){return typeof target=="function"},isArr:function(target){return!!target&&target.constructor==Array},isHash:function(target){return!!target&&typeof target=='object'&&target.constructor==Object},isReg:function(target){return!!target&&target.constructor==RegExp},isStr:function(target){return typeof target=="string"},arr:function(value,df){return _.isArr(value)?value:_.isArr(df)?df:[]},bool:function(value,df){return _.isBool(value)?value:_.isBool(df)?df:false},date:function(value,df){return _.isDate(value)?value:_.isDate(df)?df:new Date},fun:function(value,df){return _.isFun(value)?value:_.isFun(df)?df:function(){}},hash:function(value,df){return _.isHash(value)?value:_.isHash(df)?df:{}},numb:function(value,df){return _.isNumb(value)?value:_.isNumb(df)?df:0},str:function(value,df){return _.isStr(value)?value:_.isStr(df)?df:''},breakO:function(target){var n=arguments[1]||1,l=1+(arguments[2]||0),self=arguments.callee,_t='_$gc_',_o=self.o||(self.o={}),i,b,p;if(target&&(typeof target=='object'||typeof target=='function')&&target!==window&&target!==Object&&target!==Date&&target!==Array&&target!==document){if(_t in target)return;else try{target[_t]=1}catch(e){return}p=(p=target.constructor)?p.prototype:_o;for(i in target)if(i!=_t){if(l<n&&target[i]&&(typeof target[i]=='object'||typeof target[i]=='function'))self(target[i],n,l);if(!(p&&p[i])&&i!="prototype"&&i!="constructor")try{delete target[i]}catch(e){}}delete target[_t];if(target.constructor==Array)target.length=0}},tryF:function(fun,args,target,df){return(fun&&typeof fun=='function')?fun.apply(target||null,args||[]):df},asyCall:function(clsPath,fun,args,flag,threadid,onEnd){var o,id,r;if(!args)args=[];if(flag)id=clsPath+':'+fun;if(o=linb.cache.block[id]){args.push(threadid||null);if(o[fun])r=o[fun].apply(o,args);_.tryF(onEnd,[r,threadid],o);onEnd=args=null}else{var cls=linb.SC.evalPath(clsPath),task=function(cls,threadid){var o=new cls();if(flag)linb.cache.block[id]=o;args.push(threadid||null);if(fun)r=o[fun].apply(o,args);_.tryF(onEnd,[r,threadid],o);onEnd=args=null};if(cls)task(cls,threadid);else{linb.thread.asyUI(threadid,[function(threadid){var f=function(a,b,threadid){var cls;if(cls=linb.SC.evalPath(clsPath)){linb.thread(threadid).insert({task:task,args:[cls,threadid]})}};if(cls=linb.SC(clsPath,true,f,{threadid:threadid}))f(0,0,threadid)}])}}},get:function(hash,arr){for(var i=0,l=arr.length;i<l;)if(!hash||typeof(hash=hash[arr[i++]])=='undefined')return;return hash},set:function(hash,arr,value){var v,i,l,key=arr.pop();if(typeof value!='undefined'){for(i=0,l=arr.length;i<l;){v=arr[i++];if(hash[v]&&(typeof hash[v]=='object'||typeof hash[v]=='function'))hash=hash[v];else hash=hash[v]={}}return hash[key]=value}else if(hash=_.get(hash,arr))delete hash[key]},each:function(hash,fun,target){target=target||hash;for(var i in hash)if(false===fun.call(target,hash[i],i,hash))break;return hash},copy:function(hash){var i,h={};for(i in hash)h[i]=hash[i];return h},clone:function(hash,fun){if(!!hash&&typeof hash=='object'){var i,v,h=hash.constructor==Array?[]:{},me=arguments.callee;for(i in hash)if(fun?fun(i):true)h[i]=((v=hash[i])&&typeof v=='object')?me(v,fun):v;return h}else return hash},filter:function(hash,fun,target){var i,bak={};for(i in hash)if(false===fun.call(target,hash[i],i,hash))bak[i]=1;for(i in bak)delete hash[i]},asyRun:function(fun,defer,args,target){return setTimeout(typeof fun=='string'?fun:function(){fun.apply(target,args||[]);fun=args=null},defer||0)},resetRun:function(key,fun,defer,args,target){var me=arguments.callee,cache=me.cache||(me.cache={});if(cache[key]){clearTimeout(cache[key])}if(_.isFun(fun))cache[key]=setTimeout(function(){fun.apply(target||null,args||[]);delete cache[key]},defer||0)},toArr:function(value,flag){if(!value)return[];if(value.constructor==Array)return value;if(value.toArray)return value.toArray();var i,arr=[];if(flag!==undefined)for(i in value)arr.push(flag?i:value[i]);else{for(i=0;i<value.length;++i)arr[i]=value[i]}return arr},Error:function(e){return e?(e.message||e.description||e.toString()):''}});var m={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},n={'$window$':'window','$this$':'this'},s={'boolean':function(x){return String(x)},number:function(x){return isFinite(x)?String(x):'null'},string:function(x){if(n[x])return n[x];if(/[\"\\\x00-\x1f]/.test(x))x=x.replace(/([\x00-\x1f\\\"])/g,function(a,b){var c=m[b];if(c){return c}c=b.charCodeAt();return'\\u00'+Math.floor(c/16).toString(16)+(c%16).toString(16)});else if(/[^\x00-\xff]/.test(x))x=x.replace(/([^\x00-\xff])/g,function(a,b){c=b.charCodeAt();return'\\u'+Math.floor(c/16).toString(16)+(c%16).toString(16)});return'"'+x+'"'},object:function(x){var map=arguments.callee.map||(arguments.callee.map={prototype:1,constructor:1,toString:1,valueOf:1});if(x){var a=[],b,f,i,l,v;if((typeof x=='object'||typeof x=='function')&&typeof x.constructor!='function')return"$alien";else if(x.constructor==Array){a[0]='[';l=x.length;for(i=0;i<l;++i){v=x[i];if(f=s[typeof v]){v=f(v);if(typeof v=='string'){if(b)a.push(',');a.push(v);b=true}}}a.push(']')}else{if(typeof x.beforeSerialized=='function')x=x.beforeSerialized();a[0]='{';for(i in x){if(map[i])continue;v=x[i];if(f=s[typeof v]){v=f(v);if(typeof v=='string'){if(b)a.push(',');a.push(s.string(i),':',v);b=true}}}a.push('}')}b=a.join('');a.length=0;a=null;return b}return'null'},'function':function(x){return x.$path?x.$path:String(x)}};_.serialize=function(obj,flag){var f=s[flag?'object':typeof obj];if(f&&typeof(obj=f(obj))=='string')return obj;return null};_.unserialize=function(str){try{if(str.trim().charAt(0)=='{')str='('+str+')';return eval(str)}catch(e){return false}};_.id=function(){var self=arguments.callee;if(this.constructor!==self||this.a)return(self._||(self._=new self)).next();this.a=[-1];this.b=[''];this.value=''};_.id.prototype={constructor:_.id,_chars:"abcdefghijklmnopqrstuvwxyz".split(''),next:function(i){with(this){var m,k,l,i=_.numb(i,b.length-1);if((m=a[i])>=25){m=0;if(i===0){a.splice(0,0,1);b.splice(0,0,'a');l=a.length;for(k=1;k<l;++k){a[k]=0;b[k]='0'}++i}else next(i-1)}else++m;a[i]=m;b[i]=_chars[m];return value=b.join('')}}}};new function(){linb=function(nodes,flag){return linb.dom.pack(nodes,flag)};_.merge(linb,{temp:{},debug:true,Locale:{},reLang:function(s){if(s&&linb.lang!=s){linb.SC('linb.Locale.'+s);linb.lang=s}},getStr:function(a,b,c){b=Array.prototype.slice.call(arguments,1);return(c=_.get(linb.Locale[linb.lang],a.split('.')))?c.replace(/\x24\d+/g,function(){return b.length?b.shift():''}):a},main:function(fun){linb.dom.onload(fun)},create:function(){return linb.iBox.create.apply(linb.iBox,arguments)},request:function(){return linb.ajax.apply(null,arguments).start()},_object:[],getObject:function(id){return linb._object[id]}})};new function(){_.merge(String.prototype,{toArr:function(c){return this.split(c||',')},toHash:function(flag,c){var i,l,hash={},t,arr=this.toArr(c);for(i=0,l=arr.length;i<l;i++){if(flag)hash[arr[i]]=1;else if(t){hash[t]=arr[i];t=0}else t=arr[i]}arr.length=0;return hash},left:function(len){return this.slice(0,len)},right:function(len){with(this)return slice(length-len,length)},exists:function(str){return this.indexOf(str)>-1},startWith:function(str){return this.indexOf(str)===0},endWith:function(str){var l=this.length-str.length;return l>=0&&this.lastIndexOf(str)===l},repeat:function(time){var arr=new Array(time+1);return arr.join(this)},initial:function(){return this.charAt(0).toUpperCase()+this.substring(1)},trim:function(){return this.ltrim().rtrim()},ltrim:function(){var s=arguments.callee;return this.replace(s.r||(s.r=/^ */),"")},rtrim:function(){var s=arguments.callee;return this.replace(s.r||(s.r=/ *$/),"")},toDom:function(flag){var p=linb.dom.getTemp().html(this,false).get(0),t,r=[],i;for(var i=0,t=p.childNodes,l=t.length;i<l;i++)r[r.length]=t[i];if(flag!==false){if(linb.browser.ie)while(t=p.firstChild)p.removeChild(t);else p.innerHTML=''}return linb(r,false)}});_.merge(Array.prototype,{each:function(fun,target,order){var i,l=this.length;target=target||this;if(!order){for(i=0;i<l;i++)if(fun.call(target,this[i],i,this)===false)break}else for(i=l-1;i>=0;i--)if(fun.call(target,this[i],i,this)===false)break;return this},indexOf:function(value){for(var i=0,l=this.length;i<l;i++)if(this[i]===value)return i;return-1},subIndexOf:function(sub,value){for(var i=0,l=this.length;i<l;i++)if(this[i][sub]===value)return i;return-1},exists:function(value){return this.indexOf(value)>-1},insert:function(arr,index,flag){var a,l=this.length;index=index===0?0:(index||l);if(index<0||index>l)index=l;a=this.splice(index,l-index);if(arr.constructor!=Array||flag)this[this.length]=arr;else this.push.apply(this,arr);this.push.apply(this,a);return index},copy:function(){var i,l,arr=[];for(i=0,l=this.length;i<l;i++)arr[arr.length]=this[i];return arr},merge:function(arr,flag){var i,l;if(flag!==false){var copy=[];for(i=0,l=this.length;i<l;i++)copy[copy.length]=this[i];for(i=0,l=arr.length;i<l;i++)if(copy.indexOf(arr[i])==-1)this[this.length]=arr[i];copy.length=0}else{for(i=0,l=this.length;i<l;i++)if(arr.indexOf(this[i])>-1)this.splice(i,1)}return this},swap:function(a,b){var t=this[a];this[a]=this[b];this[b]=t;return this},remove:function(index,length){this.splice(index,length||1);return this},clean:function(){var i,l,a=this.copy();this.length=0;for(i=0,l=a.length;i<l;i++)if(this.indexOf(a[i])==-1)this[this.length]=a[i];return this},removeValue:function(value){for(var l=this.length,i=l-1;i>=0;i--)if(this[i]===value)this.splice(i,1);return this},filter:function(fun,target){var i,l,arr=[],o;for(i=0,l=this.length;i<l;i++)arr[arr.length]=this[i];this.length=0;for(i=0,l=arr.length;i<l;i++)if(fun.call(target||arr,arr[i],i,arr)!==false)this[this.length]=arr[i];return this}},'all');Array.prototype.boxing=Array.prototype.reBoxing=function(key,flag){var t=linb.iBox.$type[key];if(t)return new(linb.SC(t))(this,flag)}};new function(){linb.ini=function(path){linb.ini.path=path};_.merge(linb.ini,{id_window:"___window",id_document:"___document",top_zIndex:10000,appPath:location.href.toArr('?')[0].replace(/[^\\\/]+$/,'')},'all');var i,s,arr=document.getElementsByTagName('script'),reg=/js\/linb\.js$/;for(i=0;s=arr[i];i++)if(s.src.match(reg)){linb.ini.path=s.src.replace(reg,'');break}linb.getPath=function(key,tag,add){key=key.split('.');if(add)key.insert(add,1);var pre;if(key[0]=='linb'){pre=linb.ini.path;key.shift();if(key.length==(add?1:0))key.push('linb')}else{pre=linb.ini.appPath;if(key.length==((add?1:0)+1))key.push('index')}return pre+key.join('\/')+(tag||'\/')}};new function(){linb.cache={};'dom,domId,time,template,hookKey,event,thread,SC,text,block'.toArr().each(function(i){linb.cache[i]={}});_.merge(linb.cache,{setTime:function(key,value,time){this.time[key]=value;_.asyRun('delete linb.cache.time["'+key+'"];',time||60000)},getTime:function(key){return this.time[key]||null}})};new function(){Class=function(key,parent_key,o){var temp,_Static={},_Instance={},_this,_parent=[],env=Class._fun,reg=Class._reg;o=o||{};(parent_key=(!parent_key?[]:typeof parent_key=='string'?[parent_key]:parent_key)).each(function(o,i){if(!(_parent[i]=(_.get(window,o.split('.'))||linb.SC(o))))throw new Error(linb.getStr('Class',o))});if(o.Static){_.filter(o.Static,function(o,i){return!reg[i]});_Static=o.Static}_Static.Before=o.Before||(_parent[0]&&_parent[0].Before);_Static.After=o.After||(_parent[0]&&_parent[0].After);_Static.$gc=o.$gc||_Static.$gc||function(){Class.$gc(this.$key)};if(o.Instance)_Instance=o.Instance;if(typeof o.Constructor=='function'){_this=env(o.Constructor,key,_.fun(_parent[0]));_this.Constructor=String(o.Constructor)}else{if(_parent[0]){var f=_.fun(),str=_parent[0].Constructor;if(str)f=new Function(str.slice(str.indexOf("(")+1,str.indexOf(")")).split(','),str.slice(str.indexOf("{")+1,str.lastIndexOf("}")));_this=env(f,key,_parent[0].upper);_this.Constructor=str}else _this=_.fun()}_this.KEY=_this.$key=_this.prototype.KEY=_this.prototype.$key=key;Class._ob(_parent,_this,_Static);Class._ob(_parent,_this.prototype,_Instance,false,true);if(_parent.length)_parent.each(function(o,i){temp=_this.upper;Class._ob(_parent,_this,o,true);_this.upper=temp;Class._ob(_parent,_this.prototype,o.prototype,true,true)});if(_.tryF(_this.Before,arguments,_this,true)===false)return false;_parent.each(function(o,i){o=(o.$children||(o.$children=[]));if(!o.exists(key))o.push(key)});_this.$linb$=true;_this.$children=[];_this.$parent=_parent;_this.prototype.constructor=_this;_this[key]=_this.prototype[key]=true;_.set(window,_this.KEY.split('.'),_this);_.tryF(_this.After,[],_this);_.tryF(o.Initialize,[],_this);_parent.lenght=0;_Static=_Instance=_parent=o=null;return _this};_.merge(Class,{_reg:'$key,$parent,$children,KEY,Static,Instance,Constructor,Initialize'.toHash(true),_reg2:"constructor,prototype,toString,valueOf".toHash(true),_fun:function(fun,original,upper){fun.$original$=original;if(upper)fun.upper=upper;return fun},_upper:function(o,i,flag){for(var r,v,j=0;v=o[j++];)if(typeof(r=(flag?v.prototype[i]:v[i]))=='function')break;return r},_other:["toString","valueOf"],_o:{},_ob:function(parent,target,src,inherit,instance){var i,j,o;for(i in src){if((i in target)||(i.charAt(0)=='$'&&inherit)||this._reg2[i]||(!instance&&this._reg[i]))continue;o=src[i];if(o&&o.$linb$)continue;o=target[i]=(inherit||typeof o!='function'||o.$ignore$)?o:this._fun(o,target.KEY,this._upper(parent,i,instance))}for(j=0;i=this._other[j++];){o=src[i];if(o&&(o==this._o[i]))continue;o=target[i]=(inherit||typeof o!='function'||o.$ignore$)?o:this._fun(o,target.KEY,this._upper(parent,i,instance))}},$gc:function(key){var t=_.get(window,key.split('.'));if(t){if(t.$children)t.$children.each(function(o){o=_.get(window,o.split('.'));o.$gc()});t.$parent.length=t.$children.length=0;_.breakO(t);_.set(window,key.split('.'),null)}}})};Class('linb.thread',null,{Constructor:function(id,tasks,delay,callback,onStart,onEnd,cycle){var self=arguments.callee;if(this.constructor!==self||!!this.id)return new self(id,tasks,delay,callback,onStart,onEnd,cycle);var t=linb.cache.thread;if(typeof id!='string')id=_.id();this.id=id;this.profile=t[id]||(t[id]={id:id,start_flag:false,time:0,time_new:0,time_left:0,time_flag:-1,sleep_flag:-1,index:0,tasks:tasks||[],delay:delay||0,callback:_.fun(callback),onStart:_.fun(onStart),onEnd:_.fun(onEnd),cache:{},status:"run",cycle:_.bool(cycle,false)})},Instance:{$gc:function(){var t=linb.cache.thread[this.id];if(t){_.breakO([t.tasks,t],2);delete linb.cache.thread[this.id]}},_task:function(){var p=this.profile;p.time_flag=-1;var t={args:[]},value=p.tasks[p.index];if(typeof value=='function')t.task=value;else _.merge(t,value,'all');if(!t.task)return;_.merge(t,{delay:p.delay,callback:p.callback});t.args.push(p.id);p.index++;p.time=_.timeStamp();var r=_.tryF(t.task,t.args,t.target,null);if(!p||p.status!=="run")return;p.cache[t.id]=r;if(t.callback)if(false===_.tryF(t.callback,[p.id],null,true)){p.status="stop";return}if(!p||p.status!=="run")return;_.tryF(this.start,[],this)},start:function(time){var p=this.profile;if(p.start_flag===false){p.start_flag=true;if(false===_.tryF(p.onStart,[],this))this.abort()}if(!p.tasks.length)return this.abort();if(p.index>=p.tasks.length)if(p.cycle===true)this.resetTo(0);else return this.abort();var delay=p.tasks[p.index].delay;if(delay===undefined)delay=p.delay;p.time_left=(time||time===0)?time:delay;if(p.time_flag!=-1)clearTimeout(p.time_flag);p.time_flag=_.asyRun(this._task,p.time_left,[],this);p.time=_.timeStamp();return this},suspend:function(){var n,p=this.profile;if(p.status=="pause")return;p.status="pause";if(p.time_flag!==-1){clearTimeout(p.time_flag);if(p.index>0)p.index--}n=p.time_left-(_.timeStamp()-p.time);p.time_left=(n>=0?n:0);return this},sleep:function(time){this.suspend();if(time||time===0){var self=this;if(self.profile.sleep_flag!=-1)clearTimeout(self.profile.sleep_flag);else self.profile.index++;self.profile.sleep_flag=_.asyRun(function(){self.resume();self.profile.sleep_flag=-1;self=null},time)}},resume:function(time){if(this.profile.status=="run"){return}time=typeof time=='undefined'?this.profile.time_left:(time||time===0)?(time>=0)?time:0:(time===true)?this.profile.delay:0;this.profile.status="run";this.start(time);return this},abort:function(){var _t=this.profile;clearTimeout(_t.time_flag);_.tryF(_t.onEnd,[_t.id]);this.$gc();return},getStatus:function(){return this.profile.status},isAlive:function(){return this.getStatus()=="run"},insert:function(arr,index){if(arr.constructor!=Array)arr=[arr];index=index||this.profile.index;this.profile.tasks.insert(arr,index);var self=this;return this},remove:function(index,len){index=index||this.profile.index;len=len||1;this.profile.tasks.splice(index,len);return this},getCache:function(key){return this.profile.cache[key]},setCache:function(key,value){this.profile.cache[key]=value;return this},resetTo:function(index){this.profile.index=index||0;return this}},After:function(){'start,suspend,resume,sleep,abort'.toArr().each(function(i){this[i]=function(id){var t;if(linb.cache.thread[id])(t=linb.thread(id))[i].apply(t,Array.prototype.slice.call(arguments,1))}},this)},Static:{$gc:function(){linb.cache.thread={}},exists:function(threadid){return!!linb.cache.thread[threadid]},asyUI:function(threadid,tasks){if(linb.cache.thread[threadid]){linb.thread(threadid).insert(tasks)}else{linb.thread(null,tasks,0,null,function(){linb.dom.busy()},function(){linb.dom.free()}).start()}},group:function(id,group,callback,onStart,onEnd){var arr=_.toArr(group,true);return linb.thread(id,[function(threadid){linb.thread.suspend(threadid);_.each(group,function(o,i){if(typeof o=='string')o=linb.thread(o);if(o){var f=function(){_.tryF(arguments.callee.onEnd,arguments,this);arguments.callee.onEnd=null;arr.removeValue(i);_.tryF(callback,[i,threadid],this);if(!arr.length)linb.thread.resume(threadid)};f.onEnd=o.profile.onEnd;o.profile.onEnd=f;o.start()}})}],0,null,onStart,onEnd)}}});Class('linb.ajax',null,{Constructor:function(uri,queryString,onSuccess,onFail,asy,method,threadid,args){if(_.isObj(uri))args=uri;else{args=_.hash(args);_.merge(args,{uri:uri,queryString:queryString,onSuccess:onSuccess,onFail:onFail,asy:asy,method:method,threadid:threadid})}if((this.constructor!==arguments.callee)||this.id)return new arguments.callee(args);_.merge(args,{id:args.id||_.id(),uri:_.str(args.uri),queryString:encodeURIComponent((args.queryString||_.timeStamp()).toString()),asy:_.bool(args.asy,true),method:['GET','POST'].exists(args.method)?args.method:'GET'},'all');if(args.cache){var t;args.cache_id=_.str(args.cache_id,(args.uri+"|"+args.queryString));args.cache_time=args.cache_time||60000;if(!args.cache_refresh)if(_.exists(t=linb.cache.getTime(args.cache_id)))return _.tryF(args.onSuccess,[t])}_.merge(this,args,'all');_.merge(this,this.constructor._events,'without');return this},Instance:{retry_time:2,request_timeout:10000,cache:false,start:function(){var self=this;try{with(this){this._XMLHTTP=new XMLHttpRequest();if(asy)_XMLHTTP.onreadystatechange=function(){if(self&&self._XMLHTTP&&self._XMLHTTP.readyState==4){self._complete.apply(self);self._clear()}};if(!_retryNo){_fireEvent("Start");if(method!="POST"){uri=uri.split("?")[0]+"?"+queryString;queryString=null}}if(_XMLHTTP.overrideMimeType)_XMLHTTP.overrideMimeType('text/xml');_XMLHTTP.open(method,uri,asy);if(method!="POST")_XMLHTTP.setRequestHeader("Content-type","application/x-www-form-urlencoded");_XMLHTTP.setRequestHeader("X-Requested-With","XMLHttpRequest");if(_XMLHTTP.overrideMimeType)_XMLHTTP.setRequestHeader("Connection","close");try{_XMLHTTP.send(queryString)}catch(e){}if(asy){if(_XMLHTTP){if(request_timeout>0)_timeout_id=_.asyRun(function(){if(self&&!self._end){self._timeout()}},request_timeout)}}else _complete()}}catch(e){this._fireEvent("Error",e)}return this},abort:function(){if(this._XMLHTTP){this._XMLHTTP.onreadystatechange=this._fun;this._XMLHTTP.abort();this._XMLHTTP=null}this.$gc();return false},_fun:function(){},_XMLHTTP:null,_timeout_id:0,_responseText:null,_responseXML:null,_end:false,_retryNo:0,_clear:function(){if(this._XMLHTTP){this._XMLHTTP.onreadystatechange=this._fun;this._XMLHTTP=null}},$gc:function(){this._clear();_.breakO(this)},_message:function(s){linb.message(s)},_complete:function(){with(this){_responseText=_XMLHTTP.responseText;_responseXML=_XMLHTTP.responseXML;var status=_XMLHTTP.status;_fireEvent("Complete");if([undefined,0,304].exists(status)||(status>=200&&status<300))_fireEvent("Response");else _fireEvent("Error",new Error(linb.getStr('XMLHTTP',status)))}},_timeout:function(){with(this){abort();_fireEvent("Timeout");if(_retryNo<retry_time){_retryNo++;_fireEvent("Retry",_retryNo);start()}else _fireEvent("Error",new Error(linb.getStr("timout")))}},_fireEvent:function(n,o){_.tryF(this["on"+n],[o],this);with(this){if(n=="Response"||n=="Error"){_end=true;if(_timeout_id>0){clearTimeout(_timeout_id);_timeout_id=0}_fireEvent("End");$gc()}}}},Static:{_events:{onRetry:function(retry){this._message('retry:'+retry)},onTimeout:function(){this._message('timeout')},onStart:function(){linb.thread.suspend(this.threadid)},onEnd:function(){linb.thread.resume(this.threadid)},onResponse:function(){if(this.cache===true)linb.cache.setTime(this.cache_id,this._responseText,this.cache_time);_.tryF(this.onSuccess,[this._responseText,this._responseXML,this.threadid],this)},onError:function(e){_.tryF(this.onFail,[_.Error(e)],this);this._message(_.Error(e))}},group:function(group,callback,onStart,onEnd){_.each(group,function(o,i){group[i]=linb.thread(null,[function(threadid){o.threadid=threadid;o.start()}])});return linb.thread.group(null,group,callback,onStart,onEnd)},background:function(arr,callback,onStart,onEnd,threadid){var i=0,fun=function(threadid){var o=arr[i++];o.threadid=threadid;linb.ajax(o).start();if(arr.length<=i)return linb.thread(threadid).abort()};linb.thread(threadid||null,[fun],100,callback,onStart,onEnd,true).start()}}});Class('linb.SC',null,{Constructor:function(path,flag,onEnd,args){var p=linb.cache.SC;if(flag){args=_.hash(args);args.$type=1;args.$cb=onEnd}return p[path]?p[path]:(p[path]=_.get(window,path.split('.')))?p[path]:(p[path]=linb.SC._call(_.str(path),args,flag))},Static:{$gc:function(k){for(var i in linb.cache.SC)if(i.indexOf('.')==-1)window[i]=undefined;linb.cache.SC={}},evalPath:function(path,obj){var i,l,o=obj||window,arr=path.toArr('.');if(path=='')return o;for(i=0,l=arr.length;i<l;++i)if(o[arr[i]]==undefined){return null}else o=o[arr[i]];return o},_call:function(s,args,flag){flag=!!flag;var i,t,r,o,funs=[],f=function(text,n,threadid){if(this.$type==2){(this.$cache||linb.cache.text)[this.$name]=text;_.tryF(this.$cb,[this.$name,text,threadid])}else{try{eval(text)}catch(e){throw new Error(linb.getStr('SC',_.Error(e)+this.$tag))}if(this.$type==1)_.tryF(this.$cb,[this.$name,text,threadid])}},fe=function(text){if(this.$type==2)_.tryF(this.$cb,[this.$name,text,this.threadid])};if(!(r=linb.SC.evalPath(s))){if(t=linb.cache.text[s]){f.call({$type:0},t);delete linb.cache.text[s]}if(!(r=linb.SC.evalPath(s))){o=linb.getPath(s,'.js','js');args=args||{};args.$tag=s;linb.ajax(o,null,f,fe,flag,'GET',null,args).start();if(flag)return false;if(!(r=linb.SC.evalPath(s)))return false}}return r},prepare:function(arr,cache,callback,onEnd,id){var a=arr.copy(),args={$type:2,$cache:cache};if(callback||onEnd){args.$cb=function(key,str){_.tryF(callback,[key,str]);a.removeValue(key);if(!a.length&&!a.ok){_.tryF(onEnd,[id]);a.ok=1;onEnd=null}}}arr.each(function(s){var h=_.copy(args);h.$name=s;if(this._call(s,h,true)){a.removeValue(s)}},this);if(!a.length&&!a.ok){_.tryF(onEnd,[id]);a.ok=1;onEnd=null}},background:function(arr,callback,onStart,onEnd,id){var i=0,fun=function(threadid){linb.SC._call(arr[i++],{threadid:threadid},true);if(arr.length<=i){linb.thread(threadid).abort();return false}};linb.thread(id||null,[fun],1000,callback,onStart,onEnd,true).start()},clearPrepare:function(){_.each(linb.cache.text,function(o,i){try{eval(o)}catch(e){linb.getStr('SC',_.Error(e))}});linb.cache.text={}},group:function(arr,callback,onEnd,id){var self=this;this.clearPrepare();this.prepare(arr,linb.cache.text,callback,function(){self.clearPrepare();_.tryF(onEnd,[id]);onEnd=null},id)}}});new function(){;linb.log=function(){;if(linb.browser.gek&&window.console){;console.log.call(console,[_.toArr(arguments),(_.timeStamp()-linb.log.time)+"ms"]);linb.log.time=_.timeStamp()}}};Class('linb.event',null,{Constructor:function(e,o){var src,type,id,self=linb.event,dd=0,pre,obj;if(!(e=e||window.event)||!(src=o))return false;type=e.type;o=self.getSrc(e);id=linb.dom.getId(src)||'';if((obj=self.focusHook).length)if(self._kb[type]&&false===self._handleFocusHook(src,obj=obj[obj.length-1])){linb([obj],false).nextFocus();return}if('mouseover'==type||'mouseout'==type){dd=linb.dragDrop.drop2?1:2;if(!self._handleMouseHover(e,src,o,dd==1))return;if(dd==1)pre=linb.dragDrop._current}else if(linb.browser.ie&&'resize'==type&&o&&!e.width&&!e.height)return false;if(obj=self._getProfile(id)){var j,f,name,r=true,funs=[];for(j=0;j<=2;++j){if(dd==1&&j!==0&&!e.$force)break;if(dd==2&&j===0)continue;name=self._typeCache[type+j]||(self._typeCache[type+j]=linb.dom._getEventName(type,linb.dom._eventtag[j]));if(!e.$e||e.$all||(name==e.$name))Array.prototype.push.apply(funs,obj.getEV(id,name))}f=function(){var i,v,o=arguments.callee.funs;for(i=0;v=o[i++];)if(false===v.call(src,obj,e,src,o,type,name))return false;return true};f.funs=funs;r=f();if(type=='drag')linb.dragDrop._onDrag=f;else if(type=='dragover')linb.dragDrop._onDragover=f;if(dd==1){if('mouseover'==type&&linb.dragDrop._current==src&&pre&&pre!=src){linb(pre).beforeMouseout();linb.dragDrop._current=src}if('mouseout'==type&&!linb.dragDrop._current&&pre&&pre==src){self._ddtemp=id;_.asyRun(function(){delete linb.event._ddtemp})}if(src==linb.dragDrop._current)r=false}if(r===false)self.stopBubble(e);return r}},Static:{_typeCache:{},_kb:'keydown,keypress,keyup'.toHash(true),focusHook:[],_reg:/([\.\w]+)(-[\.\w]+)?(:[\w]+:)([\w]+)?/,_getProfile:function(id){return linb.cache.dom[id.replace(this._reg,'$1$3')]},_handleFocusHook:function(src,target){if(src==document)return true;var node=src;do{if(node==target)return true}while((node&&(node=node.parentNode)))return false},_handleMouseHover:function(e,target,src,dd){if(target==document)return true;if(linb.browser.gek&&(src.tagName=='INPUT'||src.tagName=='TEXTAREA'))return true;var node=(e.type=='mouseover'?e.fromElement:e.toElement)||e.relatedTarget;if(dd&&e.type=='mouseover'&&this._ddtemp)do{if(node&&node.id&&node.id==this._ddtemp){return true}}while(node&&(node=node.parentNode)&&node!==document&&node!==window)try{do{if(node==target)return false}while(node&&(node=node.parentNode))}catch(a){}return true},getSrc:function(e){var a=e.target||e.srcElement||null;if(linb.browser.kde&&a)a=(a.nodeType==3)?a.parentNode:a;return a},getBtn:function(e){return e.which||e.button||0},getPos:function(e){e=e||window.event;if(e.pageX!==undefined)return{left:e.pageX,top:e.pageY};else{var m=linb.browser.contentBox?document.documentElement:document.body;return{left:e.clientX+m.scrollLeft,top:e.clientY+m.scrollTop}}},getKey:function(e){e=e||window.event;var res=[],t,k=e.$key||e.keyCode||e.charCode||0;if(typeof k=='string')res[0]=k;else{var key=String.fromCharCode(k),type=e.type;if((type=='keypress'&&k>=33&&k<=128)||((k>=48&&k<=57)||(k>=65&&k<=90)))res[0]=key;else{if(!(t=arguments.callee.map)){t=arguments.callee.map=("3,enter,8,backspace,9,tab,12,numlock,13,enter,19,pause,20,capslock,"+"27,esc,32,space,33,pageup,34,pagedown,35,end,36,home,37,left,38,up,39,right,40,down,44,printscreen,"+"45,insert,46,delete,50,down,52,left,54,right,56,up,"+"91,win,92,win,93,apps,"+"96,0,97,1,98,2,99,3,100,4,101,5,102,6,103,7,104,8,105,9,"+"106,*,107,+,109,-,110,.,111,/,"+"112,f1,113,f2,114,f3,115,f4,116,f5,117,f6,118,f7,119,f8,120,f9,121,f10,122,f11,123,f12,"+"144,numlock,145,scroll,"+"186,;,187,=,189,-,190,.,191,/,192,`,"+"219,[,220,\\,221,],222,',"+"224,meta,"+"63289,numlock,63276,pageup,63277,pagedown,63275,end,63273,home,63234,left,63232,up,63235,right,63233,down,63272,delete,63302,insert,63236,f1,63237,f2,63238,f3,63239,f4,63240,f5,63241,f6,63242,f7,63243,f8,63244,f9,63245,f10,63246,f11,63247,f12,63248,print").toHash();t[188]=','}res[0]=t[k]||key}}if((e.modifiers)?(e.modifiers&Event.CONTROL_MASK):(e.ctrlKey||e.ctrlLeft||k==17||k==57391)){if(k==17||k==57391)res[0]='';res.push('1')}else res.push('');if((e.modifiers)?(e.modifiers&Event.SHIFT_MASK):(e.shiftKey||e.shiftLeft||k==16||k==57390)){if(k==16||k==57390)res[0]='';res.push('1')}else res.push('');if((e.modifiers)?false:(e.altKey||e.altLeft||k==18||k==57388)){if(k==18||k==57388)res[0]='';res.push('1')}else res.push('');return res},getEventPara:function(e){var pos=this.getPos(e),keys=this.getKey(e),h={pageX:pos.left,pageY:pos.top,keyCode:keys[0],ctrlKey:keys[1],shiftKey:keys[2],altKey:keys[3]};for(var i in e)if(i.charAt(0)=='$')h[i]=e[i];return h},stopBubble:function(e){e=e||window.event;if(e.stopPropagation)e.stopPropagation();e.cancelBubble=true;this.stopDefault(e)},stopDefault:function(e){e=e||window.event;if(e.preventDefault)e.preventDefault();e.returnValue=false},hookKey:function(key,ctrl,shift,alt,fun,args,target){var p=linb.cache.hookKey,k=_.str(key).toLowerCase()+":"+(ctrl?'1':'')+":"+(shift?'1':'')+":"+(alt?'1':'');if(fun===null)delete p[k];else p[k]=[fun,args,target];return this}}});Class('linb.iBox',null,{Before:function(key,parent_key,o){if(linb.iBox)linb.iBox.$type[key.replace("linb.","")]=linb.iBox.$type[key]=key},Instance:{ini:function(){return this},get:function(index){return this._nodes[index]||this._nodes},set:function(value,index){if(_.isNumb(index))this._nodes[index]=value;else this._nodes=value;return this},create:function(){return this},length:function(){return this._nodes.length},each:function(fun){for(var i=0,j=this._nodes,l=j.length;i<l;i++)if(false===fun.call(this,j[i],i))break;return this},push:function(o){return this._nodes.push(o)},pop:function(){return this._nodes.pop()},exists:function(node){return this._nodes.exists(node)},isEmpty:function(){return!this._nodes.length},add:function(e,flag){var arr=this.constructor.clean(e);this._nodes.merge(arr,flag);return this},minus:function(e){return this.add(e,false)},unBoxing:function(){return this.get()},reBoxing:function(key,flag){var t=linb.iBox.$type[key||'dom'];if(t==this.KEY)return this;if(t=linb.SC(t))return t.pack(this._nodes,flag)}},Static:{$type:{},pack:function(e,flag){var o=new this(false);o._nodes=e?flag===false?e:this.clean(e):null;return o},clean:function(e){return e},plugIn:function(key,fun){this.prototype[key]=fun;return this},support:function(key){return typeof this.prototype[key]=='function'},create:function(tag,id){var arr,o,t,self=arguments.callee,r1=self.r1||(self.r1=/^\s*<((\n|\r|.)*?)>\s*$/);if(tag.constructor==Array){arr=[];tag.each(function(v,i){arr.insert(self.apply(null,v instanceof Array?v:[v])._nodes,-1)});return arr}if(typeof tag=='string'){if(id===true)o=linb([document.createTextNode(tag)],false);else if(t=linb.iBox.$type[tag]){arr=[];for(var i=1,l=arguments.length;i<l;i++)arr[i-1]=arguments[i];o=new(linb.SC(t))(false);o.ini.apply(o,arr).create()}else if(r1.test(tag))o=tag.toDom();else{o=document.createElement(tag);o.id=typeof id=='string'?id:_.id();o=linb(o)}}else o=new(linb.SC(tag.key))(tag).create();return o}}});Class('linb.iProfile');Class('linb.DomProfile','linb.iProfile',{Instance:{$gc:function(){var t;if(this.addition&&(t=this.domNode))_.each(this.addition,function(o,i){t[i]=null},this);t=linb.cache.dom[this.id]=null},getEV:function(id,name){var funs=[],t;if(t=_.get(linb.cache.dom,[id,'events',name]))for(var i=0,l=t.length;i<l;i++)if(typeof t[t[i]]=='function')funs[funs.length]=t[t[i]];return funs}}});new function(){var u=navigator.userAgent,dom=linb.dom,b=linb.browser={kde:u.indexOf('AppleWebKit/')>-1,opr:!!window.opera,ie:!!(window.attachEvent&&!window.opera),gek:u.indexOf('Gecko')>-1&&u.indexOf('KHTML')==-1};if(b.ie){if(u.indexOf(' 7')!=-1)b.ie7=true;else b.ie6=true}b.contentBox=function(){if((linb.browser.ie)||(linb.browser.opr)){return(["BackCompat","QuirksMode"].exists(document["compatMode"]))?false:true}else{var node=document.documentElement;return(node=node.style["-moz-box-sizing"]||node.style["box-sizing"]||null)?(node==="content-box"):true}}()};Class('linb.dom','linb.iBox',{Instance:{id:function(value,flag){var t,f=arguments.callee.f||(arguments.callee.f=function(o,value,flag){if(!flag)if(t=linb.cache.dom[o.id]){linb.cache.dom[value]=t;delete linb.cache.dom[o.id]}o.id=value});if(typeof value=='string')return this.each(function(o){f(o,value,flag)});else return this.get(0).id},$sum:function(fun,args){var arr=[],r;this.each(function(o){r=fun.apply(o,args||[]);if(r)arr.insert(r)});return linb(arr,false)},children:function(){return this.$sum(function(){return _.toArr(this.childNodes)})},clone:function(flag){return this.$sum(function(flag){return this.cloneNode(flag?true:false)},arguments)},$iterator:function(type,dir,inn,fun,top){return this.$sum(function(type,dir,inn,fun,top){var self=arguments.callee;if(typeof fun!='function'){var count=fun||0;fun=function(n,index){return index==count}}var index=0,m,n=this,flag=0,t;while(n){if(n.nodeType==1)if(fun(n,index++)===true)break;if(type=='x')n=dir?n.nextSibling:n.previousSibling;else if(type=='y')n=dir?self.call(dir===1?n.lastChild:n.firstChild,'x',(dir!==1),true,0,top):n.parentNode;else{inn=_.bool(inn,true);m=null;n=dir?(t=inn&&n.firstChild)?t:(t=n.nextSibling)?t:(m=n.parentNode):(t=inn&&n.lastChild)?t:(t=n.previousSibling)?t:(m=n.parentNode);if(m){while(!(m=dir?n.nextSibling:n.previousSibling)){n=n.parentNode;if(!n)if(flag)return null;else{flag=true;m=dir?document.body.firstChild:document.body.lastChild;break}}n=m}inn=true}}return n},arguments)},dig:function(tag,attr,exp){tag=tag||'*';var me=arguments.callee,f1=me.f1||(me.f1=function(tag,attr,exp){var all=this.getElementsByTagName(tag),arr=[];if(exp.test(this[attr]))arr[arr.length]=this;for(var o,i=0;o=all[i];i++)if(exp.test(o[attr]))arr[arr.length]=o;return arr}),f2=me.f2||(me.f2=function(tag,attr,exp){var all=this.getElementsByTagName(tag),arr=[];if(this[attr]==exp)arr[arr.length]=this;for(var o,i=0;o=all[i];i++)if(o[attr]==exp)arr[arr.length]=o;return arr}),f3=me.f3||(me.f3=function(tag,attr,exp){var all=this.getElementsByTagName(tag),arr=[];if(this[attr])arr[arr.length]=this;for(var o,i=0;o=all[i];i++)if(o[attr])arr[arr.length]=o;return arr}),f4=me.f4||(me.f4=function(tag){return _.toArr(this.getElementsByTagName(tag))}),f5=me.f5||(me.f5=function(tag,attr){var all=this.getElementsByTagName(tag),arr=[];if(attr(this))arr[arr.length]=this;for(var o,i=0;o=all[i];i++)if(attr(o))arr[arr.length]=o;return arr});return this.$sum(attr?typeof attr=='function'?f5:exp?exp.constructor==RegExp?f1:f2:f3:f4,[tag,attr,exp])},$add:function(fun,target){target=linb(target);var v=this.get(0);target.each(function(target){fun.call(v,target)});return this},addPre:function(target){return this.$add(function(target){if(this.previousSibling!=target)this.parentNode.insertBefore(target,this)},target)},addFirst:function(target){return this.$add(function(target){if(this.firstChild!=target){if(this.firstChild)this.insertBefore(target,this.firstChild);else this.appendChild(target)}},target)},addLast:function(target){return this.$add(function(target){if(this.lastChild!=target)this.appendChild(target)},target)},attach:function(target){var o=this.get(0),ui,t;if(target['linb.Profile'])target=target.boxing();if(_.isArr(target))target=linb.iBox.pack(target,false);if(!target['linb.iBox'])target=target.boxing();ui=target.create();target.each(function(v){if((v.domNode||v).parentNode!=o)o.appendChild(v.domNode||v);if(t=v.envTrigger)for(var i=0,l=t.length;i<l;i++)t[i].call(v)});return this},addNext:function(target){var t;return this.$add(function(target){if((t=this.nextSibling)!=target){if(t)this.parentNode.insertBefore(target,t);else this.parentNode.appendChild(target)}},target)},addToPre:function(target){linb(target).addPre(this);return this},addToFirst:function(target){linb(target).addFirst(this);return this},addToNext:function(target){linb(target).addNext(this);return this},addToLast:function(target){linb(target).addLast(this);return this},replace:function(target,flag){var r,v;target=linb(target);if(v=target.get(0)){this.get(0).parentNode.replaceChild(v,this.get(0));this.remove(flag);r=linb([v],false);if(target instanceof Array)for(var i=1,l=target.length;i<l;i++)r.addNext(target[i])}return r},swap:function(target){target=linb(target);var t=linb.dom.getTemp().html('*',false);this.replace(t,false);target.replace(this,false);t.replace(target,false);linb([document.body],false).addFirst(t.empty(false));return this},wrap:function(str){var s;return this.each(function(o,i){o=linb([o],false);o.outerHTML(str.replace('{*}',o.outerHTML()))})},remove:function(flag){if(flag===false)this.each(function(o,i){if(o.parentNode)o.parentNode.removeChild(o)});else linb.dom.getTemp().addLast(this).empty()},empty:function(flag){return this.each(function(o){linb([o],false).html('',flag)})},gc:function(){linb.dom.$gc();return this},html:function(str,flag){var s='',t,bak,o=this.get(0);flag=typeof flag=='undefined'?true:flag;if(typeof str!='undefined'){if(o.nodeType==3)o.nodeValue=str;else{if(!(bak=o.firstChild)&&str=="")return this;if(!flag&&linb.browser.ie)while(t=o.firstChild)o.removeChild(t);if(flag)o.innerHTML='';o.innerHTML=str;if(flag&&bak)_.resetRun('dom.$gc',linb.dom.$gc,300)}return this}else return(o.nodeType==3)?o.nodeValue:o.innerHTML},outerHTML:function(str,flag){var t,s='',o=this.get(0),id=o.id;if(!linb.browser.gek)if(typeof str!='undefined'){this.html('');if(!flag&&(t=linb.cache.dom[id]))t.$gc();o.outerHTML=str}else return o.outerHTML;else{if(typeof str!='undefined')this.replace(str.toDom(),flag);else{var self=this.get(0),m=linb.dom.getTemp(),n=linb.dom.getTemp(2),np=n.parent(),p;if(p=self.parentNode)this.replace(n,false);m.addLast(self);s=m.html();if(p)n.replace(self,false);m.empty();np.addFirst(n);return s}}return this},text:function(str){var s='';if(typeof str!='undefined')return this.each(function(o){var b=false,m,n=o;while(m=n.childNodes[0]){if(m.nodeType!=1){m.nodeValue=str;b=true;break}n=m}if(!b)n.innerHTML=str});else{var f=function(o){var i,a=o.childNodes,l=a.length,str='';for(i=0;i<l;i++)if(a[i].nodeType!=8)str+=(a[i].nodeType!=1)?a[i].nodeValue:f(a[i]);return str};this.each(function(o){s+=f(o)});return s}},attr:function(key,value){var t,me=arguments.callee,map=me.map||(me.map={'class':'className',className:'className','for':'htmlFor',value:"value",disabled:"disabled",checked:"checked",selected:'selected',readonly:"readOnly"});if((t=(typeof key!='string'))||value!==undefined){if(!t){t={};t[key]=value;key=t}_.each(key,function(value,key){if(value===null)this.each(function(o){if(map[key])o[map[key]]=null;else if(o.removeAttribute)o.removeAttribute(key);else o[key]=null});else this.each(function(o){if(map[key])o[map[key]]=value;else{if(o.setAttribute)o.setAttribute(key,value);o[key]=value}})},this);return this}else{var o=this.get(0);return map[key]?o[map[key]]:((o.getAttribute?o.getAttribute(key):0)||o[key])}},setPxStyle:function(key,value){var f=linb.dom.setPxStyle;return this.each(function(o){f(o,key,value)})},setStyle:function(key,value){return key=='opacity'?this.opacity(value):this.each(function(o){if(o.nodeType!=1)return;if(typeof key=='string')o.style[key]=value;else for(var i in key){if(i=='opacity')linb([o],false).opacity(key[i]);else o.style[i]=key[i]}})},getStyle:function(key,flag){var o=this.get(0);return o.nodeType!==1?'':key=='opacity'?this.opacity():linb.dom.getStyle(o,key,flag)},opacity:function(value){if(value!==undefined){var key;value=parseFloat(value)||0;value=value>0.9999?'':linb.browser.ie?"alpha(opacity="+100*value+")":value;return this.each(function(o){if(o.nodeType!=1)return;style=o.style;if(linb.browser.ie){key='filter';value=style.filter.replace(/alpha\([^\)]*\)/ig,"")+value}else key='opacity';style[key]=value})}else{var node=this._nodes[0];if(!node||node.nodeType!=1)return 1;var style=node.style;if(linb.browser.ie){value=style.filter?(parseFloat(style.filter.match(/alpha\(opacity=(.*)\)/)[1])||0)/100:1}else value=style.opacity;return value}},show:function(left,top){var style,t;return this.each(function(o){if(o.nodeType!=1)return;style=o.style;if(t=top||o._top)style.top=t;if(t=left||o._left)style.left=t;style.visibility='visible';if(linb.browser.ie6){style.wordWrap='break-word';style.wordWrap='normal'}})},hide:function(){var style,t;return this.each(function(o){if(o.nodeType!=1)return;style=o.style;t=linb([o],false);o._top=t.getStyle('top');o._left=t.getStyle('left');style.visibility='hidden';style.top=style.left='-10000px'})},setRegion:function(hash,flag,force){var i,t,m,node=this._nodes[0],f=linb.dom.setPxStyle,me=arguments.callee;if(!me.b){m=me.b={};for(i=0;t=linb.dom.boxArr[i++];)m[t]=0}else m=me.b;for(var j=0,c=linb.dom.boxArr;i=c[j++];)m[i]=((i in hash)&&hash[i]!==null)?f(node,i,hash[i]):false;if(flag){if(force)m.width=m.height=m.left=m.top=true;if(linb.dom.hasHandler(node,'onresize')&&(m.width||m.height))this.onResize(true,{width:m.width,height:m.height});if((linb.dom.hasHandler(node,'onlocation')&&m.left||m.top))this.onLocation(true,{left:m.left,top:m.top})}return this},cssSize:function(size,flag){var node=this._nodes[0],f=linb.dom.setPxStyle,b1,b2;if(size){var t;b1=size.width!==null?f(node,'width',size.width):false;b2=size.height!==null?f(node,'height',size.height):false;if(flag&&(b1||b2)&&linb.dom.hasHandler(node,'onresize'))this.onResize(true,{width:b1,height:b2});return this}else return{width:this.W(node,1)||0,height:this.H(node,1)}},cssPos:function(pos,flag){var node=this._nodes[0],f=linb.dom.setPxStyle,b1,b2;if(pos){var t;b1=pos.left!=null?f(node,'left',pos.left):false;b2=pos.top!==null?f(node,'top',pos.top):false;if(flag&&(b1||b2)&&linb.dom.hasHandler(node,'onlocation'))this.onLocation(true,{left:b1,top:b2});return this}else{f=linb.dom.getStyle;return{left:parseInt(f(node,'left'))||0,top:parseInt(f(node,'top'))||0}}},getRegion:function(flag,parent){var pos=flag?this.absPos(parent):this.cssPos(),size=this.cssSize();return{left:pos.left,top:pos.top,width:size.width,height:size.height}},absPos:function(pos,target){var r,t,node=this.get(0),getStyle=linb.dom.getStyle,me=arguments.callee,type=me.type||(me.type={body:1,html:1}),posDiff=me.posDiff||(me.posDiff=function(o,target){var cssPos=o.cssPos(),absPos=o.absPos(null,target);return{left:absPos.left-cssPos.left,top:absPos.top-cssPos.top}});target=target?linb(target).get(0):document;if(pos){if(pos.left===null&&pos.top===null)return this;var d=posDiff(this,target);this.cssPos({left:pos.left===null?null:(pos.left-d.left),top:pos.top===null?null:(pos.top-d.top)});r=this}else{pos={left:0,top:0};var bak=node,bak2,m;do{if(type[String(node.tagName).toLowerCase()])if((linb.browser.kde||linb.browser.ie)&&node.style.position!='absolute'){pos.left-=(parseInt(getStyle(node,'marginLeft'))||0);pos.top-=(parseInt(getStyle(node,'marginTop'))||0);break}pos.left+=(parseInt(node.offsetLeft)||0);pos.top+=(parseInt(node.offsetTop)||0);me.border=me.border||function(node,pos){pos.left+=(parseInt(getStyle(node,'borderLeftWidth'))||0);pos.top+=(parseInt(getStyle(node,'borderTopWidth'))||0)};if(bak!=(bak2=node))if(linb.browser.ie||linb.browser.gek)me.border(node,pos);if(linb.browser.gek)do{if(bak!=bak2)me.border(bak2,pos)}while((bak2=bak2.parentNode)!=node.offsetParent)bak2=node;do{if(bak!=bak2){if('BODY'==bak2.tagName&&linb.browser.opr)continue;if(bak2.scrollWidth!=bak2.offsetWidth)pos.left-=(parseInt(bak2.scrollLeft)||0);pos.top-=(parseInt(bak2.scrollTop)||0)}}while((bak2=bak2.parentNode)!=node.offsetParent)}while((node=node.offsetParent)&&node!=target);r=pos}return r},hasClass:function(str){var arr=this.get(0).className.split(/\s+/);return arr.exists(str)},addClass:function(str){return this.each(function(o){var arr=o.className.split(/\s+/);if(!arr.exists(str))o.className+=" "+str})},removeClass:function(str){var arr,l,me=arguments.callee,reg=(me.reg||(me.reg=/\s+/));return this.each(function(o){arr=o.className;arr=arr.split(reg);l=arr.length;arr.filter(function(o){return typeof str=='string'?o!=str:!str.test(o)});if(l!=arr.length)o.className=arr.join(' ')})},reClass:function(reg,replace){var n,r;return this.each(function(o){r=(n=o.className).replace(reg,replace);if(n!=r)o.className=r})},addEventHandler:function(name,flag){var id,c,type='on'+linb.dom._getEventType(name),f=linb.dom._eventhander,fs=linb.dom.eventhander,fi=linb.dom.getId;return this.each(function(o){id=fi(o);if(!id)id=o.id=_.id();if(flag===false){if(o.setAttribute)o.setAttribute(type,fs)}else{if(o[type])return;o[type]=f}if(!(c=linb.cache.dom[id])){c=linb.cache.dom[id]=new linb.DomProfile();c.domNode=o;c.domId=id}(c.addition||(c.addition={}))[type]=1})},removeEventHandler:function(name){var type='on'+linb.dom._getEventType(name);return this.each(function(o){if(o[type])o[type]=null;if(o.getAttribute&&o.getAttribute(type))o.removeAttribute(type)})},clearEventHandler:function(){return this.each(function(o){linb.dom._events.each(function(s){if(o[s="on"+s])o[s]=null;if(o.getAttribute&&o.getAttribute(s))o.removeAttribute(s)})})},addEvent:function(name,fun,event_id,index,tagVar){var c,t,id,type,fi=linb.dom.getId;if(!(name instanceof Array))name=[[name,fun,event_id]];name.each(function(o,i){name=o[0];fun=o[1];event_id='$'+o[2];type=linb.dom._getEventType(name);if(typeof event_id!='string')event_id="$"+_.id();this.addEventHandler(name);this.each(function(o){id=fi(o);if(!id)id=o.id=_.id();c=linb.cache.dom[id];t=c.events||(c.events={});c=t[name]||(t[name]=[]);if(typeof event_id=='undefined'){c.length=0;c=t[name]=[];index=-1}if(tagVar)c.$tagVar=tagVar;c[event_id]=fun;c.removeValue(event_id);c.insert(event_id,index)})},this);return this},removeEvent:function(name,event_id,flag){var c,t,k,id,i,type,fi=linb.dom.getId;if(!(name instanceof Array))name=[[name,event_id]];name.each(function(o,i){name=o[0];event_id='$'+o[1];type=linb.dom._getEventType(name);this.each(function(o){if(!(id=fi(o)))return;if(!(c=linb.cache.dom[id]))return;if(!(t=c.events))return;if(flag)linb.dom._getEventName(type).each(function(o){delete t[o]});else{if(typeof event_id=='string'){if(k=t[name]){if(k.exists(event_id))k.removeValue(event_id);delete k[event_id]}}else delete t[name]}})},this);return this},getEvent:function(name,event_id){var id;if(!(id=linb.dom.getId(this.get(0))))return;if(event_id)return _.get(linb.cache.dom,[id,'events',name,'$'+event_id]);else{var r=[],arr=_.get(linb.cache.dom,[id,'events',name]);arr.each(function(o,i){r.push([o,arr[o]])});return r}},clearEvent:function(){this.clearEventHandler();return this.each(function(o){var id,c,t;if(!(id=linb.dom.getId(o)))return;if(!(c=linb.cache.dom[id]))return;_.filter(c.addition,function(i,v){if(v.startWith("on"))return false});_.breakO(c.events,2);delete c.events})},addObserver:function(name,event_id,index,fun,args,target){return this.addEvent(name,function(){var para=[];for(var i=0,l=arguments.length,n;n=arguments[i];i++)para[para.length]=(args&&args[i])||n;return _.tryF(fun,para,target||this)},event_id,index)},removeObserver:function(name,event_id){return this.removeEvent(name,event_id)},fireEvent:function(name,args,from){var type=linb.dom._getEventType(name),t,s='on'+type,me=arguments.callee,f=linb.dom._eventhander,f1=me.f1||(me.f1=function(){this.returnValue=false}),f2=me.f2||(me.f2=function(){this.cancelBubble=true});args=args||{};return this.each(function(o){from=from||o;if(typeof from[s]!='function'){if(!from[s]&&!(from.getAttribute&&from.getAttribute(s)))return;from[s]=f}_.merge(args,{type:type,target:from,$e:true,$name:name,preventDefault:f1,stopPropagation:f2},'all');if('blur'==type||'focus'==type)return from[type].call(from,args);else return from[s].call(from,args)})},canFocus:function(){var map=arguments.callee.map||(arguments.callee.map="a,input,select,textarea,button".toHash(true)),node;return!!((node=this._nodes[0])&&node.focus&&map[node.tagName.toLowerCase()]&&linb.dom.getStyle(node,'display')!='none'&&linb.dom.getStyle(node,'visibility')!='hidden'&&node.offsetWidth>0&&node.offsetHeight>0)},activate:function(){if(this.canFocus()){var node=this.get(0);node.focus();if(node.select)node.select()}},focus:function(){if(this.canFocus())this.get(0).focus()},blur:function(){if(!this.length())return this;try{this.get(0).blur()}catch(e){}finally{return this}},enable:function(value){if(typeof value!='undefined')this.disabled(!value);else return!this.disabled();return this},inlineBlock:function(){if(linb.browser.gek)return this.display('-moz-inline-block').display('-moz-inline-box');else return this.display('inline-block')},topZindex:function(flag){var i=1000,j=0,k,node=this.get(0),p=node.offsetParent,t,o;if(node.nodeType!=1||!p)return 1;t=p.childNodes;for(k=0;o=t[k];k++){if(o==node||o.nodeType!=1||o.style.display=='none'||o.style.visibility=='hidden'||o.zIndexIgnore)continue;j=parseInt(o.style&&o.style.zIndex)||0;i=i>j?i:j}i++;if(i>=linb.ini.top_zIndex)linb.ini.top_zIndex=i+1000;if(flag)node.style.zIndex=i;else{j=parseInt(node.style.zIndex)||0;return i>j?i:j}return this},busy:function(flag){if(linb.dom._busy)return;var id=this.id();if(typeof linb.dom._cursor[id]=='undefined'){linb.dom._cursor[id]=_.str(this.cursor());this.cursor('wait');linb.dom.busy(flag)}return this},free:function(){if(!linb.dom._busy)return;var id=this.id();if(typeof linb.dom._cursor[id]!='undefined'){cursor=_.str(linb.dom._cursor[id],'default');this.cursor(cursor);delete linb.dom._cursor[id]}linb.dom.free();return this},UIAction:function(fun){var self=this;linb.thread(null,[function(){self.busy()},fun,function(){self.free();self=null}]).start()},nextFocus:function(dir,inn,set){dir=_.bool(dir,true);var self=this.get(0),node=this.$iterator('',dir,inn,function(node){return node!==self&&linb([node],false).canFocus()});if(!node.isEmpty()&&set!==false)node.focus();return node},startDrag:function(e,profile,key,data){return linb.dragDrop.drag(e,this.get(0),profile,key||'',data||null)},dragable:function(flag,profile,key,data){if(typeof flag=='undefined')flag=true;else if(typeof flag=='object'){profile=flag;flag=true}if(flag===true)this.addEvent('onMousedown',function(e){if(linb.event.getSrc(e)!=this)return true;linb([this],false).startDrag(e,profile,key,data)},'dd',-1);else this.removeEvent('onMousedown','dd');return this},dropable:function(flag,key){key=_.str(key,'default');if(flag)return this.each(function(o){linb.dragDrop.register(o,key)});else return this},fx:function(args,onStart,onEnd,time,step,type,id){var me=arguments.callee,hash=me.lib||(me.lib={line:function(x){return x},inexp:function(x){return(x==0)?0:Math.pow(2,10*(x-1))},outexp:function(x){return(x==1)?1:-Math.pow(2,-10*x)+1},insine:function(x){return-1*Math.cos(x*(Math.PI/2))+1},outsine:function(x){return Math.sin(x*(Math.PI/2))},inoutsine:function(x){return-1/2*(Math.cos(Math.PI*x)-1)}}),color=me.color||(me.color=function(type,args,step,j){var f,fun,value=0+(100-0)*hash[type](j/step),from=args[0],to=args[1];if(typeof from!='string'||typeof to!='string')return'#fff';if(value<0)return from;else if(value>100)return to;f=function(str){return(str.charAt(0)!='#')?('#'+str):str};from=f(from);to=f(to);f=function(str,i,j){return parseInt(str.slice(i,j),16)||0};fun=function(o){return{red:f(o,1,3),green:f(o,3,5),blue:f(o,5,7)}};from=fun(from);to=fun(to);f=function(from,to,value,c){var r=from[c]+Math.round((value/100)*(to[c]-from[c]));return(r<16?'0':'')+r.toString(16)};return'#'+f(from,to,value,'red')+f(from,to,value,'green')+f(from,to,value,'blue')});time=time||200;step=step||5;type=typeof hash[type]!='undefined'?type:'line';var threadid=id||_.id(),self=this,delay=time/step,i,j=0,value,funs=[function(threadid){if(++j>step){linb.thread(threadid).abort();return false}_.each(args,function(o,i){if(typeof o=='function')o(j,step);else{value=String((i.toLowerCase().endWith('color'))?color(type,o,step,j):(o[0]+(o[1]-o[0])*hash[type](j/step)));(self[i])?(self[i](value)):(self.setStyle(i,value))}})}];return linb.thread(threadid,funs,delay,null,onStart,onEnd,true)},popToTop:function(pos,parent,type){var region,target=this;type=(type||1).toString();parent=linb(parent||document.body);target.setStyle({position:'absolute',left:'0',top:'0',visibility:'hidden',display:'block',zIndex:linb.ini.top_zIndex});parent.attach(target);if(pos['linb.dom']||pos.nodeType){var node=linb(pos);var abspos=node.absPos(null,parent);region={left:abspos.left,top:abspos.top,width:node.offsetWidth(),height:node.offsetHeight()}}else{region={left:pos.left-8,top:pos.top-8,width:16,height:16}}pos={left:0,top:0};var t=linb(window),box={};box.left=t.scrollLeft();box.top=t.scrollTop();box.width=t.width()+box.left;box.height=t.height()+box.top;var w=target.offsetWidth(),h=target.offsetHeight();var hi,wi;switch(type){case'1':hi=false;wi=true;break;case'2':hi=true;wi=false;break;case'3':hi=false;wi=false;break;case'4':hi=wi=true;break}if(hi){if(region.top+h<box.height)pos.top=region.top;else pos.top=region.top+region.height-h}else{if(region.top+region.height+h<box.height)pos.top=region.top+region.height;else pos.top=region.top-h}if(wi){if(region.left+w<box.width)pos.left=region.left;else pos.left=region.left+region.width-w}else{if(region.left+region.width+w<box.width)pos.left=region.left+region.width;else pos.left=region.left-w}if(pos.left+w>box.width)pos.left=box.width-w;if(pos.left<box.left)pos.left=box.left;if(pos.top+h>box.height)pos.top=box.height-h;if(pos.top<box.top)pos.top=box.top;target.cssPos(pos).setStyle({visibility:'visible',display:'block'})},setBlurTrigger:function(id,trigger,group,upper){if(!trigger){linb([document],false).beforeMousedown(null,id);return}var target=group?group:linb(this.get());var fun;if(upper&&(fun=linb([document],false).getEvent('beforeMousedown',upper)))fun.target.add(target);var f=function(p,e){var pos,size,b=true,me=arguments.callee,p=linb.event.getPos(e);me.target.each(function(o){if(o.parentNode){o=linb([o],false);pos=o.absPos();size=o.cssSize();if(p.left>=pos.left&&p.top>=pos.top&&p.left<=(pos.left+size.width)&&p.top<=(pos.top+size.height))return b=false}});if(b){linb([document],false).beforeMousedown(null,id);_.tryF(me.trigger);if(fun){fun.target.minus(arguments.callee.target);fun=null}delete me.trigger;delete me.target;return}return true};f.target=target;f.trigger=trigger;linb([document],false).beforeMousedown(f,id,0);return this},ieTrigger:function(flat){var s=this;_.asyRun(function(){s.setStyle('wordWrap','break-word')});_.asyRun(function(){s.setStyle('wordWrap','normal');s=null});return this}},Static:{_eventhander:function(){return linb.event(arguments[0],this)},eventhander:"return linb.event(arguments[0],this)",boxArr:'left,top,right,bottom,width,height'.toArr(),_eventtag:'before,on,after'.toArr(),_events:("mouseover,mouseout,mousedown,mouseup,mousemove,click,dblclick,"+"keydown,keypress,keyup,"+"resize,scroll,"+"blur,focus,contextmenu,"+"load,unload,"+"change,reset,select,submit,"+"abort,error,ready,"+"location,"+"dragbegin,drag,dragend,dragleave,dragenter,dragover,drop").toArr(),_cursor:{},setPxStyle:function(node,key,value){var style=node.style;if(value||value===0){value=(String(parseFloat(value))==String(value))?(parseInt(value)||0)+"px":value;if((key=='width'||key=='height')&&value.charAt(0)=='-')value='0';if(style[key]!=value){style[key]=value;return true}}return false},$gc:function(){var i,o,w,bak=[];for(i in linb.cache.dom){o=linb.cache.dom[i];if((!o)||(window==o.domNode)||(document==o.domNode))continue;if(!document.getElementById(o.domId)){o.$gc();bak[bak.length]=i}}for(i=0;i<bak.length;)delete linb.cache.dom[bak[i++]];if(linb.browser.ie6)CollectGarbage()},clean:function(e){var t,i,a,arr=window===e?[window]:document===e?[e]:e.constructor==Array?e:e['linb.dom']?e._nodes:e.toDomNodes?e.toDomNodes():typeof e=='function'?e.apply(arguments[2],arguments[1]):typeof e!='string'?[e]:e.charAt(0)=='{'?linb.SC(e.slice(1,e.length-1)).getAll().reBoxing()._nodes:[e];if(arr[0]&&!arr[0].nodeType){a=[];for(i=0;i<arr.length;i++)if(t=(typeof(t=arr[i])=='string'?document.getElementById(t):(t&&t.domNode)?t.domNode:t)||null)a[a.length]=t}else a=arr;return a},getStyle:function(node,key,flag){if(!node.style)return'';var value=node.style[key];if(!value||flag){var me=arguments.callee,t,map=me.map||(me.map='float,cssFloat,styleFloat'.toHash(true)),cache=me.cache||(me.cache={}),key=cache[key]||(cache[key]=key.replace(/\-(\w)/g,function(a,b){return b.toUpperCase()}));if(map[key])key=linb.browser.ie?"styleFloat":"cssFloat";value=((t=document.defaultView)&&t.getComputedStyle)?(t=t.getComputedStyle(node,null))?t[key]:'':node.currentStyle[key]}return value||''},_matixid:"linb.matix::",isMatix:function(id){return id.startWith(this._matixid)},getTemp:function(index){var i=1,id,o,count=0,me=arguments.callee,m=me.m;index=index||1;while(1){id=this._matixid+i;if(o=linb.dom.byId(id)){if(!o.firstChild&&++count==index)return linb([o],false)}else{if(!m){m=document.createElement('div');m.style.position='absolute';m.style.visibility='hidden';m.style.width=m.style.height='0';m.style.left=m.style.top='-10000px';me.m=m}o=m.cloneNode(false);o.id=id;document.body.insertBefore(o,document.body.firstChild);return linb([o],false)}i++}},iniBox:function(){var i,o,hash={};for(i=0;o=this.boxArr[i++];)hash[i]=null;return hash},setCover:function(){var me=arguments.callee,arg1=arguments[0],arg2=arguments[1],id="linb.temp:cover:",id2="linb.temp:message:",o1,o2,body=linb([document.body],false);if((o1=linb(id)).isEmpty()){body.addFirst(o1=linb.create('<div id="'+id+'" style="position:absolute;display:none;left:0;top:0;z-index:0;background-image:url('+linb.ini.path+'bg.gif)">')).addFirst(linb.create('<div id="'+id2+'" style="position:absolute;display:none;"><img src="'+linb.ini.path+'loading.gif" border="0"/><div style="font-size:12px;"></div></div>'))}o2=linb(id2);if(arg1===false){if(me.show){o1.setStyle({display:'none',zIndex:'0'});body.cursor("");o2.display('none').last().empty();me.show=false}}else{if(!me.show){var t=linb([window],false),w=t.scrollWidth(),h=t.scrollHeight();o1.cssSize({width:w,height:h}).setStyle({display:'block',zIndex:(linb.ini.top_zIndex+200),cursor:'wait'});body.cursor("wait");var x=t.scrollLeft()+t.width()/2,y=t.scrollTop()+t.height()/2;o2.left(x).top(y).display('block').zIndex(linb.ini.top_zIndex+300);me.show=true}if(typeof arg1=='string')o2.last().get(0).innerHTML=(arg2?o2.html():'')+arg1}},getId:function(o){return(window===o)?linb.ini.id_window:(document===o)?linb.ini.id_document:o?o.id:''},byId:function(e){return document.getElementById(e)},_getEventName:function(s,pos){var me=arguments.callee,map=me.map||(me.map={});return map[s+pos]||(map[s+pos]=pos?((this._eventtag.exists(pos)?pos:'on')+s.initial()):this._eventtag.copy().each(function(o,i){this[i]=o+s.initial()}))},_getEventType:function(name){var me=arguments.callee,map=me.map||(me.map={});return map[name]||(map[name]=name.replace(/^(on|before|after)/,'').toLowerCase())},hasHandler:function(node,name){return!!(node[name]||(node.getAttribute&&node.getAttribute(name)))},includeCSSFile:function(path){var me=arguments.callee,r1=me.r1||(me.r1=/(url\()\s*([\t\s\w()\/.\\'"-:#=&?]+)\s*(\))/g),r2=me.r2||(me.r2=/(AlphaImageLoader\(src\=['"])([\t\s\w()\/.\\'"-:#=&?~]*)(['"])/g),r3=me.r3||(me.r3=/^(file||https?||ftps?):\/\//);linb.request(path,'',function(str){str=str.replace(r1,function(s,a,b,c){return a+(r3.test(b)?b:(path+b))+c});if(linb.browser.ie)str=str.replace(r2,function(s,a,b,c){return a+(r3.test(b)?b:(path+b))+c});linb.dom.addHeadNode('style',str,path)},function(str){},false,'GET');return path},addHeadNode:function(type,txt,title,args){var i,t,e,me=arguments.callee,head=me.head||(me.head=document.getElementsByTagName("head")[0]);type=(t=(type=='js'))?'script':'style';e=document.createElement(type);e.setAttribute("type","text/"+(t?"javascript":"css"));if(args)for(i in args)e.setAttribute(i,args[i]);if(txt)if(linb.browser.ie){if(t)e.text=txt;else e.styleSheet.cssText=txt}else e.appendChild(document.createTextNode(txt));head.appendChild(e);e.disabled=true;e.disabled=false;return e},onload:function(fun){arguments.callee.funs.push(fun)},submit:function(action,data,method,target,enctype){data=_.hash(data);method=_.str(method,'get');action=_.str(action);target=_.str('_blank');var _t=[];_.each(data,function(o,i){_t.push('<textarea name="'+i+'">'+(typeof o=='object'?_.serialize(o):o)+'</textarea>')});var d=('<form target="'+target+'" action="'+action+'" method="'+method+(enctype?'" enctype="'+enctype:'')+'">'+_t.join('')+'<input type="hidden" name="rnd" value="'+_.timeStamp()+'"></form>').toDom();linb.dom.getTemp().addLast(d);d.get(0).submit();d.remove()},busy:function(flag){if(linb.dom._busy)return;if(flag!==false)linb.dom.setCover(true);linb.dom._busy=true},free:function(cursor){if(!linb.dom._busy)return;linb.dom.setCover(false);linb.dom._busy=false},UIAction:function(fun){linb.thread(null,[function(){linb.dom.busy()},fun,function(){linb.dom.free()}]).start()},fxProxy:function(from,to,onStart,onEnd,time,step,type,id){var args={},me=arguments.callee,arr=me.arr||(me.arr=arr='left,top,width,height'.toArr()),node=me.node=(me.node=linb.create("<div style='border:dashed 1px blue;position:absolute;left:-10000px;'></div>"));arr.each(function(i){args[i]=[from[i],to[i]]});linb(document.body).addLast(node);node.zIndex(linb.ini.top_zIndex+10);return node.fx(args,onStart,function(){node.cssSize({width:0,height:0}).remove(false);_.tryF(onEnd)},time,step,type,id)}},After:function(d){new function(){var self=linb.dom.onload,doc=d||document;self.funs=[];self.fun=function(){var self=linb.dom.onload;if(!self.ok){self.ok=true;self.funs.each(function(o){_.tryF(o)})}else{self.fun=null;self.funs.length=0}};var f=function(){var t;_.tryF(linb.dom.onload.fun);if(doc.removeEventListener)doc.removeEventListener("DOMContentLoaded",arguments.callee,false);if(t=linb.dom.byId("linb:onload:",doc)){t.onreadystatechange=null;linb(t).remove()}if(linb.dom.onload.timer)clearInterval(linb.dom.onload.timer)};if(self.timer)clearInterval(self.timer);if(doc.addEventListener&&!linb.browser.kde)doc.addEventListener("DOMContentLoaded",f,false);else if(linb.browser.ie){doc.write("<sc"+"ript id='linb:onload:' defer src='//:'><\/sc"+"ript>");linb.dom.byId("linb:onload:",doc).onreadystatechange=function(){if(this.readyState=="complete")f()}}else{self.timer=setInterval(function(){if(/loaded|complete/.test(doc.readyState))f()},1)}}}});new function(){var dom=linb.dom;_.each({parent:['y',false],pre:['x',false],next:['x',true],first:['y',true],last:['y',1]},function(o,i){this.plugIn(i,function(index){if(typeof index=='string'){css=index;index=0}if(index===0)return this;else return this.$iterator(o[0],o[1],true,index||1)})},dom);'nodeName,nodeType,tagName,offsetLeft,offsetTop,offsetParent,scrollWidth,scrollHeight'.toArr().each(function(o){this.plugIn(o,function(value){var _t=this.get(0);if([window,document].exists(_t)){if("scrollWidth"==o)return(linb.browser.contentBox&&document.documentElement.scrollWidth)||document.body.scrollWidth;if("scrollHeight"==o)return(linb.browser.contentBox&&document.documentElement.scrollHeight)||document.body.scrollHeight}_t=_t[o];return typeof _t=='string'?_t.toLowerCase():_t})},dom);[['paddingH','paddingTop','paddingBottom'],['paddingW','paddingLeft','paddingRight'],['borderH','borderTopWidth','borderBottomWidth'],['borderW','borderLeftWidth','borderRightWidth'],['marginW','marginLeft','marginRight'],['marginH','marginTop','marginBottom']].each(function(o){var node,fun=linb.dom.getStyle;this.plugIn(o[0],function(){node=this.get(0);return(parseInt(fun(node,o[1]))+parseInt(fun(node,o[2])))||0})},dom);[['W','width','paddingW','borderW','marginW','clientWidth','offsetWidth'],['H','height','paddingH','borderH','marginH','clientHeight','offsetHeight']].each(function(o){this.plugIn(o[0],function(node,index,value){var n,r,t,style=node.style,me=arguments.callee,r1=me.r1||(me.r1=/%$/),getStyle=linb.dom.getStyle,f=linb.dom.setPxStyle,type=typeof value;if(type=='undefined'||type=='boolean'){if(value===true){n=(getStyle(node,'display')=='none');if(n){var temp=linb.dom.getTemp().html('*',false);linb([node],false).swap(temp);var b,p,d;b=style.visibility,p=style.position,d=style.display;p=p||'';b=b||'';d=d||'';style.visibility='hidden';style.position='absolute';style.display='block'}}switch(index){case 1:r=getStyle(node,o[1]);if(isNaN(parseInt(r))||r1.test(r))r=me(node,2)-(linb.browser.contentBox?linb([node],false)[o[2]]():0);r=parseInt(r)||0;break;case 2:r=node[o[5]];if(!r)r=node[o[6]]-linb([node],false)[o[3]]();break;case 3:r=node[o[6]];if(!r)r=me(node,1)+(linb.browser.contentBox?(t=linb([node],false))[o[2]]():0)+t[o[3]]();break;case 4:r=me(node,3);r+=linb([node],false)[o[4]]();break}if(n){style.display=d;style.position=p;style.visibility=b;linb([node],false).swap(temp);temp.empty(false)}return parseInt(r)||0}else{switch(index){case 1:if(f(node,o[1],value))if(linb.dom.hasHandler(node,'onresize')){var args={};args[o[1]]=1;linb([node],false).onResize(true,args)}break;case 2:me(node,1,value-(linb.browser.contentBox?linb([node],false)[o[2]]():0));break;case 3:me(node,1,value-(t=linb([node],false))[o[3]]()-(linb.browser.contentBox?t[o[2]]():0));break;case 4:me(node,1,value-(t=linb([node],false))[o[4]]()-t[o[3]]()-(linb.browser.contentBox?t[o[2]]():0));break}}})},dom);[['clientWidth','W',2],['offsetWidth','W',3],['realWidth','W',4],['clientHeight','H',2],['offsetHeight','H',3],['realHeight','H',4]].each(function(o){this.plugIn(o[0],function(value){var type=typeof value;if(type=='undefined'||type=='boolean')return this[o[1]](this.get(0),o[2]);else return this.each(function(v){this[o[1]](v,o[2],value)})})},dom);[['leftBy','left','offsetLeft'],['topBy','top','offsetTop'],['widthBy','width','offsetWidth'],['heightBy','height','offsetHeight']].each(function(o){this.plugIn(o[0],function(value,flag){if(value===0)return this;var t,m,v,args,k=o[1];return this.each(function(node){t=node.style;m=t[k];if(m=='auto')m=this[o[2]](node);v=(parseInt(m)||0)+value;if(k=='width'||k=='height')v=v>0?v:0;t[k]=v+'px';if(flag){args={};args[k]=1;if((k=='left'||k=='top')&&linb.dom.hasHandler(node,'onlocation'))linb([node],false).onLocation(true,args);if((k=='width'||k=='height')&&linb.dom.hasHandler(node,'onresize')){linb([node],false).onResize(true,args)}}},this)})},dom);dom.addCustomEvent=function(o){if(!(o instanceof Array))o=[o];var f;o.each(function(o){f=function(fun,event_id,flag,tagVar){if(typeof fun=='function')return this.addEvent(o,fun,event_id,flag,tagVar);else if(fun===null)return this.removeEvent(o,event_id,flag);var args=arguments[1]||{};args.$all=(arguments[0]===true);return this.fireEvent(o,args)};f.$event$=1;this.plugIn(o,f)},this);return this};'disabled,readonly,checked,className,value,title,name,href,src'.toArr().each(function(o){this.plugIn(o,function(value){return this.attr(o,value)})},dom);'scrollLeft,scrollTop,tabIndex'.toArr().each(function(o){this.plugIn(o,function(value,flag){if(typeof value!='undefined')return this.each(function(v){v[o]=value});else{var v=this.get(0);if(v===window||v===document){if("scrollTop"==o)return window.pageYOffset||(linb.browser.contentBox&&document.documentElement.scrollTop)||document.body.scrollTop;if("scrollLeft"==o)return window.pageXOffset||(linb.browser.contentBox&&document.documentElement.scrollLeft)||document.body.scrollLeft}return v[o]}})},dom);'cursor,backgroundColor,display,overflow,color,background,position,zIndex,visibility,border'.toArr().each(function(o){this.plugIn(o,function(value){if(value===undefined){var node=this._nodes[0];if(!node||node.nodeType!=1)return;var r=linb.dom.getStyle(node,o);if('zIndex'==o)r=parseInt(r)||0;return r}else return this.setStyle(o,value)})},dom);linb.dom.boxArr.each(function(o){this.plugIn(o,function(value){var node=this._nodes[0],type=typeof value;if(!node||node.nodeType==3)return;if(type=='undefined'||type=='boolean'){if(o==='width'){if(document===node)return Math.max(document.body.scrollWidth,document.body.offsetWidth);if(window===node)return window.innerWidth||(linb.browser.contentBox&&document.documentElement.clientWidth)||document.body.clientWidth}if(o==='height'){if(document===node)return Math.max(document.body.scrollHeight,document.body.offsetHeight);if(window===node)return window.innerHeight||(linb.browser.contentBox&&document.documentElement.clientHeight)||document.body.clientHeight}if(o=='width')value=this.W(node,1,value);else if(o=='height')value=this.H(node,1,value);else value=linb.dom.getStyle(node,o);return value=='auto'?value:(parseInt(value)||0)}else{var f=linb.dom.setPxStyle,t,a;return this.each(function(v){if(v.nodeType!=1)return;switch(o){case'right':case'bottom':f(v,o,value);break;default:if(v.style[o]!==value){if(o=='width')this.W(v,1,value);else if(o=='height')this.H(v,1,value);else{if(f(v,o,value))if((o=='top'||o=='left')&&linb.dom.hasHandler(node,'onlocation')){a={};a[o]=1;linb([v],false).onLocation(true,a)}}}}},this)}})},dom);dom._events.each(function(o){this._getEventName(o).each(function(o){this.addCustomEvent(o)},this)},dom)};Class('linb.dragDrop',null,{Static:{_proxy_id:"linb.dd:proxy:",_proxy_idi:"linb.dd:td:",_proxy_size:50,_proxy_type:'blank,move,shape,copy,icon,none'.toHash(true),_dragMode:{move:'-16px',ref:'-32px',add:'-48px'},$:{},_left:function(value){with(this){if(docking_offset>0&&docking_x&&docking_x.length){var l=docking_x.length;while(l--)if(Math.abs(value-docking_x[l])<=docking_offset)return docking_x[l]}if(grid_width>1)return Math.floor(value/grid_width)*grid_width;return value}},_top:function(value){with(this){if(docking_offset>0&&docking_y&&docking_y.length){var l=docking_y.length;while(l--)if(Math.abs(value-docking_y[l])<=docking_offset)return docking_y[l]}if(grid_height>1)return Math.floor(value/grid_height)*grid_height;return value}},_ini:function(o){with(this){var _t=linb(window);_box={width:_t.width()+_t.scrollLeft(),height:_t.height()+_t.scrollTop()};origin_x=left;origin_y=top;if(proxy=o){proxystyle=o.get(0).style;_size=proxy.cssSize();_absPos=proxy.absPos(null,target_parent);_cssPos=proxy.cssPos();cssPos_offset_x=left-_cssPos.left;cssPos_offset_y=top-_cssPos.top;absPos_offset_x=left-_absPos.left;absPos_offset_y=top-_absPos.top;limit_left=left-offset_left;limit_right=left+offset_right;limit_top=top-offset_top;limit_bottom=top+offset_bottom;current.left=pre.left=_cssPos.left;current.top=pre.top=_cssPos.top;if("move"!==type){_zIndex=proxy.zIndex();proxy.zIndex(linb.ini.top_zIndex+100)}if(opacity)proxy.opacity(0.8)}}},_reset:function(){var d=this;d.start=null;d.showDDMark(null);d.resetProxy();d._defer=d.defer=0;d.type='shape';d.cursor='move';d._cursor='';d.move=true;d.proxystyle=d._onDrag=d._onDragover=null;d.key=d.data=d.dragKey=d.dragData=null;d._begin=_.timeStamp();d.mousemove=d.mouseup=d.onselectstart=d.ondragstart='*';d._zIndex=d._button=0;d.pre={left:0,top:0};d.current={left:0,top:0};d.left=d.top=d.origin_x=d.absPos_offset_y=d.absPos_offset_x=d.cssPos_offset_x=d.origin_y=d.cssPos_offset_y=d.limit_left=d.limit_right=d.limit_top=d.limit_bottom=0;d.offset_bottom=d.offset_left=d.offset_right=d.offset_top=d.drop2=false;d._current_bak=d._current=d._source=d._data=d.proxy=d.proxyIn=d._size=d._absPos=d._cssPos=d._box=null;d._timer=d.docking_offset=-1;d.docking_x=d.docking_y=[];d.working=false;d._stop=false;d.pack=d.unpack=null;d.grid_width=d.grid_height=1;d.opacity=d._flag=d.horizontal=d.vertical=d.topZindex=d._flag=false;d.target_left=d.target_top=d.target_width=d.target_height=null;d.target_parent=null;return this},abort:function(){this._stop=true},_end:function(){with(this){if(proxy){unpack?unpack():_unpack();if(opacity)proxy.opacity(1)}if(onselectstart!='*')document.body.onselectstart=onselectstart;if(ondragstart!='*')document.ondragstart=ondragstart;if(mousemove!='*')document.onmousemove=mousemove;if(mouseup!='*')document.onmouseup=mouseup}return this},drag:function(e,node,profile,key,data){with(this){_end()._reset();e=e||window.event;if(linb.event.getBtn(e)>=2)return true;_source=node=linb(node);_cursor=_source.cursor();if(!node.id())node.id(_.id(),true);_defer=defer=_.numb(profile&&profile.defer,defer);if(profile){if(true===profile.cursor)profile.cursor=_cursor;type=typeof profile.icon=='string'?"icon":_proxy_type[type]?type:'shape'}profile=_.hash(profile);var _pos=linb.event.getPos(e);profile.left=_pos.left;profile.top=_pos.top;profile._button=linb.event.getBtn(e);dragKey=key||(profile&&profile.key);dragData=data||(profile&&profile.data);this.start=function(e){var t;_source.beforeDragbegin();if(_flag||_stop){_end()._reset();return false}_.merge(this,profile,"all");_ini(pack?pack():(type=='none')?null:_pack(_pos,node));if(profile.left>=_box.width||profile.top>=_box.height){_end()._reset();return true}_flag=true;_source.onDragbegin();if(defer<=0){mousemove=document.onmousemove;mouseup=document.onmouseup}document.onmousemove=$onDrag;document.onmouseup=$onDrop;working=true;_source.afterDragbegin();if(defer>0)$onDrag.call(this,e)};if(linb.browser.ie){ondragstart=document.ondragstart;onselectstart=document.body.onselectstart;document.ondragstart=document.body.onselectstart=null;if(document.selection)_.tryF(document.selection.empty)}linb.event.stopBubble(e);if(node.get(0)!==document)linb(document).onMousedown(true,linb.event.getEventPara(e));if(defer<=0){_.tryF(this.start,[e],this);return false}else{mouseup=document.onmouseup;document.onmouseup=function(e){linb.dragDrop._end()._reset();return _.tryF(document.onmouseup,[e],null,true)};mousemove=document.onmousemove;document.onmousemove=function(e){if(--_defer<=0)linb.dragDrop.start(e);return false}}}},$onDrag:function(e){with(linb.dragDrop){e=e||window.event;if((!_flag)||_stop||(linb.browser.ie&&(!e.button))){$onDrop(e);return true}var _pos=linb.event.getPos(e);left=_pos.left;top=_pos.top;if(!_flag)return false;if(proxy){current.left=vertical?_cssPos.left:_left(((offset_left!==false||offset_right!==false)?((left<=limit_left)?limit_left:(left>=limit_right)?limit_right:left):left)-cssPos_offset_x);current.top=horizontal?_cssPos.top:_top(((offset_top!==false||offset_bottom!==false)?((top<=limit_top)?limit_top:(top>=limit_bottom)?limit_bottom:top):top)-cssPos_offset_y);if(current.left-pre.left)proxystyle.left=current.left+'px';if(current.top-pre.top)proxystyle.top=current.top+'px';pre.left=current.left;pre.top=current.top;if(_onDrag)_onDrag(e);else _source.onDrag(true)}else{if(_onDrag)_onDrag(e);else _source.onDrag(true)}return false}},$onDrop:function(e){with(linb.dragDrop){e=e||window.event;_end();if(_flag){var r=_source.onDragend(true);if(_current)linb(_current.id).onDrop(true)}_reset();linb.event.stopBubble(e);_.tryF(document.onmouseup,[e]);return!!r}},getOffset:function(){with(this)return proxy?{width:current.left-origin_x+cssPos_offset_x,height:current.top-origin_y+cssPos_offset_y}:{width:left-origin_x,height:top-origin_y}},showDDMark:function(o){if(this._Region&&this._Region.parent())this._Region.remove(false);if(this._R){this._R.setStyle('backgroundColor',this._RB);delete this._R;delete this._RB}if(o){if(!this._Region)this._Region=linb.create('<div style="font-size:0;line-height:0;border-top:dashed 1px blue;left:0;top:0;width:100%;height:0;z-index:'+linb.ini.top_zIndex+';position:absolute"></div><div style="font-size:0;line-height:0;border-right:dashed 1px blue;right:0;top:0;height:100%;width:0;z-index:'+linb.ini.top_zIndex+';position:absolute"></div><div style="font-size:0;line-height:0;border-bottom:dashed 1px blue;height:0;z-index:'+linb.ini.top_zIndex+';bottom:0;left:0;width:100%;position:absolute"></div><div style="font-size:0;line-height:0;border-left:dashed 1px blue;width:0;z-index:'+linb.ini.top_zIndex+';left:0;top:0;height:100%;position:absolute"></div>');o=linb(o);if(o.display()=='block')o.addLast(this._Region);else{this._RB=o.getStyle('backgroundColor');this._R=o;o.setStyle('backgroundColor','#FA8072')}if(this.proxyIn&&this.type=='icon')this.proxyIn.setStyle('backgroundPosition','left '+this._dragMode[this.dragMode])}else{if(this.proxyIn&&this.type=='icon')this.proxyIn.setStyle('backgroundPosition','left top')}},setProxy:function(child,pos){var t;if(!linb.dom.byId(this._proxy_id))linb(document.body).addFirst(linb.dom.create('<table id="'+this._proxy_id+'" cellspacing="'+this._proxy_size+'" cellpadding="0" style="left:0;top:0;border:0; border-spacing:'+this._proxy_size+'px; border-collapse: separate; position: absolute;"><tbody><tr><td id="'+this._proxy_idi+'"></td></tr></tbody></table>'));t=linb(this._proxy_id);if(this.drop2){t.attr('cellSpacing',0).setStyle('borderSpacing',0)}else{pos.left-=this._proxy_size;pos.top-=this._proxy_size}if(this.target_parent)linb(this.target_parent).addLast(t);if(child){linb(this._proxy_idi).addLast(child);this.proxyIn=child}else this.proxyIn=linb(this._proxy_idi);t.setStyle({cursor:this.cursor,display:'',zIndex:linb.ini.top_zIndex+100}).absPos(pos,this.target_parent);return t},resetProxy:function(){if(linb.dom.byId(this._proxy_id)){var t,k,o=linb(this._proxy_idi),t=linb(this._proxy_id);o.empty();if(linb.browser.ie){for(var i in(k=o.get(0).style))if(typeof k[i]!='function')try{k[i]=''}catch(e){}}else o.get(0).setAttribute('style','');linb(document.body).addFirst(t.attr('cellSpacing',this._proxy_size).setStyle({zIndex:0,cursor:'',display:'none',borderSpacing:this._proxy_size+'px'}));this.proxyIn=null;this.proxystyle=null}},getProxyPos:function(){var pos=linb(this._proxy_id).absPos();pos.left+=this._proxy_size;pos.top+=this._proxy_size;return pos},_pack:function(mPos,node){var target,pos={},size={},d=this,t;if(d.target_left===null||null===d.target_top)t=node.absPos(null,d.target_parent);pos.left=null!==d.target_left?d.target_left:t.left;pos.top=null!==d.target_top?d.target_top:t.top;switch(d.type){case'copy':var t;size.width=_.numb(d.target_width,node.cssSize().width);size.height=_.numb(d.target_height,node.cssSize().height);var n=node.clone(_.bool(d.target_clone,true)).id('',true).setStyle({position:'static',cursor:d.cursor,margin:0}).opacity(0.5).cssSize(size);n.dig().id('',true);target=d.setProxy(n,pos);break;case'shape':size.width=null!==d.target_width?d.target_width:node.offsetWidth();size.height=null!==d.target_height?d.target_height:node.offsetHeight();size.width-=2;size.height-=2;target=d.setProxy(linb.dom.create('div').setStyle({border:'dashed 1px',fontSize:'0',lineHeight:'0'}).cssSize(size),pos);break;case'blank':target=d.setProxy(null,pos);break;break;case'icon':size.width=_.numb(d.target_width,16);size.height=_.numb(d.target_height,16);pos.left=_.numb(d.target_left,mPos.left-linb(window).scrollLeft()+size.width);pos.top=_.numb(d.target_top,mPos.top-linb(window).scrollTop()+size.height);target=d.setProxy(linb.dom.create('<div style="font-size:0;line-height:0;background:url('+d.icon+') no-repeat left '+(d.icon_top?d.icon_top:'top')+'" />').cssSize(size),pos);break;case'move':target=node;if(target.position()!='absolute')target.position('absolute').absPos(pos);target.cursor(d.cursor)}return target},_unpack:function(){var d=this,t,f;if(d.move&&("move"!=d.type)){if((t=linb(d._source)))if(!t.isEmpty()){if(t.position()!='absolute')t.position('absolute');t.absPos(this.getProxyPos());if(d.topZindex)t.topZindex(true)}}if("move"==d.type)d._source.cursor(d._cursor)},ignore:function(){this._current=null},register:function(id,key){var o=linb(id);o.beforeMouseover(function(){var t=linb.dragDrop;if(t.dragKey&&this._dropKeys[t.dragKey]){t._current=this;linb([this],false).onDragenter(true);if(t._current)_.resetRun('showDDMark',t.showDDMark,0,[this],t)}},'dd');o.beforeMouseout(function(){var t=linb.dragDrop;if(t.dragKey&&this._dropKeys[t.dragKey]){linb([this],false).onDragleave(true);t._current=null;_.resetRun('showDDMark',t.showDDMark,0,[null],t)}},'dd');o.each(function(o){var c=linb.cache.dom[o.id];(c.addition||(c.addition={}))["_dropKeys"]=null;(o._dropKeys||(o._dropKeys={}))[key]=true});return this}},After:function(){this._reset()}});Class('linb.Page',null,{Constructor:function(){this.properties=this.properties||{};_.merge((this.events=this.events||{}),this.constructor.EventHandlers)},Instance:{langKey:'',loaded:false,domNode:false,reLang:function(lang){if(lang){linb.reLang(lang);var key=this.langKey;if(!linb.Locale[linb.lang][key]){linb.request(linb.getPath(this.KEY.split('.')[0]+'.Locale.'+lang,'.js','js'),'',function(txt){linb.Locale[linb.lang][key]=_.unserialize(txt)},null,false)}if(this.domNode){var t,v,m=String(linb.UI.$langID),n=String(linb.UI.$langID+1);while(t=linb.dom.byId('lang:'+m)){if(v=linb.getStr(t.className))t.innerHTML=v;t.id='lang:'+n}linb.UI.$langID++}}},_fireevent:function(name,args){var t;if(t=this.events[name]){if(typeof t=='string')t=this[t];if(typeof t=='function')_.tryF(t,args,this.host||this)}},_show:function(threadid){if(this.parent&&this.nodes){this.nodes.filter(function(o){return!!o.box.hasDomRoot});if(this.customAttach)this.customAttach();else this.parent.attach(linb.UI.pack(this.nodes,false),this.showID);this._fireevent('afterShow',[this,threadid],this.host)}this.loaded=true},create:function(properties,events,host,threadid,flag){if(this.nodes)return false;var self=this;linb.thread.asyUI(threadid,[function(threadid){linb.dom.setCover(linb.getStr('Page.base'))},function(threadid){var t;if((t=self.base)&&t.length){linb.thread.suspend(threadid);linb.SC.group(t,function(key){linb.dom.setCover(linb.getStr('Page.base',key))},function(){linb.thread.resume(threadid)},function(){linb.thread.resume(threadid)})}},function(threadid){if(self.getResource)self.getResource.call(self,threadid)},function(threadid){if(self.langKey)self.reLang(linb.lang);linb.dom.setCover(linb.getStr('Page.com',self.KEY));var t;if((t=self.required)&&t.length){linb.thread.suspend(threadid);linb.SC.group(t,function(key){linb.dom.setCover(linb.getStr('Page.required',self.KEY,key))},function(){linb.thread.resume(threadid)},function(){linb.thread.resume(threadid)})}},function(threadid){linb.dom.setCover(linb.getStr('Page.build',self.KEY));self._fireevent('beforeIniComponents',[self,threadid]);_.tryF(self.iniComponents,null,self);self.domNode=true},function(threadid){self._fireevent('afterCreated',[self,threadid])},function(threadid){if(flag)self._show(threadid);if(self.background)linb.SC.background(self.background)}])},iniComponents:function(){return this.nodes=[]},show:function(){var parent,showID,properties,events,host,threadid;var arr=_.toArr(arguments);threadid=arr.pop();if(arr[0])parent=arr[0];if(arr[1])showID=arr[1];if(arr[2])properties=arr[2];if(arr[3])events=arr[3];if(arr[4])host=arr[4];this.parent=parent||linb(document.body);this.showID=showID;_.merge(this.properties,properties,'all');_.merge(this.events,events,'all');this.host=host||null;if(this.parepareData)this.parepareData(this.properties,this.events);if(false===this.create.apply(this,[properties,events,host,threadid,true]))this._show.call(this,threadid)},destroy:function(){if(this.beforeDestroy)this.beforeDestroy();if(this.nodes){this.nodes.each(function(o){o.destroy()});this.nodes.length=0}_.breakO([this.properties,this],2);if(this.afterDestroy)this.afterDestroy()}},Static:{EventHandlers:{afterShow:function(page,threadid){},afterCreated:function(page,threadid){},beforeIniComponents:function(page,threadid){}}}});new function(){linb.message=function(content,caption,type,width,time){width=width||200;var div,h,me=arguments.callee,stack=me.stack||(me.stack=[]),t=linb(window),left=t.scrollLeft()+t.width()/2-width/2,height=t.height();var div;if(!(div=stack.pop())){div='<div style="font-size:0;line-height:0;border:solid 1px;border-color:#fff #cdcdcd #cdcdcd #fff;position:absolute;overflow:visible;top:-50px;z-index:'+linb.ini.top_zIndex+'; background:#fefefe">'+'<div style="font-size:14px;overflow:hidden;font-weight:bold;padding:2px;"></div>'+'<div style="padding:5px;"></div>'+'</div>';div=linb.create(div);if(div.edged)div.edged();linb(document.body).addLast(div)}div.setStyle({left:left+'px',width:width+'px',visibility:'visible'}).first().html(caption||'').next().html(content||'');if(me.last&&div!=me.last){var l=me.last.left();me.last.fx({left:[l,l+(me.last.width+width)/2+20]}).start()}me.last=div;me.last.width=width;h=div.offsetHeight();if(linb.browser.ie6)div.cssSize({height:h,width:width+1});div.fx({top:[-h-20,20]}).start();_.asyRun(function(){div.fx({top:[20,height+20]},null,function(){stack.push(div);div.hide()}).start()},time||2000)};linb(document).onKeydown(function(p,e){linb.event.currentKey=linb.event.getKey(e);if(linb.event.currentKey){var set=linb.cache.hookKey[linb.event.currentKey.join(":")];if(set&&(_.tryF(set[0],set[1],set[2])===false)){linb.event.stopBubble(e);return false}}return true},"document").onKeyup(function(p,e){linb.event.currentKey=null},"document");linb(window).afterUnload(function(){linb.SC.$gc();linb.thread.$gc();linb([window,document]).clearEvent();linb(document.body).empty();linb.dom.$gc();_.breakO([linb,Class,_],3);window.Class=window.linb=window._=window.$=undefined},"window",-1);if(!linb.debug)window.onerror=function(msg,fileName,line){linb.message(msg+": "+fileName+" ("+line+")")};if(linb.browser.ie6){window.XMLHttpRequest=function(){return new ActiveXObject("Msxml2.XMLHTTP")};try{document.execCommand('BackgroundImageCache',false,true)}catch(e){}}linb.Locale.en={Class:"parent class '$0' not exists!",SC:"eval error '$0' in SC.",selector:'Invalid selector expression: "$0"!',XMLHTTP:'XMLHTTP return $0',timeout:'timeout',inValid:'Invalid data exists!',Page:{base:'Loading base Class "$0" ...',required:'Loading "$0" Class: "$1" ...',com:'Loading "$0" Components...',build:'Building "$0" Components...'}};linb.reLang('en')};new function(){Class('linb.Profile','linb.iProfile',{Instance:{links:function(o,id,target,lid){target=target||this;o[lid||this.$id]=target;if(o instanceof Array)o.push(target);this._links[id]=o;return this},antiLinks:function(id){if(!this._links)return;var o=this._links[id];if(!o)return;if(o instanceof Array)o.removeValue(o[this.$id]);delete o[this.$id];delete this._links[id];return this},antiAllLinks:function(){var id=this.$id,l=this._links,o;for(var i in l){o=l[i];if(o instanceof Array)o.removeValue(o[id]);delete o[id]}return this},resetCache:function(){},setEvents:function(events){if(events)_.merge(this,events,'all');return this},getEvents:function(){var t,hash={};_.each(this.box.$EventHandlers,function(o,i){if(this[i])hash[i]=this[i]},this);return hash},_applySetAction:function(fun,value){fun.call(this,value)},$gc:function(){this.resetCache();this.antiAllLinks();_.breakO(this)},destroy:function(){},boxing:function(){return this},beforeSerialized:function(){var t,o=this.box.beforeSerialized?this.box.beforeSerialized(this):this,r={alias:o.alias,key:o.key};if(o.host)r.host='$this$';if(o.appearance&&o.appearance!='default')r.appearance=o.appearance;if(o.behavior&&o.behavior._id!='default')r.behavior=o.behavior._id;if(o.template&&o.template._id!='default')r.template=o.template._id;var c={},p=o.box.$DataStruct,map=linb.Base.$specialChars;_.merge(c,o.properties,function(o,i){return(i in p)&&p[i]!==o&&!map[i.charAt(0)]});if(!_.isEmpty(c))r.properties=c;if(!_.isEmpty(t=this.getEvents()))r.events=t;var eh=o.box.$EventHandlers;_.filter(r.events,function(o,i){return o!=eh[i]});if(_.isEmpty(r.events))delete r.events;if(!_.isEmpty(o.CA))r.CA=_.copy(o.CA);if(!_.isEmpty(o.CB))r.CB=_.copy(o.CB);if(o.children&&o.children.length){r.children=o.children;r.children.sort(function(x,y){x=parseInt(x[0].properties.tabindex);y=parseInt(y[0].properties.tabindex);return x>y?1:x==y?0:-1})}return r},copy:function(){var o=new this.constructor;_.merge(o,this,'all');return o},clone:function(flag){var c=_.unserialize(_.serialize(this));if(!flag){var f=function(c,host){var self=arguments.callee;delete c.alias;if(host)c.host=host;if(c.children){c.children.each(function(a){self(a[0],host)})}};f(c,this.host)}return c}},Static:{getFromCacheId:function(id){return linb._object[id]}}});Class("linb.Base","linb.iBox",{Constructor:function(alias,properties,events){var c=this.constructor;if(typeof alias=='object'){events=alias.events;properties=alias.properties;alias=alias.alias}var profile=new linb.Profile;_.merge(profile,{properties:properties||{},alias:alias||c.pickAlias(),$id:_.id(),_links:[],box:c,key:c.KEY,'object':this},'all');c._namePool[profile.alias]=1;profile.setEvents(events);profile.links(c._cache,'self').links(linb.Base._cache,'base').links(linb._object,'linb');var self=this;profile.boxing=function(){return self};this._nodes=[profile]},Instance:{ini:function(properties,events,host){var profile=this.get(0);_.merge(profile.properties,properties,'all');profile.setEvents(events||profile.events||{});delete profile.events;profile.host=host;return this},$gc:function(){delete this.box._namePool[this.alias]},alias:function(str){if(str){delete this.constructor._namePool[this.get(0).alias];this.get(0).alias=str;this.constructor._namePool[str]}else return this.get(0).alias;return this},host:function(value){if(value)return this.each(function(o){o.host=value});else return this.get(0).host}},After:function(){var temp,me=arguments.callee;this._nameId=0;this._namePool={};this._nameTag=(t=this.KEY.split('.'))[t.length-1].toLowerCase();this._cache=[];if(this===linb.Base)return;var t,k,u,m,i,j,v;m=me.a1||(me.a1='$Keys,$DataModel,$DataStruct,$EventHandlers'.toArr());for(j=0;v=m[j++];){if(t=this.$parent){k={};for(i=0;u=t[i++];)_.merge(k,u[v]);this[v]=_.clone(k)}else this[v]={}}u=this.$Keys;for(i in u)if((t=u[i].split('-')).length)u[i]=this.KEY+"-"+t[t.length-1];u.KEY=u.$key=this.KEY;this.setDataModel(this.DataModel);delete this.DataModel;this.setEventHandlers(this.EventHandlers);delete this.EventHandlers;m=me.a5||(me.a5='createdTrigger,envTrigger'.toArr());for(j=0;v=m[j++];){temp=[];if(t=this.$parent)for(i=0;u=t[i];i++){if(u=u['$'+v])temp.push.apply(temp,u)}if(this[v])temp.push(this[v]);this['$'+v]=temp;delete this[v]}},Static:{$specialChars:'_,$'.toHash(true),$gc:function(){var k=this.$key;_.breakO([this.$DataModel,this.$DataStruct,this.$EventHandlers,this],2);Class.$gc(k)},getDefaultProp:function(){return _.copy(this.$DataStruct)},setDataModel:function(hash){var t,o,n,m,r,sc=linb.Base.$specialChars;var ds=this.$DataStruct,properties=this.$DataModel;for(var i in hash){if(!properties[i])properties[i]={};if(_.isHash(o=hash[i])){t=properties[i];_.merge(t,o,'all');ds[i]=typeof o.ini!='undefined'?o.ini:typeof ds[i]!='undefined'?ds[i]:undefined}else{if(null===o){delete ds[i];delete properties[i]}else{ds[i]=o;if(typeof o!='function')properties[i].ini=o}}}_.each(hash,function(o,i){if(o===null||sc[i.charAt(0)]||typeof o=='function')return;r=i.initial();if(!(o&&o.readonly)){t=o.set;n='set'+r;m=this.prototype[n];this.prototype[n]=typeof t=='function'?t:typeof m=='function'?m:function(value,flag){return this.each(function(v){if(v.properties[i]===value&&!flag)return;var m,ovalue=v.properties[i];v.properties[i]=value;m=_.get(v.box.$DataModel,[i,'action']);if(typeof m=='function')v._applySetAction(m,value,ovalue)})};this.prototype[n].$ignore$=1}t=o.get;n='get'+r;m=this.prototype[n];this.prototype[n]=typeof t=='function'?t:typeof m=='function'?m:function(){return this.get(0).properties[i]};this.prototype[n].$ignore$=1},this);return this},getDataModel:function(key){var o=this.$DataModel;return key?o[key]:o},setEventHandlers:function(o){_.each(o,function(o,i){if(null===o){delete this.$EventHandlers[i];delete this.prototype[i]}else{this.$EventHandlers[i]=o;var f=function(fun){var args=arguments,type=typeof fun;if(args.length==1&&(type=='function'||type=='string'))return this.each(function(v){if(v.domNode)v.resetCache();v[i]=fun});else if(args.length==1&&null===fun)return this.each(function(v){v.resetCache();delete v[i]});else{var v=this.get(0),t=v[i],k=v.host||v;if(typeof t=='string')t=k[t];if(typeof t=='function')return _.tryF(t,args,k)}};f.$ignore$=1;f.$event$=1;return this.plugIn(i,f)}},this)},getEventHandlers:function(){return this.$EventHandlers},getByCacheId:function(id){var o;if(o=this._cache[id]){return o.object}},pickAlias:function(){var t,p=this._namePool,a=this._nameTag;while(p[t=(a+(++this._nameId))]){}return t},unserialize:function(str){var o=_.unserialize(str);return new this(o)}}});Class("linb.iDataBinder","linb.Base",{Constructor:function(){arguments.callee.upper.apply(this,arguments);this._nodes=[]},Instance:{each:function(fun){this._nodes.each(function(o,i){return fun.call(this,o,i)},this);return this},updateDataFromDs:function(v,flag){return this.each(function(profile){var t;if(typeof(t=v.getField(profile.properties.dataField))!='undefined'){if(flag)profile.boxing().updateUIValue(t);else profile.boxing().setValue(t,true)}})},updateDataToDs:function(){return this.each(function(profile){var p=profile.properties,ds=linb.DataSource.getFromDataBinderName(p.dataBinder),v=profile.boxing().updateValue().getValue();if(ds)ds.setField(p.dataField,v)})},getDataBinder:function(){var profile=this.get(0);return linb.iDataBinder.getDataBinder(profile.properties.dataField)},getDataSource:function(){var profile=this.get(0);return linb.DataSource.getFromDataBinderName(profile.properties.dataBinder)}},Static:{_pool:{},link:function(name,pro){var o=this._pool[name];if(!o)o=this._pool[name]=new linb.iDataBinder();linb.DataSource.bind(name,name);if(pro&&!o._nodes.exists(pro))o._nodes.push(pro)},getDataBinder:function(name){return this._pool[name]},DataModel:{dataBinder:{ini:'',combobox:function(){ds=linb.DataSource.getAll();return _.toArr(ds,true)},set:function(v){var ds,r;return this.each(function(profile){profile.properties.dataBinder=v;var b=false;if(v){linb.iDataBinder.link(v,profile);if(ds=linb.DataSource.getDataSource(v))if(r=ds.getField(profile.properties.dataField)){b=true;profile.boxing().updateUIValue(r)}}if(!b)profile.boxing().updateUIValue('')})}},dataField:{ini:'',combobox:function(){var ds,r=[];if(ds=linb.DataSource.getDataSource(this.properties.dataBinder)){r=ds.getAll();r=_.toArr(r,true)}return r},set:function(v){var ds;return this.each(function(profile){var t;profile.properties.dataField=v;var b=false;if(v){if(t=profile.properties.dataBinder)if(ds=linb.DataSource.getDataSource(t))if(r=ds.getField(v)){b=true;profile.boxing().updateUIValue(r)}}if(!b)profile.boxing().updateUIValue('')})}}},createdTrigger:function(){if(this.dataBinder)this.boxing().setDataBinder(this.dataBinder);if(this.dataField)this.boxing().setDataField(this.dataField)}}});Class("linb.DataSource","linb.Base",{Constructor:function(){arguments.callee.upper.apply(this,arguments);var c=this.constructor;var profile=this._nodes[0];profile.properties.value={};profile._fields={};profile.binder={};_.merge(profile,c.$EventHandlers,'without');profile.links(linb.DataSource._cache,'DataSource');this.profile=profile},Instance:{destroy:function(){this.profile.antiAllLinks()},request:function(){},response:function(){},getField:function(field){var t;if((t=this.profile.properties.value)&&(field in t))return t[field]},setField:function(field,value){var t;if(t=this.profile.properties.value)t[field]=value;return this},responseToBinder:function(flag){var c=this.constructor,t;if(!(t=c._map[this.profile.alias]))return false;if(t=linb.iDataBinder.getDataBinder(t))t.updateDataFromDs(this,flag);return this},bind:function(name){this.constructor.bind(this.profile.alias,name);return this},unBind:function(){this.constructor.unBind(this.profile.alias);return this},getAll:function(){return this.profile.properties.value},requestFromBinder:function(){var t,p,c=this.constructor;if(!(t=c._map[this.profile.alias]))return false;if(t=linb.iDataBinder.getDataBinder(t)){if(linb.UI.iWidget.pack(t._nodes).checkUIValueValid()){t.updateDataToDs();if((p=this.profile).onDataChanged)this.onDataChanged(p,p.properties.value);return true}else{linb.message(linb.getStr('inValid'));return false}}return false},triggerTest:function(){this.request(true)}},Static:{_map:{},bind:function(name,binder){_.filter(this._map,function(o,i){return o!=binder});this._map[name]=binder},unBind:function(name){delete this._map[name]},EventHandlers:{onRequestOK:function(profile,hash,flag){},onRequestFail:function(profile,msg){},onDataChanged:function(profile,hash){}},DataModel:{value:{ini:{}},'test':{ini:'not yet',trigger:true}},getAll:function(){var r={};this._cache.each(function(o){r[o.alias]=o});return r},getFromDataBinderName:function(name){var dsname;for(var i in this._map)if(this._map[i]==name){dsname=i;break}if(dsname)return this.getDataSource(dsname)},getDataSource:function(name){var r,index=this._cache.subIndexOf('alias',name);if(index!=-1)r=this._cache[index];if(r)return r.object},beforeSerialized:function(profile){var o=profile.copy();o.properties=_.copy(profile.properties);delete o.properties.value;var ds=this.$DataModel;_.filter(o.properties,function(o,i){return!(i in ds)||!ds[i].trigger});return o}}})};new function(){Class('linb.UIProfile','linb.Profile',{Instance:{$gc:function(){var t;if(!this.serialId)return;this.resetCache();if(this.addition&&(t=this.domNode))for(var i in this.addition)t[i]=null;var t=linb.cache.domId;(t[this.key]||(t[this.key]=[])).push(this.serialId);delete linb.cache.dom[this.domId];delete this.box._namePool[this.alias];this.antiAllLinks();_.breakO(this)},resetCache:function(key){_.breakO(this.$cache_egetter,2);_.breakO(this.$cache_domid)},getEV:function(id,name){var $k=id+"+"+name,g=this.$cache_egetter||(this.$cache_egetter={});if(g[$k])return g[$k];var funs=[],t,key,ar=['_CB',name],arr=['CB',name];if(t=_.get(linb.cache.dom,[id,'events',name]))for(var i=0,l=t.length;i<l;i++)if(typeof t[t[i]]=='function')funs[funs.length]=t[t[i]];if(key=_.str(id.split(":")[0].split("-")[1])){ar.insert((t=key.split(".")),1);arr.insert(t,1)}if(typeof(t=_.get(this,ar))=='function')funs[funs.length]=t;else if(typeof(t=_.get(this,arr))=='function')funs[funs.length]=t;else{arr[0]='behavior';if(typeof(t=_.get(this,arr))=='function')funs[funs.length]=t}arr.length=0;return g[$k]=funs},toString:function(flag){var i,o,m,a,c,self,children,h={},id,me=arguments.callee,reg=me.reg||(me.reg=/<!--([^>^\s]*)-->/g);if(!this.string||flag){c=this.box;_.merge(this.properties,c.$DataStruct);this.data={};c.prepareData(this);if(c.dynamicTemplate)c.dynamicTemplate(this);this.string=c.build(this);delete this.data;if(m=this.children)for(i=0;o=m[i++];){if(!o[0]['linb.UIProfile']){a=new(linb.SC(o[0].key));a.ini.call(a,o[0]);o[0]=a.get(0)}}}if(m=this.children)for(i=0;o=m[i++];){id=o[1]||'';a=h[id]||(h[id]=[]);a[a.length]=o[0].toString()}return this.string.replace(reg,function(a,b){return h[b]?h[b].join(''):''})},boxing:function(){var t;if(!((t=this.object)&&t._nodes[0]==this&&t._nodes.length==1))t=this.object=this.box.pack([this],false);return t},_applySetAction:function(fun,value,ovalue){if(this.domNode)fun.call(this,value,ovalue)},makeRootId:function(key){return(key||this.key)+":"+this.serialId+":"},getKey:function(id){return id.split(":")[0]},getSerialId:function(id){return id.split(":")[1]},getSubSerialId:function(id){return id.split(":")[2]},getSubNodeId:function(key,itemId){var arr=this.domId.split(':');arr[0]=key;arr[2]=itemId||'';return arr.join(':')},getSubNode:function(key,itemId){var r,t,s,h=this._domNode||(this._domNode={});if(itemId===true)r=linb([this.domNode],false).dig('*','id',new RegExp('^'+key+':'+this.serialId));else{if(!itemId&&h[key]&&h[key]._nodes.length==1)return h[key];r=(t=linb.dom.byId(s=this.getSubNodeId(key,itemId)))?linb([t],false):linb([this.domNode],false).dig('*','id',s);if(!itemId)h[key]=r}return r},pickSubId:function(key){var r,o=this.cache_subid||(this.cache_subid={});if((o[key]||(o[key]=[]))[0])return o[key].shift();o=this.subId||(this.subId={});r=(o[key]||(o[key]=new _.id)).next();return r},cacheSubId:function(id,key){var o=this.cache_subid||(this.cache_subid={});(o[key]||(o[key]=[])).push(id)},getClass:function(key,tag,flag){var me=arguments.callee,map=me.map||(me.map={}),reg=me.reg||(me.reg=/\./g),hash=this.appearance+":"+key+":"+tag+':'+flag;if(map[hash])return map[hash];if(this.classKey)key=key.replace(this.key,this.classKey);var str=(((!flag&&this.appearance!='default')?this.appearance+"--":"")+key).replace(reg,'-').toLowerCase();str=str+(tag||'');return map[hash]=str},addTagClass:function(nodes,key,tag,flag){var c=this.box.$clscache||(this.box.$clscache={}),k=key+":"+tag,cls='[^\\s]*'+this.getClass(key,'',true),reg=c[k]||(c[k]=new RegExp(cls+'[-\\w]*'+tag+'[-\\w]*')),r2=c[cls+"*2"]||(c[cls+"*2"]=new RegExp("("+cls+"[-\\w]*)",'g')),r3=c[cls+"*3"]||(c[cls+"*3"]=new RegExp("("+cls+")"));nodes.removeClass(reg);if(!flag)nodes.reClass(r2,'$1 $1'+tag);else nodes.reClass(r3,'$1 $1'+tag);return this},removeTagClass:function(nodes,key,tag){var c=this.box.$clscache||(this.box.$clscache={}),k=key+":"+tag,reg=c[k]||(c[k]=new RegExp('[^\\s]*'+this.getClass(key,'',true)+'[-\\w]*'+tag+'[-\\w]*'));nodes.removeClass(reg);return this},getNodeByItemId:function(key,id){if(id=this.getSubSerialIdByItemId(id))return this.getSubNode(key,id)},getItemByItemId:function(id){var t;if((t=this.ItemIdMapSubSerialId)&&(t=t[id]))return this.SubSerialIdMapItem[t]},getItemBySubSerialId:function(id){return this.SubSerialIdMapItem&&this.SubSerialIdMapItem[id]},getItemByDom:function(src){return this.SubSerialIdMapItem&&this.SubSerialIdMapItem[this.getSubSerialId(src.id||src)]},getItemIdByDom:function(src){var t;return(t=this.getItemByDom(src))&&t.id},getItemIdBySerailId:function(subId){var t;if(t=this.ItemIdMapSubSerialId)for(var i in t)if(t[i]==subId)return i},getSubSerialIdByItemId:function(id){var t;return(t=this.ItemIdMapSubSerialId)&&t[id]},itemsSearch:function(items,fun,deep,single){deep=deep||false;single=single||false;var r=[];var f=arguments.callee.f||(arguments.callee.f=function(items,fun,deep,single,r){var me=arguments.callee;items.each(function(o){if(fun===true||fun.call(null,o)){r.push(o);if(single)return false}if(deep&&o.sub&&o.sub.length)me(o.sub,fun,deep,single,r)})});f(items,fun,deep,single,r);return r}},Static:{getFromDomId:function(id){return linb.cache.dom[id]},getFromDomNode:function(node){return linb.cache.dom[node===window?linb.ini.id_window:node===document?linb.ini.id_document:node.id]},getFromDom:function(dom){return linb.cache.dom[dom.get(0).id]}}});Class("linb.UI","linb.Base",{Constructor:function(){if(arguments[0]!==false)return this.ini.apply(this,arguments)},Before:function(key,parent_key,o){linb.iBox.$type[key.replace("linb.UI.","").replace("linb.","")]=linb.iBox.$type[key]=key;return true},After:function(){var temp,me=arguments.callee;this._nameId=0;this._namePool={};this._nameTag=(t=this.KEY.split('.'))[t.length-1].toLowerCase();this._cache=[];this._ctrlId=new _.id();this._idCache=[];var t,k,u,b,c,m,i,j,e,w,v;m=me.a1||(me.a1='$Keys,$DataModel,$DataStruct,$EventHandlers'.toArr());for(j=0;v=m[j++];){if(t=this.$parent){k={};for(i=0;u=t[i++];)_.merge(k,u[v]);this[v]=_.clone(k)}else this[v]={}}m=me.a2||(me.a2='$Templates,$Behaviors,$Appearances'.toArr());for(j=0;v=m[j++];){k={};if(t=this.$parent){for(e=0;b=t[e++];)for(i in b[v]){t=b[v][i];u=k[i]||(k[i]={});for(c in t){w=t[c];u[c]=u[c]||{};_.merge(u[c],w)}}this[v]=_.clone(k)}else this[v]={}}u=this.$Keys;for(i in u)if((t=u[i].split('-')).length)u[i]=this.KEY+"-"+t[t.length-1];u.KEY=u.$key=this.KEY;m=me.a3||(me.a3='Templates,Behaviors,Appearances'.toArr());w=me.a4||(me.a4='setTemplate,setBehavior,setAppearance'.toArr());for(j=0;v=m[j];j++){u=this[v];for(i in u)this[w[j]](i,u[i]);delete this[v]}this.setDataModel(this.DataModel);delete this.DataModel;this.setEventHandlers(this.EventHandlers);delete this.EventHandlers;m=me.a5||(me.a5='createdTrigger,envTrigger'.toArr());for(j=0;v=m[j++];){temp=[];if(t=this.$parent)for(i=0;u=t[i];i++){if(u=u['$'+v])temp.push.apply(temp,u)}if(this[v])temp.push(this[v]);this['$'+v]=temp;delete this[v]}if(this.PublicAppearance){linb.dom.addHeadNode('style',this.buildCSSText(this.PublicAppearance,linb.getPath(this.KEY,'/css.css','appearance')));delete this.PublicAppearance}if(this.Dropable&&this.Dropable.length){this.Dropable.each(function(o){this.dropable(o)},this);delete this.Dropable}if(this.Dragable&&this.Dragable.length){this.Dragable.each(function(o){this.dragable(o)},this);delete this.Dragable}},Instance:{getSubNode:function(key,id){return this.get(0).getSubNode(this.constructor.$Keys[key],id)},toDomNodes:function(){var t,arr=[];this._nodes.each(function(o){if(t=o.domNode)arr.push(t)});return arr},ini:function(properties,events,host,template,behavior,appearance,children,CA,CB){var profile,c=this.constructor,t='default';if(properties&&properties['linb.UIProfile'])this._nodes=[profile=properties];else{this._nodes=[profile=new linb.UIProfile];if(c.iniProfile)c.iniProfile.call(profile);profile.box=c;profile.key=this.$key;profile.$id=_.id();profile.keys=c.$Keys;if(properties&&properties.key&&linb.iBox.$type[properties.key]){_.merge(profile,properties);properties=null}profile.properties=properties||profile.properties||{};profile.host=host||profile.host||null;profile.appearance=appearance||profile.appearance||t;profile.behavior=c.getBehavior(behavior||profile.behavior||t);profile.CA=CA||profile.CA||{};profile.CB=CB||CB||{};profile.template=c.getTemplate(template||profile.template||t);profile.setEvents(events||profile.events||{});delete profile.events;profile.children=children||profile.children||[];if(!profile.serialId)profile.serialId=c.pickSerialId();profile.domId=profile.makeRootId();profile.alias=profile.alias||c.pickAlias();c._namePool[profile.alias]=1;profile.createdTrigger=c.$createdTrigger.copy();profile.envTrigger=c.$envTrigger.copy();profile.addition=profile.behavior?profile.behavior.$eventhandler:null;profile._links=[];profile.links(linb.UI._cache,'UI').links(c._cache,'self').links(linb._object,'linb')}return this},create:function(){var arr=[],i,o,n=this._nodes,me=arguments.callee,set=me.set||(me.set=function(o,flag){var t,self=arguments.callee;o.root=linb([o.domNode=linb.dom.byId(o.domId)],false);linb.cache.dom[o.domId]=o;if(t=o.createdTrigger){for(var i=0,l=t.length;i<l;i++)t[i].call(o);delete o.createdTrigger}if(flag&&(t=o.envTrigger))for(var i=0,l=t.length;i<l;i++)t[i].call(o);if(o.children)for(var i=0,n=o.children,v;v=n[i++];){self(v[0],true);v[0].parent=o}});for(i=0;o=n[i++];)if(!o.domNode)arr[arr.length]=o;if(arr.length){linb.dom.getTemp().html(arr.join(''),false);for(i=0;o=arr[i++];)set(o)}return this},render:function(){var i,o,n=this._nodes,node,me=arguments.callee,set=me.set||(me.set=function(o){var t,self=arguments.callee;o.root=linb([o.domNode=linb.dom.byId(o.domId)],false);linb.cache.dom[o.domId]=o;if(t=o.createdTrigger){for(var i=0,l=t.length;i<l;i++)t[i].call(o);delete o.createdTrigger}if(t=o.envTrigger)for(var i=0,l=t.length;i<l;i++)t[i].call(o);if(o.children)for(var i=0,n=o.children,v;v=n[i++];){self(v[0],true);v[0].parent=o}}),para=me.para||(me.para=function(node){var r=node.getRegion();r.tabindex=node.tabIndex();r.zIndex=node.zIndex();r.position=node.position();return r});for(i=0;o=n[i++];)if(!(node=linb(o.alias)).isEmpty()){_.merge(o.properties,para(node));node.outerHTML(o.toString(),false);window[o.alias]=o.boxing();set(o)}return this},destroy:function(){this.each(function(o){if(o.beforeDestroy&&o.boxing().beforeDestroy(o)===false)return;if(o.destroyTrigger)o.destroyTrigger();o.root.remove()})},activate:function(){return this},clone:function(flag){var arr=[];this.each(function(o){arr.insert(linb.create(o.clone(flag)).get())});return this.constructor.pack(arr,false)},refresh:function(){var b,p,para,s,sid,host,box,children;return this.each(function(o){if(!o.domNode)return;if(b=!!o.parent){p=o.parent.boxing();para=o._links.$parent[o.$id][1]}else p=o.root.parent();var replace=linb.create('span');o.root.replace(replace,true);children=o.children.copy();o.children.length=0;children.each(function(o){delete o[0].$dockParent;replace.addLast(o[0].root)});box=o.box;sid=o.serialId;host=o.host;s=_.serialize(o);o.boxing().destroy();linb.dom.$gc();s=_.unserialize(s);s.serialId=sid;s.host=host;o=new box(s).create();replace.empty(false);replace.replace(o.get(0).root);replace.remove();if(b){p.attach(o,para)}else p.attach(o);children.each(function(v){o.attach.apply(o,v)})});return this},template:function(str){var o,t;if(typeof str=='string'){this.each(function(o){if(o.domNode){if(!o.template||o.template._id!=_.str(str)){t=o.box.getTemplate(_.str(str));if(!t)return;o.template=t;return this.refresh()}}else o.template=str});return this}else return this.get(0).template},behavior:function(str){var v,t,m;if(typeof str=='string'){this.each(function(o){if(o.behavior._id!=_.str(str)){if(o.domNode){t=o.behavior;if(v=t.$eventhandler)for(var j in v)o.root.removeEventHandler(j.slice(2));for(var i in o.keys){m=o.keys[i];if(t[i]&&(v=t[i].$eventhandler))for(var j in v)o.getSubNode(m,true).removeEventHandler(j.slice(2))}}t=o.box.getBehavior(_.str(str));if(!t)return;o.behavior=t;if(o.domNode){if(v=t.$eventhandler)for(var j in v)o.root.addEventHandler(j.slice(2));for(var i in o.keys){m=o.keys[i];if(t[i]&&(v=t[i].$eventhandler))for(var j in v)o.getSubNode(m,true).addEventHandler(j.slice(2))}}}});return this}else return this.get(0).behavior},appearance:function(str){var v,t;if(typeof str=='string')return this.each(function(o){if(o.appearance!=str){t=o.getClass(o.key);o.appearance=str;if(!o.box.cssNone)o.box.setCSSFile(o.box.cssPathKey||o.key,o.appearance);if(o.domNode)o.root.dig().reClass(new RegExp('([\\w]+\\-\\-)?'+t,'g'),o.getClass(o.key))}});else return this.get(0).appearance},attach:function(ui,id){this.appendChild(ui,id);var pro=this.get(0);if(pro.domNode)pro.getSubNode(pro.keys.PANEL||pro.keys.KEY).attach(ui);return this},show:function(ui,id){ui.attach(this,id);return this},dettach:function(target,flag){return this.each(function(v){var r=target.reBoxing('UI');r.each(function(profile){profile.antiLinks('$parent');delete profile.parent});if(flag)r.destroy()})},addPanel:function(para,children,item){var pro=linb.UI.PanelBar.getDefaultProp();_.merge(pro,para,'with');_.merge(pro,{left:0,top:0,dock:'fill',tag:para.tag||para.id},'all');var pb=new linb.UI.PanelBar(pro);this.attach(pb,item&&item.id);children.each(function(o){pb.attach(o[0])})},appendChild:function(target,id){if(target['linb.UIProfile'])target=target.boxing();if(_.isArr(target))target=linb.UI.pack(target,false);if(!target['linb.UI'])target=target.reBoxing('UI');return this.each(function(v){target.each(function(profile){profile.parent=v;profile.antiLinks('$parent');profile.links(v.children,'$parent',[profile,id])})})},getChildren:function(){var t,o=this.get(0),arr;for(var i=0,v;v=o.children[i++];)arr.push(v[0]);return arr},dragable:function(key,dragKey,dragData){return this.each(function(o){o.getSubNode(o.keys[key||'KEY'],true).onMousedown(function(pro,e,src){linb([src],false).startDrag(e,{drop2:true,key:dragKey,data:dragData,icon:linb.ini.path+'ondrag.gif',dragMode:'move',cursor:'pointer',move:false,defer:1})},'',-1).onDragbegin(function(profile,e,src){linb([src],false).onMouseout(true,{$force:true}).onMouseup(true)},'',-1)})},setCustomAppearance:function(key,value){var me=arguments.callee,style=(me.style||(me.style=function(pro,i,h,flag){var b,node=pro.getSubNode(pro.keys[i],true);if(!node.isEmpty())h[i].split(';').each(function(o,i){if((b=o.split(':')).length==2){b[0]=b[0].replace(/\-(\w)/g,function(a,b){return b.toUpperCase()});try{node.setStyle(b[0],flag?'':b[1])}catch(e){}}})}));return this.each(function(o){var bak=_.copy(o.CA);var hash,node,b,force;if(typeof key=='string'){if(o.domNode)if(key in bak)style(o,key,bak,true);if(!value)delete o.CA[key];else{o.CA[key]=value;if(o.domNode)style(o,key,bak)}}else if(!!key&&typeof key=='object'){if(o.domNode){for(var i in bak)style(o,i,bak,true);for(var i in key)style(o,i,key)}o.CA=key}else{if(o.domNode)for(var i in bak)style(o,i,bak,true);o.CA={}}})},hasBehavior:function(type,key){var profile=this.get(0);if(!key)return!!profile.behavior.type;else return!!_.get(profile.behavior,[key,type])},hasCustomBehavior:function(type,key){var profile=this.get(0);if(!key)return!!_.get(profile,['CB',type]);else return!!_.get(profile,['CB',key,type])},clearCustomBehavior:function(key){return this.each(function(o){if(key){if(o.keys[key])_.set(o,['CB',key],undefined)}else delete o.CB;o.resetCache()})},addCustomBehavior:function(type,fun,key){return this.each(function(o){if(key){if(o.keys[key])_.set(o,['CB',key,type],fun)}else _.set(o,['CB',type],fun);o.resetCache()})},removeCustomBehavior:function(type,key){return this.each(function(o){if(key){if(o.keys[key])_.set(o,['CB',key,type],undefined)}else _.set(o,['CB',type],undefined);o.resetCache()})},setCustomBehavior:function(hash){return this.each(function(o){o.CB=hash;o.resetCache()})}},Initialize:function(){linb.dom.addHeadNode('style',linb.UI.buildCSSText({body:{$order:0,font:['13px arial,helvetica,clean,sans-serif',linb.browser.ie?'x-small':''],'font-size':linb.browser.ie6?'100.01%':linb.browser.ie?'small':'',margin:'0',padding:'0',cursor:'default'},'div,span,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,form,fieldset,input,button,p,blockquote,th,td':{$order:1,margin:'0',padding:'0'},table:{$order:2,'font-size':'inherit',font:linb.browser.ie?'100%':'','border-collapse':'collapse','border-spacing':'0','empty-cells':'show'},'div,span,fieldset,img,abbr,acronym':{$order:3,border:'0'},'address,caption,cite,dfn,em,strong,th,var':{$order:4,'font-style':'normal','font-weight':'normal'},'pre, code ':{$order:5,font:'115% monospace','font-size':linb.browser.ie?'100%':'','font-style':'normal','font-weight':'normal',margin:'0',padding:'0'},'ol,ul ':{$order:6,'list-style':'none'},'caption,th':{$order:7,'text-align':'left'},'h1,h2,h3,h4,h5,h6':{$order:8,'font-size':'100%'},'q:before,q:after':{$order:9,content:'""'},a:{$order:10,'text-decoration':'none',cursor:'pointer','-moz-user-select':linb.browser.gek?'none':''},'a:focus':{$order:11,'-moz-outline-offset':linb.browser.gek?'-1px ! important':''},'select, input, textarea':{$order:12,font:'99% arial,helvetica,clean,sans-serif'},strong:{$order:14,'font-weight':'bold'},em:{$order:15,'font-style':'italic'},'div, span':{$order:15,'font-size':'12px'},span:{$order:16,display:linb.browser.gek?['-moz-inline-block','-moz-inline-box']:'inline-block','vertical-align':'middle'},'body *':{$order:17,'line-height':'1.22em'},'.ui-dirty':{$order:18,color:'#f00'},'.ui-invalid':{$order:19,'background-color':'Aqua'}}),'linb.UI');linb.cache.$dropPool={}},Static:{$cache_csspath:{},$css_tag_dirty:"ui-dirty",$css_tag_invalid:"ui-invalid",$tag_left:"{",$tag_right:"}",$tag_special:'#',$ID:"#id#",subSerialIdTag:"_serialId",$childTag:"<!--{id}-->",hasDomRoot:true,$langID:1,getStr:function(){var id=arguments[0],s,r;if(id.charAt(0)=='$')arguments[0]=id.slice(1);s=arguments[0];r=linb.getStr.apply(null,arguments);if(s==r)r=id;return'<span id="lang:'+linb.UI.$langID+'" class="'+s+'">'+r+'</span>'},unserialize:function(str,flag){var a=_.unserialize(str),f=function(o){delete o.serialId;o.children.each(f)};a.each(function(o){if(!flag)f(o)});return linb.create(a)},clean:function(e){if(e&&e._nodes&&e._nodes[0]&&e._nodes[0]['linb.UIProfile'])return e._nodes;else{var r=this._dom2ui(linb.dom.pack(e)._nodes);r.filter(function(o){return o.box['linb.UI']});return r}},_dom2ui:function(arr){var i=0,a=[],t,key=this.KEY;arr.each(function(o){if((t=linb.cache.dom[o.id])&&t.key)a[i++]=t});return a},$gc:function(){var k=this.$key;_.breakO([linb.cache.template[k],linb.cache.domId[k]],2);_.breakO([this._cache,this._idCache,this.$DataModel,this.$Templates,this.$Behaviors,this],2);delete linb.iBox.$type[k.replace("linb.UI.","")];this.$gc=null;Class.$gc(k)},getAll:function(){return this.pack(_.toArr(this._cache,false))},getByCacheId:function(ids){var t,n=this._cache,arr=[];ids=ids instanceof Array?ids:[ids];ids.each(function(id){if(t=n[id])arr[arr.length]=t});return linb.UI.pack(arr,false)},pickSerialId:function(){var arr=linb.cache.domId[this.$key];if(arr&&arr[0])return arr.shift();return this._ctrlId.next()},getCSSImgPara:function(path,para,appearance,key){return function(k){var p=linb.getPath(key||k,null,'appearance')+(appearance?appearance:'default')+'/'+path;return'url('+p+') '+(para||'')}},getImgPath2:function(path,para,appearance){return function(key){var s=linb.getPath(key,'/'+(appearance?appearance:'default')+'/'+path,'appearance');return para.replace('{*}',s)}},$doTemplate:function(profile,template,properties,tag,result){var s,t,n,isA=properties.constructor==Array,self=arguments.callee,temp=template[tag||''],r=!result,result=result||[];if(isA){if(typeof temp!='function')temp=self;for(var i=0;t=properties[i++];)temp(profile,template,t,tag,result)}else{if(typeof temp=='function')temp(profile,template,t,tag,result);else{tag=tag?tag+'.':'';var a0=temp[0],a1=temp[1];for(var i=0,l=a0.length;i<l;i++){if(n=a1[i]){if(n in properties){t=properties[n];if(template[s=tag+n])self(profile,template,t,s,result);else result[result.length]=t}}else result[result.length]=a0[i]}}}if(r)return result.join('')},$buildTemplate:function(profile,template,key,obj,arr){if(template&&template.tagName=='text'){arr[arr.length]=template.text;return}var lkey,first=false,behavior=profile.behavior?key?profile.behavior[key]:profile.behavior:null,self=arguments.callee,t,o,bak,map1=self.map1||(self.map1={tagName:1,text:1}),map2=self.map2||(self.map2={image:1,input:1}),r2=self.r2||(self.r2=/[a-z]/),r3=self.r3||(self.r3=/^(on|before|after)/),r7=self.r7||(self.r7=/([^{}]*)\{([\w]+)\}([^{}]*)/g);if(!template)template=profile.template;lkey=key?profile.keys[key]:profile.key;if(!template.tagName)template.tagName="span";template.id=lkey+":"+linb.UI.$ID+":"+linb.UI.$tag_left+linb.UI.subSerialIdTag+linb.UI.$tag_right;t=profile.getClass(lkey);bak=template.className||'';template['class']=t+' '+bak+' '+linb.UI.$tag_left+'className'+linb.UI.$tag_right;delete template.className;template.style=(template.style||'')+linb.UI.$tag_special+(key||'KEY')+'_CA'+linb.UI.$tag_special;var a=[],b={},tagName=template.tagName,text=template.text,sc=linb.Base.$specialChars;for(var i in template){if(!sc[i.charAt(0)]&&!map1[i]){o=template[i];if(!r2.test(i)){if(typeof o=='object'){if(!o.$order)o.$order=0;o.$key=i;a[a.length]=o}}else b[i]=o}}a.sort(function(x,y){x=x.$order;y=y.$order;return x>y?1:x==y?0:-1});if(!arr){first=true;arr=[]}arr[arr.length]='<'+tagName+' ';for(var i in b)arr[arr.length]=i+'="'+b[i]+'" ';template.className=bak;delete template['class'];if(behavior&&(t=behavior.$eventhandler))for(var i in t)arr[arr.length]=i+'="'+linb.dom.eventhander+'" ';arr[arr.length]='>';if(!map2[tagName]&&text)arr[arr.length]=text;for(var i=0,l=a.length;i<l;){o=a[i++];self(profile,o,o.$key,obj,arr)}if(!map2[tagName])arr[arr.length]='</'+tagName+'>';if(first){var a0=obj[0],a1=obj[1];arr.join('').replace(r7,function(a,b,c,d){if(b)a0[a0.length]=b;a1[a0.length]=a0[a0.length]=c;if(d)a0[a0.length]=d;return''})}},build:function(profile,flag){var t,p=profile,temp=[[],[]],template,m,t,self=arguments.callee,key=this.KEY,r1=self.r1||(self.r1=new RegExp(linb.UI.$ID,'img')),r2=self.r2||(self.r2=new RegExp(linb.UI.$tag_special+'([A-Z0-9]+)_CA'+linb.UI.$tag_special,'g')),hash=profile._hash='a:'+(p.template._id||'')+';'+'b:'+(p.template._did||'')+';'+'c:'+(p.appearance||'')+';'+'d:'+(p.behavior._id||'')+';'+'e:'+(p.behavior._did||'')+';'+'!'+(profile._exhash||'');if(!(template=_.get(linb.cache.template,[key,hash]))){if(!this.cssNone)this.setCSSFile(this.cssPathKey||key,profile.appearance);linb.UI.$buildTemplate(profile,null,null,temp);_.set(linb.cache.template,[key,hash,''],temp);if(t=p.template.$dynamic)for(var i in t){if(typeof(m=t[i])!='function'){var temp=[[],[]];for(var j in m)if(typeof m[j]=='object')linb.UI.$buildTemplate(profile,m[j],j,temp);m=temp}_.set(linb.cache.template,[key,hash,i],m)}template=_.get(linb.cache.template,[key,hash])}if(!template||flag)return'';temp=linb.UI.$doTemplate(profile,template,profile.data).replace(r1,profile.serialId);if(p=p.CA)temp=temp.replace(r2,function(a,b){return(t=p[b])?t:''});else temp=temp.replace(r2,'');return temp},subBuild:function(profile,key,arr){var temp,t,p=profile,hash=p._hash,k=this.KEY,r1=this.build.r1,r2=this.build.r2,template=_.get(linb.cache.template,[k,hash]);temp=linb.UI.$doTemplate(profile,template,arr,key).replace(r1,profile.serialId);if(p=p.CA)temp=temp.replace(r2,function(a,b){return(t=p[b])?t:''});else temp=temp.replace(r2,'');return temp},_setDefaultBehavior:function(hash){var f=function(arr,type,mode){var fun=function(profile,e,src){var t,id=src.id,item,key=profile.keys.KEY,cid=profile.getSubSerialId(id),prop=profile.properties,nodes,funs,box;if(prop.disabled)return;item=profile.SubSerialIdMapItem&&profile.SubSerialIdMapItem[cid];if(item&&item.disabled)return;switch(typeof arr){case'string':nodes=profile.getSubNode(profile.keys[arr],cid).get();break;case'function':funs=[arr];break;case'object':nodes=[];funs=[];for(var o,i=0,l=arr.length;i<l;i++){o=arr[i];if(typeof o=='string')nodes.insert(profile.getSubNode(profile.keys[o],cid).get());else funs.push(o)}}if(nodes&&nodes.length){nodes=linb(nodes,false);box=profile.boxing();if(arguments.callee.mode==1){if(type=='mouseover'&&profile.beforeHoverEffect)if(false==box.beforeHoverEffect(profile,item,src,'mouseover'))return;if(type=='mousedown'&&profile.beforeClickEffect)if(false==box.beforeClickEffect(profile,item,src,'mousedown'))return;profile.addTagClass(nodes,key,'-'+type)}else{if(type=='mouseup'){if(profile.beforeClickEffect&&false==box.beforeClickEffect(profile,item,src,'mouseup'))return;profile.removeTagClass(nodes,key,'-mousedown')}else{if(profile.beforeHoverEffect&&false==box.beforeHoverEffect(profile,item,src,'mouseout'))return;profile.removeTagClass(nodes,key,'-mouseover');profile.removeTagClass(nodes,key,'-mousedown')}}nodes.length=0}if(funs&&funs.length){funs.each(function(o){_.tryF(o,[profile],profile)});funs.length=0}};fun.mode=mode;return fun},t;if(hash._hoverEffect)_.each(hash._hoverEffect,function(o,i){t=['','KEY','$key'].exists(i)?hash:(hash[i]||(hash[i]={}));if(null===o)t.afterMouseover=t.afterMouseout=null;else{t.afterMouseover=f(o,'mouseover',1);t.afterMouseout=f(o,'mouseout',2)}});if(hash._clickEffect)_.each(hash._clickEffect,function(o,i){t=['','KEY','$key'].exists(i)?hash:(hash[i]||(hash[i]={}));if(null===o)t.afterMousedown=t.afterMouseup=null;else{t.afterMousedown=f(o,'mousedown',1);t.afterMouseup=f(o,'mouseup',2)}});_.merge(hash,{afterKeydown:function(profile,e,src){if(profile.onHotKeydown){var key=linb.event.getKey(e);return false!==profile.boxing().onHotKeydown(profile,key[0],!!key[1],!!key[2],!!key[3],e,src)}},afterKeypress:function(profile,e,src){if(profile.onHotKeypress){var key=linb.event.getKey(e);return false!==profile.boxing().onHotKeypress(profile,key[0],!!key[1],!!key[2],!!key[3],e,src)}},afterKeyup:function(profile,e,src){if(profile.onHotKeyup){var key=linb.event.getKey(e);return false!==profile.boxing().onHotKeyup(profile,key[0],!!key[1],!!key[2],!!key[3],e,src)}}},'all');if(hash._focusHook)_.each(hash._focusHook,function(o,i){var k,map=arguments.callee,m1=map.m1||(map.m1="KEY,$key".toHash(true));if(m1[i])return;var m2=map.m2||(map.m2="input,textarea".toHash(true)),m3=map.m3||(map.m3="tab,enter,up,down,left,right".toHash(true)),m4=map.m4||(map.m4="tab,up,down,left,right".toHash(true)),t=hash[i]||(hash[i]={});if(null===o)t.afterKeydown=null;else{t.afterKeydown=function(profile,e,src){var k=linb.event.getKey(e),key=k[0],shift=k[2],b=false;if(m2[k=src.tagName.toLowerCase()]){if(m3[key]){var reg=linb.UI.getCaretPos(src),txt=src.value;switch(key){case'up':if(!/[\n\r]/.test(txt.substr(0,reg[0])))b=true;break;case'left':if(reg[0]===0&&(reg[1]!==txt.length||reg[1]===0))b=true;break;case'down':if(!/[\n\r]/.test(txt.substr(reg[1],txt.length)))b=true;break;case'right':if(reg[1]===txt.length&&(reg[0]!==0||reg[1]===0))b=true;break;default:if(k=='input')b=true}}}else if(m4[key])b=true;if(b){if(profile.beforeNextFocus&&false===profile.boxing().beforeNextFocus(profile,key,shift,e))return false;if(key!='tab')linb(src).nextFocus(('up'==key||'left'==key)?false:true)}}}})},setBehavior:function(key,hash,did){this._setDefaultBehavior(hash);var m,n,i,j,o,v,type,t=this.$Behaviors,check=linb.Base.$specialChars,eventType=linb.dom._getEventType,me=arguments.callee,r2=me.r2||(me.r2=/[a-z]/);t[key]=t[key]||{};if(typeof did=='string'){t[key][did]=t[key][did]||{};n=t[key][did];n._did=did}else{t[key].$=t[key].$||{};n=t[key].$}n._id=key;if(hash.KEY){_.merge(hash,hash.KEY,'all');delete hash.KEY}for(i in hash){o=hash[i];if(!check[i.charAt(0)]){if(!r2.test(i)){m=n[i]=_.hash(t[i]);for(j in o){v=o[j];if(!check[j.charAt(0)]){m[j]=v;type=eventType(j);(m.$eventhandler||(m.$eventhandler={}))['on'+type]=1}}}else{n[i]=o;type=eventType(i);(n.$eventhandler||(n.$eventhandler={}))['on'+type]=1}}}return this},getBehavior:function(key,did){if(typeof key=='string'){var r=this.$Behaviors[key];if(!r&&key!='default'){var self=this;linb.request(linb.getPath(this.KEY,'/'+key+'.js','behavior'),_.id(),function(str){self.setBehavior(key,_.unserialize(str),did)},function(str){},false,'GET');r=this.$Behaviors[key]}return r?typeof did=='string'?r[did]:r.$:null}else return this.$Behaviors},mapKeys:function(v){v.each(function(i){this.$Keys[i]=this.$key+"-"+i},this)},setTemplate:function(key,hash,did){var t,self=arguments.callee,build=self.build||(self.build=function(template){var o,s=arguments.callee,r2=s.r2||(s.r2=/[a-z]/);for(var i in template){if(!linb.Base.$specialChars[i.charAt(0)])if(!r2.test(i)){this.$Keys[i]=this.$key+"-"+i;o=template[i];if(typeof o=='object')s.call(this,o)}}});build.call(this,hash);t=this.$Templates;t[key]=_.hash(t[key]);hash._id=key;if(typeof did=='string'){hash._did=did;t[key][did]=hash}else t[key]['$']=hash;if(t=hash.$dynamic)for(var i in t)for(var j in t[i])self.call(this,key,t[i],j);return this},getTemplate:function(key,did){if(typeof key=='string'){var r=this.$Templates[key];if(!r){var self=this;linb.request(linb.getPath(this.KEY,'/'+key+'.js','template'),_.id(),function(str){self.setTemplate(key,_.unserialize(str),did)},function(str){},false,'GET');r=this.$Templates[key]}return r?typeof did=='string'?r[did]:r.$:null}else return this.$Templates},getCaretPos:function(input){input.focus();if(linb.browser.ie){if(input.tagName=='INPUT'){var i,r=document.selection.createRange().duplicate(),dr=input.createTextRange();r.move("character",0);dr.move("character",0);try{dr.setEndPoint("EndToEnd",r);i=String(dr.text).replace(/\r/g,"").length}catch(e){i=0}return[i,i]}else{var c="\x01",sel=document.selection.createRange(),txt=sel.text,l=txt.length,dul=sel.duplicate();try{dul.moveToElementText(input)}catch(e){}sel.text=txt+c;len=(dul.text.indexOf(c));sel.moveStart('character',-1);sel.text="";if(len==-1)len=input.value.length;return[len,len]}}else return[input.selectionStart,input.selectionEnd]},setCSSFile:function(key,appearance,flag){var t,path=linb.getPath(this.KEY,'/'+appearance+'/css.css','appearance');if(!linb.UI.$cache_csspath[path]){if(t=this.$Appearances[appearance])linb.dom.addHeadNode('style',this.buildCSSText(t,appearance=='default'?'':appearance),path);else{if(!flag)linb.dom.includeCSSFile(path)}linb.UI.$cache_csspath[path]=true}return this},setAppearance:function(i,o){var t;if(t=this.$Appearances[i]){_.merge(t,o,'all')}else this.$Appearances[i]=o;return this},getAppearance:function(key){if(typeof key=='string'){return this.$Appearances[key]}else return this.$Appearances},buildCSSText:function(hash,appearance){var t,v,o,reg,replace,ks,enter=linb.debug?'\n':'',me=arguments.callee,r1=me.r1||(me.r1=/(^|\s|,)([0-9A-Z_]+)/g),r2=me.r2||(me.r2=/\./g),h=[],r=[];if(!this.$cssKeys){o=this.$cssKeys={};t=this.$Keys;for(var i in t)o[i]=t[i].replace(r2,'-')}ks=this.$cssKeys;if(appearance){t=ks.KEY.toLowerCase();reg=new RegExp('([\\w]+\\-\\-)?'+t,'g');replace=appearance+'--'+t}for(var i in hash){o=hash[i];t=i.replace(r1,function(a,b,c){return b+'.'+(ks[c]||c)}).toLowerCase();if(appearance)t=t.replace(reg,replace);o.$order=parseInt(o.$order)||0;o.$=t;h[h.length]=o};h.sort(function(x,y){x=x.$order;y=y.$order;return x>y?1:x==y?0:-1});for(var i=0,l=h.length;i<l;){o=h[i++];r[r.length]=o.$+"{"+enter;if(t=o.$before)r[r.length]=enter+t+enter;if(t=o.$text)r[r.length]=enter+t+enter;for(var j in o){switch(j.charAt(0)){case'$':continue;break;case'_':if(!linb.browser.ie6)continue;break;case'*':if(!linb.browser.ie)continue;break;case'-':if(!linb.browser.gek)continue;break}if((v=o[j])||o[j]===0){if(linb.debug)j='    '+j;switch(typeof v){case'string':case'number':r[r.length]=j+":"+v+";"+enter;break;case'function':r[r.length]=j+":"+v(this.KEY)+";"+enter;break;default:v.each(function(k){if(k)r[r.length]=j+":"+k+";"+enter})}}}if(v=o.$after)r[r.length]=enter+v+enter;r[r.length]="}"+enter};return r.join('')},pickObj:function(o){return _.clone(o,function(i){return i.charAt(0)!='_'})},copyItem:function(item,hash){if(!hash)hash={};var i,o;for(i in item){if(i.charAt(0)=='$')continue;if(!(i in hash))hash[i]=(typeof(o=item[i])=='string'&&o.charAt(0)=='$')?linb.UI.getStr(o.slice(1)):o}hash.iconDisplay=item.icon?'':'display:none';return hash},prepareData:function(profile){var prop=profile.properties,data=profile.data,dm=this.getDataModel(),map=arguments.callee.map||(arguments.callee.map='left,top,bottom,right,width,height'.toArr());if(prop.id)delete prop.id;if('caption'in dm&&prop.caption!==null)prop.caption=prop.caption==undefined?profile.alias:prop.caption;if('$border'in dm){data.bWidth=prop.width-(prop.$border||0)*2;data.bHeight=prop.height-(prop.$border||0)*2}for(var j=0,i;i=map[j];j++){if(prop[i]||prop[i]===0){if(String(parseFloat(prop[i]))==String(prop[i]))data[i]=i+':'+(parseInt(prop[i])||0)+'px;';else if(prop[i]!='auto'&&prop[i])data[i]=i+':'+prop[i]+';';else data[i]=''}}if('position'in dm)data.position='position:'+prop.position+';';if('tabindex'in dm)data.tabindex=prop.tabindex||'-1';if('zIndex'in dm)data.zIndex='z-index:'+prop.zIndex+';';if('items'in dm){profile.ItemIdMapSubSerialId={};profile.SubSerialIdMapItem={};if(!prop.items||prop.items.constructor!=Array)prop.items=linb.UI.getCacheList(prop.listKey||'test');if(!prop.items||prop.items.constructor!=Array)prop.items=[];data.items=this.prepareItems(profile,prop.items)}return linb.UI.copyItem(prop,data)},prepareItems:function(profile,items,pid){var result=[],item,dataItem,id,SubID=linb.UI.subSerialIdTag,tabindex=profile.properties.tabindex;for(var i=0,l=items.length;i<l;i++){item=items[i];dataItem={id:item.id,_tabindex:tabindex};if(pid)dataItem._parent=pid;id=profile.pickSubId('items');dataItem[SubID]=profile.ItemIdMapSubSerialId[item.id]=id;profile.SubSerialIdMapItem[id]=item;linb.UI.copyItem(item,dataItem);if(this.prepareItem)this.prepareItem(profile,dataItem,item);result.push(dataItem)}return result},dropable:function(key,getDropKeys){if(!getDropKeys)getDropKeys=this.getDropKeys;(linb.cache.$dropPool[this.KEY]=linb.cache.$dropPool[this.KEY]||[]).push(key);this.$dropKey=this.$Keys[key];var behaviors={beforeMouseover:function(profile,e,src){var dd=linb.dragDrop,key=dd.dragKey,data=dd.data;if(!key||!data||!(new RegExp('\\b'+key+'\\b')).test(getDropKeys(profile,this)))return;var item;if(profile.boxing().getItemByDom)item=profile.boxing().getItemByDom(src);if(profile.onDropTest&&(false==profile.boxing().onDropTest(profile,e,this,key,data,item)))return;dd._current=src;if(profile.onDropMarkShow&&(false==profile.boxing().onDropMarkShow(profile,e,this,key,data,item))){}else _.resetRun('showDDMark',dd.showDDMark,0,[this],dd);if(profile.onDragEnter)profile.boxing().onDragEnter(profile,e,this,key,data,item)},beforeMouseout:function(profile,e,src){var dd=linb.dragDrop,key=dd.dragKey,data=dd.data;if(dd._current==src){var item;if(profile.boxing().getItemByDom)item=profile.boxing().getItemByDom(src);if(profile.onDropMarkClear&&(false==profile.boxing().onDropMarkClear(profile,e,this,key,data,item))){}else _.resetRun('showDDMark',dd.showDDMark,0,[null],linb.dragDrop);if(profile.onDragLeave)profile.boxing().onDragLeave(profile,e,this,key,data,item);dd._current=null}},beforeDrop:function(profile,e,src){var dd=linb.dragDrop,key=dd.dragKey,data=dd.data;var item;if(profile.boxing().getItemByDom)item=profile.boxing().getItemByDom(src);if(profile.onDropMarkClear&&(false==profile.boxing().onDropMarkClear(profile,e,this,key,data,item))){}if(profile.onDrop)profile.boxing().onDrop(profile,e,this,key,data,item)}};_.each(this.$Behaviors,function(o,i){var v;if(key=='KEY'){v=o.$}else{if(!o.$[key])o.$[key]={};v=o.$[key]}_.merge(v,behaviors,'all');if(!v.$eventhandler)v.$eventhandler={};_.merge(v.$eventhandler,{onmouseover:1,onmouseout:1,ondrop:1})});if(!this.prototype.empty)this.prototype.empty=function(){return this.each(function(o){o.getSubNode(o.keys[key]).empty()})};this.setEventHandlers({onDragEnter:function(profile,e,node,key,data,item){},onDragLeave:function(profile,e,node,key,data,item){},onDrop:function(profile,e,node,key,data,item){},onDropTest:function(profile,e,node,key,data,item){},onDropMarkShow:function(profile,e,node,key,data,item){},onDropMarkClear:function(profile,e,node,key,data,item){}});if(!this.$DataModel.dropKeys)this.setDataModel({dropKeys:''});return this},dragable:function(key,getDragKey,getDragData){if(!getDragKey)getDragKey=this.getDragKey;if(!getDragData)getDragData=this.getDragData;_.each(this.$Behaviors,function(o,i){var v;if(key=='KEY'){v=o.$}else{if(!o.$[key])o.$[key]={};v=o.$[key]}_.merge(v,{onMousedown:function(profile,e,src){if(!profile.properties.dragKey)return;var pos=linb.event.getPos(e);linb([src],false).startDrag(e,{drop2:true,icon:linb.ini.path+'ondrag.gif',dragMode:'move',target_left:pos.left+12,target_top:pos.top+12,cursor:'pointer',defer:1,move:false,key:getDragKey(profile,this),data:getDragData(profile,this)})},onDragbegin:function(profile,e,src){linb(src).onMouseout(true,{$force:true}).onMouseup(true)}},'all');if(!v.$eventhandler)v.$eventhandler={};_.merge(v.$eventhandler,{onmousedown:1,ondragbegin:1})});return this},setCacheList:function(listKey,list){_.set(linb.cache,['list','List',listKey],list);return this},getCacheListType:function(listKey){return typeof _.get(linb.cache,['list','List',listKey])},getCacheList:function(listKey){var r=_.get(linb.cache,['list','List',listKey]);if(typeof r=='function')r=r();return _.clone(r)}}})};new function(){Class("linb.UI.iWidget",["linb.UI","linb.iDataBinder"],{Instance:{getValue:function(){return this.get(0).properties.value},getUIValue:function(){return this.get(0).properties.$UIvalue},getCtrlValue:function(){return this.get(0).properties.$UIvalue},setUIValue:function(value){this.get(0).properties.$UIvalue=value;return this},setCtrlValue:function(value){return this},setDirtyMark:function(){return this},resetValue:function(value){this.each(function(profile){profile.properties.$UIvalue=profile.properties.value=value||'';delete profile.inValid});this.setCtrlValue(value||'');this.setDirtyMark();return this},updateUIValue:function(value){var self=this;this.each(function(profile){var r,prop=profile.properties,ovalue=prop.$UIvalue,box=profile.boxing();if(ovalue!==value){if(false===profile.box.checkValid(profile,value)||(profile.beforeValueUpdated&&false===(r=box.beforeValueUpdated(profile,ovalue,value))))return;if(typeof r!='undefined')value=r;if(profile.domNode)box.setCtrlValue(value);prop.$UIvalue=value;if(profile.domNode)box.setDirtyMark();if(profile.afterValueUpdated)box.afterValueUpdated(profile,ovalue,value)}});return this},updateValue:function(){this.each(function(profile){var prop=profile.properties;prop.value=prop.$UIvalue});return this.setDirtyMark()},getDirtied:function(){var arr;this.each(function(profile){var prop=profile.properties;if(prop.value!==prop.$UIvalue)arr.push(profile)});return linb.UI.pack(arr)},checkUIValueValid:function(){var r=true,prop;this.each(function(profile){prop=profile.properties;if(!profile.box.checkValid(profile,prop.$UIvalue)){if(profile.domNode)profile.boxing().setDirtyMark();r=false}});return r},disabled:function(value){return this.each(function(o){o.root.opacity(value?0.5:1)})}},Static:{DataModel:{$UIvalue:'',tag:'',tagVar:{ini:{}},dragKey:'',value:{ini:null,set:function(value,flag){this.each(function(profile){var r,p=profile.properties,ovalue=p.value,box=profile.boxing(),oui;if(ovalue!==value||flag){if(profile.box.checkValid(profile,value)===false)return;if(profile.beforeValueSet&&false===(r=box.beforeValueSet(profile,ovalue,value)))return;if(typeof r!='undefined')value=r;if(profile.domNode)box.setCtrlValue(value);p.value=p.$UIvalue=value;delete profile.inValid;if(profile.domNode)box.setDirtyMark();if(profile.afterValueSet)box.afterValueSet(profile,ovalue,value)}});return this}},disabled:{ini:false,action:function(v){v=String(v).toLowerCase()!='false';this.boxing().disabled(v)}},dock:{ini:'none',listbox:['none','top','bottom','left','right','width','height','fill','cover'],action:function(v){if(this.domNode)this.box.dock(this,true)}},dockOrder:{ini:1,action:function(v){if(this.domNode&&this.properties.dock!='none')this.box.dock(this,true,true)}},dockMargin:{ini:{left:0,top:0,right:0,bottom:0},action:function(v){if(this.domNode&&this.properties.dock!='none')this.box.dock(this,true,true)}},dockFloat:{ini:false,action:function(v){if(this.domNode&&this.properties.dock!='none')this.box.dock(this,true,true)}}},Behaviors:{'default':{}},EventHandlers:{beforeValueSet:function(profile,oldValue,newValue,showValue){},afterValueSet:function(profile,oldValue,newValue,showValue){},beforeValueUpdated:function(profile,oldValue,newValue,showValue){},afterValueUpdated:function(profile,oldValue,newValue,showValue){},beforeHoverEffect:function(profile,item,src,type){},beforeClickEffect:function(profile,item,src,type){},beforeNextFocus:function(profile,e,src){},afterCreated:function(profile){},beforeDestroy:function(profile){},onHotKeydown:function(profile,key,control,shift,alt,e,src){},onHotKeypress:function(profile,key,control,shift,alt,e,src){},onHotKeyup:function(profile,key,control,shift,alt,e,src){}},createdTrigger:function(){var p=this.properties,box=this.boxing();this.created=true;if(this.afterCreated)box.afterCreated(this);if(p.dock&&p.dock!='none')this.box.dock(this);if(typeof p.value!='undefined')box.setCtrlValue(p.value);if(p.disabled)box.disabled(true);if(this.box.resize){var me=arguments.callee,wc=me.wc||(me.wc='top,bottom,width,fill,cover'.toHash(true)),hc=me.hc||(me.hc='left,right,height,fill,cover'.toHash(true));this.box.resize(this,wc[p.dock]?null:p.width,hc[p.dock]?null:p.height)}},envTrigger:function(){var p=this.properties;if(p.dock&&p.dock!='none')this.box.dock(this,true)},dock:function(profile,flag,force){var prop=profile.properties,margin=prop.dockMargin,node=profile.root,value=prop.dock||'none',p=node.parent(),pid=p.id(),region;if(linb.dom.isMatix(pid))return;if(profile.$dockParent!=pid||profile.$dockType!=value||force){profile.$dockParent=pid;profile.$dockType=value;profile.antiLinks('$dock');profile.antiLinks('$dock1');profile.antiLinks('$dock2');switch(value){case'top':region={left:margin.left,right:margin.right,bottom:'auto',height:prop.height?prop.height:''};break;case'bottom':region={left:margin.left,right:margin.right,top:'auto',height:prop.height?prop.height:''};break;case'left':region={right:'auto',width:prop.width?prop.width:''};break;case'right':region={left:'auto',width:prop.width?prop.width:''};break;case'width':region={bottom:'auto',height:prop.height?prop.height:'',top:prop.top?prop.top:''};break;case'height':region={right:'auto',width:prop.width?prop.width:'',left:prop.left?prop.left:''};break;case'fill':case'cover':region={right:'auto',bottom:'auto'};break;case'none':region={left:prop.left,top:prop.top,width:prop.width?prop.width:'',height:prop.height?prop.height:''};break}node.setRegion(region,true);var f,win=false;if(p.get(0)===document.body){p=linb([window],false);win=true;if(win&&!linb.cache._resizeTime)linb.cache._resizeTime=1}if(value!='none'){if(!win)p.setStyle('overflow','hidden');f=p.getEvent('onResize','dock');if(!f){f=function(p,arg){var me=arguments.callee,map=me.map||(me.map='top,bottom,left,bottom'.toHash(true)),arr=me.arr,rePos=me.rePos,node=me.node,win=me.win,obj,i,k,o,key,target;if(arg.$dockid||!win||(_.timeStamp()-linb.cache._resizeTime>100)){obj={left:0,top:0,right:0,bottom:0,width:node.width(),height:node.height()};for(k=0;key=arr[k++];){target=me[key];if(target.length){if(map[key])arg.width=arg.height=1;for(i=0;o=target[i++];)rePos(o,obj,key,arg.$dockid,win||arg.width,win||arg.height)}}if(obj.later){_.each(obj.later,function(o){try{o.node.setRegion(o,true,true)}catch(e){_.asyRun(function(){o.width+=1;o.height+=1;o.node.setRegion(o,true,true)})}})}if(win)linb.cache._resizeTime=_.timeStamp()}};f.node=p;f.arr=['top','bottom','left','right','width','height'];f.arr.each(function(key){f[key]=[]});f.win=win;f.rePos=function(profile,obj,value,id,w,h){var flag=false;if(id&&profile.$id!=id)flag=true;var prop=profile.properties,margin=prop.dockMargin,node=profile.root,style=profile.domNode.style,left,top,right,bottom,temp,other,x=parseInt(prop._dockBorderWidth)||0,y=parseInt(prop._dockBorderHeight)||0,region={};switch(value){case'top':if(!flag){left=margin.left;right=margin.right;top=obj.top+margin.top;if(parseFloat(style.top)!=top)region.top=top;temp=obj.width-left-right-x;if(parseFloat(style.width)!=temp)region.width=temp;if(!_.isEmpty(region))node.setRegion(region,true)}obj.top+=(node.offsetHeight()+margin.top+margin.bottom);break;case'bottom':if(!flag){left=margin.left;right=margin.right;bottom=obj.bottom+margin.bottom;if(parseFloat(style.bottom)!=bottom)region.bottom=bottom;temp=obj.width-left-right-x;if(parseFloat(style.width)!=temp)region.width=temp;if(!_.isEmpty(region))node.setRegion(region,true)}obj.bottom+=(node.offsetHeight()+margin.top+margin.bottom);break;case'left':if(!flag){left=obj.left+margin.left;top=obj.top+margin.top;bottom=obj.bottom+margin.bottom;if(parseFloat(style.left)!=left)region.left=left;if(parseFloat(style.top)!=top)region.top=top;temp=obj.height-top-bottom-y;if(parseFloat(style.height)!=temp)region.height=temp;if(!_.isEmpty(region))node.setRegion(region,true)}obj.left+=(node.offsetWidth()+margin.left+margin.right);break;case'right':if(!flag){right=obj.right+margin.right;top=obj.top+margin.top;bottom=obj.bottom+margin.bottom;if(parseFloat(style.right)!=right)region.right=right;if(parseFloat(style.top)!=top)region.top=top;temp=obj.height-top-bottom-y;if(parseFloat(style.height)!=temp)region.height=temp;if(!_.isEmpty(region))node.setRegion(region,true)}obj.right+=(node.offsetWidth()+margin.left+margin.right);break;case'width':if(!w)return;left=(prop.dock=='cover'?0:obj.left)+margin.left;right=(prop.dock=='cover'?0:obj.right)+margin.right;top=prop.dock=='width'?(parseInt(prop.top)||0):((prop.dock=='cover'?0:obj.top)+margin.top);temp=obj.width-left-right-x;obj.later=obj.later||{};obj.later[profile.$id]=obj.later[profile.$id]||linb.dom.iniBox();_.merge(obj.later[profile.$id],{node:node,width:temp,left:left,top:top},'all');break;case'height':if(!h)return;top=(prop.dock=='cover'?0:obj.top)+margin.top;bottom=(prop.dock=='cover'?0:obj.bottom)+margin.bottom;left=prop.dock=='height'?(parseInt(prop.left)||0):((prop.dock=='cover'?0:obj.left)+margin.left);temp=obj.height-top-bottom-y;obj.later=obj.later||{};obj.later[profile.$id]=obj.later[profile.$id]||linb.dom.iniBox();_.merge(obj.later[profile.$id],{node:node,height:temp,left:left,top:top},'all');break}};p.onResize(f,'dock')}var order=function(x,y){x=parseInt(x.properties.dockOrder)||0;y=parseInt(y.properties.dockOrder)||0;return x>y?1:x==y?0:-1};if(value=='fill'||value=='cover'){profile.links(f.height,'$dock1');profile.links(f.width,'$dock2');f.height.sort(order);f.width.sort(order)}else{profile.links(f[value],'$dock');f[value].sort(order)}linb.cache._resizeTime=1;profile.$dock=f}else{if(!win)p.setStyle('overflow','')}}if(value!='none'&&flag)profile.$dock(profile,{width:1,height:1,$dockid:['width','height','fill','cover'].exists(value)?profile.$id:null,$type:value})},checkValid:function(profile,value){return true},beforeSerialized:function(profile){var r=profile.boxing(),b=false,o=profile.copy(),p=o.properties=_.copy(profile.properties);switch(p.dock){case'top':case'bottom':delete p.width;delete p.left;delete p.top;delete p.right;delete p.bottom;break;case'left':case'right':delete p.height;delete p.left;delete p.top;delete p.right;delete p.bottom;break;case'width':delete p.width;break;case'height':delete p.height;break;case'fill':case'cover':delete p.width;delete p.height;break}if(p.items&&p.items.length){p.items=_.clone(p.items);p.items.each(function(o){_.filter(o,function(o,i){return!linb.Base.$specialChars[i.charAt(0)]})})}if(p.listKey&&!p.$first)p.items.length=0;return o},getDropKeys:function(profile,node){return profile.properties.dropKeys},getDragKey:function(profile,node){return profile.properties.dragKey},getDragData:function(profile,node){return{profile:profile,domId:node.id}}},Initialize:function(){var hash={};'left,top,width,height,right,bottom'.toArr().each(function(o){hash[o]={ini:'auto',action:function(value){var p=this.properties,b=false,args={$type:p.dock};if(this.domNode){switch(p.dock){case'top':if(!['height','top'].exists(o))return;args.width=args.height=1;break;case'bottom':if(!['height','bottom'].exists(o))return;args.width=args.height=1;break;case'left':if(!['width','left'].exists(o))return;args.width=args.height=1;break;case'right':if(!['width','right'].exists(o))return;args.width=args.height=1;break;case'width':if('width'==o)return;args.width=1;break;case'height':if('height'==o)return;args.height=1;break;case'fill':case'cover':if(['width','height'].exists(o))return;args.width=args.height=1;break}this.root[o](value);if(p.dock!='none')_.tryF(this.$dock,[this,args],this)}}}});_.merge(hash,{zIndex:{ini:1,action:function(value){if(this.domNode)this.root.zIndex(value)}},tabindex:{ini:0},position:{ini:'absolute',hidden:true,listbox:['relative','absolute'],action:function(value){if(this.domNode)this.root.position(value)}}});this.setDataModel(hash);'left,top,width,height,right,bottom,zIndex,position'.toArr().each(function(key){this.prototype['refresh'+key.initial()]=function(){this.each(function(profile){var t=(profile.domNode)?profile.root[key]():profile.properties[key];this['set'+key.initial()](t)},this);return this['get'+key.initial()]()}},this)}});Class("linb.UI.iList","linb.UI.iWidget",{Instance:{activate:function(){var profile=this.get(0),items=profile.getSubNode(profile.keys.ITEM,true);if(!items.isEmpty())items.focus();return this},insertItems:function(arr,base,before){if(!arr||!arr.length)return;var self=this.constructor,node,items,r,data,b=this.insertItemsEx;return this.each(function(profile){items=profile.properties.items;index=items.subIndexOf('id',base);if(index==-1){items.insert(arr,before?0:-1)}else items.insert(arr,before?index:index+1);data=profile.box.prepareItems(profile,arr);if(profile.domNode){r=self.subBuild(profile,'items',data).toDom();if(index==-1){node=profile.getSubNode(profile.keys.ITEMS||profile.keys.KEY);if(before)node.addFirst(r);else node.addLast(r)}else{node=profile.getSubNode(profile.keys.ITEM,profile.getSubSerialIdByItemId(base));if(before)node.addPre(r);else node.addNext(r)}}if(b)profile.boxing().insertItemsEx(data,base,before)})},removeItems:function(arr){var obj,v;if(!(arr instanceof Array))arr=[arr];var serialId,self=this.constructor,remove=function(profile,arr,target,force){var self=arguments.callee;arr.filter(function(o){var b;if(force||(b=target.exists(o.id))){if(serialId=profile.ItemIdMapSubSerialId[o.id]){delete profile.SubSerialIdMapItem[serialId];delete profile.ItemIdMapSubSerialId[o.id];profile.cacheSubId(serialId,'items');if(!force)if(!(obj=profile.getSubNode(profile.keys.ITEM,serialId)).isEmpty())obj.remove()}}if(o.sub)self(profile,o.sub,target,force||b);if(b)return false},null,true)};return this.each(function(profile){remove(profile,profile.properties.items,arr);if(v=profile.properties.value){if((v=v.split(';')).length>1){v.filter(function(o){return!arr.exists(o)});profile.properties.value=v.join(';')}else{if(arr.exists(profile.properties.value))profile.properties.value=null}}})},clearItems:function(key){return this.each(function(profile){if(!profile.SubSerialIdMapItem)return;profile.getSubNode(key||profile.keys.ITEMS||profile.keys.KEY,true).empty();_.each(profile.SubSerialIdMapItem,function(o,serialId){profile.cacheSubId(serialId,'items')});if(profile.properties.items)profile.properties.items.length=0;profile.SubSerialIdMapItem={};profile.ItemIdMapSubSerialId={};profile.properties.value=null})}},Initialize:function(){this.setCacheList('test',[{id:'a',caption:'itema',tips:'item a',sub:[{id:'aa',caption:'suba'},{id:'ab',caption:'subb'}]},{id:'b',caption:'itemb',tips:'item b'},{id:'c',caption:'itemc',tips:'item c'}]);'getItemByItemId,getItemByDom,getIdBySubId,getSubSerialIdByItemId'.toArr().each(function(s){this[s]=function(){var t=this.get(0);return t[s].apply(t,arguments)}},this.prototype)},Static:{cssNone:true,DataModel:{listKey:{ini:'',set:function(v,flag){return this.each(function(o){if(o.properties.listKey!=v||flag){var t=linb.UI.getCacheList(v);if(t)o.boxing().setItems(t);else o.boxing().setItems(o.properties.items);o.properties.listKey=v}})}},items:{ini:{},set:function(v){return this.each(function(o){if(o.domNode)o.boxing().clearItems().insertItems(v);o.properties.items=v})}}},showTips:function(profile,id,pos){if(profile.properties.disabled)return;if(profile.SubSerialIdMapItem&&_.get(profile.SubSerialIdMapItem,[id,'disabled']))return;var item=profile.getItemByDom(id);if(item&&item.tips){linb.UI.Tips.show(pos,item);return true}else return false}}});Class("linb.UI.Widget","linb.UI.iWidget",{Instance:{_shadow:function(key){if(!linb.dom.support('shadow'))return this;return this.each(function(o){var target=o.getSubNode(o.keys.BORDER);if(target.isShadow())return;var v=o.boxing(),d=o.properties,n=v.reBoxing(),w=n.width(),h=n.height();o.$shadow=target.shadow({size:d._shadowSize,offset:d.$paddingBottom||d.$border});d.$paddingBottom+=d._shadowSize;d.$paddingRight+=d._shadowSize;o.box.resize(o,w,h)})},_unShadow:function(){if(!linb.dom.support('shadow'))return this;return this.each(function(o){var target=o.getSubNode(o.keys.BORDER);if(!target.isShadow())return;target.unShadow();var v=o.boxing(),d=o.properties,n=v.reBoxing(),w=n.width(),h=n.height();d.$paddingBottom-=d._shadowSize;d.$paddingRight-=d._shadowSize;o.box.resize(o,w,h);delete o.$shadow})},_resize:function(key,args){if(!linb.dom.support('resizable'))return this;return this.each(function(o){var target=o.getSubNode(o.keys.BORDER),d=o.properties;if(target.isResizable())return;args=args||{};_.merge(args,{child:true,cover:true,parent:o.getSubNode(o.keys.BORDER)},'without');var update=function(pro,target,size,cssPos){var profile=arguments.callee.profile,node=profile.root,prop=profile.properties;if(cssPos){if(cssPos.left){node.leftBy(cssPos.left);prop.left=node.left()}if(cssPos.top){node.topBy(cssPos.top);prop.top=node.top()}}if(size){var w=null,h=null;if(size.width){node.widthBy(size.width);prop.width=w=node.width()}if(size.height){node.heightBy(size.height);prop.height=h=node.height()}profile.box.resize(profile,w,h)}};update.profile=o;o.$resizer=target.resizable(args,target,update)})},_unResize:function(){if(!linb.dom.support('resizable'))return this;return this.each(function(o){var target=o.getSubNode(o.keys.BORDER);if(!target.isResizable())return;target.unResizable();delete o.$resizer})},_border:function(key,args){if(!linb.dom.support('edged'))return this;return this.each(function(o){var target=o.getSubNode(o.keys.BORDER);if(target.isEdged())return;var v=o.boxing(),d=o.properties,n=v.reBoxing(),w=v.reBoxing().width(),h=v.reBoxing().height();d.$paddingLeft+=d._borderSize;d.$paddingTop+=d._borderSize;d.$paddingBottom+=d._borderSize;d.$paddingRight+=d._borderSize;args=args||{};_.merge(args,{offset:d._borderSize/2,enlarge:d._borderSize/2,cover:true,parent:o.getSubNode(o.keys.BORDER)},'without');var update=function(target,size,cssPos){var profile=arguments.callee.profile,node=profile.root;if(cssPos){if(cssPos.left)node.leftBy(cssPos.left);if(cssPos.top)node.topBy(cssPos.top)}if(size){var w=null,h=null;if(size.width){node.widthBy(size.width);w=node.width()}if(size.height){node.heightBy(size.height);h=node.height()}profile.box.resize(profile,w,h)}};update.profile=o;o.$border=target.edged(args,target,update,o.makeRootId());o.box.resize(o,w,h);o.resetCache();if(target.isShadow()){var o=target.getShadow();o.setOffset(o.getOffset()+d._borderSize/2+1)}})},_unBorder:function(){if(!linb.dom.support('edged'))return this;return this.each(function(o){var target=o.getSubNode(o.keys.BORDER);if(!target.isEdged())return;var v=o.boxing(),d=o.properties,n=v.reBoxing(),w=v.reBoxing().width(),h=v.reBoxing().height();d.$paddingLeft-=d._borderSize;d.$paddingTop-=d._borderSize;d.$paddingBottom-=d._borderSize;d.$paddingRight-=d._borderSize;target.unEdged();o.box.resize(o,w,h);if(target.isShadow()){var o=target.getShadow();o.setOffset(o.getOffset()-d._borderSize/2-1)}delete o.$border})}},Static:{cssNone:false,Templates:{'default':{tagName:'span',className:'linb-uishell ',style:'{left}{top}{width}{height}{right}{bottom}{zIndex}{position}',FRAME:{tagName:'span',className:'linb-uiframe ',BORDER:{tagName:'span',style:'width:{bWidth}px;height:{bHeight}px;',className:'linb-uiborder '}}}},PublicAppearance:{'.linb-uishell':{display:linb.browser.gek?['-moz-inline-block','-moz-inline-box']:'inline-block',overflow:'hidden',border:'0',padding:'0',margin:'0'},'.linb-uiframe':{$order:1,display:'block',position:'relative',overflow:'hidden',border:'0',padding:'0',margin:'0',width:'100%',height:'100%','-moz-box-flex':'1'},'.linb-uiborder':{$order:2,display:'block',position:'absolute',border:'0',padding:'0',margin:'0',left:'0',top:'0',width:'100%',height:'100%'}},Behaviors:{'default':{onResize:function(profile,e,src){var o=linb([profile.domNode],false),w=null,h=null;if(e.width)w=o.width();if(e.height)h=o.height();profile.box.resize(profile,w,h)}}},DataModel:{shadow:{ini:false,action:function(v){v=String(v).toLowerCase()!='false';if(v)this.boxing()._shadow(v);else this.boxing()._unShadow()}},resizable:{ini:false,action:function(v){v=String(v).toLowerCase()!='false';if(v){var t=this.properties,arg={};_.merge(arg,t,'all',['minHeight','minWidth','maxHeight','maxWidth']);this.boxing()._resize(v,arg)}else this.boxing()._unResize()}},border:{ini:false,action:function(v){v=String(v).toLowerCase()!='false';if(v)this.boxing()._border(v);else this.boxing()._unBorder()}},caption:{action:function(value){this.getSubNode(this.keys.CAPTION).html(value);var p=this.properties;if(p.hAlign&&p.hAlign!='left')this.boxing().setHAlign(p.hAlign,true);if(p.vAlign&&p.vAlign!='top')this.boxing().setVAlign(p.vAlign,true)}},icon:{ini:'',action:function(value){this.getSubNode(this.keys.ICON).display(value?'':'none').setStyle('backgroundImage','url('+(value||'')+')')}},iconPos:{ini:'',action:function(value){this.getSubNode(this.keys.ICON).setStyle('backgroundPosition',value)}},tips:'',$paddingTop:0,$paddingLeft:0,$paddingBottom:0,$paddingRight:0,$border:0,_shadowSize:8,_borderSize:4},createdTrigger:function(){var prop=this.properties,o=this.boxing();prop.$UIvalue=prop.value;if(prop.border)o._border(prop.border);if(prop.resizable)o.setResizable(prop.resizable,true);if(prop.shadow)o._shadow(prop.shadow);if(prop.disabled)o.disabled(true)},resize:function(profile,w,h){var o=profile.getSubNode(profile.keys.BORDER),t=profile.properties,left=null,top=null,width=null,height=null;if(null!==w){w-=(t.$border*2+t.$paddingLeft+t.$paddingRight);if(linb.browser.ie6)w=(parseInt(w/2))*2;left=t.$paddingLeft;width=w}if(null!==h){h-=(t.$border*2+t.$paddingTop+t.$paddingBottom);if(linb.browser.ie6)h=(parseInt(h/2))*2;top=t.$paddingTop;height=h;if(linb.browser.ie6&&null===w)o.ieTrigger()}o.setRegion({left:left,top:top,width:width,height:height});return{width:width,height:height}}}});Class("linb.UI.iDataSource");Class("linb.UI.iContainer");Class("linb.UI.iForm");Class("linb.UI.iMisc");Class("linb.UI.iNavigator");Class('linb.UI.iSchedule');Class("linb.UI.Div","linb.UI.iWidget",{Static:{cssNone:true,Templates:{'default':{tagName:'div',style:'overflow:auto;{left}{top}{width}{height}{right}{bottom}{zIndex}{position}',text:'{html}'+linb.UI.$childTag}},DataModel:{dataBinder:null,dataField:null,value:null,disabled:null,width:'100',height:'100',html:{ini:'',action:function(v){this.root.html(v)}}},EventHandlers:{beforeValueSet:null,afterValueSet:null,beforeValueUpdated:null,afterValueUpdated:null,beforeHoverEffect:null,beforeNextFocus:null,beforeClickEffect:null}}});Class("linb.UI.Panel",["linb.UI.Div","linb.UI.iContainer"],{Static:{Dropable:['KEY']}})};Class("linb.UI.Label",["linb.UI.Widget","linb.UI.iForm"],{Instance:{_shadowText:function(key){return this.each(function(o){o.getSubNode(o.keys.SHADOW).display('block')})},_unShadowText:function(key){return this.each(function(o){o.getSubNode(o.keys.SHADOW).display('none')})}},Initialize:function(){var t=this.getTemplate('default');_.merge(t.FRAME.BORDER,{SHADOW:{$order:1,style:'display:none;',SICON:{style:'background:url({icon}) transparent no-repeat {iconPos};{iconDisplay}',$order:0},SCAPTION:{text:'{caption}',style:'color:#cdcdcd;',$order:1}},BOX:{$order:2,ICON:{style:'background:url({icon}) transparent no-repeat {iconPos};{iconDisplay}',$order:0},CAPTION:{text:'{caption}',$order:1}}},'all');this.setTemplate('default',t)},Static:{Appearances:{'default':{KEY:{'font-size':'12px','line-height':'12px'},BOX:{position:'absolute'},SHADOW:{position:'absolute'},ICON:{width:'16px',height:'16px',margin:'0 4px 0 0'},SICON:{width:'16px',height:'16px',margin:'0 4px 0 0'}}},DataModel:{tabindex:null,caption:{action:function(value){this.getSubNode(this.keys.CAPTION).add(this.getSubNode(this.keys.SCAPTION)).html(value,false);if(this.properties.hAlign!='left')this.boxing().setHAlign(this.properties.hAlign,true);if(this.properties.vAlign!='top')this.boxing().setVAlign(this.properties.vAlign,true)}},icon:{ini:'',action:function(value){this.getSubNode(this.keys.ICON).add(this.getSubNode(this.keys.SICON)).display(value?'':'none').setStyle('backgroundImage','url('+(value||'')+')')}},iconPos:{ini:'',action:function(value){this.getSubNode(this.keys.ICON).add(this.getSubNode(this.keys.SICON)).setStyle(backgroundPosition,value)}},shadowText:{ini:false,action:function(v){v=String(v).toLowerCase()!='false';if(v)this.boxing()._shadowText(v);else this.boxing()._unShadowText()}},hAlign:{ini:'right',listbox:['left','center','right'],action:function(v){var c=this.getSubNode(this.keys.BOX),d=this.getSubNode(this.keys.SHADOW),t=this.properties;switch(v){case'left':c.setStyle({left:0,right:'auto','marginLeft':'auto'});d.setStyle({left:t._textSshadowSize+'px',right:'auto','marginLeft':'auto'});break;case'right':c.setStyle({left:'auto',right:t._textSshadowSize+'px','marginLeft':'auto'});d.setStyle({left:'auto',right:0,'marginLeft':'auto'});break;case'center':c.setStyle({left:'50%',right:'auto','marginLeft':-1*c.get(0).offsetWidth/2+'px'});d.setStyle({left:'50%',right:'auto','marginLeft':-1*c.get(0).offsetWidth/2+t._textSshadowSize+'px'});break}}},vAlign:{ini:'top',listbox:['top','middle','bottom'],action:function(v){var c=this.getSubNode(this.keys.BOX),d=this.getSubNode(this.keys.SHADOW),t=this.properties;switch(v){case'top':c.setStyle({top:0,bottom:'auto','marginTop':'auto'});d.setStyle({top:t._textSshadowSize+'px',bottom:'auto','marginTop':'auto'});break;case'bottom':c.setStyle({top:'auto',bottom:t._textSshadowSize+'px','marginTop':'auto'});d.setStyle({top:'auto',bottom:0,'marginTop':'auto'});break;case'middle':c.setStyle({top:'50%',bottom:'auto','marginTop':-1*c.get(0).offsetHeight/2+'px'});d.setStyle({top:'50%',bottom:'auto','marginTop':-1*c.get(0).offsetHeight/2+t._textSshadowSize+'px'});break}}},'fontSize':{ini:'',action:function(value){this.getSubNode(this.keys.CAPTION).add(this.getSubNode(this.keys.SCAPTION)).setStyle('fontSize',value)}},'fontWeight':{ini:'',action:function(value){this.getSubNode(this.keys.CAPTION).add(this.getSubNode(this.keys.SCAPTION)).setStyle('fontWeight',value)}},width:60,height:20,_textSshadowSize:4},createdTrigger:function(){var properties=this.properties,o=this.boxing();if(properties.hAlign!='left'||properties.shadowText)o.setHAlign(properties.hAlign,true);if(properties.vAlign!='top'||properties.shadowText)o.setVAlign(properties.vAlign,true);if(properties.fontSize)o.setFontSize(properties.fontSize,true);if(properties.fontWeight)o.setFontWeight(properties.fontWeight,true);if(properties.shadowText)o.setShadowText(true,true)},EventHandlers:{beforeValueUpdated:null,afterValueUpdated:null,beforeValueSet:null,afterValueSet:null,beforeNextFocus:null}}});Class("linb.UI.Button",["linb.UI.Widget","linb.UI.iForm"],{Instance:{_border:function(key,args){args=args||{};args.borderActive=true;return arguments.callee.upper.call(this,key,args)},activate:function(){var profile=this.get(0);profile.getSubNode(profile.keys.FOCUS).focus();return this},setCtrlValue:function(value){if(_.isNull(value)||!_.exists(value))value=false;return this.each(function(profile){if(!profile.properties.toggleKey)return;var key=profile.keys.BORDER;if(value)profile.addTagClass(profile.getSubNode(key),key,'-checked');else profile.removeTagClass(profile.getSubNode(key),key,'-checked');if(profile.properties.border){var b=profile.boxing().getBorder();if(b)b.setChecked(value)}})}},Initialize:function(){var t=this.getTemplate('default');_.merge(t.FRAME.BORDER,{FOCUS:{tagName:'a',href:"javascript:;",tabindex:'{tabindex}',BOX:{tagName:'span',ICON:{$order:1,tagName:'span',style:'background:url({icon}) transparent no-repeat  {iconPos};{iconDisplay}'},CAPTION:{$order:2,tagName:'span',text:'{caption}',className:"{disabled}"}}}},'all');this.setTemplate('default',t);t=this.getAppearance('default');var n=_.copy(t);_.merge(n,{'BORDER':{$order:0,'text-decoration':'underline','cursor':'pointer'},'BORDER-mouseover':{$order:1,'font-weight':'bold'},'BORDER-mousedown':{$order:1,'font-style':'italic'}},'all');this.setAppearance('link',n)},Static:{Appearances:{'default':{KEY:{'font-size':'12px','line-height':'12px'},BORDER:{border:'solid 1px #eee','background-color':'#f4f4f4'},'BORDER-mouseover':{$order:1,'border-color':'#fff #cdcdcd #cdcdcd #fff'},'BORDER-mousedown, BORDER-checked':{$order:2,'border-color':'#cdcdcd #fff #fff #cdcdcd','background-color':'#fff'},ICON:{width:'16px',height:'16px',margin:'0 4px 0 0'},FOCUS:{overflow:'hidden',display:'block',position:'absolute',left:'0',top:'0','z-index':'20',width:'100%',height:'100%','-moz-outline-offset':'-1px !important'},BOX:{display:linb.browser.gek?['-moz-inline-block','-moz-inline-box']:'inline-block','font-size':'12px','line-height':'14px',overflow:'hidden','white-space':'nowrap',position:'absolute'}}},Behaviors:{'default':{_hoverEffect:{KEY:['BORDER']},_clickEffect:{KEY:['BORDER']},_focusHook:{FOCUS:1},onClick:function(profile,e,src){var p=profile.properties;if(p.disabled)return false;profile.getSubNode(profile.keys.FOCUS).focus();if(p.toggleKey){profile.boxing().updateUIValue(!p.$UIvalue);if(profile.onToggle)profile.boxing().onToggle(profile,e,profile.properties.$UIvalue,p.toggleKey)}if(profile.onClick)profile.boxing().onClick(profile,e,profile.properties.$UIvalue);return false}}},DataModel:{hAlign:{ini:'center',listbox:['left','center','right'],action:function(v){var c=this.getSubNode(this.keys.BOX),t=this.properties;switch(v){case'left':c.setStyle({left:0,right:'auto','marginLeft':'auto'});break;case'right':c.setStyle({left:'auto',right:0,'marginLeft':'auto'});break;case'center':c.setStyle({left:'50%',right:'auto','marginLeft':-1*c.get(0).offsetWidth/2+'px'});break}}},vAlign:{ini:'top',listbox:['top','middle','bottom'],action:function(v){var c=this.getSubNode(this.keys.BOX),t=this.properties;switch(v){case'top':c.setStyle({top:0,bottom:'auto','marginTop':'auto'});break;case'bottom':c.setStyle({top:'auto',bottom:0,'marginTop':'auto'});break;case'middle':c.setStyle({top:'50%',bottom:'auto','marginTop':-1*c.get(0).offsetHeight/2+'px'});break}}},tabindex:{action:function(value){if(this.domNode)this.getSubNode(this.keys.FOCUS).tabIndex(value)}},value:false,toggleKey:'',width:120,height:20,$border:1},createdTrigger:function(){var properties=this.properties,o=this.boxing();if(properties.hAlign!='left')o.setHAlign(properties.hAlign,true);if(properties.vAlign!='top')o.setVAlign(properties.vAlign,true);if(properties.toggleKey&&properties.value)o.setValue(true,true)},EventHandlers:{onClick:function(profile,e,value){},onToggle:function(profile,e,value,toggleKey){}}}});Class("linb.UI.CheckBox","linb.UI.Button",{Instance:{activate:function(){var profile=this.get(0);profile.getSubNode(profile.keys.FOCUS).focus();return this},setCtrlValue:function(value){if(_.isNull(value)||!_.exists(value))value=false;return this.each(function(profile){var key=profile.keys.MARK;if(value)profile.addTagClass(profile.getSubNode(key),key,'-checked');else profile.removeTagClass(profile.getSubNode(key),key,'-checked')})},setDirtyMark:function(){return this.each(function(profile){if(!profile.domNode)return;var properties=profile.properties,o=profile.getSubNode(profile.keys.CAPTION),flag=properties.value!==properties.$UIvalue;if(o.beforeDirtyMark&&false===o.boxing().beforeDirtyMark(profile,flag))return;if(flag)o.addClass(linb.UI.$css_tag_dirty);else o.removeClass(linb.UI.$css_tag_dirty)})}},Initialize:function(){var t=this.getTemplate('default');_.merge(t.FRAME.BORDER.FOCUS.BOX,{MARK:{$order:0,tagName:'span'}},'all');this.setTemplate('default',t)},Static:{Appearances:{'default':{KEY:{'font-family':'"Verdana", "Helvetica", "sans-serif"','font-size':'12px',border:'0',cursor:'pointer','background-color':'#fff'},BORDER:{},FOCUS:{overflow:'hidden',display:'block',position:'absolute',left:'0',top:'0','z-index':'200',width:'100%',height:'100%','-moz-outline-offset':'-1px !important'},BOX:{display:linb.browser.gek?['-moz-inline-block','-moz-inline-box']:'inline-block','font-size':'12px','line-height':'14px',overflow:'hidden',position:'absolute'},MARK:{cursor:'pointer',width:'16px',height:'16px',background:linb.UI.getCSSImgPara('cmds.gif',' no-repeat -112px top',null,'linb.UI.Public')},'MARK-mouseover':{$order:1,'background-position':'-112px -17px'},'MARK-mousedown':{$order:2,'background-position':'-112px -34px'},'MARK-checked':{$order:3,'background-position':'-96px top'},'MARK-checked-mouseover':{$order:4,'background-position':'-96px -17px'},'MARK-checked-mousedown':{$order:5,'background-position':'-96px -34px'},ICON:{cursor:'pointer',width:'16px',height:'16px',margin:'0 4px 0 0'},CAPTION:{'vertical-align':'top'}}},Behaviors:{'default':{_hoverEffect:{KEY:'MARK'},_clickEffect:{KEY:'MARK'},_focusHook:{FOCUS:1},onClick:function(profile,e,src){if(profile.properties.disabled)return false;profile.boxing().updateUIValue(!profile.properties.$UIvalue);if(profile.onChecked)profile.boxing().onChecked(profile,profile.properties.$UIvalue);profile.getSubNode(profile.keys.FOCUS).focus()},FOCUS:{onKeydown:function(profile,e,src){var key=linb.event.getKey(e)[0];if(key=='space'||key=='enter'){profile.getSubNode(profile.keys.KEY).onClick(true);return false}}}}},DataModel:{value:false,hAlign:'left',toggleKey:null},EventHandlers:{beforeDirtyMark:function(profile,flag){},onClick:null,onToggle:null,onChecked:function(profile,value){}}}});Class("linb.UI.Input",["linb.UI.Widget","linb.UI.iForm"],{Instance:{activate:function(){var profile=this.get(0);profile.getSubNode(profile.keys.INPUT).activate();return this},disabled:function(value){arguments.callee.upper.call(this,value);return this.each(function(o){o.getSubNode(o.keys.INPUT).readonly(value)})},setCtrlValue:function(value){if(_.isNull(value)||!_.exists(value))value='';return this.each(function(profile){profile.getSubNode(profile.keys.INPUT).value(value.toString())})},getCtrlValue:function(){var profile=this.get(0);return profile.getSubNode(profile.keys.INPUT).value()},setDirtyMark:function(){return this.each(function(profile){var properties=profile.properties,o=profile.getSubNode(profile.keys.INPUT),flag=properties.value!==properties.$UIvalue;if(o.beforeDirtyMark&&false===o.boxing().beforeDirtyMark(profile,flag)){}else{if(flag)o.addClass(linb.UI.$css_tag_dirty);else o.removeClass(linb.UI.$css_tag_dirty)}if(o.beforeFormatMark&&false==o.boxing().beforeFormatMark(profile)){}else{if(profile.inValid)o.addClass(linb.UI.$css_tag_invalid);else o.removeClass(linb.UI.$css_tag_invalid);profile.getSubNode(profile.keys.ERROR).display(profile.inValid?'block':'none');if(profile.inValid){if(!_.exists(profile.tips)){profile.tips=profile.properties.tips;profile.properties.tips=profile.properties.validTips||profile.box.formatErr}}else{if(_.exists(profile.tips)){profile.properties.tips=profile.tips;delete profile.tips}}}})},readonly:function(value){return this.each(function(profile){profile.getSubNode(profile.keys.INPUT).readonly(value)})}},Initialize:function(){var t=this.getTemplate('default');_.merge(t.FRAME.BORDER,{BOX:{tagName:'div',INPUT:{tagName:'input',type:'{type}',value:'{value}',tabindex:'{tabindex}',cursor:'{cursor}'}}},'all');t.FRAME.ERROR={tagName:'span'};this.setTemplate('default',t)},Static:{formatErr:'format error!',Appearances:{'default':{KEY:{'font-family':'"Verdana", "Helvetica", "sans-serif"',cursor:'pointer',overflow:'hidden'},BORDER:{'line-height':'0px','font-size':'0px','background-color':'#fff',border:'1px solid #7F9DB9'},'BORDER-focus, BORDER-mouseover':{$order:1,border:'1px solid #FFD700'},BOX:{display:'block',position:'absolute',width:'100%',height:'100%',left:'0',top:'0',overflow:linb.browser.gek?'auto':''},INPUT:{border:'0',padding:'0',margin:'0','font-size':'12px',position:'relative',overflow:'auto','overflow-y':(linb.browser.gek||linb.browser.ie)?'auto':'','overflow-x':(linb.browser.gek||linb.browser.ie)?'hidden':''},ERROR:{width:'16px',height:'16px',position:'absolute',right:'0',top:'0',display:'none','font-size':'0',background:linb.UI.getCSSImgPara('icon.gif',' no-repeat left top',null,'linb.UI.Public'),'z-index':'2'}}},Behaviors:{'default':{_focusEffect:{INPUT:1},_hoverEffect:{KEY:['BORDER']},_focusHook:{INPUT:1},INPUT:{onChange:function(profile,e,src){var o=profile.inValid;profile.boxing().updateUIValue(src.value);profile.properties.$UIvalue=src.value;if(o!==profile.inValid)if(profile.domNode)profile.boxing().setDirtyMark()},onFocus:function(profile,e,src){if(profile.properties.disabled)return false;profile.addTagClass(profile.getSubNode(profile.keys.BORDER),profile.key,'-focus')},onBlur:function(profile,e,src){if(profile.properties.disabled)return false;profile.removeTagClass(profile.getSubNode(profile.keys.BORDER),profile.key,'-focus')}}}},DataModel:{icon:null,iconPos:null,caption:null,validTips:'',valueFormat:{ini:'',helpinput:[{caption:'required',id:"[^.*]"},{caption:'email',id:"^[\\w\\.=-]+@[\\w\\.-]+\\.[\\w\\.-]{2,4}$"},{caption:'charOnly',id:"^[a-zA-Z]*$"},{caption:'words',id:"^[\\w ]*$"},{caption:'integer',id:"^-?\\d\\d*$"},{caption:'positiveInteger',id:"^\\d\\d*$"},{caption:'number',id:"^-?(\\d\\d*\\.\\d*$)|(^-?\\d\\d*$)|(^-?\\.\\d\\d*$)"},{caption:'filepath',id:"([\\/]?[\\w_]+)+\\.\\w{1,9}$"},{caption:'URL',id:"^(http|https|ftp)\\:\\/\\/[a-z0-9\\-\\.]+\\.[a-z]{2,3}(:[a-z0-9]*)?\\/?([a-z0-9\\-\\._\\?\\,\\'\\/\\\\\\+&amp;%\\$#\\=~])*$"},{caption:'color',id:"^\\#[0-9A-Fa-f]{6}$"},{caption:"HH-MM-SS",id:"^\(\([0-1][0-9]\)|\([2][0-3])\)\\:\([0-5][0-9]\)\\:\([0-5][0-9]\)$"},{caption:"YYYY-MM-DD",id:"^\([0-9]{4}\)\\-\(\([0][0-9]\)|\([1][0-2]\)\)\\-\([0-3][0-9]\)$"},{caption:"DD/MM/YYYY",id:"^\(\([0-2][0-9]\)|\([3][0-1]\)\)\/\(\([0][0-9]\)|\([1][0-2]\)\)\/\([0-9]{4}\)$"}]},width:120,height:20,tabindex:{action:function(value){if(this.domNode)this.getSubNode(this.keys.INPUT).tabIndex(value)}},readonly:{ini:false,action:function(v){v=String(v).toLowerCase()!='false';this.boxing().readonly(v);this.root.cursor(v?'pointer':'')}},type:{ini:'text',listbox:['text','password'],action:function(value){this.getSubNode(this.keys.INPUT).attr('type',value)}},inputArea:{ini:'input',listbox:['input','textarea'],action:function(value){var str=this.getSubNode(this.keys.INPUT).outerHTML();str=str.replace(/^(<)[a-zA-Z]+(\s)/i,'$1'+value+'$2');var v=this.boxing().getValue();this.getSubNode(this.keys.INPUT).outerHTML(str);this.boxing().updateUIValue(v)}},$border:1},EventHandlers:{beforeDirtyMark:function(profile,flag){},onFormatCheck:function(profile,value){},beforeFormatMark:function(profile){}},prepareData:function(profile){arguments.callee.upper.call(this,profile);profile.data.cursor=profile.data.readonly?'pointer':'default';profile.data.type=profile.data.type||''},dynamicTemplate:function(profile){var properties=profile.properties;var hash=profile._exhash="$"+'inputArea:'+properties.inputArea+';'+'readonly:'+properties.readonly+';',tid=profile.template._id,template=profile.box.getTemplate(tid,hash);properties.$UIvalue=properties.value;if(!template){template=_.clone(profile.box.getTemplate(tid));if(properties.inputArea!='input'){template.FRAME.BORDER.BOX.INPUT.tagName=properties.inputArea;delete template.FRAME.BORDER.BOX.INPUT.type}if(properties.readonly)template.FRAME.BORDER.BOX.INPUT.readonly='readonly';profile.box.setTemplate(tid,template,hash)}profile.template=template},checkValid:function(profile,value){var p=profile.properties;if((p.valueFormat&&typeof p.valueFormat=='string'&&!(new RegExp(p.valueFormat)).test(value))||(profile.onFormatCheck&&(profile.boxing().onFormatCheck(profile,value)===false))){profile.inValid=true;var s=p.validTips||profile.box.formatErr;if(s.charAt(0)=='$')s=s.slice(1);linb.message(linb.getStr(s));return false}{delete profile.inValid;return true}},resize:function(profile,w,h){var size=arguments.callee.upper.apply(this,arguments);var v=linb.dom.pack([],false).add(profile.getSubNode(profile.keys.INPUT)).add(profile.getSubNode(profile.keys.BOX));if(!_.isNull(w))v.width(size.width);if(!_.isNull(h))v.height(size.height-(linb.browser.ie6?2:linb.browser.ie?1:linb.browser.kde?1:0));return size}}});Class("linb.UI.ComboInput","linb.UI.Input",{Instance:{setCtrlValue:function(value,flag){return this.each(function(profile){profile.getSubNode(profile.keys.INPUT).value(flag?value:profile.boxing().getShowValue(value))})},getShowValue:function(value){var profile=this.get(0),pro=profile.properties,v;if(profile.onCustomPop)v=value;else{if(profile.onGetShowValue)v=profile.boxing().onGetShowValue(profile,value);else{if('listbox'==pro.type||'combobox'==pro.type){if((v=profile.properties.items.subIndexOf('id',value))!=-1){v=profile.properties.items[v].caption;v=v.charAt(0)=='$'?linb.getStr(v.slice(1)):v}else v=''}else v=profile.$showValue||value}}return v||value||''},_cache:function(){var profile=this.get(0);if(profile.$drop)profile.getSubNode(profile.keys.POOL).addLast(profile.$drop.root.display('none'));delete profile.$poplink},refreshCache:function(){var profile=this.get(0);if(profile.domNode)profile.getSubNode(profile.keys.POOL).Empty()},_drop:function(){return this.each(function(profile){if(profile.properties.disabled)return;if(profile.$poplink)return;var o,v,pro=profile.properties,box=profile.boxing(),main=box.reBoxing(),pos=main.absPos(),size=main.cssSize();size.width+=2;pos.top+=main.offsetHeight();switch(pro.type){case'getter':case'cmdbox':case'popbox':profile.boxing().onCustomPop(profile,pos);return}var cachekey;switch(pro.type){case'combobox':case'listbox':case'helpinput':if(pro.listKey)if(linb.UI.getCacheListType(pro.listKey)=='function')profile.$drop=null;else cachekey=profile.$drop;else cachekey=profile.$id;break;default:cachekey=pro.type}if(cachekey){_.filter(profile.box.$drop,function(o){return!!o.domNode});profile.$drop=profile.box.$drop[cachekey]}if(!profile.$drop){switch(pro.type){case'combobox':case'listbox':case'helpinput':linb.SC('linb.UI.List');o=linb.create('List');break}o.host(profile).setItems(pro.items.copy()).adjustSize();o.beforeValueUpdated(function(pro,ovalue,value,showValue){var box=pro.boxing();pro.$showValue=showValue;this.boxing().updateUIValue(value);this.boxing()._cache();this.boxing().activate();return false});profile.$drop=o.get(0);if(cachekey)profile.$drop.links(profile.box.$drop,cachekey,null,cachekey)}o=profile.$drop.boxing();switch(pro.type){case'combobox':case'listbox':case'helpinput':o.host(profile).setWidth(profile.root.width()).setValue(box.getUIValue());break}profile.$poplink=o.get(0);var node=o.reBoxing();node.popToTop(profile.root);o.activate();node.setBlurTrigger(profile.key+":"+profile.$id,function(){profile.boxing()._cache()},null,profile.$id);linb.event.hookKey('esc',0,0,0,function(){profile.boxing()._cache();profile.boxing().activate();linb.event.hookKey('esc',0,0,0,null)})})}},Initialize:function(){var t=this.getTemplate('default');_.merge(t.FRAME.BORDER,{BTN:{$order:2,TOP:{},MIDDLE:{style:'background-position:{typePos}'}}},'all');t.FRAME.POOL={};this.setTemplate('default',t)},Static:{$drop:{},Appearances:{'default':{POOL:{position:'absolute',left:0,top:0,width:0,height:0,display:'none',visibility:'hidden'},BTN:{cursor:'pointer',width:'13px','font-size':'0','line-height':'0',position:'absolute',top:'0',right:'0',background:linb.UI.getCSSImgPara('cmd.gif',' left bottom no-repeat')},'BTN-mouseover':{$order:1,'background-position':'-14px bottom'},'BTN-mousedown':{$order:2,'background-position':'-27px bottom'},TOP:{cursor:'pointer',width:'13px','font-size':'0','line-height':'0',position:'absolute',top:'0',left:'0',height:'4px',background:linb.UI.getCSSImgPara('cmd.gif',' left -104px no-repeat')},'BTN-mouseover TOP':{$order:1,'background-position':'-14px -104px'},'BTN-mousedown TOP':{$order:2,'background-position':'-27px -104px'},MIDDLE:{cursor:'pointer',width:'13px','font-size':'0','line-height':'0',position:'absolute',bottom:'3px',left:'0',height:'13px',background:linb.UI.getCSSImgPara('cmd.gif',' left top no-repeat')}}},Behaviors:{'default':{_hoverEffect:{KEY:'BORDER',BTN:['BTN']},_clickEffect:{BTN:['BTN']},_focusHook:{INPUT:1},BTN:{onClick:function(profile,e,src){profile.boxing()._drop()}},INPUT:{onChange:function(profile,e,src){var o=profile.inValid;profile.boxing().updateUIValue(src.value);profile.properties.$UIvalue=src.value;if(o!==profile.inValid)if(profile.domNode)profile.boxing().setDirtyMark()},onFocus:function(profile,e,src){if(profile.properties.disabled)return false;profile.addTagClass(profile.getSubNode(profile.keys.BORDER),profile.key,'-focus')},onBlur:function(profile,e,src){if(profile.properties.disabled)return false;profile.removeTagClass(profile.getSubNode(profile.keys.BORDER),profile.key,'-focus')},onKeydown:function(profile,e,src){var p=profile.properties.type;if(p=='getter'||p=='cmdbox'||p=='popbox')return;var key=linb.event.getKey(e);if((key[0]=='down'||key[0]=='up')&&key[1]){profile.boxing()._drop();return false}else if(key=='enter')profile.getSubNode(profile.keys.INPUT).onChange()},onClick:function(profile,e,src){if(profile.properties.readonly)profile.boxing()._drop()}}}},EventHandlers:{onCustomPop:function(profile,pos){},onGetShowValue:function(profile,value){}},posMap:{combobox:'left top',listbox:'left top',getter:'left -27px',helpinput:'left -91px',cmdbox:'left -14px',popbox:'left -40px',timepicker:'left -53px',datepicker:'left -66px',colorpicker:'left -79px'},DataModel:{icon:null,iconPos:null,caption:null,listKey:{ini:'',set:function(v){var t=linb.UI.getCacheList(v);return this.each(function(o){if(t)o.boxing().setItems(t);else o.boxing().setItems(o.properties.items);o.properties.listKey=v})}},items:{ini:{}},readonly:{ini:false,action:function(v){this.getSubNode(this.keys.INPUT).cursor(v?'pointer':'default')}},type:{ini:'combobox',listbox:'combobox,listbox,getter,helpinput,cmdbox,popbox,timepicker,datepicker,colorpicker'.toArr(),set:function(v){if(v.exists(':')){var arr=v.split(':');if(arr[1]=='readonly')this.setReadonly(true);v=arr[0]}if(v=='listbox')this.setReadonly(true);return this.each(function(pro){pro.properties.type=v;if(pro.domNode)pro.getSubNode(pro.keys.MIDDLE).setStyle('backgroundPosition',pro.box.posMap[v]||'left top')})}},$border:1},createdTrigger:function(){if(this.properties.readonly)this.getSubNode(this.keys.INPUT).cursor('pointer')},prepareData:function(profile){arguments.callee.upper.call(this,profile);profile.data.typePos=profile.box.posMap[profile.data.type]},resize:function(profile,w,h){var size=linb.UI.Widget.resize.apply(this,arguments);var t,v=profile.getSubNode(profile.keys.INPUT),c=profile.getSubNode(profile.keys.BTN);if(!_.isNull(w))v.width(size.width-c.width());if(!_.isNull(h)){v.height(size.height-(linb.browser.ie6?2:linb.browser.ie?1:linb.browser.kde?1:0));c.height(size.height)}}}});Class("linb.UI.Group",["linb.UI.Widget","linb.UI.iForm"],{Instance:{activate:function(){var profile=this.get(0);profile.getSubNode(profile.keys.LEGEND).focus();return this}},Initialize:function(){var t=this.getTemplate('default');_.merge(t.FRAME.BORDER,{FIELDSET:{tagName:'fieldset',style:'{width}{height}',LEGEND:{tagName:'legend',ICON:{tagName:'span',style:'background:url({icon}) transparent  no-repeat {iconPos};{iconDisplay}',$order:0},CAPTION:{tagName:'a',href:"javascript:;",tabindex:'{tabindex}',text:'{caption}',$order:1}}},PANEL:{$order:1,tagName:'div',text:linb.UI.$childTag}},'all');this.setTemplate('default',t)},Static:{Dropable:['PANEL'],Appearances:{'default':{FIELDSET:{border:'1px solid #CCCCCC','background-color':'#fff',position:'relative'},PANEL:{position:'absolute',top:'0',left:'0',width:'100%',height:'100%',overflow:'auto'},LEGEND:{'margin-left':'3px'},CAPTION:{'font-family':'"Verdana", "Helvetica", "sans-serif"','font-size':'12px','line-height':'18px'},ICON:{width:'16px',height:'16px','vertical-align':'middle',margin:'0 4px 0 0'}}},EventHandlers:{beforeValueSet:null,afterValueSet:null,beforeValueUpdated:null,afterValueUpdated:null,beforeHoverEffect:null,beforeClickEffect:null,beforeNextFocus:null},DataModel:{width:100,height:100,tabindex:{action:function(value){if(this.domNode)this.getSubNode(this.keys.CAPTION).tabIndex(value)}},$border:1},Behaviors:{'default':{_focusHook:{CAPTION:1}}},resize:function(profile,w,h){var size=arguments.callee.upper.apply(this,arguments);var t,v=profile.getSubNode(profile.keys.FIELDSET),p=profile.getSubNode(profile.keys.PANEL);if(!_.isNull(w)){v.width(t=(size.width-2));p.width(t)}if(!_.isNull(h)){v.height(t=(size.height-2));p.top(20).height(t-20)}}}});Class("linb.UI.RadioBox",["linb.UI.Widget","linb.UI.iForm","linb.UI.iList"],{Instance:{setCtrlValue:function(value){return this.each(function(profile){var id=profile.domId,key=profile.keys.MARK,properties=profile.properties,itemId=profile.getSubSerialIdByItemId(value);if(properties.$UIvalue){var o=profile.getSubNode(key,true);if(itemId)profile.removeTagClass(o,key,'-checked')}var o=profile.getSubNode(key,itemId);if(itemId)profile.addTagClass(o,key,'-checked')})},setDirtyMark:function(){return this.each(function(profile){var id=profile.domId,key=profile.keys.CAPTION,properties=profile.properties,itemId=profile.getSubSerialIdByItemId(properties.$UIvalue),flag=properties.value!==properties.$UIvalue;if(profile.beforeDirtyMark&&false===profile.boxing().beforeDirtyMark(profile,flag)){}else{var o=profile.getSubNode(key,itemId);if(properties.$UIvalue){profile.getSubNode(key,true).removeClass(linb.UI.$css_tag_dirty)}if(properties.value!==properties.$UIvalue)o.addClass(linb.UI.$css_tag_dirty);else o.removeClass(linb.UI.$css_tag_dirty)}})},activate:function(){var profile=this.get(0),items=profile.getSubNode(profile.keys.ITEM,true);if(!items.isEmpty())items.focus();return this}},Initialize:function(){var t=this.getTemplate('default');_.merge(t.FRAME.BORDER,{ITEMS:{tagName:'DIV',text:"{items}"}},'all');t.$dynamic={items:{ITEM:{tagName:'a',href:"javascript:;",tabindex:'{_tabindex}',MARK:{tagName:'span',$order:0},ICON:{tagName:'span',style:'background:url({icon}) transparent  no-repeat {iconPos};{iconDisplay}',$order:1},CAPTION:{tagName:'span',text:'{caption}',className:"{disabled}",$order:2}}}};this.setTemplate('default',t)},Static:{Appearances:{'default':{ITEM:{'font-family':' "Verdana", "Helvetica", "sans-serif"',border:'0',margin:'2px',padding:'0 0 0 4px',cursor:'pointer','vertical-align':'middle',display:linb.browser.gek?['-moz-inline-block','-moz-inline-box']:'inline-block','vertical-align':'middle','font-size':'12px'},MARK:{cursor:'pointer',width:'16px',height:'16px',background:linb.UI.getCSSImgPara('cmds.gif',' no-repeat -144px top',null,'linb.UI.Public')},'MARK-mouseover':{$order:1,'background-position':' -144px -17px'},'MARK-mousedown':{$order:2,'background-position':' -144px -34px'},'MARK-checked':{$order:3,'background-position':' -128px top'},'MARK-checked-mouseover':{$order:4,'background-position':' -128px -17px'},'MARK-checked-mousedown':{$order:5,'background-position':' -128px -34px'},ICON:{cursor:'pointer',width:'16px',height:'16px',margin:'0 4px 0 0'},ITEMS:{overflow:'auto','line-height':'12px',background:'#fff'}}},Behaviors:{'default':{_hoverEffect:{ITEM:'MARK'},_clickEffect:{ITEM:'MARK'},ITEM:{onClick:function(profile,e,src){var properties=profile.properties,item=profile.getItemByDom(src),box=profile.boxing();if(properties.disabled)return false;box.updateUIValue(item.id);if(box.getUIValue()==item.id){box.onItemSelected(profile,item,src);linb(src).focus()}},onKeydown:function(profile,e,src){var keys=linb.event.getKey(e),key=keys[0],shift=keys[2],cur=linb([src],false),first=profile.root.nextFocus(true,true,false),last=profile.root.nextFocus(false,true,false);switch(linb.event.getKey(e)[0]){case'tab':if(shift){if(src!=first.get(0)){first.focus();return false}}else{if(src!=last.get(0)){last.focus();return false}}break;case'left':case'up':var next=cur.nextFocus(false,true,false);if(cur.get(0)==first.get(0))last.focus();else cur.nextFocus(false);return false;break;case'right':case'down':var next=cur.nextFocus(true,false,false);if(cur.get(0)==last.get(0))first.focus();else cur.nextFocus();return false;break;case'space':case'enter':linb(src).onClick();return false;break}}}}},DataModel:{icon:null,iconPos:null,caption:null,tabindex:{action:function(value){if(this.domNode)this.getSubNode(this.keys.ITEM,true).tabIndex(value)}},width:160,height:80},EventHandlers:{beforeDirtyMark:function(profile,flag){},onItemSelected:function(profile,item,src){}},resize:function(profile,w,h){var size=arguments.callee.upper.apply(this,arguments);profile.getSubNode(profile.keys.ITEMS).cssSize(size)}}});Class("linb.UI.List",["linb.UI.Widget","linb.UI.iForm","linb.UI.iList"],{Instance:{setCtrlValue:function(value){return this.each(function(profile){if(!profile.domNode)return;var key=profile.keys.ITEM,box=profile.boxing(),uiv=box.getUIValue(),properties=profile.properties;if(!properties.multiSel){var itemId=profile.getSubSerialIdByItemId(uiv);if(uiv&&itemId){profile.removeTagClass(profile.getSubNode(key,itemId),key,'-checked')}itemId=profile.getSubSerialIdByItemId(value);if(itemId){profile.addTagClass(profile.getSubNode(key,itemId),key,'-checked')}if(itemId){var o=profile.getSubNode(key,itemId);if(o){var top=o.offsetTop(),items=profile.getSubNode(profile.keys.ITEMS),sh=items.scrollHeight(),st=items.scrollTop(),hh=items.height();if(sh>hh){if(top<st||top>st+hh)items.scrollTop(top)}}}}else{uiv=uiv?uiv.split(';'):[];value=value?value.split(';'):[];uiv.each(function(o){if(!value.exists(o)){profile.removeTagClass(profile.getSubNode(key,profile.getSubSerialIdByItemId(o)),key,'-checked')}});value.each(function(o){if(!uiv.exists(o)){profile.addTagClass(profile.getSubNode(key,profile.getSubSerialIdByItemId(o)),key,'-checked')}})}})},setValue:function(value,flag){var upper=arguments.callee.upper;return this.each(function(profile){if(profile.properties.multiSel){var arr=value.split(';');arr.sort();value=arr.join(';')}upper.apply(profile.boxing(),[value,flag])})},adjustSize:function(){return this.each(function(profile){var root=profile.root,border=profile.getSubNode(profile.keys.BORDER),items=profile.getSubNode(profile.keys.ITEMS),pool=profile.getSubNode(profile.keys.POOL),size1=root.cssSize(),size2=border.cssSize();items.height('auto');var h=Math.min(profile.properties.maxHeight,items.offsetHeight()+size1.height-size2.height+2);profile.properties.height=h;root.height(h)})},activate:function(){return linb.UI.iList.prototype.activate.call(this)}},Initialize:function(){var t=this.getTemplate('default');_.merge(t.FRAME.BORDER,{tagName:'div',ITEMS:{tagName:'div',text:"{items}"}},'all');t.$dynamic={items:{ITEM:{tagName:'a',href:"javascript:;",tabindex:'{_tabindex}',ICON:{tagName:'span',style:'background:url({icon}) transparent  no-repeat {iconPos};{iconDisplay}',$order:0},CAPTION:{tagName:'text',text:'{caption}',$order:1}}}};this.setTemplate('default',t)},Static:{Appearances:{'default':{KEY:{'font-size':'12px'},BORDER:{border:'1px solid #91A7B4'},ITEMS:{'background-color':'#fff',position:'absolute',width:'100%',top:'0',left:'0',overflow:'auto','overflow-x':(linb.browser.ie||linb.browser.gek)?'hidden':''},ITEM:{display:'block','font-family':'"Verdana", "Helvetica", "sans-serif"',border:'0',cursor:'pointer',padding:'2px',position:'relative'},'ITEM-mouseover':{$order:1,'background-color':'#d9e8fb'},'ITEM-checked':{$order:2,'background-color':'#316AC5',color:'#fff'},ICON:{cursor:'pointer',width:'16px',height:'16px',margin:'0 4px 0 0'}}},Behaviors:{'default':{_hoverEffect:{ITEM:'ITEM'},ITEM:{onClick:function(profile,e,src){var properties=profile.properties,item=profile.getItemByDom(src),box=profile.boxing();if(properties.disabled||item.disabled)return false;if(properties.multiSel){var value=box.getUIValue();var arr=value?value.split(';'):[];if(arr.exists(item.id))arr.removeValue(item.id);else arr.push(item.id);arr.sort();value=arr.join(';');box.updateUIValue(value);if(box.getUIValue()==value)box.onItemSelected(profile,item,src)}else{box.updateUIValue(item.id);if(box.getUIValue()==item.id)box.onItemSelected(profile,item,src)}linb(src).focus();return false},onKeydown:function(profile,e,src){var keys=linb.event.getKey(e),key=keys[0],shift=keys[2],cur=linb([src],false),first=profile.root.nextFocus(true,true,false),last=profile.root.nextFocus(false,true,false);switch(linb.event.getKey(e)[0]){case'tab':if(shift){if(src!=first.get(0)){first.focus();return false}}else{if(src!=last.get(0)){last.focus();return false}}break;case'left':case'up':var next=cur.nextFocus(false,true,false);if(cur.get(0)==first.get(0))last.focus();else cur.nextFocus(false);return false;break;case'right':case'down':var next=cur.nextFocus(true,false,false);if(cur.get(0)==last.get(0))first.focus();else cur.nextFocus();return false;break;case'space':case'enter':linb(src.id).onClick();return false;break}}},ITEMS:{beforeKeypress:function(profile,e){var key=linb.event.getKey(e)[0];if(key=='tab'||key=='enter')return true;else if(/^\w$/.test(key)){profile._wordcache=profile._wordcache||'';profile._wordcache+=key.toLowerCase();clearTimeout(profile._wordcachetimeout);var arr=profile.properties.items;arr.each(function(o,i){if(o.caption.toLowerCase().startWith(profile._wordcache)){profile.getSubNode(profile.keys.ITEM,profile.getSubSerialIdByItemId(o.id)).focus();return false}});profile._wordcachetimeout=_.asyRun(function(){profile._wordcache=''},300)}}}}},DataModel:({icon:null,iconPos:null,caption:null,tabindex:{action:function(value){if(this.domNode)this.getSubNode(this.keys.ITEM,true).tabIndex(value)}},multiSel:false,width:120,height:150,maxHeight:500,$border:1}),EventHandlers:{onItemSelected:function(profile,item,src){}},resize:function(profile,w,h){var size=arguments.callee.upper.apply(this,arguments);profile.getSubNode(profile.keys.ITEMS).cssSize(size)}}});Class("linb.UI.Gallery",["linb.UI.List"],{Initialize:function(){var t=this.getTemplate('default');t.$dynamic={items:{ITEM:{tagName:'a',href:"javascript:;",tabindex:'{_tabindex}',style:'padding:{itemPadding}px;',ITEMFRAME:{tagName:'span',style:'width:{itemWidth}px;height:{itemHeight}px;',CAPTION:{tagName:'div',text:'{caption}',$order:0},CONTENT:{tagName:'div',$order:1,ICON:{tagName:'span',style:'background:url({icon}) transparent  no-repeat {iconPos};width:{iconWidth}px;height:{iconHeight}px;'}},COMMENT:{tagName:'div',text:'{comment}',$order:2}}}}};this.setTemplate('default',t)},Static:{Appearances:{'default':{ITEMS:{position:'absolute',top:'0',left:'0',overflow:'auto','overflow-x':(linb.browser.ie||linb.browser.gek)?'hidden':''},ITEM:{display:linb.browser.gek?['-moz-inline-block','-moz-inline-box']:'inline-block',position:'relative',overflow:'hidden','vertical-align':'top',border:'0',padding:'0',margin:'0'},ITEMFRAME:{display:linb.browser.ie?'inline-block':'block',position:'relative',overflow:'hidden',border:'0',padding:'0',margin:'0',width:'100%',height:'100%','-moz-box-flex':'1',border:'1px solid #A7A6AA'},'ITEM-mouseover ITEMFRAME':{$order:1,border:'1px solid blue'},'ITEM-checked ITEMFRAME':{$order:2,border:'1px solid blue','background-color':'#316AC5',color:'#fff'},CONTENT:{'text-align':'center'},CAPTION:{'font-weight':'bold','text-align':'center'},ICON:{'vertical-align':'middle'}}},DataModel:({itemPadding:{ini:6,action:function(v){if(typeof v!='object')this.getSubNode(this.keys.ITEM,true).setPxStyle('padding',v);else this.getSubNode(this.keys.ITEM,true).setStyle(v)}},itemWidth:{ini:32,action:function(v){this.getSubNode(this.keys.ITEMFRAME,true).width(v)}},itemHeight:{ini:32,action:function(v){this.getSubNode(this.keys.ITEMFRAME,true).height(v)}},iconWidth:{ini:16,action:function(v){this.getSubNode(this.keys.ICON,true).width(v)}},iconHeight:{ini:16,action:function(v){this.getSubNode(this.keys.ICON,true).height(v)}},tabindex:{action:function(value){if(this.domNode)this.getSubNode(this.keys.ITEM,true).tabIndex(value)}},width:200,height:200}),prepareItem:function(profile,item){var p=profile.properties;item.itemWidth=item.itemWidth||p.itemWidth;item.itemHeight=item.itemHeight||p.itemHeight;item.iconWidth=item.iconWidth||p.iconWidth;item.iconHeight=item.iconHeight||p.iconHeight;item.itemPadding=item.itemPadding||p.itemPadding;item.capition=item.capition||'';item.comment=item.comment||'';item._tabindex=p.tabindex}}});Class("linb.UI.PanelBar",["linb.UI.Div","linb.UI.iContainer"],{Instance:{removePanel:function(){this.destroy()},getPanelPara:function(){return this.get(0).properties},getPanelChildren:function(){return this.get(0).children}},Static:{cssNone:false,Dropable:['PANEL'],Dragable:['HANDLE'],Templates:{'default':{tagName:'div',style:'{left}{top}{width}{height}{right}{bottom}{zIndex}{position}',BORDER:{tagName:'div',HANDLE:{tagName:'a',href:"javascript:;",tabindex:'{tabindex}',style:'{handleDisplay};height:{handleHeight}px',ICON:{tagName:'span',style:'background:url({icon}) transparent  no-repeat {iconPos}; {iconDisplay}',$order:0},CAPTION:{tagName:'span',text:'{caption}',className:"{disabled}",$order:1},CMDS:{LAND:{tagName:'span',style:'{landDisplay}',$order:1},CLOSE:{tagName:'span',style:'{closeDisplay}',$order:2}}},PANEL:{$order:1,tagName:'div',text:'{html}'+linb.UI.$childTag}}}},Appearances:{'default':{PANEL:{position:'absolute',left:'0',top:'0',overflow:'auto','background-color':'#fff'},HANDLE:{display:'block',cursor:'pointer','white-space':'nowrap',background:linb.UI.getCSSImgPara('barvbg.gif',' repeat-x left top',null,'linb.UI.Public'),height:'22px','padding-left':'3px',left:'0'},'HANDLE-mouseover':{$order:1,'background-position':'right -22px'},ICON:{width:'16px',height:'16px',margin:'2px'},CMDS:{position:'absolute',top:'0',right:'0','text-align':'right','vertical-align':'middle',height:'100%',cursor:'default'},'CLOSE, LAND':{position:'relative',margin:'5px 4px 2px 0',width:'15px',height:'15px','vertical-align':'middle',cursor:'default'},CLOSE:{background:linb.UI.getCSSImgPara('cmds.gif',' no-repeat -64px 0',null,'linb.UI.Public')},'CLOSE-mouseover':{$order:1,'background-position':'-64px -16px'},'CLOSE-mousedown':{$order:2,'background-position':'-64px -32px'},LAND:{background:linb.UI.getCSSImgPara('cmds.gif',' no-repeat -220px 0',null,'linb.UI.Public')},'LAND-mouseover':{$order:1,'background-position':'-220px -16px'},'LAND-mousedown':{$order:2,'background-position':'-220px -32px'},CAPTION:{margin:'2px','font-size':'12px'}}},Behaviors:{'default':{_hoverEffect:{HANDLE:'HANDLE',CLOSE:'CLOSE',LAND:'LAND'},_clickEffect:{CLOSE:'CLOSE',LAND:'LAND'},onResize:function(profile,e,src){var o=profile.root,w=null,h=null;if(e.height)h=o.height();if(e.width)w=o.width();profile.box.resize(profile,w,h)},CLOSE:{onClick:function(profile,e,src){var properties=profile.properties;if(properties.disabled)return;var instance=profile.boxing();if(false===instance.beforeClose(profile,src))return;instance.destroy();return false}},LAND:{onClick:function(profile,e,src){var properties=profile.properties;if(properties.disabled)return;var pos=profile.root.absPos(),size=profile.root.cssSize();var pro=linb.UI.Dialog.getDefaultProp();_.merge(pro,properties,'with');_.merge(pro,{dock:'none',width:size.width,height:size.height,left:pos.left,top:pos.top},'all');var dialog=new linb.UI.Dialog(pro);linb(document.body).attach(dialog);profile.children.each(function(o){dialog.attach(o[0])});profile.boxing().destroy();return false}}}},EventHandlers:{beforeClose:function(profile,src){}},DataModel:{position:'absolute',zIndex:0,dock:'fill',tabindex:{action:function(value){if(this.domNode)this.getSubNode(this.keys.HANDLE).tabIndex(value)}},dragKey:'',html:{ini:'',action:function(v){this.getSubNode(this.keys.PANEL).html(v)}},titleHeight:{ini:22,action:function(v){this.getSubNode(this.keys.HANDLE).display(v?'':'none')}},caption:linb.UI.Widget.getDataModel('caption'),icon:linb.UI.Widget.getDataModel('icon'),iconPos:linb.UI.Widget.getDataModel('iconPos'),closeBtn:{ini:true,action:function(v){this.getSubNode(this.keys.CLOSE).display(v?'':'none')}},landBtn:{ini:true,action:function(v){this.getSubNode(this.keys.LAND).display(v?'':'none')}}},prepareData:function(profile){arguments.callee.upper.call(this,profile);var data=profile.data;data.closeDisplay=data.closeBtn?'':'display:none';data.landDisplay=data.landBtn?'':'display:none';data.handleDisplay=data.titleHeight?'':'display:none';data.handleHeight=data.titleHeight},resize:function(profile,w,h){profile.getSubNode(profile.keys.BORDER).cssSize({width:w?w:null,height:h?h:null});var off=profile.properties.titleHeight;profile.getSubNode(profile.keys.PANEL).setRegion({top:off,width:w?w:null,height:h?(h-off):null},true)}}});Class("linb.UI.Block",["linb.UI.Widget","linb.UI.iContainer"],{Initialize:function(){var t=this.getTemplate('default');_.merge(t.FRAME.BORDER,{PANEL:{tagName:'div',text:'{html}'+linb.UI.$childTag}},'all');this.setTemplate('default',t);t=this.getAppearance('default')||{};_.merge(t,{PANEL:{position:'absolute',left:'0',top:'0',overflow:'auto','background-color':'#fff'}});this.setAppearance('default',t)},Static:{Dropable:['PANEL'],DataModel:{dataBinder:null,dataField:null,value:null,disabled:null,caption:null,icon:null,iconPos:null,tips:null,html:{ini:'',action:function(v){this.getSubNode(this.keys.PANEL).html(v)}},width:100,height:100},EventHandlers:{beforeValueSet:null,afterValueSet:null,beforeValueUpdated:null,afterValueUpdated:null,beforeHoverEffect:null,beforeClickEffect:null,beforeNextFocus:null},resize:function(profile,w,h){var size=arguments.callee.upper.apply(this,arguments);profile.getSubNode(profile.keys.PANEL).cssSize(size,true)}}});Class("linb.UI.PopMenu",["linb.UI.Widget","linb.UI.iList","linb.UI.iNavigator"],{Instance:{activate:function(){return linb.UI.iList.prototype.activate.call(this)},adjustSize:function(){return this.each(function(profile){var root=profile.root,items=profile.getSubNode(profile.keys.ITEMS),border=profile.getSubNode(profile.keys.BORDER),size1=root.cssSize(),size2=border.cssSize(),h=Math.min(profile.properties.maxHeight,items.height()+size1.height-size2.height+2),w=Math.min(profile.properties.maxWidth,items.width()+size1.width-size2.width+2);profile.properties.width=w;profile.properties.height=h;root.cssSize({width:w,height:h},true);profile.boxing().setScrollButtons()})},setScrollButtons:function(){return this.each(function(profile){var o=profile.getSubNode(profile.keys.ITEMS),t=o.offsetTop(),h=o.offsetHeight(),b=profile.getSubNode(profile.keys.BORDER),hh=b.offsetHeight();if(t===0)profile.getSubNode(profile.keys.TOP).display('none');else profile.getSubNode(profile.keys.TOP).display('block');if(hh>h+t)profile.getSubNode(profile.keys.BOTTOM).display('none');else profile.getSubNode(profile.keys.BOTTOM).display('block')})},scrollToBottom:function(){return this.each(function(profile){var o=profile.getSubNode(profile.keys.ITEMS),border=profile.getSubNode(profile.keys.BORDER),y=o.offsetTop(),offset,h=o.offsetHeight(),b=false,bh=border.height();if(bh<h+y){if(!profile.$scrollStep)profile.$scrollStep=1;if(profile.$scrollStep<10)profile.$scrollStep=profile.$scrollStep*1.03;y-=profile.$scrollStep;if(bh>h+y){y=bh-h;b=true}o.top(y);if(b){profile.getSubNode(profile.keys.BOTTOM).display('none');profile.$scrollTobottom=false;profile.$scrollStep=null}else{profile.getSubNode(profile.keys.TOP).display('block');if(profile.$scrollTobottom)_.asyRun(arguments.callee,0,[profile],this)}}})},scrollToTop:function(){return this.each(function(profile){var o=profile.getSubNode(profile.keys.ITEMS),y=o.offsetTop(),b=false;if(y<0){if(!profile.$scrollStep)profile.$scrollStep=1;if(profile.$scrollStep<10)profile.$scrollStep=profile.$scrollStep*1.03;y+=profile.$scrollStep;if(y>=-1){y=0;b=true}o.top(y);if(b){profile.getSubNode(profile.keys.TOP).display('none');profile.$scrollToTop=false;profile.$scrollStep=null}else{profile.getSubNode(profile.keys.BOTTOM).display('block');if(profile.$scrollToTop)_.asyRun(arguments.callee,0,[profile],this)}}})},pop:function(obj,parent,type){var profile=this.get(0);if(!profile.created)profile.boxing().create();if(profile.$highLight)profile.removeTagClass(linb([profile.$highLight],false),profile.keys.ITEM,'-mouseover');profile.root.popToTop(obj,parent,type);var f=function(){arguments.callee.profile.boxing().hide();arguments.callee.profile.$groupPopMenu.length=0};f.profile=profile;if(!profile.$groupPopMenu||!profile.$groupPopMenu.length){profile.$groupPopMenu=[profile.root.get(0)];profile.root.setBlurTrigger(profile.$id,null);profile.root.setBlurTrigger(profile.$id,f,profile.$groupPopMenu)}},hide:function(flag){var t,profile=this.get(0);profile.root.setBlurTrigger(profile.$id,null);if(profile.$hideMenuPool)profile.$hideMenuPool.addLast(profile.root);else profile.root.display('none');var p=profile.$childPopMenu,q;while(p){p.boxing().hide();p=(q=p).$childPopMenu;q.$childPopMenu=q.$subPopMenuShowed=null}profile.$childPopMenu=profile.$subPopMenuShowed=null;if(t=profile.$parentPopMenu)t.$subPopMenuShowed=null;profile.$groupPopMenu.removeValue(profile.root.get(0));if(false!==flag)profile.boxing().onHide(profile)}},Initialize:function(){var t=this.getTemplate('default');_.merge(t.FRAME.BORDER,{TOP:{tagName:'span'},BOTTOM:{tagName:'span'},BOX:{tagName:'div',ITEMS:{tagName:'div',text:"{items}"}},POOL:{tagName:'div',style:'display:none;'}},'all');t.$dynamic={'items':function(profile,template,v,tag,result){tag=tag+'.'+v.type;if(template[tag])linb.UI.$doTemplate(profile,template,v,tag,result)},'items.split':{ITEMSPLIT:{tagName:'div',ITEMIN:{style:"width:2px;height:2px;font-size:0;line-height:0;"}}},'items.button':{ITEM:{tagName:'a',href:"javascript:;",tabindex:'0',className:'{cls}',ICON:{tagName:'span',style:'background:url({icon}) transparent  no-repeat {iconPos};',$order:0},CAPTION:{tagName:'span',text:'{caption}',$order:1},RULER:{tagName:'span',style:'{displayAdd}',$order:2},ADD:{tagName:'div',style:'{displayAdd}',text:'{add}',$order:2},SUB:{style:'{tagClass}'}}}};this.setTemplate('default',t)},Static:{hasDomRoot:false,Appearances:{'default':{KEY:{'font-size':'12px',visibility:'hidden'},BORDER:{border:'1px solid','border-color':'#fff #cdcdcd #cdcdcd #fff'},BOX:{'background-color':'#F9F8F7',overflow:'hidden',position:'absolute',left:'0',top:'0','z-index':'3'},ITEMS:{position:'absolute',top:'0',left:'0',overflow:'visible',background:linb.UI.getCSSImgPara('bg.gif',' repeat-y left top')},ITEM:{display:'block',position:'relative',overflow:'visible','white-space':'nowrap',color:'#000','font-family':'"Verdana", "Helvetica", "sans-serif"',cursor:'pointer',padding:'2px 20px 2px 2px'},ITEMSPLIT:{display:'block',position:'relative',overflow:'hidden','font-size':'0','line-height':'0',margin:'2px 2px 2px 26px',background:linb.UI.getCSSImgPara('hsplit.gif',' repeat-x left top',null,'linb.UI.Public')},'ITEM-mouseover':{$order:1,'background-color':'#B6BDD2'},'ITEM-checked':{$order:2,'background-color':'#B6BDD2'},TOP:{cursor:'pointer',display:'none',position:'absolute','margin-left':'-8px',right:'0',height:'16px',width:'16px','z-index':'10',top:'0',background:linb.UI.getCSSImgPara('icon.gif',' no-repeat -33px 0',null,'linb.UI.Public')},BOTTOM:{cursor:'pointer',display:'none',position:'absolute','margin-left':'-8px',right:'0',height:'16px',width:'16px','z-index':'10',bottom:'0',background:linb.UI.getCSSImgPara('icon.gif',' no-repeat -33px -17px',null,'linb.UI.Public')},ICON:{cursor:'pointer',width:'16px',height:'16px',margin:'0 4px 0 0'},CAPTION:{'vertical-align':'bottom','padding-left':'2px'},RULER:{width:'100px','font-size':'0','line-height':'0'},ADD:{'font-family':'"Verdana", "Helvetica", "sans-serif"','font-size':'11px',position:'absolute',top:'2px',right:'0',width:'80px',padding:'2px 20px 2px 2px','text-align':'right','z-index':'10'},SUB:{position:'absolute',top:'4px',right:'0',width:'8px',height:'16px',background:linb.UI.getCSSImgPara('icon.gif',' no-repeat left -16px',null,'linb.UI.Public')}}},Behaviors:{'default':{ITEM:{onMouseover:function(profile,e,src){if(profile.$highLight==src)return;var properties=profile.properties,item=profile.getItemByDom(src),itemId=item.id;var Cancel=false;if(profile.$subPopMenuShowed){if(profile.$subPopMenuShowed==profile.$allRelatedPopMenus[itemId])Cancel=true;else{profile.$subPopMenuShowed.hide();profile.$subPopMenuShowed=null}}if(!Cancel){if(profile.$highLight)profile.removeTagClass(linb([profile.$highLight],false),profile.keys.ITEM,'-mouseover');profile.$highLight=src;profile.addTagClass(linb([profile.$highLight],false),profile.keys.ITEM,'-mouseover');src.focus()}if(!Cancel&&item.sub){var pop;profile.$allRelatedPopMenus=profile.$allRelatedPopMenus||{};if(!(pop=profile.$allRelatedPopMenus[itemId])){pop=linb.create('PopMenu',{position:'absolute',items:item.sub});pop.onMenuSelected(function(pro,id,src){profile.boxing().onMenuSelected(profile,id,src)});pop.get(0).$hideMenuPool=profile.$hideMenuPool||profile.getSubNode(profile.keys.POOL);profile.$allRelatedPopMenus[itemId]=pop;profile.$showpops=profile.$showpops||[profile];pop.get(0).$showpops=profile.$showpops;profile.$showpops.push(pop.get(0))}profile.$groupPopMenu.push(pop.get(0).root.get(0));pop.get(0).$groupPopMenu=profile.$groupPopMenu;pop.get(0).$parentPopMenu=profile;profile.$childPopMenu=pop.get(0);pop.pop(src,null,2);profile.$subPopMenuShowed=pop}},onMouseout:function(profile,e,src){var properties=profile.properties,item=profile.getItemByDom(src),itemId=item.id;var action=true;if(profile.$subPopMenuShowed){var node=e.toElement||e.relatedTarget;var target=profile.$subPopMenuShowed.get(0).root.get(0);try{do{if(node==target)return}while((node&&(node=node.parentNode)))}catch(a){}}else{profile.removeTagClass(linb([src],false),profile.keys.ITEM,'-mouseover');profile.$highLight=null;if(profile.$subPopMenuShowed){profile.$subPopMenuShowed.hide();profile.$subPopMenuShowed=null}}},onClick:function(profile,e,src){var properties=profile.properties,item=profile.getItemByDom(src),itemId=item.id;if(item.sub){}else{profile.boxing().onMenuSelected(profile,item.id,src);profile.removeTagClass(linb(this),profile.keys.ITEM,'-mouseover');var p=profile,q;while(p){p.boxing().hide();p=(q=p).$parentPopMenu;q.$parentPopMenu=q.$subPopMenuShowed=null}profile.$subPopMenuShowed=null;profile.$groupPopMenu.length=0}return false},onFocus:function(profile,e,src){var box=profile.getSubNode(profile.keys.BOX),top=box.scrollTop(),h=box.scrollHeight(),n=linb(src).offsetTop();if(n<top||n>top+h)linb(src).offsetTop(top);linb(src).onMouseover()},onKeydown:function(profile,e,src){var item=profile.getItemByDom(src),items=profile.properties.items,itemId=item.id,flag,r,tid,node;var t,key=linb.event.getKey(e)[0];switch(key){case'up':r=true;flag=false;items.each(function(o,i){if(o.type=='split')return;if(flag){tid=o.id;return r=false}if(o.id==itemId)flag=true},null,true);if(r)tid=items[items.length-1].id;node=profile.getSubNode(profile.keys.ITEM,profile.getSubSerialIdByItemId(tid)).get(0);if(node)node.focus();break;case'down':r=true;flag=false;items.each(function(o,i){if(o.type=='split')return;if(flag){tid=o.id;return r=false}if(o.id==itemId)flag=true});if(r)tid=items[0].id;node=profile.getSubNode(profile.keys.ITEM,profile.getSubSerialIdByItemId(tid)).get(0);if(node)node.focus();break;case'left':if(t=profile.$parentPopMenu){if(t=profile.$parentPopMenu.$highLight)node=t}if(node)node.focus();break;case'right':if((t=profile.$subPopMenuShowed)&&t==profile.$allRelatedPopMenus[itemId])t.activate();break}}},TOP:{onMouseover:function(profile,e,src){profile.$scrollToTop=true;profile.boxing().scrollToTop()},onMouseout:function(profile,e,src){profile.$scrollToTop=false;profile.$scrollStep=null},onClick:function(profile,e,src){profile.$scrollStep=1000}},BOTTOM:{onMouseover:function(profile,e,src){profile.$scrollTobottom=true;profile.boxing().scrollToBottom()},onMouseout:function(profile,e,src){profile.$scrollTobottom=false;profile.$scrollStep=null},onClick:function(profile,e,src){profile.$scrollStep=1000}},ITEMS:{beforeKeydown:function(profile,e){var key=linb.event.getKey(e)[0];if(key=='tab'||key=='enter')return true;else if(/^\w$/.test(key)){profile._wordcache=profile._wordcache||'';profile._wordcache+=key;clearTimeout(profile._wordcachetimeout);var arr=profile.properties.items;arr.each(function(o,i){if(o.caption.toLowerCase().startWith(profile._wordcache)){profile.getSubNode(profile.keys.ITEM,profile.getSubSerialIdByItemId(o.id)).focus();return false}});profile._wordcachetimeout=_.asyRun(function(){profile._wordcache=''},300)}else if(key=='esc'){profile.boxing().onCancelled(profile);do{profile.boxing().hide()}while(profile=profile.$parentPopMenu)return false}else return false}}}},DataModel:({dataField:null,dataBinder:null,dock:null,tabindex:null,tips:null,zIndex:null,icon:null,iconPos:null,caption:null,border:null,shadow:true,resizable:false,maxHeight:500,maxWidth:300,height:100,left:-10000,width:300,position:'absolute',$border:1}),EventHandlers:{beforeNextFocus:null,onCancelled:function(profile){},onMenuSelected:function(profile,id,src){},onHide:function(profile){}},createdTrigger:function(){this.boxing().adjustSize()},prepareItem:function(profile,item){item.add=item.add||'';item.displayAdd=item.add?'':'display:none';item.tagClass=item.sub?'':'display:none';item.type=item.type||'button'},resize:function(profile,w,h){var size=arguments.callee.upper.apply(this,arguments);profile.getSubNode(profile.keys.BOX).cssSize(size)}}});Class("linb.UI.MenuBar",["linb.UI.iList","linb.UI.iNavigator"],{Instance:{pop:function(id,src,flag){var menu,profile=this.get(0);if(profile.$currentmenu)this.hide();profile.addTagClass(linb([src],false),profile.keys.ITEM,'-mousedown');profile.$allRelatedPopMenus=profile.$allRelatedPopMenus||{};if(flag||!(menu=profile.$allRelatedPopMenus[id])){var sub=profile.getItemByItemId(id).sub;sub=sub||[];menu=linb.create('PopMenu',{position:'absolute',items:sub});profile.getSubNode(profile.keys.POOL).attach(menu);var self=this;menu.onHide(function(pro){self.hide(false);self.get(0).properties.$menuPop=null}).onMenuSelected(function(pro,id,src){profile.boxing().onMenuSelected(profile,id,src)});menu.get(0).$hideMenuPool=profile.getSubNode(profile.keys.POOL);menu.get(0).$allRelatedPopMenus=profile.$allRelatedPopMenus;if(!flag)profile.$allRelatedPopMenus[id]=menu}var target=linb([src],false);menu.pop(target);profile.$currentmenu=id;profile.$currentNode=src},hide:function(flag){var profile=this.get(0),menu,id=profile.$currentmenu,node=profile.$currentNode;if(menu=profile.$allRelatedPopMenus[id]){if(false!==flag)menu.hide(false);menu.reBoxing().addToLast(profile.getSubNode(profile.keys.POOL));menu=profile.$currentmenu=profile.$currentNode=null;profile.removeTagClass(linb([node],false),profile.keys.ITEM,'-mousedown')}},reset:function(){var profile=this.get(0);profile.getSubNode(profile.keys.POOL).empty();profile.$allRelatedPopMenus=profile.$currentmenu=profile.$currentNode=null}},Initialize:function(){linb.SC('linb.UI.PopMenu')},Static:{cssNone:false,Templates:{'default':{tagName:'div',POOL:{tagName:'div',style:'display:none;'},BORDER:{tagName:'div',LIST:{tagName:'div',HANDLER:{style:'{handler}'},ITEMS:{$order:1,text:"{items}"}}},$dynamic:{items:{ITEM:{tagName:'a',href:"javascript:;",tabindex:'{_tabindex}',className:' {typeCls} ',ICON:{$order:1,tagName:'span',style:'background:url({icon}) transparent no-repeat  {iconPos}; {iconDisplay}'},CAPTION:{$order:2,tagName:'span',text:'{caption}',style:'{captionDisplay}'}}}}}},Appearances:{'default':{KEY:{'font-size':'0','line-height':'0',position:'absolute',left:'0',top:'0'},BORDER:{left:'0',top:'0',border:'solid 1px','background-color':'#f4f4f4','border-color':'#fff #A7A6AA #A7A6AA #fff','font-size':'0','line-height':'0'},HANDLER:{height:'22px',width:'6px',background:linb.UI.getCSSImgPara('handler.gif',' left top #f4f4f4 ',null,'linb.UI.Public'),cursor:'move'},LIST:{'padding':'1px 4px 1px 2px'},'LIST-disabled':{'background-color':'#E4E4E4'},ITEM:{display:linb.browser.gek?['-moz-inline-block','-moz-inline-box']:'inline-block','vertical-align':'middle',padding:'1px 4px 1px 4px',border:'solid 1px #f4f4f4'},'ITEM-mouseover':{$order:2,'border-color':'#fff #cdcdcd #cdcdcd #fff'},'ITEM-mousedown':{$order:2,'border-color':'#cdcdcd #fff #fff #cdcdcd','background-color':'#fff'},ICON:{width:'16px',height:'16px','margin-right':'1px','vertical-align':'middle'},CAPTION:{height:'16px','margin-left':'1px','font-size':'12px','line-height':'12px','vertical-align':'middle'}}},Behaviors:{'default':{onMousedown:function(profile,e,src){},ITEM:{onMouseover:function(profile,e,src){var p=profile.properties;if(p.disabled)return;var item=profile.getItemByDom(src),itemId=item.id;if(p.$menuPop){if(p.$menuPop!=itemId){profile.addTagClass(linb([this],false),profile.keys.ITEM,'-mousedown');profile.boxing().pop(itemId,this);p.$menuPop=itemId}}else{profile.addTagClass(linb([this],false),profile.keys.ITEM,'-mouseover')}},onMouseout:function(profile,e,src){var p=profile.properties;if(p.disabled)return;profile.removeTagClass(linb([this],false),profile.keys.ITEM,'-mouseover')},onMousedown:function(profile,e,src){var p=profile.properties;if(p.disabled)return;var item=profile.getItemByDom(src),itemId=item.id;if(p.$menuPop){if(false===_.tryF(profile.onPopMenu,[itemId],profile))return;p.$menuPop=null;profile.boxing().hide(itemId)}else{if(false===_.tryF(profile.onHideMenu,[itemId],profile))return;p.$menuPop=itemId;profile.boxing().pop(itemId,this);return false}},onKeydown:function(profile,e,src){var keys=linb.event.getKey(e),key=keys[0],shift=keys[2],cur=linb([src],false),first=profile.root.nextFocus(true,true,false),last=profile.root.nextFocus(false,true,false);switch(linb.event.getKey(e)[0]){case'tab':if(shift){if(src!=first.get(0)){first.focus();return false}}else{if(src!=last.get(0)){last.focus();return false}}break;case'left':case'up':var next=cur.nextFocus(false,true,false);if(cur.get(0)==first.get(0))last.focus();else cur.nextFocus(false);return false;break;case'right':case'down':var next=cur.nextFocus(true,false,false);if(cur.get(0)==last.get(0))first.focus();else cur.nextFocus();return false;break;case'space':case'enter':linb(src).onMousedown();return false;break}},onClick:function(){return false}}}},DataModel:{value:null,dataField:null,dataBinder:null,zIndex:null,listKey:null,height:null,tabindex:{action:function(value){if(this.domNode)this.getSubNode(this.keys.ITEM,true).tabIndex(value)}},$menuPop:null,$border:1,left:0,top:0,handler:{ini:true,action:function(v){this.getSubNode(this.keys.HANDLER).display(v?'':'none')}},position:'absolute',dock:{ini:'top',listbox:['top','bottom']}},EventHandlers:{beforeValueUpdated:null,afterValueUpdated:null,beforeValueSet:null,afterValueSet:null,onMenuSelected:function(profile,id,src){}},createdTrigger:function(){if(this.properties.disabled)this.boxing().setDisabled(true,true)},prepareData:function(profile){arguments.callee.upper.call(this,profile);profile.data.handler=profile.data.handler?'':'display:none'}}});Class("linb.UI.ToolBar",["linb.UI.iList","linb.UI.iNavigator"],{Instance:{updateItem:function(id,txt){var pro=this.get(0),id=pro.getSubSerialIdByItemId(id);pro.getSubNode(pro.keys.CAPTION,id).html(txt,false)},hideItem:function(id){var pro=this.get(0),id=pro.getSubSerialIdByItemId(id);pro.getSubNode(pro.keys.ITEM,id).display('none')},disableGroup:function(id,value){return this.each(function(profile){profile.getSubNode(profile.keys.GROUP,profile.getSubSerialIdByItemId(id)).opacity(value?0.5:1);var item=profile.boxing().getItemByItemId(id);item.disabled=value})}},Static:{cssNone:false,Templates:{'default':{tagName:'div',ITEMS:{tagName:'div',style:'{mode}',text:'{items}'},$dynamic:{items:{GROUP:{HANDLER:{style:'{mode2}'},LIST:{$order:1,tagName:'text',text:'{sub}'}}},'items.sub':function(profile,template,v,tag,result){tag=tag+'.'+v.type;if(template[tag])linb.UI.$doTemplate(profile,template,v,tag,result)},'items.sub.split':{ITEMSPLIT:{}},'items.sub.button':{ITEM:{$order:1,tagName:'a',href:"javascript:;",tabindex:'{_tabindex}',className:' {typeCls} ',ICON:{$order:1,tagName:'span',style:'background:url({icon}) transparent no-repeat  {iconPos}; {iconDisplay}'},CAPTION:{$order:2,tagName:'span',text:'{caption}',className:" {disabled}",style:'{captionDisplay}'}}}}}},Appearances:{'default':{KEY:{'font-size':'0','line-height':'0',position:'absolute',left:'0',top:'0'},ITEMS:{display:'block',border:'solid 1px','background-color':'#f4f4f4','border-color':'#fff #A7A6AA #A7A6AA #fff','font-size':'0','line-height':'0'},HANDLER:{height:'22px',width:'6px',background:linb.UI.getCSSImgPara('handler.gif',' left top #f4f4f4 ',null,'linb.UI.Public'),cursor:'move'},GROUP:{'font-size':'0','line-height':'0','padding':'1px 4px 1px 2px'},ITEM:{display:linb.browser.gek?['-moz-inline-block','-moz-inline-box']:'inline-block','vertical-align':'top',margin:'1px',padding:'1px'},ICON:{width:'16px',height:'16px','margin-right':'1px'},'ITEM-BUTTON':{$order:1,border:'solid 1px #f4f4f4'},'ITEM-BUTTON-mouseover':{$order:2,border:'solid 1px #A7A6AA'},'ITEM-BUTTON-mousedown':{$order:2,border:'solid 1px #A7A6AA','background-color':'#FFFFE0'},'ITEMSPLIT':{$order:1,width:'6px',height:'16px',background:linb.UI.getCSSImgPara('vsplit.gif',' repeat-y left top',null,'linb.UI.Public')},CAPTION:{height:'16px','margin-left':'1px','margin-right':'3px','font-size':'12px','line-height':'12px'}}},Behaviors:{'default':{_hoverEffect:{ITEM:['ITEM']},_clickEffect:{ITEM:['ITEM']},onMousedown:function(profile,e,src){},ITEM:{onClick:function(profile,e,src){if(profile.properties.disabled)return;var id2=src.parentNode.id,itemId2=profile.getSubSerialId(id2),item2=profile.getItemBySubSerialId(itemId2);if(item2.disabled)return;var id=src.id,itemId=profile.getSubSerialId(id),item=profile.getItemBySubSerialId(itemId);if(item.disabled)return;linb(src).focus();profile.boxing().onClick(profile,item.id,item2.id,src);return false},onKeydown:function(profile,e,src){var keys=linb.event.getKey(e),key=keys[0],shift=keys[2],cur=linb([src],false),first=profile.root.nextFocus(true,true,false),last=profile.root.nextFocus(false,true,false);switch(linb.event.getKey(e)[0]){case'tab':if(shift){if(src!=first.get(0)){first.focus();return false}}else{if(src!=last.get(0)){last.focus();return false}}break;case'left':case'up':var next=cur.nextFocus(false,true,false);if(cur.get(0)==first.get(0))last.focus();else cur.nextFocus(false);return false;break;case'right':case'down':var next=cur.nextFocus(true,false,false);if(cur.get(0)==last.get(0))first.focus();else cur.nextFocus();return false;break;case'space':case'enter':linb(src).onClick();return false;break}}}}},DataModel:{value:null,dataField:null,dataBinder:null,zIndex:null,listKey:null,tabindex:{action:function(value){if(this.domNode)this.getSubNode(this.keys.ITEM,false).tabIndex(value)}},height:null,left:0,top:0,handler:{ini:true,action:function(v){this.getSubNode(this.keys.HANDLER,true).display(v?'':'none')}},position:'absolute',align:{ini:'left',listbox:['left','right'],action:function(v){this.getSubNode(this.keys.ITEMS,true).setStyle('textAlign',v)}},dock:{ini:'top',listbox:['top','bottom']}},EventHandlers:{onClick:function(profile,id,groupid,src){},onValueChanged:function(profile,id,ov,v){}},createdTrigger:function(){if(this.properties.disabled)this.boxing().setDisabled(true,true)},prepareData:function(profile){arguments.callee.upper.call(this,profile);var d=profile.data,p=profile.properties;d.mode=p.align=='right'?'text-align:right;':'';d.items.filter(function(o){return!o.$del})},prepareItem:function(profile,item,sitem){item.mode2=profile.properties.handler?'':'display:none;';var arr=[],t,id;var a=sitem.sub||[];a.each(function(item){t={id:item.id};id=profile.pickSubId('items');t[linb.UI.subSerialIdTag]=profile.ItemIdMapSubSerialId[item.id]=id;profile.SubSerialIdMapItem[id]=item;linb.UI.copyItem(item,t);t.type=t.type||'button';if(t.type.exists('.')){t.$del=true;return}t.captionDisplay=t.caption?'':'display:none';t.typeCls=profile.getClass(profile.keys.ITEM,'-'+t.type);arr.push(t)});item.sub=arr}}});Class("linb.UI.Layout",["linb.UI.iList","linb.UI.iContainer"],{Instance:{getPanel:function(id){var o=this.get(0);return o.getSubNode(o.keys.PANEL,o.getSubSerialIdByItemId(id))},attach:function(ui,id){this.appendChild(ui,id||'main');var profile=this.get(0);if(profile.domNode){if(!profile.getSubSerialIdByItemId(id))id='main';this.getPanel(id).attach(ui)}return this}},Static:{cssNone:false,Dropable:['PANEL'],Templates:{'default':{tagName:'div',style:'{left}{top}{width}{height}{right}{bottom}{zIndex}{position}',text:"{items}",$dynamic:{items:{ITEM:{tagName:'div',className:'{cls1} ',style:'{size}',MOVE:{$order:0,tagName:'div',className:'{cls2} ',style:'{display}'},CMD:{$order:1,tagName:'div',style:'{cmdDisplay}',className:'{cls3} '},PANEL:{tagName:'div',style:'position:absolute;left:0;top:0;',text:linb.UI.$childTag}}}}}},Appearances:{'default':{KEY:{position:'absolute',overflow:'hidden',left:'0',top:'0','font-size':linb.browser.ie?'0':'','line-height':linb.browser.ie?'0':''},MOVE:{$order:0,position:'absolute','background-color':'#f4f4f4','z-index':'10','font-size':linb.browser.ie?'0':'','line-height':linb.browser.ie?'0':''},'MOVE-mouseover':{$order:1,'background-color':'#f8f8f8'},CMD:{position:'absolute',border:'solid 1px #cdcdcd',cursor:'pointer','z-index':'20','font-size':linb.browser.ie?'0':'','line-height':linb.browser.ie?'0':''},ITEM:{position:'absolute',overflow:'hidden','background-color':'#fff','border-width':linb.browser.opr?'0px':'','font-size':linb.browser.ie?'0':'','line-height':linb.browser.ie?'0':''},PANEL:{position:'absolute',overflow:'auto','border-width':linb.browser.opr?'0px':'','font-size':linb.browser.ie?'0':'','line-height':linb.browser.ie?'0':''},'ITEM-MAIN':{left:'0',right:'0',top:'0',bottom:'0'},'ITEM-TOP, ITEM-BOTTOM':{left:'0',right:'0'},'ITEM-LEFT, ITEM-RIGHT':{top:'0',bottom:'0'},'MOVE-TOP':{'border-top':'solid 1px #cdcdcd','border-bottom':'solid 1px #cdcdcd',width:'100%',bottom:'0',height:'4px',cursor:'n-resize'},'MOVE-BOTTOM':{'border-top':'solid 1px #cdcdcd','border-bottom':'solid 1px #cdcdcd',width:'100%',top:'0',height:'4px',cursor:'n-resize'},'MOVE-LEFT':{'border-left':'solid 1px #cdcdcd','border-right':'solid 1px #cdcdcd',height:'100%',right:'0',width:'4px',cursor:'w-resize'},'MOVE-RIGHT':{'border-left':'solid 1px #cdcdcd','border-right':'solid 1px #cdcdcd',height:'100%',left:'0',width:'4px',cursor:'w-resize'},'MOVE-TOP-checked, MOVE-BOTTOM-checked, MOVE-LEFT-checked, MOVE-RIGHT-checked':{$order:1,'background-color':'#cdcdcd'},'CMD-TOP':{$order:0,left:'50%','margin-left':'-15px',bottom:'0',width:'30px',height:'4px',background:linb.UI.getCSSImgPara('icon.gif',' no-repeat left -52px',null,'linb.UI.Public')},'CMD-TOP-mouseover, CMD-BOTTOM-mouseover, CMD-LEFT-mouseover, CMD-RIGHT-mouseover':{$order:1,'background-color':'#ffff00'},'CMD-TOP-mouseover, CMD-BOTTOM-mouseover, CMD-LEFT-mouseover, CMD-RIGHT-mouseover':{$order:2,'background-color':'#ffff00'},'CMD-BOTTOM':{$order:0,left:'50%','margin-left':'-15px',top:'0',width:'30px',height:'4px',background:linb.UI.getCSSImgPara('icon.gif',' no-repeat left -60px',null,'linb.UI.Public')},'CMD-LEFT':{$order:0,top:'50%','margin-top':'-15px',right:'0',height:'30px',width:'4px',background:linb.UI.getCSSImgPara('icon.gif',' no-repeat -84px 0px',null,'linb.UI.Public')},'CMD-RIGHT':{$order:0,top:'50%','margin-top':'-15px',left:'0',height:'30px',width:'4px',background:linb.UI.getCSSImgPara('icon.gif',' no-repeat -92px -0px',null,'linb.UI.Public')},'MOVE-MAIN':{$order:5,display:'none'},'CMD-MAIN':{$order:5,display:'none'}}},Behaviors:{'default':{_hoverEffect:{MOVE:'MOVE',CMD:'CMD'},onResize:function(profile,e,src){var o=profile.root,w=null,h=null;if(e.width)w=o.width();if(e.height)h=o.height();profile.box.resize(profile,w,h)},MOVE:{onMousedown:function(profile,e,src){var id=src.id,itemId=profile.getSubSerialId(id),item=profile.getItemByDom(src);if(item.hide)return;var main=profile.getItemByItemId('main'),t=profile.properties,o=profile.getSubNode(profile.keys.ITEM,itemId),m=profile.getSubNode(profile.keys.ITEM,profile.getSubSerialIdByItemId('main')),cursor=o.cursor(),h,w,mh,mw,offset1,offset2;var t=profile.properties,cursor=linb([src],false).cursor();profile.pos=item.pos;if(t.type=='vertical'){h=profile._cur=o.height();mh=m.height();if(item.pos=='before'){offset1=h-item.min;offset2=item.max?Math.min(parseInt(item.max)-h,(mh-main.min)):(mh-main.min)}else{offset1=item.max?Math.min(parseInt(item.max)-h,(mh-main.min)):(mh-main.min);offset2=h-item.min}linb([src],false).startDrag(e,{type:'copy',move:false,target_clone:false,vertical:true,offset_top:offset1,offset_bottom:offset2,cursor:cursor})}else{w=profile._cur=o.width();mw=m.width();if(item.pos=='before'){offset1=w-item.min;offset2=item.max?Math.min(parseInt(item.max)-w,(mw-main.min)):(mw-main.min)}else{offset1=item.max?Math.min(parseInt(item.max)-w,(mw-main.min)):(mw-main.min);offset2=w-item.min}linb([src],false).startDrag(e,{type:'copy',move:false,target_clone:false,horizontal:true,offset_left:offset1,offset_right:offset2,cursor:cursor})}profile._limited=0},onDrag:function(profile,e,src){var t=profile.properties,d=linb.dragDrop,b=0;if(t.type=='vertical'){if((d.top<=d.limit_top)||(d.top>=d.limit_bottom))b=true}else{if(d.left<=d.limit_left||d.left>=d.limit_right)b=true}if(b){if(!profile._limited){profile._bg=d.proxyIn.getStyle('backgroundColor');d.proxyIn.setStyle('backgroundColor','#ff6600');profile._limited=true}}else{if(profile._limited){d.proxyIn.setStyle('backgroundColor',profile._bg);profile._limited=0}}},onDragend:function(profile,e,src){var t=profile.properties,o=linb([src],false).parent(),r=profile.getSubNode(profile.key);var item=profile.getItemByDom(src);if(t.type=='vertical'){o.height(item.size=profile._cur+(profile.pos=='before'?1:-1)*linb.dragDrop.getOffset().height);profile.box.resize(profile,null,r.height())}else{o.width(item.size=profile._cur+(profile.pos=='before'?1:-1)*linb.dragDrop.getOffset().width);profile.box.resize(profile,r.width(),null)}profile._limited=0}},CMD:{onMousedown:function(profile,e,src){var t=profile.properties,id=src.id,self=linb([src],false),itemId=profile.getSubSerialId(id),item=profile.getItemByDom(src),r=profile.getSubNode(profile.key),main=profile.getItemByItemId('main'),m=profile.getSubNode(profile.keys.ITEM,profile.getSubSerialIdByItemId('main'));var o=profile.getSubNode(profile.keys.ITEM,itemId),panel=profile.getSubNode(profile.keys.PANEL,itemId),move=profile.getSubNode(profile.keys.MOVE,itemId);if(t.type=='vertical'){if(item.hide){if(item.size<=m.height()-main.min+t._handlerSize){o.height(item.size);panel.show();item.hide=false;if(item.pos=='before')self.reClass(/bottom/g,'top');else self.reClass(/top/g,'bottom');if(!item.locked)move.cursor('n-resize');profile.removeTagClass(move,profile.keys.MOVE,'-checked')}else linb.message('no enough space!')}else{o.height(t._handlerSize);panel.hide();item.hide=true;if(item.pos=='before')self.reClass(/top/g,'bottom');else self.reClass(/bottom/g,'top');if(!item.locked)move.cursor('default');profile.addTagClass(move,profile.keys.MOVE,'-checked')}profile.box.resize(profile,null,r.height())}else{if(item.hide){if(item.size<=m.width()-main.min+t._handlerSize){o.width(item.size);panel.show();item.hide=false;if(item.pos=='before')self.reClass(/right/g,'left');else self.reClass(/left/g,'right');if(!item.locked)move.cursor('w-resize');profile.removeTagClass(move,profile.keys.MOVE,'-checked')}else linb.message('no enough space!')}else{o.width(t._handlerSize);panel.hide();item.hide=true;if(item.pos=='before')self.reClass(/left/g,'right');else self.reClass(/right/g,'left');if(!item.locked)move.cursor('default');profile.addTagClass(move,profile.keys.MOVE,'-checked')}profile.box.resize(profile,r.width(),null)}return false}}}},DataModel:{dataBinder:null,dataField:null,value:null,disabled:null,position:'absolute',type:{listbox:['vertical','horizontal'],ini:'vertical',action:function(value,ovalue){if(value!=ovalue){var nodes2=this.getSubNode(this.keys.ITEM,true),nodes1=this.getSubNode(this.keys.MOVE,true),nodes3=this.getSubNode(this.keys.CMD,true);nodes1.add(nodes2).add(nodes3);if(value=='vertical'){nodes1.reClass(/(-left)(\b)/ig,'-top$2');nodes1.reClass(/(-right)(\b)/ig,'-bottom$2');nodes2.each(function(o){linb(o).height(linb(o).width())}).left(0).right('auto').top('auto').bottom('auto')}else{nodes1.reClass(/(-top)(\b)/ig,'-left$2');nodes1.reClass(/(-bottom)(\b)/ig,'-right$2');nodes2.each(function(o){linb(o).width(linb(o).height())}).top(0).bottom('auto').left('auto').right('auto')}var size=this.root.cssSize();this.box.resize(this,size.width,size.height)}}},dock:'fill',listKey:null,width:200,height:200,_handlerSize:6,items:{ini:{},set:function(v){return this.each(function(o){if(o.domNode){var box=o.boxing();var p,temp=linb.dom.getTemp();var children=o.children.copy();o.children.length=0;children.each(function(o){delete o[0].$dockParent;temp.addLast(o[0].root)});box.clearItems();linb.dom.$gc();v=o.box.prepareDefaultValue(o,v);box.insertItems(v);children.each(function(v){box.attach.apply(box,v)});temp.empty();var size=o.root.cssSize();o.box.resize(o,size.width,size.height)}else o.properties.items=v})}}},EventHandlers:{beforeValueSet:null,afterValueSet:null,beforeValueUpdated:null,afterValueUpdated:null,beforeHoverEffect:null,beforeClickEffect:null,beforeNextFocus:null},prepareDefaultValue:function(profile,items){var main,before=[],after=[];items.each(function(o){if(o.id=='main'){main=o}else{if(o.pos=='before')before.push(o);else after.push(o)}});main=main||{};main.id='main';main.min=main.min||10;items.length=0;items.insert(before,0);items.insert(main);items.insert(after);items.each(function(o){o.id=_.isStr(o.id)?o.id:profile.$id+':'+_.id();o.min=o.min||10;if(o.id!='main'){o.size=parseInt(o.size)||20;o.locked=_.bool(o.locked,false);o.hide=_.bool(o.hide,false);o.cmd=_.bool(o.cmd,true)}});return items},prepareData:function(profile){var prop=profile.properties;if(!prop.items||prop.items.constructor!=Array)prop.items=_.clone([{id:'before',pos:'before',locked:false,size:60,min:50,max:200},{id:'after',pos:'after',locked:false,size:60,min:50,max:200}]);profile.properties.items=this.prepareDefaultValue(profile,profile.properties.items);arguments.callee.upper.call(this,profile)},prepareItem:function(profile,item){if(item.id=='main'){item.cls1=profile.getClass(profile.keys.ITEM,'-main');item.cls2=profile.getClass(profile.keys.MOVE,'-main');item.cls3=profile.getClass(profile.keys.CMD,'-main');return}if(profile.properties.type=='vertical')item.size='height:'+item.size+'px';else item.size='width:'+item.size+'px';var pos;if(profile.properties.type=='vertical'){if(item.pos=='before')pos='top';else pos='bottom'}else{if(item.pos=='before')pos='left';else pos='right'}item.cls1=profile.getClass(profile.keys.ITEM,'-'+pos);item.cls2=profile.getClass(profile.keys.MOVE,'-'+pos);item.cls3=profile.getClass(profile.keys.CMD,'-'+pos);item.display=item.locked?'display:none':'';item.cmdDisplay=item.cmd?'':'display:none'},createdTrigger:function(){var t,profile=this;profile.properties.items.each(function(item){if(item.id!='main'){if(item.hide&&(t=profile.getSubSerialIdByItemId(item.id))){item.hide=false;profile.getSubNode(profile.keys.CMD,t).onMousedown()}}})},resize:function(profile,w,h){var _t,t=profile.properties,m,n,itemId,temp1,temp2,temp,key=profile.keys.ITEM,panel=profile.keys.PANEL;var obj={},obj2={};t.items.each(function(o){itemId=profile.getSubSerialIdByItemId(o.id);obj[itemId]=linb.dom.iniBox();obj2[itemId]=linb.dom.iniBox()});if(t.type!='vertical'){if(!_.isNull(w)){temp=temp1=temp2=0;t.items.each(function(o){if(o.id=='main')return;itemId=profile.getSubSerialIdByItemId(o.id);if(o.pos=='before'){n=profile.getSubNode(key,itemId);m=n.width();obj2[itemId].left=temp1;temp1+=m;obj2[itemId].right='auto';obj[itemId].right='auto';obj[itemId].left=0;obj[itemId].width=m-(o.locked?0:t._handlerSize)}});t.items.each(function(o){if(o.id=='main')return;itemId=profile.getSubSerialIdByItemId(o.id);if(o.pos=='after'){n=profile.getSubNode(key,itemId);m=n.width();obj2[itemId].right=temp2;temp2+=m;obj2[itemId].left='auto';obj[itemId].right=0;obj[itemId].left='auto';obj[itemId].width=m-(o.locked?0:t._handlerSize)}},null,true);temp=temp1+temp2;if(w-temp>=0){_t=profile.getSubSerialIdByItemId('main');obj[_t].width=w-temp;obj2[_t].width=w-temp;obj2[_t].left=temp1}}if(!_.isNull(h)){_.each(obj,function(o,id){o.height=h;obj2[id].height=h})}}else{if(!_.isNull(h)){temp=temp1=temp2=0;t.items.each(function(o){if(o.id=='main')return;itemId=profile.getSubSerialIdByItemId(o.id);if(o.pos=='before'){n=profile.getSubNode(key,itemId);m=n.height();obj2[itemId].top=temp1;temp1+=m;obj2[itemId].bottom='auto';obj[itemId].top=0;obj[itemId].bottom='auto';obj[itemId].height=m-(o.locked?0:t._handlerSize)}});t.items.each(function(o){if(o.id=='main')return;itemId=profile.getSubSerialIdByItemId(o.id);if(o.pos=='after'){n=profile.getSubNode(key,itemId);m=n.height();obj2[itemId].bottom=temp2;temp2+=m;obj2[itemId].top='auto';obj[itemId].bottom=0;obj[itemId].top='auto';obj[itemId].height=m-(o.locked?0:t._handlerSize)}},null,true);temp=temp1+temp2;if(h-temp>=0){_t=profile.getSubSerialIdByItemId('main');obj[_t].height=h-temp;obj2[_t].height=h-temp;obj2[_t].top=temp1}}if(!_.isNull(w)){_.each(obj,function(o,id){o.width=w;obj2[id].width=w})}}_.each(obj,function(o,id){profile.getSubNode(panel,id).setRegion(o,true)});_.each(obj2,function(o,id){profile.getSubNode(key,id).setRegion(o)})}}});Class("linb.UI.Tabs",["linb.UI.iWidget","linb.UI.iList","linb.UI.iContainer"],{Instance:{setCtrlValue:function(value){this.each(function(profile){var id=profile.domId,box=profile.boxing(),uiv=box.getUIValue(),key1=profile.keys.ITEM,key2=profile.keys.BOX,properties=profile.properties,itemId=profile.getSubSerialIdByItemId(uiv),temp,t;if(uiv&&profile.getSubSerialIdByItemId(uiv)){profile.removeTagClass(profile.getSubNode(key1,itemId),key1,'-checked');profile.removeTagClass(profile.getSubNode(key2,itemId),key2,'-checked');box.getPanel(uiv).hide()}itemId=profile.getSubSerialIdByItemId(value);if(itemId){profile.addTagClass(profile.getSubNode(key1,itemId),key1,'-checked');profile.addTagClass(profile.getSubNode(key2,itemId),key2,'-checked');t=box.getPanel(value).show();profile.box.resize(profile,value,profile.root.width(),profile.root.height())}})},attach:function(ui,id){var profile=this.get(0);this.appendChild(ui,id);if(profile.domNode){if(!profile.getSubSerialIdByItemId(id))id=profile.properties.$UIvalue;this.getPanel(id).attach(ui)}return this},getCurPanel:function(){var profile=this.get(0);return this.getPanel(profile.properties.$UIvalue)},getPanel:function(id){var profile=this.get(0);return profile.getSubNode(profile.keys.PANEL,profile.getSubSerialIdByItemId(id))},addPanel:function(para,children,item){id=item&&item.id;var i={};_.merge(i,{caption:para.caption,icon:para.icon,closeBtn:para.closeBtn||false,landBtn:para.landBtn||false,iconPos:para.iconPos,dragKey:para.dragKey,dropKeys:para.dropKeys,id:para.id||para.tag||_.id()});this.insertItems([i],id);children.each(function(o){this.attach(o[0],i.id)},this)},removePanel:function(id){var profile=this.get(0),item=profile.getItemByDom(id);this.removeItems(item.id);this.box},getPanelPara:function(id){var profile=this.get(0),item=profile.getItemByDom(id);var para=_.clone(item);if(!para.dragKey)para.dragKey=profile.properties.dragKey;if(!para.dropKeys)para.dropKeys=profile.properties.dropKeys;return para},getPanelChildren:function(id){var profile=this.get(0),item=profile.getItemByDom(id);id=item.id;var arr=[];if(id){this.get(0).children.each(function(o){if(o[1]==id)arr.push(o)})}return arr},selectPage:function(id){var profile=this.get(0);var node=profile.getSubNode(profile.keys.ITEM,profile.getSubSerialIdByItemId(id));if(node.isEmpty()){profile.boxing().updateUIValue(null)}else node.onClick();return this},insertItemsEx:function(data,base,before){var profile=this.get(0),box=profile.box,obj,v;if(obj=profile.root){obj.addLast(box.subBuild(profile,'panels',data).toDom());if(!(v=this.getUIValue()))this.selectPage((v=profile.properties.items[0])&&(v=v.id));box.resize(profile,v,obj.width(),obj.height())}},removeItems:function(arr){var obj;if(!_.isArr(arr))arr=[arr];var serialId;this.each(function(profile){arr.each(function(o){serialId=profile.getSubSerialIdByItemId(o);if(serialId&&!(obj=profile.getSubNode(profile.keys.PANEL,serialId)).isEmpty()){obj.remove()}})});arguments.callee.upper.apply(this,arguments);this.each(function(profile){if(arr.exists(profile.boxing().getUIValue())){var i;profile.boxing().selectPage((i=profile.properties.items[0])&&i.id)}profile.box.resize(profile,profile.boxing().getUIValue(),profile.root.width(),profile.root.height())});return this},clearItems:function(){this.each(function(profile){profile.getSubNode(profile.keys.PANEL,true).remove()});this.setValue(null,true);arguments.callee.upper.apply(this,arguments);return this},markDirty:function(item,b,flag){var profile=this.get(0);if(typeof item=='string')item=profile.getItemByItemId(item);if((item._dirty!=b)||flag){var id=item.id;var caption=profile.getItemByItemId(id).caption;if(!b){profile.getSubNode(profile.keys.CAPTION,profile.getSubSerialIdByItemId(id)).html(profile.getItemByItemId(id).caption=caption.replace(/^\*/,'')).setStyle('fontStyle','normal')}else{profile.getSubNode(profile.keys.CAPTION,profile.getSubSerialIdByItemId(id)).html(profile.getItemByItemId(id).caption='*'+caption).setStyle('fontStyle','italic')}item._dirty=b}return this}},Static:{cssNone:false,Dropable:['PANEL','KEY','ITEM'],Dragable:['ITEM'],Templates:{'default':{tagName:'div',style:'{left}{top}{width}{height}{right}{bottom}{zIndex}{position}',LIST:{$order:0,tagName:'div',ITEMS:{tagName:'div',text:"{items}"}},PNAELS:{$order:1,tagName:'text',text:'{panels}'},$dynamic:{items:{ITEM:{tagName:'span',BOX:{tagName:'span',HANDLE:{tagName:'a',href:"javascript:;",tabindex:'{_tabindex}',RULER:{},ICON:{tagName:'span',style:'background:url({icon}) transparent  no-repeat {iconPos};{iconDisplay}',$order:0},CAPTION:{tagName:'span',text:'{caption}',className:"{disabled}",$order:1},CMDS:{$order:2,LAND:{tagName:'span',style:'{landDisplay}',$order:1},CLOSE:{tagName:'span',style:'{closeDisplay}',$order:2}}}}}},panels:{PANEL:{tagName:'div',text:linb.UI.$childTag}}}}},Appearances:{'default':{KEY:{position:'absolute',overflow:'hidden'},LIST:{'z-index':'2',position:'absolute','padding-left':'2px',left:'0',top:'0',width:'100%'},ITEM:{$order:0,'font-family':'"Verdana", "Helvetica", "sans-serif"',cursor:'pointer','padding-right':'6px','vertical-align':'top','border-bottom':'1px solid #91A7B4',background:linb.UI.getCSSImgPara('top.gif',' no-repeat right top'),'margin-bottom':linb.browser.ie6?'1px':''},'ITEM-mouseover':{$order:1,'background-position':'right -100px'},'ITEM-mousedown':{$order:2,'background-position':'right -200px','border-bottom':'1px solid #fff'},'ITEM-checked':{$order:3,'background-position':'right -200px','border-bottom':'1px solid #fff'},BOX:{$order:0,padding:'6px 0 2px 6px',border:'0','vertical-align':'top','text-align':'center',background:linb.UI.getCSSImgPara('top.gif',' no-repeat left -50px')},'BOX-mouseover':{$order:1,'background-position':'left -150px'},'BOX-mousedown':{$order:2,'background-position':'left -250px'},'BOX-checked':{$order:3,'background-position':'left -250px'},HANDLE:{cursor:'pointer','vertical-align':'middle',display:linb.browser.gek?['-moz-inline-block','-moz-inline-box']:'inline-block','font-size':'12px'},RULER:{height:'16px',width:'1px'},ICON:{cursor:'pointer',width:'16px',height:'16px','vertical-align':'middle',margin:'0 4px 0 0'},'CLOSE, LAND':{cursor:'pointer',width:'15px',height:'15px','vertical-align':'middle'},CLOSE:{background:linb.UI.getCSSImgPara('cmds.gif',' no-repeat -64px 0',null,'linb.UI.Public')},'CLOSE-mouseover':{$order:1,'background-position':'-64px -16px'},'CLOSE-mousedown':{$order:2,'background-position':'-64px -32px'},LAND:{background:linb.UI.getCSSImgPara('cmds.gif',' no-repeat -220px 0',null,'linb.UI.Public')},'LAND-mouseover':{$order:1,'background-position':'-220px -16px'},'LAND-mousedown':{$order:2,'background-position':'-220px -32px'},PANEL:{position:'absolute',visibility:'hidden',top:'-10000px',left:'-10000px',overflow:'auto','background-color':'#fff',border:'1px solid #91A7B4'}}},Behaviors:{'default':{_hoverEffect:{ITEM:['ITEM','BOX'],CLOSE:'CLOSE',LAND:'LAND'},_clickEffect:{ITEM:['ITEM','BOX'],CLOSE:'CLOSE',LAND:'LAND'},onResize:function(profile,e,src){var o=profile.root,w=null,h=null;if(e.height)h=o.height();if(e.width)w=o.width();profile.box.resize(profile,profile.properties.$UIvalue,w,h)},ITEM:{onClick:function(profile,e,src){var properties=profile.properties,itemId=profile.getSubSerialId(src.id),item=profile.getItemByDom(src),box=profile.boxing();if(properties.disabled)return false;if(box.getUIValue()==item.id)return false;box.updateUIValue(item.id);if(box.getUIValue()==item.id){box.onItemSelected(profile,item,src);profile.getSubNode(profile.keys.HANDLE,itemId).focus()}return false}},HANDLE:{onKeydown:function(profile,e,src){var keys=linb.event.getKey(e),key=keys[0],shift=keys[2],cur=linb([src],false),target=profile.getSubNode(profile.keys.ITEMS),first=target.nextFocus(true,true,false),last=target.nextFocus(false,true,false);switch(linb.event.getKey(e)[0]){case'tab':if(shift){if(src!=first.get(0)){first.focus();return false}}else{if(src!=last.get(0)){last.focus();return false}}break;case'left':case'up':var next=cur.nextFocus(false,true,false);if(cur.get(0)==first.get(0))last.focus();else cur.nextFocus(false);return false;break;case'right':case'down':var next=cur.nextFocus(true,false,false);if(cur.get(0)==last.get(0))first.focus();else cur.nextFocus();return false;break;case'space':case'enter':profile.getSubNode(profile.keys.ITEM,profile.getSubSerialId(src.id)).onClick();return false;break}}},CLOSE:{onClick:function(profile,e,src){var properties=profile.properties,item=profile.getItemByDom(src);if(properties.disabled)return;var instance=profile.boxing();if(false===instance.beforePageClose(profile,item,src))return;instance.removeItems(item.id);instance.afterPageClose(profile,item,src);profile.box.resize(profile,profile.properties.$UIvalue,profile.root.width(),profile.root.height());return false}},LAND:{onClick:function(profile,e,src){var properties=profile.properties,item=profile.getItemByDom(src),id=item.id;if(properties.disabled)return;var panel=profile.boxing().getPanel(id);var pos=profile.root.absPos(),size=profile.root.cssSize();var pro=linb.UI.Dialog.getDefaultProp();_.merge(pro,item,'with');_.merge(pro,{dragKey:item.dragkey||properties.dragKey,dock:'none',tag:item.tag||item.id,width:size.width,height:size.height,left:pos.left,top:pos.top},'all');var dialog=new linb.UI.Dialog(pro);linb(document.body).attach(dialog);profile.children.each(function(o){if(o[1]==id)dialog.attach(o[0])},null,true);profile.boxing().removeItems(id);return false}}}},DataModel:{dataBinder:null,dataField:null,dock:'fill',width:200,height:200,position:'absolute',tabindex:{action:function(value){if(this.domNode)this.getSubNode(this.keys.HANDLE,true).tabIndex(value)}},dragKey:'',dropKeysPanel:'',value:{ini:'a'},items:{set:function(v){return this.each(function(o){if(o.domNode){var box=o.boxing();var p,temp=linb.dom.getTemp();var children=o.children.copy();o.children.length=0;children.each(function(o){delete o[0].$dockParent;temp.addLast(o[0].root)});var value=o.properties.value;box.clearItems();linb.dom.$gc();box.insertItems(v);children.each(function(v){box.attach.apply(box,v)});temp.empty();box.setValue(value,true);var size=o.root.cssSize();o.box.resize(o,o.properties.$UIvalue,size.width,size.height)}else o.properties.items=v})}}},EventHandlers:{beforeNextFocus:null,beforePageClose:function(profile,item,src){},afterPageClose:function(profile,item,src){},onItemSelected:function(profile,item,src){}},createdTrigger:function(){if(this.properties.value){this.boxing().updateUIValue(this.properties.value)}},prepareData:function(profile){arguments.callee.upper.call(this,profile);profile.data.panels=profile.data.items},prepareItem:function(profile,item){item.closeDisplay=item.closeBtn?'':'display:none';item.landDisplay=item.landBtn?'':'display:none'},getDropKeys:function(profile,node){var key=profile.getKey(node.id);if(key==profile.keys.PANEL)return profile.properties.dropKeys;else return profile.properties.dropKeysPanel},resize:function(profile,key,w,h){var t=profile.properties,temp,top;var o=profile.boxing().getPanel(key);var l=profile.getSubNode(profile.keys.LIST),lc=false;if(!o||o.isEmpty())return;var wc=null,hc=null;if(w){wc=w;if(l.width!=w){l.width(w-2);lc=true}}if(h||lc){temp=l.offsetHeight();if(t.mode=='bottom')top=0;else top=temp-(linb.browser.ie6?2:1);h=h-temp+(linb.browser.ie6?2:1);if(h>0)hc=h}o.setRegion({width:wc?wc-2:null,height:hc?hc-2:null,top:top,left:0},true)}}});Class("linb.UI.Stacks","linb.UI.Tabs",{Static:{Appearances:{'default':{LIST:{position:'static'},ITEM:{$order:0,display:'block',position:'absolute',cursor:'pointer',background:linb.UI.getCSSImgPara('barvbg.gif',' repeat-x left top',null,'linb.UI.Public'),height:'22px',width:'100%',left:'0'},BOX:{display:'block'},'ITEM-mouseover':{$order:1,'background-position':'right -22px'},'ITEM-mousedown':{$order:1,'background-position':'right -44px'},'ITEM-checked':{$order:1,'background-position':'right -44px'},HANDLE:{cursor:'pointer',display:'block','font-size':'12px',height:'100%','padding-left':'6px'},ICON:{cursor:'pointer',width:'16px',height:'16px',margin:'3px 4px 0 0'},CAPTION:{margin:'2px'},PANEL:{position:'absolute',visibility:'hidden',top:'-10000px',left:'-10000px',overflow:'auto','background-color':'#fff'},CMDS:{position:'absolute',top:'0',right:'0','text-align':'right','vertical-align':'middle',height:'100%',cursor:'default'},'CLOSE, LAND':{position:'relative',width:'15px',height:'15px','vertical-align':'middle',cursor:'default'},CLOSE:{background:linb.UI.getCSSImgPara('cmds.gif',' no-repeat -64px 0',null,'linb.UI.Public')},'CLOSE-mouseover':{$order:1,'background-position':'-64px -16px'},'CLOSE-mousedown':{$order:2,'background-position':'-64px -32px'},LAND:{background:linb.UI.getCSSImgPara('cmds.gif',' no-repeat -220px 0',null,'linb.UI.Public')},'LAND-mouseover':{$order:1,'background-position':'-220px -16px'},'LAND-mousedown':{$order:2,'background-position':'-220px -32px'}}},resize:function(profile,key,w,h){var t=profile.properties,temp,t1,t2,obj,top;var o=profile.boxing().getPanel(key);if(!o||o.isEmpty())return;var wc=null,hc=null;if(h){t2=t1=0;t.items.each(function(o){obj=profile.getNodeByItemId(profile.keys.ITEM,o.id);obj.bottom('auto').top(t1);t1+=obj.height();if(o.id==key)return false});t.items.each(function(o){if(o.id==key)return false;obj=profile.getNodeByItemId(profile.keys.ITEM,o.id);obj.top('auto').bottom(t2);t2+=obj.height()},null,true);temp=h-t1-t2;if(temp>0){top=t1;hc=temp}}if(w)wc=w;o.setRegion({width:wc?wc:null,height:hc?hc:null,top:top,left:0},true);if(wc)profile.getSubNode(profile.keys.LIST).width(wc)}}});Class("linb.UI.ButtonViews","linb.UI.Tabs",{Initialize:function(){this.mapKeys(['LEFT','TOP','RIGHT','BOTTOM'])},Static:{Appearances:{'default':{LIST:{'z-index':'2',position:'absolute','background-color':'#F3F3F3'},ITEMS:{'z-index':'2',position:'absolute',left:'0',top:'0'},ITEM:{margin:'2px',position:'relative'},'ITEM-checked':{},LEFT:{'border-right':'1px solid #A7A6AA'},RIGHT:{'border-left':'1px solid #A7A6AA'},TOP:{'border-bottom':'1px solid #A7A6AA'},BOTTOM:{'border-top':'1px solid #A7A6AA'},BOX:{$order:0,border:'solid 1px #F3F3F3','vertical-align':'top'},'BOX-mouseover':{$order:1,border:'solid 1px #A7A6AA','background-color':'#FFFFE0'},'BOX-mousedown, BOX-checked':{$order:1,border:'solid 1px #A7A6AA','background-color':'#fff'},HANDLE:{cursor:'pointer','vertical-align':'middle',display:linb.browser.gek?['-moz-inline-block','-moz-inline-box']:'inline-block','vertical-align':'middle','font-size':'12px',margin:'1px'},ICON:{cursor:'pointer',width:'16px',height:'16px',margin:'1px'}}},DataModel:{dock:'fill',handleDock:{ini:'top',listbox:['top','bottom','left','right'],action:function(v){var hs=this.getSubNode(this.keys.LIST),h=this.getSubNode(this.keys.ITEM,true),b=this.getSubNode(this.keys.BOX,true);switch(v){case'left':case'top':hs.setRegion({left:0,top:0,right:'auto',bottom:'auto'});break;case'right':case'bottom':hs.setRegion({left:'auto',top:'auto',right:0,bottom:0});break}switch(v){case'left':case'right':h.display('block');b.display('block');break;case'top':case'bottom':h.inlineBlock();b.inlineBlock();hs.height('auto');break}this.boxing().setHandleSize(this.properties.handleSize,true)}},handleHAlign:{ini:'left',listbox:['left','right'],action:function(v){var hl=this.getSubNode(this.keys.ITEMS);hl.setStyle('textAlign',v)}},handleVAlign:{ini:'top',listbox:['top','bottom'],action:function(v){var hl=this.getSubNode(this.keys.ITEMS);if(v=='top'){hl.top(0).bottom('auto')}else{hl.bottom(0).top('auto')}}},handleSize:{ini:50,action:function(v){var t=this.properties,hs=this.getSubNode(this.keys.LIST),hl=this.getSubNode(this.keys.ITEMS);if(['left','right'].exists(t.handleDock)){hs.add(hl).width(v)}else{hs.height(v)}this.box.resize(this,this.properties.$UIvalue,this.root.width(),this.root.height())}}},createdTrigger:function(){var pro=this.properties;this.boxing().setHandleDock(pro.handleDock,true).setHandleHAlign(pro.handleHAlign,true).setHandleVAlign(pro.handleVAlign,true)},resize:function(profile,key,w,h){var o=profile.boxing().getPanel(key);if(!o||o.isEmpty())return;var t=profile.properties,top,left,hs=profile.getSubNode(profile.keys.LIST),hl=profile.getSubNode(profile.keys.ITEMS);var wc=null,hc=null;if(['top','bottom'].exists(t.handleDock)){if(w){hs.width(w);hl.width(w);left=0;wc=w}if(h-t.handleSize>0)hc=h-t.handleSize;top=t.handleDock=='top'?t.handleSize:0}else{if(h){hs.height(h);top=0;hc=h}if(w){left=t.handleDock=='left'?t.handleSize:0;wc=w-t.handleSize}}if(!o.isEmpty())o.setRegion({width:wc?wc-2:null,height:hc?hc-2:null,left:left,top:top},true)}}});Class("linb.UI.TreeBar",["linb.UI.iList","linb.UI.iNavigator"],{Instance:{setCtrlValue:function(value,flag){return this.each(function(profile){if(!profile.domNode)return;var box=profile.boxing(),uiv=box.getUIValue(),properties=profile.properties,key1=profile.keys.BAR,key2=profile.keys.MARK2;if(properties.selMode=='single'){var itemId=profile.getSubSerialIdByItemId(uiv);if(uiv&&itemId){profile.removeTagClass(profile.getSubNode(key1,itemId),key1,'-checked');profile.removeTagClass(profile.getSubNode(key2,itemId),key2,'-checked')}itemId=profile.getSubSerialIdByItemId(value);if(itemId){profile.addTagClass(profile.getSubNode(key1,itemId),key1,'-checked');profile.addTagClass(profile.getSubNode(key2,itemId),key2,'-checked')}}else if(properties.selMode=='multi'){uiv=uiv?uiv.split(';'):[];value=value?value.split(';'):[];if(flag){value.each(function(o){profile.addTagClass(profile.getSubNode(key1,profile.getSubSerialIdByItemId(o)),key1,'-checked');profile.addTagClass(profile.getSubNode(key2,profile.getSubSerialIdByItemId(o)),key2,'-checked')})}else{uiv.each(function(o){if(!value.exists(o)){profile.removeTagClass(profile.getSubNode(key1,profile.getSubSerialIdByItemId(o)),key1,'-checked');profile.removeTagClass(profile.getSubNode(key2,profile.getSubSerialIdByItemId(o)),key2,'-checked')}});value.each(function(o){if(!uiv.exists(o)){profile.addTagClass(profile.getSubNode(key1,profile.getSubSerialIdByItemId(o)),key1,'-checked');profile.addTagClass(profile.getSubNode(key2,profile.getSubSerialIdByItemId(o)),key2,'-checked')}})}}})},setValue:function(value,flag){var upper=arguments.callee.upper;return this.each(function(profile){if(profile.properties.multiSel){var arr=value.split(';');arr.sort();value=arr.join(';')}upper.apply(profile.boxing(),[value,flag])})},insertItems:function(arr,pid,base,before){var node,self=this.constructor;return this.each(function(profile){var tar,r,k;if(!pid){k=profile.properties;tar=k.items||(k.items=[])}else{k=profile.getItemByItemId(pid);tar=k.sub||(k.sub=[])}if(!base)tar.insert(arr,before?0:-1);else{var index=tar.subIndexOf(id,base);tar.insert(arr,before?index:(index+1))}if(profile.domNode){if(!base){if(!pid)node=profile.getSubNode(profile.keys.ITEMS);else{k=profile.getItemByItemId(pid);if(k._created)node=profile.getSubNode(profile.keys.SUB,profile.getSubSerialIdByItemId(pid))}if(node){r=self.subBuild(profile,'items',profile.box.prepareItems(profile,arr,pid)).toDom();if(before)node.addFirst(r);else node.addLast(r)}}else{k=profile.getItemByItemId(pid);if(k._created){r=self.subBuild(profile,'items',profile.box.prepareItems(profile,arr,pid)).toDom();node=profile.getSubNode(profile.keys.ITEM,profile.getSubSerialIdByItemId(base));if(before)node.addPre(r);else node.addNext(r)}}}var obj;if(pid)if((obj=profile.getSubNode(profile.keys.MARK1,profile.getSubSerialIdByItemId(pid))).display()=='none')obj.inlineBlock();if(!profile.properties.iniFold)if(!pid||profile.getItemByItemId(pid)._created)profile.boxing().openNodes(arr,true)})},updateItem:function(id,name,value){var profile=this.get(0),item=profile.getItemByItemId(id);if(!item)return;item[name]=value;switch(name){case'caption':profile.getSubNode(profile.keys.CAPTION,profile.getSubSerialIdByItemId(id)).html(value,false);break}},moveItems:function(ids,toPid){var profile=this.get(0),t;if(toPid){var domPid=profile.getSubSerialIdByItemId(toPid),pItem=profile.getItemByItemId(toPid),pItemSub=pItem.sub||(pItem.sub=[]),domP=profile.getSubNode(profile.keys.SUB,domPid);if((t=profile.getSubNode(profile.keys.MARK1,domPid)).visibility()=='none')t.inlineBlock()}else{var pItemSub=profile.properties.items,domP=profile.getSubNode(profile.keys.KEY)}ids.each(function(id){var domId=profile.getSubSerialIdByItemId(id),iItem=profile.getItemByItemId(id);var sub;if(iItem.pid)sub=profile.getItemByItemId(iItem.pid).sub;else sub=profile.properties.items;var index=sub.subIndexOf('id',id);sub[index].pid=toPid;pItemSub.insert(sub[index]);sub.remove(index);domP.addLast(profile.getSubNode(profile.keys.ITEM,domId))})},openNodes:function(items,flag){if(items&&items.length)items.each(function(o){if(o.sub&&o.sub.length&&!o.iniFold&&!o._checked)this.openNode(o.id,flag)},this)},openNode:function(id,flag){var profile=this.get(0),item=profile.getItemByItemId(id);if(item&&!item._checked)profile.box.setSub(profile,item,flag)},selectItem:function(id){var profile=this.get(0);var node=profile.getSubNode(profile.keys.BAR,profile.getSubSerialIdByItemId(id));if(!node.isEmpty()){node.onClick();return this}else return false}},Initialize:function(){this.mapKeys(['DISABLED'])},Static:{cssNone:false,Templates:{'default':{tagName:'div',style:'{left}{top}{width}{height}{right}{bottom}{zIndex}{position}',BORDER:{tagName:'div',BOX:{tagName:'div',ITEMS:{tagName:'div',text:"{items}"}}},$dynamic:{items:{ITEM:{tagName:'div',BAR:{$order:0,tagName:'div',className:'{cls_group} ',CMD:{tagName:'a',href:"javascript:;",tabindex:'{_tabindex}',MARK1:{tagName:'span',$order:0,style:'{mark}'},MARK2:{tagName:'span',$order:1,style:'{mark2Display}'},ITEMICON:{tagName:'span',style:'background:url({icon}) transparent  no-repeat   {iconPos}; {iconDisplay}',$order:2},ITEMCAPTION:{tagName:'span',text:'&nbsp;{caption}',className:"{disabled} ",$order:3}}},SUB:{$order:1,tagName:'div',text:linb.UI.$childTag}}}}}},Appearances:{'default':{KEY:{'font-family':'Verdana, Helvetica, sans-serif','border':'0'},BOX:{overflow:'auto','overflow-x':(linb.browser.ie||linb.browser.gek)?'hidden':''},ITEMS:{'border-bottom':'1px solid #e5e5e5','border-right':'1px solid #e5e5e5'},BORDER:{'cursor':'pointer','background-color':'#fff'},ITEM:{'border-left':'1px solid #e5e5e5','white-space':'nowrap',overflow:'hidden'},BAR:{'border-top':'1px solid #e5e5e5',padding:'1px'},DISABLED:{color:'#808080'},'BAR-mouseover':{$order:1,'background-color':'#d9e8fb'},'BAR-checked':{$order:2,'background-color':'#f6f6f6'},'BAR-GROUP':{background:linb.UI.getCSSImgPara('group.gif',' repeat-x left top'),padding:'1px'},'BAR-GROUP-mouseover':{$order:1,'background-position':'left -30px'},'BAR-GROUP-checked':{$order:2,'background-position':'left -60px'},CMD:{cursor:'pointer','vertical-align':'middle',display:'block','font-size':'12px'},SUB:{display:'none',overflow:'hidden','margin-left':'20px'},MARK1:{background:linb.UI.getCSSImgPara('cmds.gif',' no-repeat -161px top',null,'linb.UI.Public'),cursor:'pointer',width:'16px',height:'16px',margin:'0 4px 0 0'},'MARK1-mouseover':{$order:2,'background-position':'-161px -15px'},'MARK1-mousedown':{$order:3,'background-position':'-161px -30px'},'MARK1-checked':{$order:4,'background-position':'-176px top'},'MARK1-checked-mouseover':{$order:5,'background-position':'-176px -15px'},'MARK1-checked-mousedown':{$order:6,'background-position':'-176px -30px'},'MARK1-BUSY':{$order:7,background:linb.UI.getCSSImgPara('busy.gif',' no-repeat center center',null,'linb.UI.Public')},MARK2:{cursor:'pointer',width:'16px',height:'16px',margin:'0 4px 0 0'},'MARK2-checked':{$order:2,background:linb.UI.getCSSImgPara('icon.gif',' no-repeat -50px 0',null,'linb.UI.Public')},'ITEMICON, ICON':{cursor:'pointer',width:'16px',height:'16px'}}},Behaviors:{'default':{_hoverEffect:{MARK1:'MARK1',BAR:'BAR'},_clickEffect:{MARK1:'MARK1',BAR:'BAR'},onResize:function(profile,e,src){var o=profile.root,w=null,h=null;if(e.height)h=o.height();if(e.width)w=o.width();profile.box.resize(profile,w,h)},MARK1:{onClick:function(profile,e,src){var properties=profile.properties,item=profile.getItemByDom(src);if(properties.disabled||item.disabled)return false;if(!item.sub)return false;profile.box.setSub(profile,item);return false}},BAR:{onMousedown:function(profile,e,src){var properties=profile.properties,item=profile.getItemByDom(src);if(item.dragable){linb([src],false).startDrag(e,{type:'copy',move:false,key:item.dragKey||profile.properties.dragKey,data:item.id});profile.removeTagClass(linb(src),profile.keys.BAR,'-mouseover')}},onClick:function(profile,e,src){var properties=profile.properties,item=profile.getItemByDom(src),itemId=profile.getSubSerialId(src.id),box=profile.boxing();if(properties.disabled||item.disabled)return false;if(item.sub&&(item.group!=undefined?item.group:properties.group)){profile.getSubNode(profile.keys.MARK1,itemId).onClick();return false}switch(properties.selMode){case'none':box.onItemSelected(profile,item,src);break;case'multi':var value=box.getUIValue();var arr=value?value.split(';'):[];if(arr.exists(item.id))arr.removeValue(item.id);else arr.push(item.id);arr.sort();value=arr.join(';');box.updateUIValue(value);if(box.getUIValue()==value)box.onItemSelected(profile,item,src);break;case'single':if(box.getUIValue()!=item.id){box.updateUIValue(item.id);if(box.getUIValue()==item.id)box.onItemSelected(profile,item,src)}break}profile.getSubNode(profile.keys.CMD,itemId).focus();return false}},CMD:{onKeydown:function(profile,e,src){var keys=linb.event.getKey(e),key=keys[0],shift=keys[2],cur=linb([src],false),first=profile.root.nextFocus(true,true,false),last=profile.root.nextFocus(false,true,false);switch(linb.event.getKey(e)[0]){case'tab':if(shift){if(src!=first.get(0)){first.focus();return false}}else{if(src!=last.get(0)){last.focus();return false}}break;case'up':var next=cur.nextFocus(false,true,false);if(cur.get(0)==first.get(0))last.focus();else cur.nextFocus(false);return false;break;case'down':var next=cur.nextFocus(true,false,false);if(cur.get(0)==last.get(0))first.focus();else cur.nextFocus();return false;break;case'right':case'left':profile.getSubNode(profile.keys.MARK1,profile.getSubSerialId(src.id)).onClick();return false;case'enter':case'space':profile.getSubNode(profile.keys.BAR,profile.getSubSerialId(src.id)).onClick();return false}},onClick:function(e){}}}},EventHandlers:{onRequestData:function(profile,id,threadid){},onItemSelected:function(profile,item,src){}},DataModel:{listKey:null,zIndex:null,tabindex:{action:function(value){if(this.domNode)this.getSubNode(this.keys.CMD,true).tabIndex(value)}},iniFold:true,dragKey:'treeBar',dock:'fill',group:{ini:false,action:function(v){var self=this,items=this.properties.items,results=this.itemsSearch(items,function(o){return o.sub&&o.group==undefined}),nodes=linb([]);results.each(function(o){nodes.add(self.getSubNode(self.keys.BAR,self.getSubSerialIdByItemId(o.id)))});var cls1=this.getClass(self.keys.BAR),cls2=this.getClass(self.keys.BAR,'-group');if(v)nodes.reClass(new RegExp('(\\b)'+cls1+'([^b]*\\b)','g'),'$1'+cls2+'$2');else nodes.reClass(new RegExp('(\\b)'+cls2+'([^b]*\\b)','g'),'$1'+cls1+'$2')}},selMode:{ini:'single',listbox:['single','none','multi'],action:function(v,ov){if(ov=='none')this.getSubNode(this.keys.MARK2,true).inlineBlock();if(v=='none')this.getSubNode(this.keys.MARK2,true).display('none')}},position:'absolute'},createdTrigger:function(){if(linb.browser.ie)this.root.addEvent('ondrag',function(){return false}).addEvent('onselectstart',function(){return false});if(!this.properties.iniFold)this.boxing().openNodes(this.properties.items,true)},prepareItem:function(profile,item,oitem){var p=profile.properties;item.mark=item.sub?'':'display:none';item.disabled=item.disabled?profile.getClass(profile.keys.KEY,'-disabled'):'';item.mark2Display=(p.selMode=='none')?'display:none':'';item._tabindex=p.tabindex;if(item.sub&&(item.group!=undefined?item.group:p.group)){item.cls_group=profile.getClass(profile.keys.BAR,'-group');item.mark2Display='display:none'}},setSub:function(profile,item,flag){var id=profile.domId,itemId=profile.getSubSerialIdByItemId(item.id),key1=profile.keys.MARK1,key2=profile.keys.SUB,key3=profile.keys.BAR,properties=profile.properties,barNode=profile.getSubNode(key3,itemId),markNode=profile.getSubNode(key1,itemId),subNode=profile.getSubNode(key2,itemId);if(linb.thread.exists(profile.key+profile.id))return;if(item._checked){var h=subNode.height();subNode.fx({'height':[h,0]},function(){subNode.height(h)},function(){subNode.display('none').height('auto')},200,8,'inexp',profile.key+profile.id).start();profile.removeTagClass(markNode,key1,'-checked');if(item.group||properties.group)profile.removeTagClass(barNode,key3,'-checked');item._checked=false}else{var openSub=function(profile,item,id,markNode,subNode,barNode,sub,flag){if(!item._created){delete item.sub;item._created=true;subNode.display('none');profile.boxing().insertItems(sub,item.id);profile.boxing().setCtrlValue(profile.boxing().getUIValue(),true)}if(!flag){var h=subNode.height(true);subNode.fx({'height':[0,h]},function(){subNode.height('0').display('block')},function(){subNode.height('auto')},200,8,'outexp',profile.key+profile.id).start()}else subNode.display('block');profile.addTagClass(markNode,key1,'-checked');if(item.group||properties.group)profile.addTagClass(barNode,key3,'-checked');item._checked=true};var sub=profile.getItemBySubSerialId(itemId).sub;if(sub&&sub.length){openSub(profile,item,id,markNode,subNode,barNode,sub,flag);if(flag){sub.each(function(o){if(o.sub&&o.sub.length&&!o.iniFold&&!o._checked)profile.box.setSub(profile,o,true)})}}else{linb.thread(null,[function(threadId){if(profile.onRequestData)profile.boxing().onRequestData(profile,item.id,threadId);else linb.thread(threadId).abort()},function(threadId){sub=linb.thread(threadId).getCache('response');if(sub){openSub(profile,item,id,markNode,subNode,barNode,sub,flag);openSub=null}}],null,null,function(threadId){profile.addTagClass(markNode,key1,'-busy');linb(id).busy(false)},function(){profile.removeTagClass(markNode,key1,'-busy');linb(id).free()}).start()}}},resize:function(profile,w,h){profile.getSubNode(profile.keys.BORDER).cssSize({width:w?w:null,height:h?h:null});profile.getSubNode(profile.keys.BOX).cssSize({width:w?w:null,height:h?h:null})}}});Class("linb.UI.TreeGrid","linb.UI.iWidget",{Instance:{_insertRowsToDom:function(profile,arr,pid,base,before){if(pid){var parent=profile.row_SerialIdMapItem[pid];if(parent&&!parent._created)return}var obj,hw,self=arguments.callee;var ws=[],hw=profile.getSubNode(profile.keys.HCELL0).width();profile.properties.header.each(function(v){ws.push(profile.getSubNode(profile.keys.HCELL,profile.header_ItemIdMapSerialId[v.id]).width())});arr.each(function(o){o.rowHandlerWidth=hw-o._layer*profile.properties.$subMargin;o.cells.each(function(v,i){v.width=ws[i]})});var nodes=profile.box.subBuild(profile,'rows',arr).toDom();if(!base){if(pid){obj=profile.getSubNode(profile.keys.SUB,pid)}else{obj=profile.getSubNode(profile.keys.BODY)}if(before)obj.addFirst(nodes);else obj.addLast(nodes)}else{obj=profile.getSubNode(profile.keys.CELLS,base);if(before)obj.addPre(nodes);else{nodes.get().reverse();obj.addNext(nodes)}}arr.each(function(o){o.open=false},this);delete profile.$allrowscache},refreshHeader:function(header){var profile=this.get(0);profile.properties.header=header;var rows=profile.properties.rows.copy();this.removeAllRows();var arr=profile.box.prepareHeader(profile,header);var nodes=profile.box.subBuild(profile,'header',arr).toDom();profile.getSubNode(profile.keys.HCELL,true).remove();profile.getSubNode(profile.keys.HCELLS).addLast(nodes);this.insertRows(rows)},insertRows:function(arr,pid,base,before){var c=this.constructor,profile=this.get(0),pro=profile.properties;pid=profile.row_ItemIdMapSerialId[pid];base=profile.row_ItemIdMapSerialId[base];var rows=c.prepareItems(profile,arr,pid);var tar,b=profile.row_SerialIdMapItem;if(!pid)tar=(pro.rows||(pro.rows=[]));else tar=(b[pid].sub||(b[pid].sub=[]));if(!base)tar.insert(arr,before?0:-1);else{var index=tar.subIndexOf('_serialId',base);tar.insert(arr,before?index:(index+1))}this._insertRowsToDom(profile,rows,pid,base,before);if(!profile.properties.iniFold)profile.boxing().openRows(rows,true);return this},removeRows:function(ids){var profile=this.get(0),cell=profile.cells_SerialIdMapItem,nodes=[];ids=_.isArr(ids)?ids:[ids];ids.each(function(id){if(!(id=profile.row_ItemIdMapSerialId[id]))return;var row;if(row=profile.row_SerialIdMapItem[id]){var tdids=row._cells,rowid=row.id,temp;_.each(tdids,function(o){delete cell[o].header._cells[rowid];delete cell[o];profile.cacheSubId(o._serialId,'cell')});if(temp=row._parent?(temp=profile.row_SerialIdMapItem[row._parent])?temp.sub:null:profile.properties.row)temp.filter(function(o){return o._serialId!=id});delete profile.row_ItemIdMapSerialId[rowid];delete profile.row_SerialIdMapItem[id];profile.cacheSubId(serialId,'row');nodes.push(profile.getSubNode(profile.keys.CELLS,id));if(row.sub){var arr=[];row.sub.each(function(o){arr.push(o.id)});this.removeRows(arr)}}},this);linb(nodes,false).remove();return this},removeAllRows:function(){var profile=this.get(0);for(var i in profile.cells_SerialIdMapItem)profile.cacheSubId(i,'cell');for(var i in profile.row_SerialIdMapItem)profile.cacheSubId(i,'row');_.each(profile.header_SerialIdMapItem,function(o){o._cells={}});profile.row_SerialIdMapItem={};profile.cells_SerialIdMapItem={};profile.row_ItemIdMapSerialId={};profile.properties.rows.length=0;profile.getSubNode(profile.keys.BODY).empty();profile.getSubNode(profile.keys.SCROLL).scrollTop(0).scrollLeft(0);return this},resetContent:function(){var profile=this.get(0);_.each(profile.$cache_editor,function(o,i){o.reBoxing().hide()});this.removeAllRows();return this},updateColumn:function(colId,hashValue){var pro=this.get(0),col=pro.header_SerialIdMapItem[pro.header_ItemIdMapSerialId[colId]];if(!col)return;var cells=col._cells;_.each(hashValue,function(o,i){pro.cells_SerialIdMapItem[cells[i]].value=o;pro.getSubNode(pro.keys.CELLA,cells[i]).html(o,false)})},updateCellbyRowCol:function(rowId,colId,value){var t;if(t=this.constructor.getCellId(this.get(0),rowId,colId))this.constructor.changeCellValue(this.get(0),t,value);return this},updateCell:function(cellId,value){this.constructor.changeCellValue(this.get(0),cellId,value);return this},openRows:function(rows,flag){if(rows&&rows.length)rows.each(function(o){if(o.sub&&o.sub.length&&!o.iniFold&&!o._checked)this.openRow(o.id,flag)},this)},openRow:function(id,flag){var profile=this.get(0),row=profile.row_SerialIdMapItem[profile.row_ItemIdMapSerialId[id]];if(row&&!row._checked)profile.box.setSub(profile,row,flag)},scrollTo:function(pos){var profile=this.get(0),scroll=profile.getSubNode(profile.keys.SCROLL);pos=pos=='top'?0:pos=='bottom'?scroll.scrollHeight():pos;scroll.scrollTop(pos)}},Initialize:function(){this.mapKeys(['ALT']);var b=this.getBehavior('default');b.HCELLA={};b.HCELL0A={};b.CELLA.onKeydown=b.CELL0A.onKeydown=b.HCELLA.onKeydown=b.HCELL0A.onKeydown=function(profile,e,src){var keys=linb.event.getKey(e),key=keys[0],shift=keys[2],cur=linb([src],false),first=profile.root.nextFocus(true,true,false),last=profile.root.nextFocus(false,true,false);switch(key){case'tab':if(shift){if(src!=first.get(0)){first.focus();return false}}else{if(src!=last.get(0)){last.focus();return false}}break;case'left':var next=cur.nextFocus(false,true,false);if(cur.get(0)==first.get(0))last.focus();else cur.nextFocus(false);return false;break;case'right':var next=cur.nextFocus(true,false,false);if(cur.get(0)==last.get(0))first.focus();else cur.nextFocus();return false;break;case'up':case'down':var count=1,temp=cur.parent().get(0);var max=temp.parentNode.childNodes.length;while(temp=temp.previousSibling)count++;temp=cur.parent(2).get(0);if(!profile.$allrowscache){var all=[];all.push(profile.getSubNode(profile.keys.HCELLS).get(0));all.insert(profile.getSubNode(profile.keys.CELLS,true).get(),-1);all.filter(function(o){return!!o.offsetWidth});profile.$allrowscache=all}var index=profile.$allrowscache.indexOf(temp);var rowLen=profile.$allrowscache.length;if(key=='up'){index--;if(index==-1){index=rowLen-1;count--;if(count==0)count=max}}else{index++;if(index==rowLen){index=0;count++;if(count==max+1)count=1}}node=linb(profile.$allrowscache[index]).first().next(count-1).first();if(!node.isEmpty())node.focus();return false;break}};this.setBehavior('default',b)},Static:{Templates:{'default':{tagName:'div',style:'{left}{top}{width}{height}{right}{bottom}{zIndex}{position}',BORDER:{tagName:'div',BOX:{tagName:'div',HEADER:{$order:0,tagName:'div',HCELLS:{tagName:'div',style:'height:{headerHeight}px;',HCELL0:{$order:0,tagName:'span',style:'{tdfDisplay};width:{rowHandlerWidth}px;',HCELL0A:{tagName:'a',href:"javascript:;",tabindex:'{tabindex}',HCELLHANDLER:{tagName:'div',style:'{thhandlerDisplay}'},ROWHANDLER:{tagName:'div',style:'{tdfhandlerDisplay}'}}},OTHERHCELLS:{$order:1,tagName:'text',text:'{header}'}}},SCROLL:{$order:1,tagName:'div',BODY:{tagName:'div',text:'{rows}'}},FOOTER:{$order:2}}},$dynamic:{header:{HCELL:{tagName:'span',style:"width:{width}px",HCELLA:{tagName:'a',href:"javascript:;",tabindex:'{_tabindex}',text:"{caption}",SORT:{style:'{sortDisplay}'},HCELLHANDLER:{$order:2,tagName:'div',style:'{thhandlerDisplay}'}}}},rows:{ROW:{tagName:'div',className:'{cls}',CELLS:{tagName:'div',style:'height:{rowHeight}px;',CELL0:{$order:0,tagName:'span',style:'{tdfDisplay};width:{rowHandlerWidth}px;',CELL0A:{tagName:'a',href:"javascript:;",tabindex:'{_tabindex}',MARK:{style:'{display}'},ROWHANDLER:{tagName:'div',style:'{tdfhandlerDisplay}'}}},OTHERCELLS:{tagName:'text',$order:1,text:'{cells}'}},SUB:{$order:1,tagName:'div'}}},'rows.cells':function(profile,template,v,tag,result){if(v.type=='checkbox')var t=tag+'.'+'checkbox';else var t=tag+'.'+'input';linb.UI.$doTemplate(profile,template,v,t,result)},'rows.cells.input':{CELL:{style:'width:{width}px;',className:'{cellCls}',CELLA:{tagName:'a',href:"javascript:;",tabindex:'{_tabindex}',text:"{caption}"}}},'rows.cells.checkbox':{CELL:{style:'width:{width}px;',className:'{cellCls}',CELLA:{tagName:'a',href:"javascript:;",tabindex:'{_tabindex}',CHECKBOX:{className:'{checkboxCls}'}}}},MARK:{}}}},Appearances:{'default':{KEY:{display:'block',position:'absolute'},BOX:{display:'block',position:'relative',overflow:'hidden'},HEADER:{position:'absolute',left:'0',top:'0'},SCROLL:{position:'absolute',left:'0',overflow:'auto'},BODY:{position:'absolute',display:'block',left:'0',top:'0',overflow:'visible'},'SORT, SORT-checked':{width:'15px',height:'15px',position:'absolute',right:'0px',bottom:'0px'},SORT:{background:linb.UI.getCSSImgPara('cmds.gif',' no-repeat -191px top',null,'linb.UI.Public')},'HCELL-mouseover SORT':{$order:1,'background-position':'-191px -15px'},'HCELL-mousedown SORT':{$order:2,'background-position':'-191px -30px'},'SORT-checked':{$order:3,'background-position':'-206px top'},'HCELL-mouseover SORT-checked':{$order:4,'background-position':'-206px -15px'},'HCELL-mousedown SORT-checked':{$order:5,'background-position':'-206px -30px'},HCELLHANDLER:{position:'absolute',width:'4px',top:'0px',height:'100%',right:'0px',cursor:'e-resize','font-size':'0','line-height':'0',background:linb.UI.getCSSImgPara('handler.v.gif')},'HCELLS, CELLS':{'overflow-y':linb.browser.ie6?'hidden':'',position:linb.browser.ie6||linb.browser.opr?'relative':null,'white-space':'nowrap','padding-bottom':'2px','font-size':'0','line-height':'0',display:'block'},'CELLS-mouseover CELL':{$order:4,'background-color':'#d9e8fb'},'CELLS-active CELL, CELL-active':{$order:5,'background-color':'#316AC5'},'CELLS-active CELLA, CELL-active CELLA':{$order:5,color:'white'},'HCELL0, CELL0':{'background-color':'#d4d0c8',height:'100%',border:'1px solid','border-color':'#fff #ACA899 #ACA899 #fff',padding:'0'},'HCELL0A, CELL0A':{'-moz-box-flex':linb.browser.gek?'1':'',display:'block',position:'relative',overflow:'hidden',height:'100%','font-weight':'bold','font-size':'12px','line-height':'20px'},CELL0A:{'text-align':'left'},' TDFCAPTION':{'font-weight':'bold'},ROWHANDLER:{position:'absolute','height':'4px',left:'0px',width:'100%',bottom:'0px',cursor:'n-resize',background:linb.UI.getCSSImgPara('handler.h.gif'),'font-size':'0','line-height':'0'},HCELL:{'background-color':' #d4d0c8',height:'100%',border:'1px solid','border-color':'#fff #ACA899 #ACA899 #fff',padding:'0'},ROW:{'_position':'relative','font-size':'0','line-height':'0','background-color':' #fff'},CELL:{'padding-top':'1px','padding-left':'1px','border-bottom':'1px solid #ACA899','border-right':'1px solid #ACA899',height:'100%',overflow:linb.browser.ie6?'hidden':''},'ALT > CELLS':{'background-color':'#f1f1f1'},'CELL-label':{'background-color':'#F3F3F3'},'CELL-input':{},'CELL-number':{'text-align':'right'},'CELL-checkbox':{'text-align':'center'},HCELLA:{position:'relative'},'HCELLA, CELLA':{display:'block',overflow:'hidden','-moz-box-flex':linb.browser.gek?'1':'',height:'100%',width:linb.browser.ie?'100%':'','font-size':'12px','line-height':'20px'},'HCELLA, HCELL0A':{'text-align':'center','font-weight':'bold'},'CHECKBOX':{cursor:'pointer',width:'16px',height:'16px',background:linb.UI.getCSSImgPara('cmds.gif',' no-repeat -112px top',null,'linb.UI.Public')},'CELL-mouseover CHECKBOX':{$order:1,'background-position':'-112px -17px'},'CELL-mousedown CHECKBOX':{$order:2,'background-position':'-112px -34px'},'CHECKBOX-checked':{$order:3,'background-position':'-96px top'},'CELL-mouseover CHECKBOX-checked':{$order:4,'background-position':'-96px -17px'},'CELL-mousedown CHECKBOX-checked':{$order:5,'background-position':'-96px -34px'},SUB:{'_zoom':'1','_position':'relative','margin-left':'16px','font-size':'12px','line-height':'20px',overflow:'hidden',display:'none'},MARK:{width:'16px',height:'16px',background:linb.UI.getCSSImgPara('cmds.gif',' no-repeat -161px top',null,'linb.UI.Public')},'CELL0-mouseover MARK':{$order:1,'background-position':'-161px -15px'},'CELL0-mousedown MARK':{$order:2,'background-position':'-161px -30px'},'MARK-checked':{$order:3,width:'16px',height:'16px','background-position':'-176px top'},'CELL0-mouseover MARK-checked':{$order:4,'background-position':'-176px -15px'},'CELL0-mousedown MARK-checked':{$order:5,'background-position':'-176px -30px'},'CELLS-dragover':{'border-top':'solid 2px #ff6600'},'HCELL-dragover':{$order:3,'border-left':'solid 2px #ff6600'}}},Behaviors:{'default':{_hoverEffect:{CELLS:'CELLS',CELL:'CELL',CELL0:'CELL0',HCELL:'HCELL'},_clickEffect:{CELL:'CELL',CELL0:'CELL0',HCELL:'HCELL'},onResize:function(profile,e,src){var o=profile.root;profile.box.resize(profile,e.width?o.width():null,o.height?o.height():null)},SCROLL:{onScroll:function(profile,e,src){var pos=linb(src).scrollLeft();if(profile.oldPos!=pos){profile.getSubNode(profile.keys.HEADER).left(-pos);profile.oldPos=pos}}},HCELLHANDLER:{onMousedown:function(profile,e,src){var p=profile.properties,o=linb(src),minW=o.parent(2).width()-p.minColW,scroll=profile.getSubNode(profile.keys.SCROLL),maxW=scroll.absPos().left+scroll.width()-linb.event.getPos(e).left-4,id=profile.getSubSerialId(src.id),col=profile.header_SerialIdMapItem[id];if(p.disabled)return false;if(col&&col.disabled)return false;o.startDrag(e,{horizontal:true,type:'blank',offset_left:minW,offset_right:maxW,move:false})},onDragbegin:function(profile,e,src){linb.dragDrop.proxyIn.setStyle({height:profile.getSubNode(profile.key).height()+'px',width:'4px',backgroundColor:'#ddd',cursor:'e-resize'})},onDrag:function(profile,e,src){var d=linb.dragDrop,b=0;if(d.left<=d.limit_left||d.left>=d.limit_right)b=true;if(b){if(!profile._limited){linb.dragDrop.proxyIn.setStyle('backgroundColor','#ff6600');profile._limited=true}}else{if(profile._limited){linb.dragDrop.proxyIn.setStyle('backgroundColor','#ddd');profile._limited=0}}},onDragend:function(profile,e,src){var o=linb(src).parent(2),w=o.width()+linb.dragDrop.getOffset().width;o.width(w);var ids=[],ws=[];if(src.parentNode.id.startWith(profile.keys.HCELL0A)){var map=profile.row_SerialIdMapItem,p=profile.properties;_.each(profile.row_ItemIdMapSerialId,function(v){ids.push(profile.getSubNodeId(profile.keys.CELL0,v));ws.push(w-map[v]._layer*p.$subMargin)});ids.each(function(o,i){linb(o).width(ws[i])})}else{var cells=profile.header_SerialIdMapItem[profile.getSubSerialId(src.id)]._cells;_.each(cells,function(o){ids.push(profile.getSubNodeId(profile.keys.CELL,o))});linb(ids).width(w)}profile.getSubNode(profile.keys.SCROLL).onScroll();profile._limited=0}},ROWHANDLER:{onMousedown:function(profile,e,src){var p=profile.properties,row=profile.row_SerialIdMapItem[profile.getSubSerialId(src.id)],o=linb(src),minH=o.parent(3).height()-p.minRowH,scroll=profile.getSubNode(profile.keys.SCROLL),maxH=scroll.absPos().top+scroll.height()-linb.event.getPos(e).top-4;if(p.disabled||(row&&row.disabled))return false;o.startDrag(e,{vertical:true,type:'blank',offset_top:minH,offset_bottom:maxH,move:false})},onDragbegin:function(profile,e,src){linb.dragDrop.proxyIn.setStyle({width:profile.getSubNode(profile.key).width()+'px',height:'4px',backgroundColor:'#ddd',cursor:'n-resize'})},onDrag:function(profile,e,src){var d=linb.dragDrop,b=0;if(d.top<=d.limit_top||d.top>=d.limit_bottom)b=true;if(b){if(!profile._limited){linb.dragDrop.proxyIn.setStyle('backgroundColor','#ff6600');profile._limited=true}}else{if(profile._limited){linb.dragDrop.proxyIn.setStyle('backgroundColor','#ddd');profile._limited=0}}},onDragend:function(profile,e,src){var o=linb(src).parent(3),h=o.height()+linb.dragDrop.getOffset().height;if(linb.browser.ie&&h%2==1)h+=1;o.height(h);if(src.parentNode.id.startWith(profile.keys.HCELL0A)){profile.box.resize(profile,null,profile.getSubNode(profile.keys.KEY).height())}profile._limited=0}},MARK:{onClick:function(profile,e,src){var p=profile.properties,row=profile.row_SerialIdMapItem[profile.getSubSerialId(src.id)];if(p.disabled||row.disabled)return false;if(!row.sub)return false;profile.box.setSub(profile,row);return false}},HCELL0:{onClick:function(profile,e,src){linb(src).first().focus();return false}},HCELL:{onClick:function(profile,e,src){var p=profile.properties,id=profile.getSubSerialId(src.id),col=profile.header_SerialIdMapItem[id];linb(src).first().focus();if(!p.colSortable||false===col.colSortable)return false;if(p.disabled||col.disabled)return false;var order=col._order||false,type=col.type||'input',index=p.header.indexOf(col),me=arguments.callee,fun=me.fun||(me.fun=function(profile,root,index,type,order){var rows,parent,self=arguments.callee;if(root){rows=root.sub;parent=profile.getSubNode(profile.keys.SUB,root._serialId).get(0)}else{root={_created:true};rows=profile.properties.rows;parent=profile.getSubNode(profile.keys.BODY).get(0)}var a1=[],a2=[],a3=[],a4=[];rows.each(function(row){if(row.sub&&row.sub.length>1)self(profile,row,index,type,order);a1[a1.length]=row.cells[index].value;a2[a2.length]=a2.length});switch(type){case'number':a2.sort(!order?function(x,y){x=parseFloat(a1[x])||0;y=parseFloat(a1[y])||0;return x>y?1:x==y?0:-1}:function(x,y){x=parseFloat(a1[x])||0;y=parseFloat(a1[y])||0;return x<y?1:x==y?0:-1});break;case'date':a2.sort(!order?function(x,y){x=Date.parse(new Date(a1[x]));y=Date.parse(new Date(a1[y]));return x>y?1:x==y?0:-1}:function(x,y){x=Date.parse(new Date(a1[x]));y=Date.parse(new Date(a1[y]));return x<y?1:x==y?0:-1});break;default:a2.sort(!order?function(x,y){x=a1[x];y=a1[y];return x>y?1:x==y?0:-1}:function(x,y){x=a1[x];y=a1[y];return x<y?1:x==y?0:-1})}var b=root._created,bak=_.copy(rows),c;if(b)a1=parent.childNodes;a2.each(function(o,i){rows[i]=bak[o];if(b)a3[i]=a1[o]});if(b){a3.each(function(o,i){parent.appendChild(o);if(i%2)a4[a4.length]=o});if(profile.properties.altRowsBg){var altCls=profile.getClass(profile.keys.ALT);linb(a3,false).removeClass(altCls);linb(a4,false).addClass(altCls)}}});fun(profile,'',index,type,order);profile.getSubNode(profile.keys.SORT,true).display('none');var node=profile.getSubNode(profile.keys.SORT,col._serialId).display('block');if(col._order=!col._order)profile.addTagClass(node,profile.keys.SORT,'-checked');else profile.removeTagClass(node,profile.keys.SORT,'-checked');delete profile.$allrowscache;return false},onMousedown:function(profile,e,src){if(!profile.properties.colDragable||false===profile.header_SerialIdMapItem[profile.getSubSerialId(src.id)].colDragable)return;if(false===profile.boxing().beforeColumnDrag(profile,profile.getSubSerialId(src.id)))return;var pos=linb.event.getPos(e),o=linb([src],false),itemId=profile.getSubSerialId(src.id);o.startDrag(e,{drop2:true,type:'copy',cursor:'pointer',target_clone:true,target_left:pos.left+12,target_top:pos.top+12,move:false,defer:1,key:(profile.properties.colDragKey||profile.$id)+":col",data:o.id()})},onDragbegin:function(profile,e,src){linb(src).onMouseout(true,{$force:true}).onMouseup(true)},beforeMouseover:function(profile,e,src){if(false===profile.box._colDragCheck(profile,src))return;linb.dragDrop._current=this;profile.addTagClass(linb(src),profile.keys.HCELL,'-dragover')},beforeMouseout:function(profile,e,src){if(false===profile.box._colDragCheck(profile,src))return;linb.dragDrop._current=null;profile.removeTagClass(linb(src),profile.keys.HCELL,'-dragover')},onDrop:function(profile,e,src){if(false===profile.box._colDragCheck(profile,src))return;var p=profile.properties,fromId=linb.dragDrop.data&&profile.getSubSerialId(linb.dragDrop.data),toId=profile.getSubSerialId(src.id);if(false===profile.boxing().beforeColumnMoved(profile,fromId,toId))return;profile.removeTagClass(linb(src),profile.keys.HCELL,'-dragover');var fromIndex=p.header.subIndexOf('_serialId',fromId),toIndex=p.header.subIndexOf('_serialId',toId);if(fromIndex===toIndex||fromIndex===toIndex-1)return;var map=profile.header_SerialIdMapItem,fromTh=map[fromId],toTh=map[toId];profile.getSubNode(profile.keys.HCELL,toId).addPre(linb.dragDrop.data);_.each(toTh._cells,function(o,i){profile.getSubNode(profile.keys.CELL,o).addPre(profile.getSubNode(profile.keys.CELL,fromTh._cells[i]))});var temp=p.header[fromIndex];p.header.remove(fromIndex);p.header.insert(temp,toIndex);var allitems=profile.itemsSearch(p.rows,true,true);allitems.each(function(o){temp=o.cells[fromIndex];o.cells.remove(fromIndex);o.cells.insert(temp,toIndex)});profile.boxing().afterColumnMoved(profile,fromId,toId);delete profile.$allrowscache}},CELL0:{onClick:function(profile,e,src){var p=profile.properties,serialId=profile.getSubSerialId(src.id),row=profile.row_SerialIdMapItem[serialId];if(p.disabled||row.disabled)return false;if(row.sub)profile.getSubNode(profile.keys.MARK,serialId).onClick(true);linb(src).first().focus();return false},onMousedown:function(profile,e,src){var p=profile.properties,fromId=profile.getSubSerialId(src.id),row=profile.row_SerialIdMapItem[fromId],_layer=row._layer;if(p.disabled||row.disabled)return false;if(!p.rowDragable||row.rowDragable===false)return;if(false===profile.boxing().beforeRowDrag(profile,row))return;var pos=linb.event.getPos(e),o=linb([src],false).parent(2);linb([src],false).startDrag(e,{drop2:true,type:'copy',cursor:'pointer',target_clone:true,target_left:pos.left+12,target_top:pos.top+12,move:false,defer:1,key:(p.rowDragKey||profile.$id)+":row"+(p.rowDragToAny?'':(':'+_layer)),data:o.id()})},onDragbegin:function(profile,e,src){linb(src).onMouseout(true,{$force:true}).onMouseup(true)},beforeMouseover:function(profile,e,src){if(false===profile.box._rowDragCheck(profile,src))return;linb.dragDrop._current=this;linb.dragDrop.showDDMark(src)},beforeMouseout:function(profile,e,src){if(false===profile.box._rowDragCheck(profile,src))return;linb.dragDrop._current=null;linb.dragDrop.showDDMark(null)},onDrop:function(profile,e,src){if(false===profile.box._rowDragCheck(profile,src))return;linb.dragDrop.showDDMark(null);profile.box._rowDrop(profile,src,true);return false}},CELL0A:{onFocus:function(profile,e,src){if(profile.properties.activeMode=='row'){var src=profile.getSubNode(profile.keys.CELLS,profile.getSubSerialId(src.id)).get(0);if(profile.$activeRow==src.id)return true;profile.box.activeRow(profile,src.id)}}},CELLS:{beforeMouseover:function(profile,e,src){if(false===profile.box._rowDragCheck(profile,src))return;linb.dragDrop._current=this;profile.addTagClass(linb(src),profile.keys.CELLS,'-dragover')},beforeMouseout:function(profile,e,src){if(false===profile.box._rowDragCheck(profile,src))return;linb.dragDrop._current=null;profile.removeTagClass(linb(src),profile.keys.CELLS,'-dragover')},onDrop:function(profile,e,src){if(false===profile.box._rowDragCheck(profile,src))return;profile.removeTagClass(linb(src),profile.keys.CELLS,'-dragover');profile.box._rowDrop(profile,src);return false},onClick:function(profile,e,src){var p=profile.properties,serialId=profile.getSubSerialId(src.id),row=profile.row_SerialIdMapItem[serialId];if(p.disabled||row.disabled)return false;profile.box.activeRow(profile,src.id);return false},onDblclick:function(profile,e,src){var p=profile.properties,serialId=profile.getSubSerialId(src.id),row=profile.row_SerialIdMapItem[serialId];if(p.disabled||row.disabled)return false;if(profile.onDblClickRow)profile.boxing().onDblClickRow(row,e,src);return false}},CELL:{onClick:function(profile,e,src){var cell=profile.cells_SerialIdMapItem[profile.getSubSerialId(src.id)],box=profile.box;linb(src).first().focus();if(box.getCellPro(profile,cell,'disabled'))return false;if(box.getCellPro(profile,cell,'editable'))if(box.getCellPro(profile,cell,'type')=='checkbox')box.changeCellValue(profile,cell,!cell.value);return false}},CELLA:{onFocus:function(profile,e,src){var p=profile.properties,box=profile.box,cell=profile.cells_SerialIdMapItem[profile.getSubSerialId(src.id)],mode=p.activeMode,id;if(mode=='cell'){if(box.getCellPro(profile,cell,'disabled'))return false;id=linb(src).parent().id();box.activeCell(profile,id)}else if(mode=='row'){if(p.disabled||cell._row.disabled)return false;id=linb(src).parent(2).id();box.activeRow(profile,id)}if(box.getCellPro(profile,cell,'editable'))box.editCell(profile,cell._serialId)}}}},DataModel:{listKey:null,zIndex:null,tabindex:{action:function(value){if(this.domNode)this.root.dig('A').tabIndex(value)}},dock:'fill',rowDragKey:'',rowDragToAny:true,colDragKey:'',altRowsBg:{ini:true,action:function(value){if(this.domNode){}}},editable:true,$subMargin:16,iniFold:true,left:0,top:0,position:'absolute',width:300,height:200,minColW:5,minRowH:20,rowHandlerWidth:20,headerHeight:{ini:20,action:function(v){this.getSubNode(this.keys.HCELLS).height(v);this.box.resize(this,this.root.width(),this.root.height())}},rowHeight:{ini:20,action:function(v){this.getSubNode(this.keys.CELLS,true).height(v)}},cellDfWidth:80,colResizer:{ini:true,action:function(value){this.getSubNode(this.keys.HCELLHANDLER,true).display(value?'':'none')}},rowHandler:{ini:true,action:function(value){this.getSubNode(this.keys.HCELL0).display(value?'':'none');this.getSubNode(this.keys.CELL0,true).display(value?'':'none')}},rowResizer:{ini:true,action:function(value){this.getSubNode(this.keys.ROWHANDLER,true).display(value?'':'none')}},colSortable:{ini:true,action:function(value){this.getSubNode(this.keys.SORT,true).display('none')}},header:{ini:{},set:function(v){return this.each(function(o){if(o.domNode){o.boxing().refreshHeader(v)}else o.properties.header=v})}},rows:{ini:{},set:function(v){return this.each(function(o){if(o.domNode)o.boxing().removeAllRows().insertRows(v);else o.properties.rows=v})}},colDragable:true,rowDragable:true,activeMode:{ini:'row',listbox:['row','cell'],action:function(value){if(this.domNode){var profile=this;if(profile.$activeCell)profile.removeTagClass(linb(profile.$activeCell),profile.keys.CELL,'-active');if(profile.$activeRow)profile.removeTagClass(linb(profile.$activeRow),profile.keys.CELLS,'-active')}}}},EventHandlers:{onRequestData:function(profile,id,threadid){},beforeColumnSort:function(profile,id,order){},afterColumnSort:function(profile,id,order){},beforeRowDrag:function(profile,id){},beforeRowMoved:function(profile,fromId,toId){},afterRowMoved:function(profile,fromId,toId){},beforeColumnDrag:function(profile,id){},beforeColumnMoved:function(profile,fromId,toId){},afterColumnMoved:function(profile,fromId,toId){},beforeRowActive:function(profile,row){},afterRowActive:function(profile,row){},beforeCellActive:function(profile,cell){},afterCellActive:function(profile,cell){},onDblClickRow:function(row,e,src){}},createdTrigger:function(){if(!this.properties.iniFold)this.boxing().openRows(this.properties.rows,true)},iniProfile:function(){this.$cache_editor={}},beforeSerialized:function(profile){var t,o=profile.copy();o.properties=_.copy(profile.properties);o.properties.header=linb.UI.pickObj(profile.properties.header);o.properties.rows=linb.UI.pickObj(profile.properties.rows);return o},_clsCache:{},_resetRowHandler:function(profile,row,baseW,subMargin,_layer){var self=arguments.callee,w=baseW-_layer*subMargin;row._layer=_layer;profile.getSubNode(profile.keys.CELL0,row._serialId).width(w);if(row.sub){++_layer;_.each(row.sub,function(r){self(profile,r,baseW,subMargin,_layer)})}},_colDragCheck:function(profile,src){var dd=linb.dragDrop,key=dd.dragKey,data=dd.data;if(!key||!data)return false;var dkey=(profile.properties.colDragKey||profile.$id)+":col";if(key!=dkey)return false;if(profile.getKey(data)!=profile.keys.HCELL)return false;var fromId=linb.dragDrop.data&&profile.getSubSerialId(data),toId=profile.getSubSerialId(src.id);if(fromId==toId)return},_rowDragCheck:function(profile,src){var dd=linb.dragDrop,key=dd.dragKey,data=dd.data;if(!key||!data)return false;var dkey=(profile.properties.rowDragKey||profile.$id)+":row"+(profile.properties.rowDragToAny?'':(':'+_layer));if(key!=dkey)return false;if(profile.getKey(data)!=profile.keys.ROW)return false;var fromId=linb.dragDrop.data&&profile.getSubSerialId(data),toId=profile.getSubSerialId(src.id),toRow=profile.row_SerialIdMapItem[toId],_layer=toRow._layer;if(fromId==toId)return false;var node=src,target=linb.dom.byId(data);do{if(node==target)return false}while((node&&(node=node.parentNode)&&node!=profile.domNode))},_rowDrop:function(profile,src,flag){var map=profile.row_SerialIdMapItem,fromId=linb.dragDrop.data&&profile.getSubSerialId(linb.dragDrop.data),fromRow=map[fromId],toId=profile.getSubSerialId(src.id),toRow=map[toId],_layer=flag?toRow._layer+1:toRow._layer;if(false===profile.boxing().beforeRowMoved(profile,fromId,toId,flag))return;var toParentId,toParent,toIndex,fromParentId=fromRow._parent,fromParent=fromParentId?map[fromParentId].sub:profile.properties.rows,fromIndex=fromParent.subIndexOf('_serialId',fromId);if(flag){toParentId=toRow._serialId,toParent;if(toRow.sub)toParent=toRow.sub;else{toParent=toRow.sub=[];profile.getSubNode(profile.keys.MARK,toRow._serialId).display('block')}toIndex=-1}else{toParentId=toRow._parent;toParent=toParentId?map[toParentId].sub:profile.properties.rows;toIndex=toParent.subIndexOf('_serialId',toId)}if(toParentId==fromParentId&&(toIndex==fromIndex||toIndex==fromIndex+1))return;if(flag&&!toRow._created){profile.box.setSub(profile,toRow,true);toRow._created=true}if(profile.properties.rowHandler){if(toParentId!==fromParentId){fromRow._parent=toParentId;profile.box._resetRowHandler(profile,fromRow,profile.getSubNode(profile.keys.HCELL0).width(),profile.properties.$subMargin,_layer||0)}}fromParent.remove(fromIndex);toParent.insert(fromRow,toIndex);if(flag)profile.getSubNode(profile.keys.SUB,toId).addLast(linb.dragDrop.data);else profile.getSubNode(profile.keys.ROW,toId).addPre(linb.dragDrop.data);profile.boxing().afterRowMoved(profile,fromId,toId,flag);delete profile.$allrowscache},prepareData:function(profile){profile.row_ItemIdMapSerialId={};profile.row_SerialIdMapItem={};profile.cells_SerialIdMapItem={};var data=profile.data,pro=profile.properties;data.thhandlerDisplay=pro.colResizer?'':'display:none';data.tdfhandlerDisplay=pro.rowResizer?'':'display:none';data.tdfDisplay=pro.rowHandler?'':'display:none';if(pro.header&&pro.header.constructor!=Array)pro.header=_.clone([{id:'col1',caption:'col1',type:'input',width:50},{id:'col2',caption:'col2',type:'input',width:80}]);if(pro.rows&&pro.rows.constructor!=Array)pro.rows=_.clone([{id:'row1',cells:['cell11','cell12']},{id:'row2',cells:[{value:'cell21',type:'label'},'cell22'],sub:[{id:'row21',cells:['cell31',{value:'cell32',type:'number'}]}]}]);data.header=this.prepareHeader(profile,pro.header);arguments.callee.upper.call(this,profile);data.rows=this.prepareItems(profile,pro.rows)},prepareHeader:function(profile,arr){var a=profile.header_ItemIdMapSerialId={},b=profile.header_SerialIdMapItem={},SubID=linb.UI.subSerialIdTag,pro=profile.properties,header=[],temp,t;arr.each(function(o,i){temp=profile.pickSubId('header');o._cells={};o[SubID]=temp;b[temp]=o;t={width:o.width||pro.cellDfWidth,sortDisplay:'display:none',tdfDisplay:pro.rowHandler?'':'display:none'};t[SubID]=temp;t._tabindex=pro.tabindex;t.thhandlerDisplay=pro.colResizer?'':'display:none';linb.UI.copyItem(o,t);a[o.id]=temp;header.push(t)});return header},prepareItems:function(profile,arr,pid){var pro=profile.properties,a=profile.row_ItemIdMapSerialId,b=profile.row_SerialIdMapItem,d=profile.cells_SerialIdMapItem,_layer=pid?b[pid]?(b[pid]._layer+1):0:0,SubID=linb.UI.subSerialIdTag,getPro=profile.box.getCellPro,self=arguments.callee,rows=[],altCls=profile.getClass(profile.keys.ALT),temp,cells,t,row,listKey,headCell,n,render;for(var i=0,l=arr.length;i<l;i++){temp=profile.pickSubId('row');row=arr[i];row._parent=pid;row._cells={};row._layer=_layer;row[SubID]=temp;row._tabindex=pro.tabindex;b[temp]=row;t={id:row.id};t.rowHeight=pro.rowHeight;t.rowHandlerWidth=pro.rowHandlerWidth;t.tdfDisplay=pro.rowHandler?'':'display:none';t.tdfhandlerDisplay=pro.rowResizer?'':'display:none';if(pro.altRowsBg)t.cls=i%2?altCls:'';cells=t.cells=[];t[SubID]=temp;t.display=row.sub?'':'display:none';a[row.id]=temp;row.cells.each(function(g,j){headCell=pro.header[j];n={width:headCell.width};if(typeof g=='object')linb.UI.copyItem(g,n);else{n.value=g;g=row.cells[j]={value:g}}g._row=row;g._header=headCell;n.type=getPro(profile,g,'type')||'input';render=getPro(profile,g,'render');n.caption=render?render(n.value):n.value;g[SubID]=n[SubID]=profile.pickSubId('cell');n.cellCls=this._clsCache[n.type]||(this._clsCache[n.type]=profile.getClass(profile.keys.CELL,'-'+n.type));switch(n.type){case'checkbox':n.checkboxCls=this._clsCache[n.type+':'+n.value]||(this._clsCache[n.type+':'+n.value]=profile.getClass(profile.keys.CHECKBOX,n.value?'-checked':''));break}n._tabindex=pro.tabindex;cells.push(n);d[n[SubID]]=g;row._cells[headCell.id]=n[SubID];headCell._cells[row.id]=n[SubID]},this);linb.UI.copyItem(row,t);rows.push(t)}return rows},setSub:function(profile,item,flag){var id=profile.domId,key1=profile.keys.MARK,key2=profile.keys.SUB,serialId=profile.row_ItemIdMapSerialId[item.id],markNode=profile.getSubNode(key1,serialId),subNode=profile.getSubNode(key2,serialId);if(linb.thread.exists(profile.key+profile.id))return;if(item._checked){var h=subNode.height();subNode.fx({'height':[h,0]},function(){subNode.height(h)},function(){subNode.display('none').height('auto')},200,8,'inexp',profile.key+profile.id).start();profile.removeTagClass(markNode,key1,'-checked');item._checked=false}else{var openSub=function(profile,item,id,markNode,subNode,sub,flag){var p=profile.properties;if(!item._created){delete item.sub;item._created=true;subNode.display('none');profile.boxing().insertRows(sub,item.id)}if(!flag){var h=subNode.height(true);subNode.fx({'height':[0,h]},function(){subNode.setStyle({height:'0px',display:'block'})},function(){subNode.setStyle({height:'auto'})},200,8,'outexp',profile.key+profile.id).start()}else subNode.display('block');if(p.rowHandler){var w1=profile.getSubNode(profile.keys.HCELL0).width(),w2=(item._layer+2)*p.$subMargin;if(w1<w2){profile.getSubNode(profile.keys.HCELL0).width(w2);profile.getSubNode(profile.keys.CELL0,true).widthBy(w2-w1)}}profile.addTagClass(markNode,key1,'-checked').addTagClass(markNode,key1,'-mouseover');item._checked=true};var sub=item.sub;if(sub&&sub.length){openSub(profile,item,id,markNode,subNode,sub,flag);if(flag){sub.each(function(o){if(o.sub&&o.sub.length&&!o.iniFold&&!o._checked)profile.box.setSub(profile,o,true)})}}else{linb.thread(null,[function(threadId){if(profile.onRequestData)profile.boxing().onRequestData(profile,item.id,threadId);else linb.thread(threadId).abort()},function(threadId){sub=linb.thread(threadId).getCache('response');if(sub){openSub(profile,item,id,markNode,subNode,sub,flag);openSub=null}}],null,null,function(threadId){profile.addTagClass(markNode,key1,'-busy');linb(id).busy(false)},function(){profile.removeTagClass(markNode,key1,'-busy');linb(id).free()}).start()}}delete profile.$allrowscache},getCellId:function(profile,rowId,colId){var rowItemId=profile.row_ItemIdMapSerialId[rowId],row=profile.row_SerialIdMapItem[rowItemId];return row&&row._cells&&row._cells[colId]},changeCellValue:function(profile,cellId,value){var cell;if(typeof cellId=='string')cell=profile.cells_SerialIdMapItem[cellId];else{cell=cellId;cellId=cell._serialId}if(!cell)return;var type=profile.box.getCellPro(profile,cell,'type')||'input',render=profile.box.getCellPro(profile,cell,'render');if(cell.value!=value){if(false===profile.boxing().beforeValueUpdated(profile,cell,cell.value,value))return;switch(type){case'checkbox':if(value)profile.addTagClass(profile.getSubNode(profile.keys.CHECKBOX,cellId),profile.keys.CHECKBOX,'-checked');else profile.removeTagClass(profile.getSubNode(profile.keys.CHECKBOX,cellId),profile.keys.CHECKBOX,'-checked');break;case'number':value=parseFloat(value);case'listbox':case'timepicker':case'datepicker':case'colorpicker':default:profile.getSubNode(profile.keys.CELLA,cellId).text(render?render(value):value)}cell.value=value;profile.boxing().afterValueUpdated(profile,cell,cell.value,value)}},activeCell:function(profile,id){if(profile.properties.activeMode!='cell')return;var targetId=profile.getSubSerialId(id),map=profile.cells_SerialIdMapItem,targetCell=map[targetId];if(false===profile.boxing().beforeCellActive(profile,targetCell))return;if(profile.$activeCell)profile.removeTagClass(linb(profile.$activeCell),profile.keys.CELL,'-active');profile.addTagClass(linb(id),profile.keys.CELL,'-active');profile.$activeCell=id;profile.boxing().afterCellActive(profile,targetCell)},activeRow:function(profile,id){if(profile.properties.activeMode!='row')return;var targetId=profile.getSubSerialId(id),map=profile.row_SerialIdMapItem,targetRow=map[targetId];if(false===profile.boxing().beforeRowActive(profile,targetRow))return;if(profile.$activeRow)profile.removeTagClass(linb(profile.$activeRow),profile.keys.CELLS,'-active');profile.addTagClass(linb(id),profile.keys.CELLS,'-active');profile.$activeRow=id;profile.boxing().afterRowActive(profile,targetRow)},getCellPro:function(profile,cell,key){return cell[key]||cell._row[key]||cell._header[key]||profile.properties[key]},editCellbyRowCol:function(profile,rowId,colId){return this.editCell(profile,this.getCellId(profile,rowId,colId))},editCell:function(profile,cellId){var cell=typeof cellId=='string'?profile.cells_SerialIdMapItem[cellId]:cellId;if(!cell)return;var grid=this;var cellNode=profile.getSubNode(profile.keys.CELL,cellId),baseNode=profile.getSubNode(profile.keys.SCROLL),absPos=cellNode.absPos(null,baseNode),size=cellNode.cssSize(),type=profile.box.getCellPro(profile,cell,'type')||'input',format=profile.box.getCellPro(profile,cell,'format'),widget,t;if(type=='checkbox'){cellNode.first().focus();return}if(profile.$cache_editor[type]){widget=profile.$cache_editor[type]}else{switch(type.split(':')[0]){case'label':return;break;case'number':case'input':case'textarea':linb.SC('linb.UI.Input');break;case'checkbox':break;case'listbox':case'combobox':case'popbox':case'getter':case'helpinput':case'cmdbox':case'popbox':case'timepicker':case'datepicker':case'colorpicker':linb.SC('linb.UI.ComboInput');break;case'button':linb.SC('linb.UI.Button');break;default:}switch(type.split(':')[0]){case'label':return;break;case'number':case'input':widget=linb.create('Input');break;case'textarea':widget=linb.create('Input',{inputArea:'textarea'});break;case'listbox':case'combobox':case'helpinput':case'timepicker':case'datepicker':case'colorpicker':widget=new linb.UI.ComboInput;widget.setType(type);widget.create();break;case'getter':case'popbox':case'cmdbox':case'popbox':widget=new linb.UI.ComboInput;widget.setType(type).onCustomPop(function(pro){var cell=pro.$cell;if(typeof cell.event=='function')cell.event.call(profile._host||profile,profile,cell,pro)});widget.create();break;case'checkbox':break;case'button':widget=linb.create('Button',{caption:'...'},{onClick:function(pro){var cell=pro.$cell;if(typeof cell.event=='function')cell.event.call(profile._host||profile,profile,cell,pro)}});break;default:}widget.reBoxing().setStyle({position:'absolute',display:'none'});baseNode.attach(widget);profile.$cache_editor[type]=widget}widget.get(0).$cell=cell;if(cell.items)widget.setItems(cell.items);if(t=profile.box.getCellPro(profile,cell,'listKey'))widget.setListKey(t);widget.setValue(cell.value,true);if(cell.$tag){if(widget.setCaption)widget.setCaption(cell.$tag);else if(widget.setValue)widget.setValue(cell.$tag)}var undo=function(){if(widget){widget.updateUIValue(widget.getCtrlValue());widget.beforeValueUpdated(null).beforeNextFocus(null);if(widget.onFormatCheck)widget.onFormatCheck(null);if(widget.setValueFormat)widget.setValueFormat('');widget.setValue('',true);widget.reBoxing().hide();widget=null}};widget.beforeValueUpdated(function(pro,oV,nV){grid.changeCellValue(profile,cellId,nV)}).beforeNextFocus(function(pro,key,shift,e){undo();var hash=linb.event.getEventPara(e);if(hash.keyCode=='enter')hash.keyCode='down';profile.getSubNode(profile.keys.CELLA,cell._serialId).onKeydown(true,hash);return false});if(format){if(typeof format=='function'){if(widget.onFormatCheck)widget.onFormatCheck(format)}else{if(widget.setValueFormat)widget.setValueFormat(format)}t=profile.box.getCellPro(profile,cell,'validTips');if(t&&widget.setValidTips)widget.setValidTips(t)}widget.reBoxing().setBlurTrigger(widget.get(0).$id,function(){undo();return false});if(type=='textarea'){widget.reBoxing().width(200).height(100).popToTop(cellNode,baseNode,4)}else{widget.reBoxing().width(size.width+3).height(size.height+3).setStyle({display:'block'});widget.reBoxing().show((absPos.left-1)+'px',(absPos.top-1)+'px')}_.asyRun(function(){if(widget)widget.activate()})},showTips:function(profile,id,pos){if(profile.properties.disabled)return;if(profile.getKey(id)!=profile.keys.CELLA)return;var item=profile.cells_SerialIdMapItem[profile.getSubSerialId(id)];if(item&&item.value){linb.UI.Tips.show(pos,{tips:item.value});return true}else return false},resize:function(profile,w,h){profile.getSubNode(profile.keys.BORDER).cssSize({width:w,height:h});var rh;if(h)rh=profile.getSubNode(profile.keys.HEADER).realHeight();profile.getSubNode(profile.keys.BOX).cssSize({width:w?w:null,height:h?h:null});profile.getSubNode(profile.keys.SCROLL).setRegion({top:rh?rh:null,width:w?w:null,height:h?(h-rh):null}).onScroll()}}});Class("linb.UI.Dialog",["linb.UI.Widget","linb.UI.iContainer"],{Instance:{html:function(html){var pro=this.get(0);pro.getSubNode(pro.keys.PANEL).html(html)},show:function(parent,modal){parent=parent||linb(document.body);return this.each(function(profile){if(profile.$show)return;var t,pro=profile.properties,instance=profile.boxing(),fun=function(){profile.$show=true;parent.attach(profile.boxing());var t1=profile.root.topZindex(),t2=profile.root.zIndex();profile.root.zIndex(t1>t2?t1:t2).show();if(modal&&!profile.$inModal)profile.box.modal(profile);profile.box.active(profile);profile.root.nextFocus()};if(t=pro.fromRegion)linb.dom.fxProxy(t,pro,null,fun,240,8,'inexp').start();else fun()},this)},hide:function(){this.each(function(profile){delete profile.$show;if(profile.$inModal)profile.box.unModal(profile);if(profile.properties.status=='max'||profile.properties.status=='min')profile.box.restore(profile);profile.root.hide();var t=profile.properties.fromRegion;if(t)linb.dom.fxProxy(profile.properties,t,null,null,240,8,'outexp').start()});return this},close:function(){return this.each(function(profile){if(profile.beforeClose&&false===profile.boxing().beforeClose(profile))return;var t=profile.properties.fromRegion,fun=function(){profile.boxing().destroy()};if(t)linb.dom.fxProxy(profile.properties,t,null,fun,240,8,'outexp').start();else fun()})},removePanel:function(){this.destroy()},getPanelPara:function(){var para=_.copy(this.get(0).properties);return para},getPanelChildren:function(){return this.get(0).children}},Initialize:function(){var t=this.getTemplate('default');_.merge(t.FRAME.BORDER,{TITLE:{tagName:'div',style:'height:{_titleHeight}px;',ICON:{$order:0,style:'background:url({icon}) transparent no-repeat  {iconPos};{iconDisplay}'},CAPTION:{$order:1,text:'{caption}'},CMDS:{$order:2,MIN:{$order:1,style:'{minDisplay}'},RESTORE:{$order:2,style:'display:none;'},MAX:{$order:3,style:'{maxDisplay}'},CLOSE:{$order:4,style:'{closeDisplay}'},PIN:{$order:5,style:'{pinDisplay}'},LAND:{$order:6,style:'{landDisplay}'}}},PANEL:{tagName:'div',$order:2,text:linb.UI.$childTag},STATUS:{tagName:'div',$order:3}},'all');this.setTemplate('default',t)},Static:{Dropable:['PANEL'],Dragable:['LAND'],Appearances:{'default':{BORDER:{'border-style':'solid','border-width':'1px','border-color':'#fff #BBBBBB #BBBBBB #fff','background-color':'#F3F3F3'},PANEL:{position:'absolute',left:'0',overflow:'auto'},STATUS:{position:'absolute',left:'0',bottom:'0',height:'0','*font-size':'0','*line-height':'0'},TITLE:{position:'absolute',left:'0',top:'0',height:'0',background:linb.UI.getCSSImgPara('title.gif',' left top repeat-x'),'*font-size':'0','*line-height':'0'},'TITLE-focus':{$order:1,'background-position':'left -30px'},ICON:{height:'16px',width:'16px',margin:'4px 0 0 4px'},CAPTION:{margin:'4px 0 0 4px',color:'#555','font-weight':'bold','font-size':'12px'},CMDS:{position:'absolute',top:'0',right:'0','text-align':'right','vertical-align':'middle',background:linb.UI.getCSSImgPara('title.gif',' left top repeat-x'),height:'100%',cursor:'default'},'CMDS-focus':{$order:1,'background-position':'left -30px'},'MIN, RESTORE, MAX, PIN, CLOSE, LAND':{position:'relative',margin:'5px 4px 2px 0',width:'15px',height:'15px','vertical-align':'middle',cursor:'default'},MIN:{background:linb.UI.getCSSImgPara('cmds.gif',' -16px 0',null,'linb.UI.Public'),$order:0},'MIN-mouseover':{$order:1,'background-position':' -16px -16px'},'MIN-mousedown':{$order:2,'background-position':'-16px -32px'},RESTORE:{background:linb.UI.getCSSImgPara('cmds.gif',' -32px 0',null,'linb.UI.Public')},'RESTORE-mouseover':{$order:1,'background-position':'-32px -16px'},'RESTORE-mousedown':{$order:2,'background-position':'-32px -32px'},MAX:{background:linb.UI.getCSSImgPara('cmds.gif',' -48px 0',null,'linb.UI.Public')},'MAX-mouseover':{$order:1,'background-position':'-48px -16px'},'MAX-mousedown':{$order:2,'background-position':'-48px -32px'},PIN:{background:linb.UI.getCSSImgPara('cmds.gif',' 0 0',null,'linb.UI.Public')},'PIN-mouseover':{$order:1,'background-position':'0 -16px'},'PIN-mousedown':{$order:2,'background-position':' 0 -32px'},'PIN-checked, PIN-checked-mouseover':{$order:2,'background-position':'0 -32px'},CLOSE:{background:linb.UI.getCSSImgPara('cmds.gif',' no-repeat  -64px 0',null,'linb.UI.Public')},'CLOSE-mouseover':{$order:1,'background-position':'-64px -16px'},'CLOSE-mousedown':{$order:2,'background-position':'-64px -32px'},LAND:{background:linb.UI.getCSSImgPara('cmds.gif',' no-repeat  -80px 0',null,'linb.UI.Public')},'LAND-mouseover':{$order:1,'background-position':'-80px -16px'},'LAND-mousedown':{$order:2,'background-position':'-80px -32px'}}},Behaviors:{'default':{_hoverEffect:{PIN:'PIN',MIN:'MIN',MAX:'MAX',RESTORE:'RESTORE',CLOSE:'CLOSE',LAND:'LAND'},_clickEffect:{PIN:'PIN',MIN:'MIN',MAX:'MAX',RESTORE:'RESTORE',CLOSE:'CLOSE',LAND:'LAND'},onMousedown:function(profile,e){profile.box.active(profile)},onDragend:function(profile){var pos=profile.root.cssPos();profile.properties.left=pos.left;profile.properties.top=pos.top},TITLE:{onMousedown:function(profile,e,src){if(profile.getKey(linb.event.getSrc(e).parentNode.id)==profile.keys.CMDS)return;if(profile.properties.movable&&!profile._locked){profile.box.active(profile);var hash={defer:1,target_parent:profile.root.parent()};if(profile.properties.dragKey)hash.data={data:[profile.$id],domId:src.id};profile.root.startDrag(e,hash)}},onDblclick:function(profile,e,src){if(!profile.properties.maxBtn)return;if(profile.properties.status=='max')profile.box.restore(profile);else profile.box.max(profile)}},PIN:{onClick:function(profile,e,src){var key=profile.keys.PIN,t=profile.properties;t.pinned=!t.pinned;if(t.pinned)profile.addTagClass(profile.getSubNode(key),key,'-checked',true);else profile.removeTagClass(profile.getSubNode(key),key,'-checked');profile._locked=t.pinned;if(t.resizable){if(!t.pinned){if(t.status!='min'&&profile.$resizer)profile.$resizer.show()}else if(profile.$resizer)profile.$resizer.hide()}}},MIN:{onClick:function(profile,e,src){profile.box.min(profile)}},MAX:{onClick:function(profile,e,src){profile.box.max(profile)}},RESTORE:{onClick:function(profile,e,src){profile.box.restore(profile)}},CLOSE:{onClick:function(profile,e,src){profile.boxing().close()}}}},DataModel:{$border:1,value:null,tips:null,dataField:null,dataBinder:null,border:null,disabled:null,dock:{hidden:true},shadow:true,resizable:true,movable:true,minBtn:{ini:true,action:function(v){var o=this.getSubNode(this.keys.MIN);if(v)o.inlineBlock();else o.display('none')}},maxBtn:{ini:true,action:function(v){var o=this.getSubNode(this.keys.MAX);if(v)o.inlineBlock();else o.display('none')}},closeBtn:{ini:true,action:function(v){var o=this.getSubNode(this.keys.CLOSE);if(v)o.inlineBlock();else o.display('none')}},pinBtn:{ini:true,action:function(v){var o=this.getSubNode(this.keys.PIN);if(v)o.inlineBlock();else o.display('none')}},landBtn:{ini:false,action:function(v){var o=this.getSubNode(this.keys.LAND);if(v)o.inlineBlock();else o.display('none')}},width:300,height:300,minWidth:200,minHeight:100,_titleHeight:25,position:'absolute',fromRegion:{hidden:true,ini:null},status:{ini:'normal',listbox:['normal','min','max'],action:function(v,ov){switch(v){case'min':this.box.min(this,ov);break;case'max':this.box.max(this,ov);break;default:this.box.restore(this,ov)}}}},EventHandlers:{beforeValueSet:null,afterValueSet:null,beforeValueUpdated:null,afterValueUpdated:null,beforeHoverEffect:null,beforeClickEffect:null,beforeNextFocus:null,beforeClose:function(profile){}},createdTrigger:function(){this.destroyTrigger=function(){if(this.$inModal)this.box.unModal(this)}},envTrigger:function(){var t=this.properties;if(t.status=='min')this.box.min(this);else if(t.status=='max')this.box.max(this);else this.box.resize(this,t.width,t.height)},prepareData:function(profile){arguments.callee.upper.call(this,profile);var data=profile.data;data.minDisplay=data.minBtn?'':'display:none';data.maxDisplay=data.maxBtn?'':'display:none';data.closeDisplay=data.closeBtn?'':'display:none';data.pinDisplay=data.pinBtn?'':'display:none';data.landDisplay=data.landBtn?'':'display:none';data.iconDisplay=data.icon?'':'display:none'},min:function(profile,ov){var o=profile.boxing().reBoxing(),box=profile.box,p=o.parent(),t=profile.properties;if((ov||t.status)=='max')box.unMax(profile);else box.refreshRegion(profile);profile.getSubNode(profile.keys.PANEL).display('none');profile.getSubNode(profile.keys.STATUS).display('none');if(t.minBtn){profile.getSubNode(profile.keys.RESTORE).inlineBlock();profile.getSubNode(profile.keys.MIN).display('none')}if(t.resizable&&profile.$resizer)profile.$resizer.hide();t.status='min';var h1=o.height(),h2=profile.getSubNode(profile.keys.BORDER).height(),h=profile.getSubNode(profile.keys.TITLE).height();o.cssSize({width:t.minWidth,height:h+h1-h2},true)},max:function(profile,ov){var o=profile.boxing().reBoxing(),p=o.parent();var t=profile.properties;if((ov||t.status)=='min')profile.box.unMin(profile);else profile.box.refreshRegion(profile);if(t.pinBtn)profile.getSubNode(profile.keys.PIN).display('none');if(t.maxBtn){profile.getSubNode(profile.keys.MAX).display('none');profile.getSubNode(profile.keys.RESTORE).inlineBlock()}profile.old_m=t.movable;t.movable=false;if(t.resizable&&profile.$resizer)profile.$resizer.hide();if(t.shadow)profile.boxing()._unShadow(false);t.status='max';profile.boxing().setDock('fill')},restore:function(profile,ov){var o=profile.boxing().reBoxing();var t=profile.properties;if((ov||t.status)=='max')profile.box.unMax(profile);if((ov||t.status)=='min')profile.box.unMin(profile);profile.getSubNode(profile.keys.RESTORE).display('none');t.status='normal'},unMax:function(profile){var t=profile.properties;profile.getSubNode(profile.keys.MAX).inlineBlock();if(t.pinBtn)profile.getSubNode(profile.keys.PIN).inlineBlock();t.movable=profile.old_m;if(t.shadow)profile.boxing()._shadow();if(t.resizable&&!t.pinned&&profile.$resizer)profile.$resizer.show();profile.boxing().setDock('none');profile.box.resize(profile,profile.properties.width,profile.properties.height)},unMin:function(profile){var t=profile.properties;profile.getSubNode(profile.keys.PANEL).display('block');profile.getSubNode(profile.keys.STATUS).display('block');profile.getSubNode(profile.keys.MIN).inlineBlock();if(t.resizable&&!t.pinned&&profile.$resizer)profile.$resizer.show();profile.root.cssSize({width:profile.properties.width,height:profile.properties.height});profile.box.resize(profile,profile.properties.width,profile.properties.height)},active:function(profile){if(this.activeWndId==profile.$id)return;this.deActive();var o=linb(this.activeWndId=profile.domId);var t1=o.topZindex(),t2=o.zIndex();o.zIndex(t1>t2?t1:t2);profile.addTagClass(profile.getSubNode(profile.keys.TITLE),profile.keys.TITLE,'-focus');profile.addTagClass(profile.getSubNode(profile.keys.CMDS),profile.keys.CMDS,'-focus');this.activeWndId=profile.$id},deActive:function(profile){var id,profile;if((id=linb.UI._cache[this.activeWndId])&&linb.dom.byId(id)){profile=linb(id).reBoxing(this.KEY).get(0);profile.removeTagClass(profile.getSubNode(profile.keys.TITLE),profile.keys.TITLE,'-focus');profile.removeTagClass(profile.getSubNode(profile.keys.CMDS),profile.keys.CMDS,'-focus')}delete this.activeWndId},modal:function(profile){var s=profile.root,temp,p=s.parent(),cover;if(!p.isEmpty()){if(!profile.$inModal){if(!profile.$modalDiv)profile.$modalDiv=new linb.UI.Div({position:'absolute'}).setCustomAppearance({KEY:'overflow:hidden;display:block;z-index:0;cursor:wait;background-image:url('+linb.ini.path+'bg.gif)'});cover=profile.$modalDiv;p.attach(cover);cover.setDock('cover',true);cover=cover.reBoxing();cover.display('block').onMousedown(function(){return false}).topZindex(true);s.zIndex((parseInt(cover.zIndex())||0)+1);var hash={},a=profile.root.dig('*',function(o){return o.tabIndex>0}).get();for(var i=0,o;o=a[i++];){(hash[o.tabIndex]=hash[o.tabIndex]||[]).push(o);o.tabIndex=-1}var h=profile.$focusHash={},b=linb([document.body],false).dig('*',function(o){return o.tabIndex>0}).get();for(var i=0,o;o=b[i++];){(h[o.tabIndex]=h[o.tabIndex]||[]).push(o);o.tabIndex=-1}for(var i in hash){h=hash[i];for(var j in h)h[j].tabIndex=i}linb.event.focusHook.push(profile.domNode);profile.$inModal=true}}},unModal:function(profile){if(profile.$inModal){profile.$modalDiv.setDock('none');profile.$modalDiv.reBoxing().display('none').addToLast(profile.getSubNode(profile.keys.BORDER));profile.$inModal=false;var hash=profile.$focusHash,h;for(var i in hash){h=hash[i];for(var j in h)h[j].tabIndex=i}_.breakO(profile.$focusHash,2);linb.event.focusHook.pop()}},refreshRegion:function(profile){if(!profile.root)return;return _.merge(profile.properties,profile.root.getRegion(),'all')},_adjust:function(dialog,caption,content){caption=caption||'';if(!content){content=caption;caption=""}var node=dialog.$div.reBoxing();node.cssSize({width:'auto',height:'auto'}).overflow('visible').html(content);var size=node.cssSize();if(size.width>500){size.width=500;node.width(500);size.height=node.offsetHeight()+10}if(size.height>400)size.height=400;if(size.width<50)size.width=50;if(size.height<20)size.height=20;node.cssSize(size).overflow('auto').show();dialog.setCaption(caption).setWidth(size.width+30).setHeight(size.height+80);dialog.$cmd.reBoxing().left((size.width+30-dialog.$cmd.reBoxing().width())/2)},alert:function(caption,content,onOK){var me=arguments.callee,dialog=me.dialog;me.onOK=onOK;if(!dialog){dialog=me.dialog=new linb.UI.Dialog({caption:caption||'Alert',minBtn:false,maxBtn:false,pinBtn:false,resizable:false,left:200,top:200},{beforeClose:function(){dialog.$div.reBoxing().html('',false);dialog.hide();_.tryF(me.onOK);me.onOK=null;return false}}).create();linb.SC('linb.UI.Button');var cmd=new linb.UI.Div({bottom:10,width:60,height:24}).setCustomAppearance({KEY:'overflow:visible'});dialog.$cmd=cmd;var btn=new linb.UI.Button({caption:'OK',width:60,tabindex:1},{onClick:function(){dialog.$div.reBoxing().html('',false);dialog.hide();_.tryF(onOK)}});cmd.attach(btn);dialog.$btn=btn;var div=new linb.UI.Div({left:10,top:10}).setCustomAppearance({KEY:'overflow:visible'});dialog.$div=div;dialog.attach(cmd).attach(div)}this._adjust(dialog,caption,content);dialog.show(linb([document.body],false),true);_.asyRun(function(){dialog.$btn.activate()})},confirm:function(caption,content,onYes,onNo){var me=arguments.callee,dialog=me.dialog;me.onYes=onYes,me.onNo=onNo;if(!dialog){dialog=me.dialog=new linb.UI.Dialog({caption:caption||'Alert',minBtn:false,maxBtn:false,pinBtn:false,resizable:false,left:200,top:200},{beforeClose:function(){dialog.$div.reBoxing().html('',false);dialog.hide();_.tryF(me.onNo);me.onNo=null;return false}}).create();linb.SC('linb.UI.Button');var cmd=new linb.UI.Div({bottom:10,width:140,height:24});dialog.$cmd=cmd;var btn=new linb.UI.Button({caption:'Yes',width:60,tabindex:1,left:0},{onClick:function(){dialog.$div.reBoxing().html('',false);_.tryF(me.onYes);me.onYes=null;dialog.hide()}});cmd.attach(btn);btn=new linb.UI.Button({caption:'No',tabindex:1,width:60,left:80},{onClick:function(){dialog.$div.reBoxing().html('',false);_.tryF(me.onNo);me.onNo=null;dialog.hide()}});cmd.attach(btn);dialog.$btn=btn;var div=new linb.UI.Div({left:10,top:10}).setCustomAppearance({KEY:'overflow:visible'});dialog.$div=div;dialog.attach(cmd).attach(div)}this._adjust(dialog,caption,content);dialog.show(linb([document.body],false),true);_.asyRun(function(){dialog.$btn.activate()})},pop:function(caption,content){var me=arguments.callee,dialog=me.dialog;if(!dialog){dialog=new linb.UI.Dialog({caption:caption||'Alert',minBtn:false,maxBtn:false,pinBtn:false,resizable:false,left:200,top:200}).create();linb.SC('linb.UI.Button');var cmd=new linb.UI.Div({bottom:10,width:60,height:24});dialog.$cmd=cmd;var btn=new linb.UI.Button({caption:'OK',tabindex:1,width:60},{onClick:function(){dialog.destroy()}});cmd.attach(btn);dialog.$btn=btn;var div=new linb.UI.Div({left:10,top:10}).setCustomAppearance({KEY:'overflow:visible'});dialog.$div=div;dialog.attach(cmd).attach(div)}this._adjust(dialog,caption,content);dialog.show(linb([document.body],false));_.asyRun(function(){dialog.$btn.activate()})},prompt:function(caption){},resize:function(profile,w,h){var size=arguments.callee.upper.apply(this,arguments),region={};var v1=profile.getSubNode(profile.keys.TITLE),v2=profile.getSubNode(profile.keys.PANEL),v3=profile.getSubNode(profile.keys.STATUS);if(h){var bh=size.height,h1=v1.height(),h3=v3.height();region.top=h1;if(bh-h1-h3>0)region.height=bh-h1-h3}if(w){var bw=size.width;region.width=bw}v2.setRegion(region,true);if(bw)v1.add(v3).width(bw)}}});Class("linb.UI.TextEditor",["linb.UI.Widget","linb.UI.iForm"],{Instance:{activate:function(){var profile=this.get(0);profile.getSubNode(profile.keys.INPUT).focus();return this},setCtrlValue:function(value){if(_.isNull(value)||!_.exists(value))value='';return this.each(function(profile){var node=profile.getSubNode(profile.keys.INPUT).get(0);if(node.value.replace(/(\r\n|\r)/g,"\n")!=value.replace(/(\r\n|\r)/g,"\n")){var st=node.scrollTop;node.value=value;node.scrollTop=st}})},getCtrlValue:function(value){var profile=this.get(0);return profile.getSubNode(profile.keys.INPUT).value().replace(/(\r\n|\r)/g,"\n").replace(/( +)(\n)/g,"$2").replace(/\t/g,"    ")},prepareMaps:function(){return this.each(function(profile){profile._maps=profile._maps||{}})},setTempMaps:function(h){return this.each(function(profile){profile._maps2=h||{}})},disabled:function(value){arguments.callee.upper.call(this,value);return this.each(function(o){o.getSubNode(o.keys.INPUT).disabled(value)})},readonly:function(value){return this.each(function(profile){profile.getSubNode(profile.keys.INPUT).readonly(value).background(value?'#F4F4F4':'')})}},Initialize:function(){var t=this.getTemplate('default');_.merge(t.FRAME.BORDER,{BOX:{tagName:'div',INPUT:{tagName:'textarea',tabindex:'{tabindex}'}},BAK1:{},BAK2:{tagName:'div'}},'all');this.setTemplate('default',t)},Static:{Appearances:{'default':{KEY:{overflow:'hidden'},BOX:{display:'block',position:'absolute',width:'100%',height:'100%',left:'0',top:'0',overflow:linb.browser.gek?'auto':''},INPUT:{'font-family':'Courier New, Courier, monospace','font-size':'12px',position:'relative',left:'0',top:'0',border:'0',margin:'0',padding:'0',overflow:'auto','overflow-y':(linb.browser.gek||linb.browser.ie)?'auto':'','overflow-x':(linb.browser.gek||linb.browser.ie)?'hidden':''},'BAK1, BAK2':{'font-family':'Courier New, Courier, monospace','font-size':'12px',position:'absolute',visibility:'hidden',left:'-10000px',top:'-10000px'}}},Behaviors:{'default':{INPUT:{onChange:function(profile,e,src){profile.boxing().updateUIValue(src.value)},afterKeydown:function(profile,e,src){if(profile.properties.disabled||profile.properties.readonly)return;if(profile.$change)delete profile.$change;var key=linb.event.getKey(e),k=key[0];switch(k){case'tab':profile.box.insertAtCaret(profile,'    ');profile.$pos=profile.box.getParas(profile)[0];return false;case'enter':var paras=profile.box.getParas(profile);str=paras[1];var len=str.length-str.ltrim().length;if(str.charAt(str.length-1)=="{")len+=4;if(len){profile.box.insertAtCaret(profile,((linb.browser.ie||linb.browser.opr)?'\r\n':'\n')+' '.repeat(len));profile.$enter=true;return false}break;default:if(profile.tips){profile.tips.destroy();profile.tips=null}}},afterKeypress:function(profile,e,src){if(profile.properties.disabled||profile.properties.readonly)return;var key=linb.event.getKey(e),k=key[0];var me=arguments.callee,map=me.map||(me.map='space,enter,backspace,tab,delete'.toHash(true));if(k.length==1||map[k])profile.$change=true;switch(k){case'tab':if(linb.browser.opr)_.asyRun(function(){profile.box.setCaretTo(src,profile.$pos)});return false;case'enter':if(profile.$enter){delete profile.$enter;return false}case'}':if(key[2]){var paras=profile.box.getParas(profile);var loc=paras[0],str=paras[1],pos=paras[2],input=paras[3];if(/ {4}$/.test(str)){var st=linb(src).scrollTop();input.value=input.value.substr(0,loc).replace(/ {4}$/,'}')+input.value.substr(loc,input.value.length);linb(input).onChange();profile.box.setCaretTo(input,loc-4+1,st);return false}}break}},afterKeyup:function(profile,e,src){var key=linb.event.getKey(e),k=key[0];var me=arguments.callee,map=me.map||(me.map='space,enter,backspace,tab,delete'.toHash(true));if(k.length==1||map[k])profile.$change=true;if(profile.$change){delete profile.$change;if(profile.onKeyPress)profile.boxing().onKeyPress(profile,e,src)}}}}},DataModel:{icon:null,iconPos:null,tabindex:{action:function(value){if(this.domNode)this.getSubNode(this.keys.INPUT).tabIndex(value)}},left:'0',top:'0',width:200,height:200,position:'absolute',readonly:{ini:false,action:function(v){this.boxing().readonly(v)}}},EventHandlers:{onKeyPress:function(profile,e,src){}},createdTrigger:function(){if(this.properties.readonly)this.boxing().readonly(true)},resize:function(profile,w,h){var size=arguments.callee.upper.apply(this,arguments);profile.getSubNode(profile.keys.BOX).cssSize(size);profile.getSubNode(profile.keys.INPUT).cssSize(size)},insertAtCaret:function(profile,text){var start,end,input=profile.getSubNode(profile.keys.INPUT),scrollTop;scrollTop=input.scrollTop()||null;input.onChange();input=input.get(0);if(linb.browser.ie){linb(input).focus();var range=document.selection.createRange();if(range.parentElement()!=input)return false;range.text='';var loc=linb.UI.getCaretPos(input);input.value=input.value.substr(0,loc[0])+text+input.value.substr(loc[0],input.value.length);start=loc[0]}else{start=input.selectionStart;end=input.selectionEnd;input.value=input.value.substr(0,start)+text+input.value.substr(end,input.value.length)}if(start!=null){this.setCaretTo(input,start+text.length,scrollTop)}else{input.value+=text}},setCaretTo:function(input,pos,scrollTop){linb(input).focus();var s,c,h,o=linb(input);if(_.isNumb(scrollTop))o.scrollTop(scrollTop);if(scrollTop===true){if(o.tagName().toLowerCase()=='textarea'&&o.scrollHeight()!==o.offsetHeight()){s=o.value().substr(0,pos);c=o.clone().id('').setStyle({visibility:'hidden',position:'absolute',left:5000+'px'}).value(s);linb([document.body],false).addLast(c);h=Math.max((c.scrollHeight()>c.offsetHeight())?c.scrollHeight()-30:0,0);o.scrollTop(h);c.remove()}}if(linb.browser.ie){pos=input.value.substr(0,pos).replace(/\r\n/g,'\n').length;var range=input.createTextRange();range.move('character',pos);range.select()}else try{input.setSelectionRange(pos,pos)}catch(e){}},getParas:function(profile){var o=profile.getSubNode(profile.keys.INPUT),me=arguments.callee,reg=me.reg||(me.reg=/\r\n/g);v=o.get(0).value;loc=linb.UI.getCaretPos(o.get(0));if(loc[0]<0)loc[0]=0;var l=0,m=v.substr(0,loc[0]).match(reg);if(m)l=m.length;v=v.replace(reg,'\n');var txt=v.substr(0,loc[0]-l);var li=txt.lastIndexOf('\n'),line=txt.substr(li+1,loc[0]-li),w=o.clientWidth(),bak1=profile.getSubNode(profile.keys.BAK1),bak2=profile.getSubNode(profile.keys.BAK2);if(txt.charAt(txt.length-1)=='\n')txt+='*';bak2.width(w);var x=bak1.html(line.replace(/ /g,'&nbsp;'),false).width(),y=bak2.html(txt.replace(/\n/g,'<br />'),false).height()-o.scrollTop();if(x>w){bak2.html(line,false);var lbak=line;var bl=bak2.height();while(lbak){lbak=lbak.replace(/ [^ ]*$/,'');bak2.html(lbak,false);if(bak2.height()!=bl)break}lbak=line.substr(lbak.length,line.length-lbak.length);x=bak1.html(lbak,true).width()}bak1.html('',false);bak2.html('',false);var pos=profile.getSubNode(profile.keys.KEY).absPos();pos.left+=x;pos.top+=y;return[loc[0],line,pos,o.get(0),txt]}}});Class("linb.UI.Tips",null,{Constructor:function(){return null},Initialize:function(){linb([document],false).afterMouseover(function(obj,e,src){var node=linb.event.getSrc(e);if(/^lang:/.test(node.id))node=node.parentNode;if(!node)return;var id=node.id;if(!id||linb.cache.dom[id])return;var from=linb.event._getProfile(id);if(!from||!from.box)return;var pos=linb.event.getPos(e);linb.UI.Tips.srcId=id;_.resetRun('$Tips',function(){var o=from.box,t,b=false;if(!o)return;b=(o.showTips&&o.showTips(from,id,pos));if(!b&&(t=from.properties)&&(t.tips)){linb.UI.Tips.show(pos,t);b=true}if(!b)linb.UI.Tips.hide();else _.resetRun('$Tips2',linb.UI.Tips.hide,3000,null,linb.UI.Tips)},400)},'$Tips',-1).afterMouseout(function(obj,e,src){var node=linb.event.getSrc(e);if(/^lang:/.test(node.id))node=node.parentNode;if(!node)return;var id=node.id;if(!id||!linb.UI.Tips.srcId)return;if(!linb.UI.Tips.flag||id!=linb.UI.Tips.srcId){_.resetRun('$Tips',null)}else{this.srcId=null;linb.UI.Tips.hide()}},'$Tips',-1);this.Types={'default':new function(){this.show=function(item,pos){if(!this.node){this.node=linb.create('<div style="font-size:0;line-height:0;position:absolute;border:solid gray 1px;background-color:#FFF8DC;overflow:visible;"><div style="font-size:12px;margin:2px;"></div></div>');this.n=this.node.first();this.node.shadow()}if(document.body.lastChild!=this.node.get(0))linb([document.body],false).addLast(this.node);pos.left+=12;pos.top+=12;var s=item.tips;if(s=s.toString()){s=s.charAt(0)=='$'?linb.UI.getStr(s.slice(1)):s;if(linb.browser.ie)this.node.setStyle({width:'auto',height:'auto'});this.n.html(s);if(linb.browser.ie){var w=this.node.width(),h=this.node.height();w=Math.round(w/2)*2+2;h=Math.round(h/2)*2;this.node.setStyle({width:w+'px',height:h+'px'})}this.node.popToTop(pos,null,3)}};this.hide=function(){this.node.zIndex(0).hide()}}}},Static:{show:function(pos,item){if(this.item==item)return;if(this.curTemplate)this.curTemplate.hide();if(!item||!item.tips)return;this.curTemplate=this.Types[item.tipsTemplate]||this.Types['default'];this.curTemplate.show(item,pos);this.item=item;this.flag=true},hide:function(flag){if(flag||this.flag){if(this.curTemplate)this.curTemplate.hide();this.curTemplate=this.item=this.flag=null}}}});Class("linb.UI.Shadow","linb.UI",{Instance:{getTarget:function(){return this.get(0)._target},attachTo:function(o){o=o.reBoxing();this.get(0)._target=o.get(0);o.attach(this);return this}},Initialize:function(){_.each({shadow:function(properties){var o=this.get(0);return new linb.UI.Shadow(properties).attachTo(linb([o],false))},isShadow:function(){var s=this.get(0),b=false;linb.UI.Shadow._cache.each(function(o){if(o._target==s){b=true;return false}});return b},getShadow:function(){var s=this.get(0),b=null;linb.UI.Shadow._cache.each(function(o){if(o._target==s){b=o;return false}});return b.boxing()},unShadow:function(){var s=this.get();linb.UI.Shadow._cache.each(function(o){if(s.exists(linb(o._target).get(0)))o.boxing().destroy()});return this}},function(o,i){linb.dom.plugIn(i,o)})},Static:{Templates:{'default':{tagName:'div',R:{tagName:'div',style:'top:{offset}px;width:{size}px;right:-{pos}px;'},RB:{tagName:'div',style:'height:{size}px;width:{size}px;right:-{rbpos}px;bottom:-{rbpos}px;'},B:{tagName:'div',style:'left:{offset}px;height:{size}px;bottom:-{pos}px;'}}},Appearances:{'default':{KEY:{width:'0',height:'0',_display:'inline'},'B, RB, R':{position:'absolute',display:'block','*font-size':'0','*line-height':'0'},B:{left:'0',width:'100%',background:linb.browser.ie6?'':linb.UI.getCSSImgPara('B.png','repeat-x left bottom'),_filter:linb.UI.getImgPath2('B.png','progid:DXImageTransform.Microsoft.AlphaImageLoader(src="{*}",sizingMethod="crop")')},RB:{background:linb.browser.ie6?'':linb.UI.getCSSImgPara('RB.png','left top'),_filter:linb.UI.getImgPath2('RB.png','progid:DXImageTransform.Microsoft.AlphaImageLoader(src="{*}",sizingMethod="crop")')},R:{top:'0',height:'100%',background:linb.browser.ie6?'':linb.UI.getCSSImgPara('R.png','repeat-y right top'),_filter:linb.UI.getImgPath2('R.png','progid:DXImageTransform.Microsoft.AlphaImageLoader(src="{*}",sizingMethod="crop")')}}},DataModel:{size:{ini:8,action:function(value){var offset=this.properties.offset;this.getSubNode(this.keys.R).width(value).top(offset).right(-value-offset);this.getSubNode(this.keys.RB).width(value).height(value).right(-value-offset).bottom(-value-offset);this.getSubNode(this.keys.B).height(value).left(offset).bottom(-value-offset)}},offset:{ini:0,action:function(value){this.boxing().setSize(this.properties.size,true)}}},prepareData:function(profile){arguments.callee.upper.call(this,profile);var t=profile.data;t.pos=(parseInt(t.size)||0)+(parseInt(t.offset)||0);t.rbpos=t.pos-1},Behaviors:{'default':{}},createdTrigger:function(){if(linb.browser.ie)this.root.ieTrigger()},hide:function(profile,value){linb([profile.domNode],false).children().display(value?'none':'block')}}});Class("linb.UI.Resizer","linb.UI",{Instance:{getRegion:function(){var profile=this.get(0),target=profile._target,l,t,b,r,ll,tt,ww,hh,c=[];if(target)target.each(function(o,i){var o=linb([o],false);if(i===0){l=o.offsetLeft();t=o.offsetTop();r=l+(ww=o.offsetWidth());b=t+(hh=o.offsetHeight());c.push([{left:l,top:t},{width:ww,height:hh},o.id()])}else{l=Math.min(l,ll=o.offsetLeft());t=Math.min(t,tt=o.offsetTop());r=Math.max(r,ll+(ww=o.offsetWidth()));b=Math.max(b,tt+(hh=o.offsetHeight()));c.push([{left:ll,top:tt},{width:ww,height:hh},o.id()])}});profile.regionBlocks=c;c.each(function(o){o[0].left-=l;o[0].top-=t;o[1].width-=2;o[1].height-=2});return{l:l,t:t,b:b,r:r}},rePosSize:function(){this.each(function(o){var t1=o.getSubNode(o.keys.KEY),t2=o._target;if(!t2||t2.isEmpty())return;if(!o.properties.child){o.region=o.boxing().getRegion();t1.cssPos({left:o.region.l,top:o.region.t}).offsetWidth(o.region.r-o.region.l).offsetHeight(o.region.b-o.region.t)}if(!o.regPool)o.regPool=linb([],false);if(o.regions){o.regPool.add(o.regions);o.regions.display('none')}o.regions=linb([],false);if(o.regionBlocks){var t,fun=function(){var t=o.boxing().getTarget();var key=linb.event.currentKey;if(t.length()>1){if(key&&key[2]){t.minus(linb(this.tid));o.boxing().resetTarget(t)}else{o.boxing().focus(this.tid)}}};o.regionBlocks.each(function(v){if(o.regPool.length()){t=o.regPool.pop();linb(t).cssPos(v[0]).cssSize(v[1])}else{t='<div style="position:absolute;border:dashed 1px blue;left:{l}px;top:{t}px;width:{w}px;height:{h}px;"></div>'.replace('{l}',v[0].left).replace('{t}',v[0].top).replace('{w}',v[1].width).replace('{h}',v[1].height).toDom();t.onMousedown(fun);t=t.get(0)}o.regions.push(t);t.tid=v[2]});o.getSubNode(o.keys.KEY).addLast(o.regions.display('block'))}});this.focus();return this},getTarget:function(){return this.get(0)._target},resetTarget:function(target,flag){var profile=this.get(0);if(profile.properties.child)return;delete profile.$focus;var ids;if(target){profile._target=target;this.rePosSize();this.reBoxing().zIndex(linb.ini.top_zIndex).display('block')}else{profile._target=linb([],false);this.reBoxing().zIndex(0).display('none')}if(target){ids=[];target.reBoxing('UI').each(function(o,i){ids.push(o.$id)})}else ids=null;if(flag!==false)profile.boxing().onItemsSelected(profile,ids,profile.$id);return this},attachTo:function(target,parent){var v=this.get(0);v._target=linb(target);v._parent=parent||linb(document.body);v._parent.attach(this);this.resetTarget(v._target);v.$resizeId=linb(target).id();return this},focus:function(id){var profile=this.get(0),index=-1;if(!profile.regions)return;profile.regions.border('dashed 1px blue');var arr=profile._target.get();if(id)index=arr.subIndexOf('id',id);if(index==-1&&profile.$focus!=undefined)index=profile.$focus;if(index==-1&&arr.length>1)index=arr.length-1;if(index!=-1){profile.regions.border('dashed 1px blue');linb([profile.regions.get(index)],false).border('solid 1px red');profile.$focus=index;if(profile.onFocusChange)profile.boxing().onFocusChange(profile,index)}return this},getFocus:function(){return this.get(0).$focus},active:function(flag){return this.each(function(profile){profile.getSubNode(profile.keys.MOVE).setStyle('backgroundPosition','-17px top');var o=profile.getSubNode(profile.keys.LT).add(profile.getSubNode(profile.keys.T)).add(profile.getSubNode(profile.keys.RT)).add(profile.getSubNode(profile.keys.R)).add(profile.getSubNode(profile.keys.RB)).add(profile.getSubNode(profile.keys.B)).add(profile.getSubNode(profile.keys.LB)).add(profile.getSubNode(profile.keys.L));if(linb.browser.ie)o.background('url('+linb.ini.path+'bg.gif)');else o.background('transparent');if(flag!==false)profile.boxing().onActive(profile)})},inActive:function(){return this.each(function(profile){if(profile.$onDrag)return;profile.getSubNode(profile.keys.MOVE).setStyle('backgroundPosition','-17px -17px');var o=profile.getSubNode(profile.keys.LT).add(profile.getSubNode(profile.keys.T)).add(profile.getSubNode(profile.keys.RT)).add(profile.getSubNode(profile.keys.R)).add(profile.getSubNode(profile.keys.RB)).add(profile.getSubNode(profile.keys.B)).add(profile.getSubNode(profile.keys.LB)).add(profile.getSubNode(profile.keys.L));o.background('#808080')})},show:function(){this.each(function(o){o.root.display(o.$display||'block')});if(linb.browser.ie)this.reBoxing().ieTrigger();return this},hide:function(){this.each(function(o){o.$display=o.root.display()});this.reBoxing().display('none');return this}},Initialize:function(){this.mapKeys(['HANDLER','HIDDEN']);_.each({resizable:function(properties,target,onUpdate){var o=this.get(0);properties=_.hash(properties);var r=new linb.UI.Resizer(properties).attachTo(target,linb([o],false));if(onUpdate)r.onUpdate(onUpdate);return r},unResizable:function(){var s=this.id();linb.UI.Resizer._cache.each(function(o){if(o.$resizeId==s)o.boxing().destroy()});return this},isResizable:function(){var s=this.id(),b=false;linb.UI.Resizer._cache.each(function(o){if(o.$resizeId==s){b=true;return false}});return b},getResizer:function(){var s=this.id(),b=null;linb.UI.Resizer._cache.each(function(o){if(o.$resizeId==s){b=o;return false}});return b.boxing()}},function(o,i){linb.dom.plugIn(i,o)})},Static:{Templates:{'default':{tagName:'div',style:'{width}{height}{left}{top}{position};display:{display};visibility:{visibility};',TAG:{}}},Appearances:{'default':{KEY:{position:'absolute',margin:'0 -1px -1px 0',visibility:'visible','_font-size':'0px','_line-height':'0px','*background':'url('+linb.ini.path+'bg.gif)','z-index':'60',cursor:'move'},TAG:{'_font-size':'0px','_line-height':'0px'},MOVE:{position:'absolute',display:'block','z-index':'100',visibility:'visible',background:linb.UI.getCSSImgPara('icon.gif',' no-repeat -17px top',null,'linb.UI.Public'),'_font-size':'0px','_line-height':'0px'},HANDLER:{$order:0,position:'absolute',display:'block',border:'solid 1px','z-index':'100',visibility:'visible','_font-size':'0px','_line-height':'0px'},T:{$order:1,left:'50%',cursor:'n-resize'},RT:{$order:1,cursor:'ne-resize','z-index':'110'},R:{$order:1,top:'50%',cursor:'e-resize'},RB:{$order:1,cursor:'se-resize','z-index':'110'},B:{$order:1,left:'50%',cursor:'s-resize'},LB:{$order:1,cursor:'sw-resize','z-index':'110'},L:{$order:1,top:'50%',cursor:'w-resize'},LT:{$order:1,cursor:'nw-resize','z-index':'110'},HIDDEN:{$order:10,'border-width':'0'}}},Behaviors:{'default':{onMousedown:function(profile,e,src){profile.box.onMousedown(profile,e,src,{move:true})},onDragbegin:function(profile,e,src){profile.box.onDragbegin(profile,e,src)},onDrag:function(profile,e,src){profile.box.onDrag(profile,e,src,{move:true})},onDragend:function(profile,e,src){profile.box.onDragend(profile,e,src,{move:true})},LT:{onMousedown:function(profile,e,src){profile.box.onMousedown(profile,e,src,{left:true,top:true})},onDragbegin:function(profile,e,src){profile.box.onDragbegin(profile,e,src)},onDrag:function(profile,e,src){profile.box.onDrag(profile,e,src,{left:true,top:true})},onDragend:function(profile,e,src){profile.box.onDragend(profile,e,src,{left:true,top:true})}},RT:{onMousedown:function(profile,e,src){profile.box.onMousedown(profile,e,src,{right:true,top:true})},onDragbegin:function(profile,e,src){profile.box.onDragbegin(profile,e,src)},onDrag:function(profile,e,src){profile.box.onDrag(profile,e,src,{right:true,top:true})},onDragend:function(profile,e,src){profile.box.onDragend(profile,e,src,{right:true,top:true})}},LB:{onMousedown:function(profile,e,src){profile.box.onMousedown(profile,e,src,{left:true,bottom:true})},onDragbegin:function(profile,e,src){profile.box.onDragbegin(profile,e,src)},onDrag:function(profile,e,src){profile.box.onDrag(profile,e,src,{left:true,bottom:true})},onDragend:function(profile,e,src){profile.box.onDragend(profile,e,src,{left:true,bottom:true})}},RB:{onMousedown:function(profile,e,src){profile.box.onMousedown(profile,e,src,{right:true,bottom:true})},onDragbegin:function(profile,e,src){profile.box.onDragbegin(profile,e,src)},onDrag:function(profile,e,src){profile.box.onDrag(profile,e,src,{right:true,bottom:true})},onDragend:function(profile,e,src){profile.box.onDragend(profile,e,src,{right:true,bottom:true})}},L:{onMousedown:function(profile,e,src){profile.box.onMousedown(profile,e,src,{left:true})},onDragbegin:function(profile,e,src){profile.box.onDragbegin(profile,e,src)},onDrag:function(profile,e,src){profile.box.onDrag(profile,e,src,{left:true})},onDragend:function(profile,e,src){profile.box.onDragend(profile,e,src,{left:true})}},T:{onMousedown:function(profile,e,src){profile.box.onMousedown(profile,e,src,{top:true})},onDragbegin:function(profile,e,src){profile.box.onDragbegin(profile,e,src)},onDrag:function(profile,e,src){profile.box.onDrag(profile,e,src,{top:true})},onDragend:function(profile,e,src){profile.box.onDragend(profile,e,src,{top:true})}},R:{onMousedown:function(profile,e,src){profile.box.onMousedown(profile,e,src,{right:true})},onDragbegin:function(profile,e,src){profile.box.onDragbegin(profile,e,src)},onDrag:function(profile,e,src){profile.box.onDrag(profile,e,src,{right:true})},onDragend:function(profile,e,src){profile.box.onDragend(profile,e,src,{right:true})}},B:{onMousedown:function(profile,e,src){profile.box.onMousedown(profile,e,src,{bottom:true})},onDragbegin:function(profile,e,src){profile.box.onDragbegin(profile,e,src)},onDrag:function(profile,e,src){profile.box.onDrag(profile,e,src,{bottom:true})},onDragend:function(profile,e,src){profile.box.onDragend(profile,e,src,{bottom:true})}}}},DataModel:{proxy:true,child:false,visible:true,cover:false,Static:false,reHeight:true,reWidth:true,changable:true,move:true,left:100,top:100,height:100,width:100,position:'absolute',display:'block',visibility:'visible',minHeight:12,minWidth:12,maxHeight:5000,maxWidth:5000,offset:2,enlarge:0,dragArgs:{}},EventHandlers:{onUpdate:function(profile,target,size,cssPos){},onActive:function(profile){},onFocusChange:function(profile,index){},onItemsSelected:function(profile,ids){}},dynamicTemplate:function(profile){var pro=profile.properties,size,pos,temp;var hash=profile._exhash="$"+'child:'+pro.child+';'+'visible:'+pro.visible+';'+'cover:'+pro.cover+';'+'Static:'+pro.Static+';'+'reheight:'+pro.reHeight+';'+'rewidth:'+pro.reWidth+';'+'move:'+pro.move+';';var map=arguments.callee.map||(arguments.callee.map={MOVE:{tagName:'div',style:'top:50%;left:50%;margin-left:-6px;margin-top:-6px;width:13px;height:13px;'},T:{tagName:'div',style:'top:-{edge}px;margin-left:-{edge}px;width:{handlerSize}px;height:{handlerSize}px;'},RT:{tagName:'div',style:'top:-{edge}px;right:-{edge}px;width:{handlerSize}px;height:{handlerSize}px;'},R:{tagName:'div',style:'right:-{edge}px;margin-top:-{edge}px;width:{handlerSize}px;height:{handlerSize}px;'},RB:{tagName:'div',style:'bottom:-{edge}px;right:-{edge}px;width:{handlerSize}px;height:{handlerSize}px;'},B:{tagName:'div',style:'bottom:-{edge}px;margin-left:-{edge}px;width:{handlerSize}px;height:{handlerSize}px;'},LB:{tagName:'div',style:'bottom:-{edge}px;left:-{edge}px;width:{handlerSize}px;height:{handlerSize}px;'},L:{tagName:'div',style:'left:-{edge}px;margin-top:-{edge}px;width:{handlerSize}px;height:{handlerSize}px;'},LT:{tagName:'div',style:'left:-{edge}px;top:-{edge}px;width:{handlerSize}px;height:{handlerSize}px;'},cover:{T:{tagName:'div',style:'width:100%;left:0;top:-{edge}px;height:{handlerSize}px;'},RT:{tagName:'div',style:'top:-{edge}px;right:-{edge}px;width:{handlerSize}px;height:{handlerSize}px;'},R:{tagName:'div',style:'height:100%;top:0;right:-{edge}px;width:{handlerSize}px;'},RB:{tagName:'div',style:'right:-{edge}px;bottom:-{edge}px;width:{handlerSize}px;height:{handlerSize}px;'},B:{tagName:'div',style:'width:100%;left:0;bottom:-{edge}px;height:{handlerSize}px;'},LB:{tagName:'div',style:'left:-{edge}px;bottom:-{edge}px;width:{handlerSize}px;height:{handlerSize}px;'},L:{tagName:'div',style:'height:100%;top:0;left:-{edge}px;width:{handlerSize}px;'},LT:{tagName:'div',style:'top:-{edge}px;left:-{edge}px;width:{handlerSize}px;height:{handlerSize}px;'}}});var tid=profile.template._id,template=profile.box.getTemplate(tid,hash);if(!template){var t,n;template=_.clone(profile.box.getTemplate(tid));t=pro.cover?map.cover:map;if(pro.move)template.MOVE=t.MOVE;if(pro.reHeight){if(!pro.Static)template.T=t.T;template.B=t.B}if(pro.reWidth){if(!pro.Static)template.L=t.L;template.R=t.R;if(pro.reHeight){if(!pro.Static){template.LB=t.LB;template.RT=t.RT;template.LT=t.LT}template.RB=t.RB}}n=profile.getClass(profile.key,'-handler')+" ";if(t=template.T)t.className=n;if(t=template.RT)t.className=n;if(t=template.R)t.className=n;if(t=template.RB)t.className=n;if(t=template.B)t.className=n;if(t=template.LB)t.className=n;if(t=template.L)t.className=n;if(t=template.LT)t.className=n;if(!pro.visible){n=profile.getClass(profile.key,'-hidden')+" ";if(t=template.T)t.className+=n;if(t=template.RT)t.className+=n;if(t=template.R)t.className+=n;if(t=template.RB)t.className+=n;if(t=template.B)t.className+=n;if(t=template.LB)t.className+=n;if(t=template.L)t.className+=n;if(t=template.LT)t.className+=n}profile.box.setTemplate(tid,template,hash)}profile.template=template},prepareData:function(profile){var t=profile.properties;t.handlerSize=parseInt(t.offset)*2;t.edge=t.offset+t.enlarge;if(t.child){t.offset=0;t.visible=false;t.cover=true;t.position='static';t.display='inline';t.left=t.top=t.width=t.height=0}if(!t.visible)t.visibility='hidden';arguments.callee.upper.call(this,profile)},createdTrigger:function(){this.boxing().rePosSize();this.domNode.zIndexIgnore=true;if(!this.onUpdate)this.onUpdate=function(profile,target,size,cssPos){if(target){if(size)target.widthBy(size.width,true).heightBy(size.height,true);if(cssPos)target.leftBy(cssPos.left).topBy(cssPos.top)}}},onMousedown:function(profile,e,src,ddparas){if(!profile.properties.changable)return;var ck=linb.event.currentKey;if(ck&&(ck[1]||(linb.browser.kde&&ck[0]=='space'))){profile.boxing().resetTarget(null);var pos=linb.event.getPos(e);var hash={drop2:true,icon:linb.ini.path+'ondrag.gif',dragMode:'move',target_left:pos.left+12,target_top:pos.top+12,cursor:'pointer',move:false};_.merge(hash,profile.properties.dragArgs,'all');hash.grid_width=hash.grid_height=0;hash.data.pos=profile.boxing().reBoxing().cssPos();linb([],false).startDrag(e,hash)}else{var hash,o,absPos,pos,posbak,size;if(profile.properties.child){pos=linb.event.getPos(e);linb([src],false).startDrag(e,{move:false,type:'blank',cursor:true,target_left:pos.left,target_top:pos.top})}else{o=profile.getSubNode(profile.keys.KEY);var absPos=o.absPos();pos=o.cssPos();posbak=_.copy(pos);size=o.cssSize();if(ddparas.move){var absPos=linb.event.getPos(e),posbak=_.copy(pos)}else{var absPos=o.absPos();pos=o.cssPos();posbak=_.copy(pos);size=o.cssSize();if(ddparas.left){if(ddparas.top){}else if(ddparas.bottom){pos.top=pos.top+size.height}else{pos.top=pos.top+size.height/2}}if(ddparas.right){pos.left=pos.left+size.width;if(ddparas.top){}else if(ddparas.bottom){pos.top=pos.top+size.height}else{pos.top=pos.top+size.height/2}}if(ddparas.top&&!ddparas.left&&!ddparas.right){pos.left=pos.left+size.width/2}if(ddparas.bottom&&!ddparas.left&&!ddparas.right){pos.left=pos.left+size.width/2;pos.top=pos.top+size.height}}if((t=profile.properties.dragArgs)&&(t=t.grid_width)){var offx=linb.dragDrop._proxy_size%t;if(ddparas.left){pos.left+=offx}else if(ddparas.right){pos.left+=offx}else if(ddparas.move){pos.left+=offx}}if((t=profile.properties.dragArgs)&&(t=t.grid_height)){var offy=linb.dragDrop._proxy_size%t;if(ddparas.top){pos.top+=offy}else if(ddparas.bottom){pos.top+=offy}else if(ddparas.move){pos.top+=offy}}pos.left+=parseInt((absPos.left-posbak.left)/t)*t;pos.top+=parseInt((absPos.top-posbak.top)/t)*t;var hash={move:false,type:'blank',cursor:true,target_left:pos.left,target_top:pos.top};_.merge(hash,profile.properties.dragArgs,'all');hash.target_parent=profile._parent;hash.key=null;linb([src],false).startDrag(e,hash)}}},onDragbegin:function(profile,e){if(profile.properties.child){var o=profile._target,pos=o.absPos(),w=o.offsetWidth(),h=o.offsetHeight();profile.proxy=linb.dom.getTemp();profile.proxy.html(' ',false).setStyle({border:'1px dashed',visibility:'visible'}).absPos(pos).offsetWidth(w).offsetHeight(h).zIndex(linb.ini.top_zIndex+20)}else{var o=linb([profile.domNode],false);profile.proxy=o}profile.o_pos=profile.proxy.cssPos();profile.o_w2=profile.o_w=o.width();profile.o_h2=profile.o_h=o.height();profile.$onDrag=true},onDrag:function(profile,e,src,ddparas){var o=ddparas;profile.oos=profile.oos||{};var os=linb.dragDrop.getOffset();if(os.width==profile.oos.width&&os.height==profile.oos.height)return;profile.oos=os;var x,y,w,h,t=profile.properties;if(o.left){w=profile.o_w-os.width;x=profile.o_pos.left+os.width;if(w<t.minWidth){w=t.minWidth;x=profile.o_w+profile.o_pos.left-w}else if(w>t.maxWidth){w=t.maxWidth;x=profile.o_w+profile.o_pos.left-w}profile.proxy.width(w).left(x)}else if(o.right){w=profile.o_w+os.width;if(w<t.minWidth)w=t.minWidth;else if(w>t.maxWidth)w=t.maxWidth;profile.proxy.width(w)}if(o.left||o.right){var byw=w-profile.o_w2;if(profile.regions&&byw!==0){profile.regions.widthBy(byw);profile.o_w2=w}}if(o.top){h=profile.o_h-os.height;y=profile.o_pos.top+os.height;if(h<t.minHeight){h=t.minHeight;y=profile.o_h+profile.o_pos.top-h}else if(h>t.maxHeight){h=t.maxHeight;y=profile.o_h+profile.o_pos.top-h}profile.proxy.height(h).top(y)}else if(o.bottom){h=profile.o_h+os.height;if(h<t.minHeight)h=t.minHeight;else if(h>t.maxHeight)h=t.maxHeight;profile.proxy.height(h)}if(o.top||o.bottom){var byh=h-profile.o_h2;if(profile.regions&&byh!==0){profile.regions.heightBy(byh);profile.o_h2=h}}if(o.move){x=profile.o_pos.left+os.width;y=profile.o_pos.top+os.height;profile.proxy.top(y).left(x)}},onDragend:function(profile,e,src,args){var cssPos,size,pos;var o=profile.proxy;if(!args.move)size={width:o.width()-profile.o_w,height:o.height()-profile.o_h};if(args.left||args.top||args.move){cssPos=o.cssPos();pos={left:cssPos.left-profile.o_pos.left,top:cssPos.top-profile.o_pos.top}}profile.boxing().onUpdate(profile,profile._target,size,pos);if(profile.properties.child){if(linb.browser.ie6)profile._target.ieTrigger();profile.proxy.html('',false).setStyle({visibility:'hidden',zIndex:'0',width:'0',height:'0'})}profile.boxing().active();profile.$onDrag=false}}});Class("linb.UI.Edge","linb.UI.Resizer",{Instance:{attachTo:function(target,parent,tieId){var v=this.get(0);v._target=linb(target);v._parent=parent||linb(document.body);v._parent.attach(this);this.resetTarget(v._target);v.$edgeId=linb(target).id();if(v.properties.borderActive){var t=v.behavior.TAG;var s=linb(tieId);if(s)s.addObserver('afterMouseover','tag',-1,t.afterMouseover,[v]).addObserver('afterMouseout','tag',-1,t.afterMouseout,[v]).addObserver('afterMouseover','tag',-1,t.afterMouseover,[v]).addObserver('afterMouseout','tag',-1,t.afterMouseout,[v])}return this},setChecked:function(v){return this.each(function(profile){if(v)profile.addTagClass(profile.root,profile.keys.KEY,'-checked');else profile.removeTagClass(profile.root,profile.keys.KEY,'-checked')})}},Initialize:function(){_.each({edged:function(properties,target,onUpdate,tieId){var o=this.get(0);properties=_.hash(properties);var r=new linb.UI.Edge(properties).attachTo(target||o,linb([o],false),tieId);if(onUpdate)r.onUpdate(onUpdate);return r},isEdged:function(){var s=this.id(),b=false;linb.UI.Edge._cache.each(function(o){if(o.$edgeId==s){b=true;return false}});return b},getEdge:function(){var s=this.id(),b=null;linb.UI.Edge._cache.each(function(o){if(o.$edgeId==s){b=o;return false}});return b&&b.boxing()},unEdged:function(){var s=this.id();linb.UI.Edge._cache.each(function(o){if(o.$edgeId==s)o.boxing().destroy()});return this}},function(o,i){linb.dom.plugIn(i,o)})},Static:{Appearances:{'default':{KEY:{position:'static',width:'0',height:'0','_font-size':'0px','_line-height':'0px',visibility:'hidden','z-index':'50'},'T, RT, R, RB, B, LB, L, LT':{$order:1,position:'absolute',display:'block',border:'solid 1px','z-index':'30',visibility:'visible','_font-size':'0px','_line-height':'0px'},'RT, RB, LB, LT':{'z-index':'40','_font-size':'0px','_line-height':'0px'},T:{background:linb.UI.getCSSImgPara('v.gif',' repeat-x left top')},B:{background:linb.UI.getCSSImgPara('v.gif',' repeat-x left bottom')},'KEY-mouseover T, KEY-mouseover B':{$order:1,'background-image':linb.UI.getCSSImgPara('v_mouseover.gif')},'KEY-checked T, KEY-checked B, KEY-mousedown T, KEY-mousedown B':{$order:2,'background-image':linb.UI.getCSSImgPara('v_mousedown.gif')},L:{background:linb.UI.getCSSImgPara('h.gif',' repeat-y left top')},R:{background:linb.UI.getCSSImgPara('h.gif',' repeat-y right top')},'KEY-mouseover L, KEY-mouseover R':{$order:1,'background-image':linb.UI.getCSSImgPara('h_mouseover.gif')},'KEY-checked L, KEY-checked R, KEY-mousedown L, KEY-mousedown R':{$order:2,'background-image':linb.UI.getCSSImgPara('h_mousedown.gif')},LT:{background:linb.UI.getCSSImgPara('corner.gif',' no-repeat left top')},RT:{background:linb.UI.getCSSImgPara('corner.gif',' no-repeat right top')},RB:{background:linb.UI.getCSSImgPara('corner.gif',' no-repeat right bottom')},LB:{background:linb.UI.getCSSImgPara('corner.gif',' no-repeat left bottom')},'KEY-mouseover LT, KEY-mouseover RT, KEY-mouseover RB, KEY-mouseover LB':{$order:1,'background-image':linb.UI.getCSSImgPara('corner_mouseover.gif')},'KEY-checked LT, KEY-checked RT, KEY-checked RB, KEY-checked LB, KEY-mousedown LT, KEY-mousedown RT, KEY-mousedown RB, KEY-mousedown LB':{$order:2,'background-image':linb.UI.getCSSImgPara('corner_mousedown.gif')},HIDDEN:{$order:20,'border-width':'0'}}},Behaviors:{'default':{_hoverEffect:{TAG:'KEY'},_clickEffect:{TAG:'KEY'}}},DataModel:{child:true,borderActive:false,changable:false}}});Class("linb.UI.IFrame",["linb.UI.iWidget","linb.UI.iMisc"],{Instance:{submit:function(action,data,method,enctype,flag){data=_.hash(data);method=_.str(method,'get').toUpperCase();action=_.str(action);var _t=[];_.each(data,function(o,i){_t.push('<textarea name="'+i+'">'+(typeof o=='object'?_.serialize(o):o)+'</textarea>')});var formStr='<form target="'+this.get(0).domId+'" action="'+action+'" method="'+method+(enctype?'" enctype="'+enctype:'')+'">'+_t.join('')+'</form>';var form=formStr.toDom(false);if(linb.browser.ie6)linb.temp.cancelBeforeload=true;if(flag){linb.dom.setCover('Getting file...');linb.iframeTrigger=function(){linb.dom.setCover(false);delete linb.iframeTrigger}}form.get(0).submit();form.remove()}},Initialize:function(){},Static:{cssNone:true,Templates:{'default':{style:'{left}{top}{width}{height}{right}{bottom}{zIndex}{position}',tagName:'iFrame',name:'{name}',src:'{src}'}},Behaviors:{'default':{onLoad:function(profile){if(profile.onResponse)profile.boxing().onResponse(profile,profile.box.getBody(profile.domNode).innerHTML)}}},Appearances:{'default':{}},DataModel:{width:100,height:100,src:{ini:'',action:function(v){if(this.domNode)this.root.src(v)}}},EventHandlers:{onLoad:function(profile,response){}},prepareData:function(profile){arguments.callee.upper.apply(this,arguments);profile.data.name=profile.key+":"+linb.UI.$ID+":"},createdTrigger:function(){},getBody:function(i){return(i.contentDocument||i.document).body}}});Class("linb.DataSource.Memory","linb.DataSource",{Instance:{request:function(flag){var pro=this.profile,prop=pro.properties,memory=prop.memory;if(memory){if(flag)linb.message(prop.test='Memory reqeust OK');prop.value=_.clone(memory);this.responseToBinder(flag);if(pro.onDataChanged)this.onDataChanged(pro,prop.value);this.onRequestOK(pro,prop.value,flag)}else{if(flag)linb.message(prop.test='err');this.onRequestFail(pro,'No memory data exists!')}},response:function(){var self=this.profile;self.properties.memory=self.properties.value}},Static:{DataModel:{memory:{ini:{}}}}});Class("linb.DataSource.Ajax","linb.DataSource",{Instance:{request:function(flag){var o,self=this,pro=this.profile,prop=pro.properties;linb.request((prop.$design?prop.$design+'/':'')+prop.url+'?'+_.timeStamp(),prop.queryString,function(str){o=_.unserialize(str);if(o===false){var msg='Not valid JSON format!';linb.message(msg);if(flag)prop.test=msg}else{if(flag)linb.message(prop.test='Ajax reqeust OK');prop.value=o;self.responseToBinder(flag);if(pro.onDataChanged)self.onDataChanged(pro,prop.value);pro.boxing().onRequestOK(pro,prop.value,flag)}},function(str){if(flag)linb.message(prop.test=str);pro.boxing().onRequestFail(pro,str)},prop.asy,prop.method,prop.threadid,_.clone(prop.args))},response:function(){var self=this.profile}},Static:{DataModel:{url:{ini:''},queryString:'',asy:true,method:{ini:'GET',listbox:['GET','POST']},args:{ini:{}}}}});linb.ini('jsLinb/js/');