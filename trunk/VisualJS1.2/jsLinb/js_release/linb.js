_=function(){return new Date().getTime()};_.merge=function(target,source,type){var i,f;if(typeof type=="function"){f=type;type="fun"}switch(type){case"fun":for(i in source){if(true===f(source[i],i)){target[i]=source[i]}}break;case"all":for(i in source){target[i]=source[i]}break;case"with":for(i in source){if(i in target){target[i]=source[i]}}break;default:for(i in source){if(!(i in target)){target[i]=source[i]}}}return target};_.merge(_,{get:function(hash,arr){for(var i=0,l=arr.length;i<l;){if(!hash||typeof (hash=hash[arr[i++]])=="undefined"){return }}return hash},set:function(hash,arr,value){var v,i,m,last=arr.length-1,key=arr[last];for(i=0;i<last;){v=arr[i++];if(hash[v]&&((m=typeof hash[v])=="object"||m=="function")){hash=hash[v]}else{hash=hash[v]={}}}if(typeof value=="undefined"){delete hash[key]}else{return hash[key]=value}},fun:function(){return function(){}},tryF:function(fun,args,target,df){return(fun&&typeof fun=="function")?fun.apply(target||null,args||[]):df},asyRun:function(fun,defer,args,target){return setTimeout(typeof fun=="string"?fun:function(){fun.apply(target,args||[]);fun=args=null},defer||0)},isEmpty:function(hash){for(var i in hash){return false}return true},resetRun:function(key,fun,defer,args,target){var me=arguments.callee,k=key,cache=me.cache||(me.cache={});if(cache[k]){clearTimeout(cache[k])}if(typeof fun=="function"){cache[k]=setTimeout(function(){delete cache[k];fun.apply(target||null,args||[])},defer||0)}else{delete cache[k]}}});Class=function(key,parent_key,o){var _Static,_Instance,_parent=[],self=Class,env=self._fun,reg=self._reg,parent0,temp,_this,i,t;o=o||{};if(t=_.get(window,key.split("."))){return t}parent_key=(!parent_key?[]:typeof parent_key=="string"?[parent_key]:parent_key);for(i=0;t=parent_key[i];i++){if(!(_parent[i]=(_.get(window,t.split("."))||(linb&&linb.SC&&linb.SC(t))))){throw new Error("No parent class :"+t)}}if(o.Dependency){for(i=0;t=o.Dependency[i];i++){if(!(_.get(window,t.split("."))||(linb&&linb.SC&&linb.SC(t)))){throw new Error("No dependency class :"+t)}}}parent0=_parent[0];_Static=o.Static||{};t={};for(i in _Static){if(reg[i]){t[i]=1}}for(i in t){delete _Static[i]}_Static.Before=o.Before||(parent0&&parent0.Before);_Static.After=o.After||(parent0&&parent0.After);_Static.$gc=o.$gc||_Static.$gc||function(){Class.$gc(this.$key)};_Instance=o.Instance||{};if(typeof o.Constructor=="function"){_this=env(o.Constructor,"Constructor",key,parent0||_.fun());_this.Constructor=String(o.Constructor)}else{if(parent0){var f=_.fun(),str=parent0.Constructor;if(str){f=new Function(str.slice(str.indexOf("(")+1,str.indexOf(")")).split(","),str.slice(str.indexOf("{")+1,str.lastIndexOf("}")))}_this=env(f,"Constructor",key,parent0.upper);_this.Constructor=str}else{_this=_.fun()}}_this.KEY=_this.$key=_this.prototype.KEY=_this.prototype.$key=key;self._ob(_parent,_this,_Static);self._ob(_parent,_this.prototype,_Instance,false,true);for(i=0;t=_parent[i];i++){temp=_this.upper;self._ob(_parent,_this,t,true);_this.upper=temp;self._ob(_parent,_this.prototype,t.prototype,true,true)}if(_.tryF(_this.Before,arguments,_this,true)===false){return false}for(i=0;t=_parent[i];i++){t=(t.$children||(t.$children=[]));for(var j=0,k=t.length,b;j<k;j++){if(t[k]==key){b=true;break}}if(!b){t[t.length]=key}}_this.$linb$=true;_this.$children=[];_this.$parent=_parent;_this.prototype.constructor=_this;_this[key]=_this.prototype[key]=true;_.set(window,_this.KEY.split("."),_this);_.tryF(_this.After,[],_this);_.tryF(o.Initialize,[],_this);_parent.lenght=0;_Static=_Instance=_parent=o=null;return _this};_.merge(Class,{_reg:{$key:1,$parent:1,$children:1,KEY:1,Static:1,Instance:1,Constructor:1,Initialize:1},_reg2:{constructor:1,prototype:1,toString:1,valueOf:1},_fun:function(fun,name,original,upper){fun.$name$=name;fun.$original$=original;if(upper){fun.upper=upper}return fun},_upper:function(o,i,flag){for(var r,v,j=0;v=o[j++];){if(typeof (r=(flag?v.prototype[i]:v[i]))=="function"){break}}return r},_other:["toString","valueOf"],_o:{},_ob:function(parent,target,src,inherit,instance){var self=this,i,j,o;for(i in src){if((i in target)||(i.charAt(0)=="$"&&inherit)||self._reg2[i]||(!instance&&self._reg[i])){continue}o=src[i];if(o&&o.$linb$){continue}target[i]=(inherit||typeof o!="function"||o.$ignore$)?o:self._fun(o,i,target.KEY,self._upper(parent,i,instance))}for(j=0;i=self._other[j++];){o=src[i];if(o&&(o==self._o[i])){continue}target[i]=(inherit||typeof o!="function"||o.$ignore$)?o:self._fun(o,i,target.KEY,self._upper(parent,i,instance))}},$gc:function(key){var t=_.get(window,key.split("."));if(t){for(var i=0,o;t=t.$children[i];i++){o=_.get(window,o.split("."));o.$gc()}t.$parent.length=t.$children.length=0;_.set(window,key.split("."))}}});linb=function(nodes,flag){return linb.dom.pack(nodes,flag)};_.merge(linb,{cache:{dom:{},domId:{},time:{},template:{},hookKey:{},event:{},thread:{},SC:{},text:{},block:{}},ini:function(path){linb.ini.path=path},Locale:{en:{}},lang:"en",langId:"linb_lang",reLang:function(s,cb){var l=linb.Locale,g=linb.getRes,t,v,i,j,f,m,z,a=[];linb.lang=s;v=linb.browser.ie?document.all.tags("span"):document.getElementsByTagName("span");for(i=0;t=v[i];i++){if(t.id==linb.langId){a[a.length]=t}}f=function(){setTimeout(function(){j=a.splice(0,100);for(i=0;t=j[i];i++){if(typeof (v=g(t.className))=="string"){t.innerHTML=v}}if(a.length){setTimeout(arguments.callee,0)}_.tryF(cb)},0)},z="linb.Locale."+s,m=function(){linb.include(z+"."+linb.ini.appLangKey,linb.getPath("Locale."+s,".js"),f,f)};linb.include(z,linb.getPath(z,".js"),m,m)},_r:/\x24(\d+)/g,getRes:function(a){var d,b=a.indexOf("-")!=-1?((d=a.split("-"))&&(a=d[0])&&d):arguments,c=_.get(linb.Locale[linb.lang],a.split("."));return(d=typeof c)=="string"?c.replace(linb._r,function(z,a){return b[parseInt(a)+1]||z}):d=="function"?c.apply(null,b):c?String(c):a.substr(a.lastIndexOf(".")+1)},wrapRes:function(){var id=arguments[0],s,r;if(id.charAt(0)=="$"){arguments[0]=id.substr(1,id.length-1)}s=arguments[0];r=linb.getRes.apply(null,arguments);if(s==r){r=id}return'<span id="'+linb.langId+'" class="'+s+'">'+r+"</span>"},request:function(){if(!arguments[1]){arguments[1]=String(_())}return(linb.io.crossDomain(arguments[0])?linb.sajax:linb.ajax).apply(null,arguments).start()},include:function(k,s,f,g){if(k&&linb.SC.evalPath(k)){_.tryF(f)}else{linb.sajax(s,"",f,g,0,{rspType:"script"}).start()}},_m:[],main:function(f){linb._m.push(f)},getPath:function(key,tag,add){key=key.split(".");if(add){var a=[key[0],add];for(var i=1,l=key.length;i<l;i++){a.push(key[i])}key.length=0;key=a}var pre,ini=linb.ini;if(key[0]=="linb"){pre=ini.path;key.shift();if(key.length==(add?1:0)){key.push("linb")}}else{pre=ini.appPath;if(key.length==((add?1:0)+1)){key.push("index")}}if(ini.ver){pre=pre+ini.ver+"/"}return pre+key.join("/")+(tag||"/")},temp:{},log:_.fun(),message:_.fun(),_object:[],getObject:function(id){return linb._object[id]}});new function(){_.merge(linb.ini,{appPath:location.href.split("?")[0].replace(/[^\\\/]+$/,""),appLangKey:"app",file_bg:"bg.gif",file_xd:"xd.html"});var i,s,arr=document.getElementsByTagName("script"),reg=/js\/linb\.js$/;for(i=0;s=arr[i];i++){if(s.src.match(reg)){linb.ini.path=s.src.replace(reg,"");break}}var w=window,u=navigator.userAgent.toLowerCase(),d=document,b=linb.browser={ver:(u.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],kde:/webkit/.test(u),opr:/opera/.test(u),ie:/msie/.test(u)&&!/opera/.test(u),gek:/mozilla/.test(u)&&!/(compatible|webkit)/.test(u)};if(b.ie){if(u.indexOf(" 7")!=-1){b.ie7=true}else{b.ie6=true;try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}w.XMLHttpRequest=function(){return new ActiveXObject("Msxml2.XMLHTTP")}}}b.contentBox=function(n){return(b.ie||b.opr)?!/BackCompat|QuirksMode/.test(d.compatMode):(n=(n=n||d.documentElement).style["-moz-box-sizing"]||n.style["box-sizing"])?(n=="content-box"):true}();var f=function(){if(d.addEventListener&&!b.kde){d.removeEventListener("DOMContentLoaded",arguments.callee,false)}try{for(var i=0,l=linb._m.length;i<l;i++){_.tryF(linb._m[i])}linb._m.length=0}catch(e){_.asyRun(function(){throw e})}};if(d.addEventListener&&!b.kde){d.addEventListener("DOMContentLoaded",f,false)}else{if(b.ie){(function(){try{d.activeElement.id;d.documentElement.doScroll("left");f()}catch(e){setTimeout(arguments.callee,1)}})()}else{(function(){/loaded|complete/.test(d.readyState)?f():setTimeout(arguments.callee,1)})()}}};Class("linb.thread",null,{Constructor:function(id,tasks,delay,callback,onStart,onEnd,cycle){var self=this,me=arguments.callee,t=linb.cache.thread;if(self.constructor!==me||!!self.id){return new me(id,tasks,delay,callback,onStart,onEnd,cycle)}if(typeof id!="string"){id="$"+(self.constructor.id++)}self.id=id;self.profile=t[id]||(t[id]={id:id,_start:false,time:0,_left:0,_asy:-1,index:0,tasks:tasks||[],delay:delay||0,callback:callback||_.fun(),onStart:onStart||_.fun(),onEnd:onEnd||_.fun(),cache:{},status:"run",cycle:!!cycle})},Instance:{$gc:function(){var m=linb.cache.thread,t=m[this.id];if(t){delete m[this.id];t.tasks.length=0;for(var i in t){t[i]=null}}},_task:function(){var self=this,p=self.profile,t={args:[]},value=p.tasks[p.index],r;p._asy=-1;if(typeof value=="function"){t.task=value}else{_.merge(t,value,"all")}if(!t.task){return }_.merge(t,{delay:p.delay,callback:p.callback});t.args.push(p.id);p.index++;p.time=_();try{r=_.tryF(t.task,t.args,t.target,null);if(p.status!=="run"){return }if(t.id){p.cache[t.id]=r}if(t.callback){if(false===_.tryF(t.callback,[p.id],null,true)){p.status="stop";return }}}catch(e){self.abort();linb.logger&&linb.logger.trace(e)}if(!p||p.status!=="run"){return }self.start()},start:function(time){var self=this,p=self.profile,delay;if(p._start===false){p._start=true;if(false===_.tryF(p.onStart,[p.id],self)){self.abort()}}if(!p.tasks.length){return self.abort()}if(p.index>=p.tasks.length){if(p.cycle===true){self.profile.index=0}else{return self.abort()}}delay=p.tasks[p.index].delay;if(typeof delay=="undefined"){delay=p.delay}p._left=(time||time===0)?time:delay;if(p._asy!=-1){clearTimeout(p._asy)}p._asy=_.asyRun(self._task,p._left,[],self);p.time=_();return self},suspend:function(){var n,p=this.profile;if(p.status=="pause"){return }p.status="pause";if(p._asy!==-1){clearTimeout(p._asy);if(p.index>0){p.index--}}n=p._left-(_()-p.time);p._left=(n>=0?n:0);return this},resume:function(time){var self=this;if(self.profile.status=="run"){return }time=typeof time=="undefined"?self.profile._left:(time||time===0)?(time>=0)?time:0:(time===true)?self.profile.delay:0;self.profile.status="run";self.start(time);return self},abort:function(){var t=this.profile;clearTimeout(t._asy);_.tryF(t.onEnd,[t.id]);this.$gc();return },insert:function(arr,index){var self=this,o=self.profile.tasks,l=o.length,a;if(arr.constructor!=Array){arr=[arr]}index=index||self.profile.index;if(index<0||index>l){index=l}a=o.splice(index,l-index);o.push.apply(o,arr);o.push.apply(o,a);return self},getCache:function(key){return this.profile.cache[key]},setCache:function(key,value){this.profile.cache[key]=value;return this}},After:function(){var self=this,f=function(i){self[i]=function(id){var t;if(linb.cache.thread[id]){(t=linb.thread(id))[i].apply(t,Array.prototype.slice.call(arguments,1))}}},a="start,suspend,resume,abort".split(",");for(var i=0,l=a.length;i<l;i++){f(a[i])}},Static:{id:1,$gc:function(){linb.cache.thread={}},exists:function(threadid){return !!linb.cache.thread[threadid]},asyUI:function(threadid,tasks,onEnd){var thread=linb.thread,dom=linb.dom;if(linb.cache.thread[threadid]){if(typeof onEnd=="function"){tasks.push(onEnd)}thread(threadid).insert(tasks)}else{thread(null,tasks,0,null,function(threadid){if(dom){dom.busy(true,threadid)}},function(threadid){_.tryF(onEnd);if(dom){dom.free(threadid)}}).start()}},group:function(id,group,callback,onStart,onEnd){var bak={},thread=linb.thread,f=function(o,i,threadid){if(typeof o=="string"){o=thread(o)}if(o){var f=function(){var me=arguments.callee;_.tryF(me.onEnd,arguments,this);me.onEnd=null;delete bak[i];_.tryF(callback,[i,threadid],this);if(_.isEmpty(bak)){thread.resume(threadid)}};f.onEnd=o.profile.onEnd;o.profile.onEnd=f;o.start()}};for(var i in group){bak[i]=1}return thread(id,[function(threadid){if(!_.isEmpty(group)){thread.suspend(threadid);for(var i in group){f(group[i],i,threadid)}}}],0,null,onStart,onEnd)}}});Class("linb.io",null,{Constructor:function(uri,queryString,onSuccess,onFail,threadid,args){if(typeof uri=="object"){args=uri}else{args=args||{};_.merge(args,{uri:uri,queryString:queryString,onSuccess:onSuccess,onFail:onFail,threadid:threadid})}var self=this,me=arguments.callee,con=self.constructor;if((con!==me)||self.id){return new me(args)}_.merge(args,{id:args.id||(_()+""+(con.id++)),uri:args.uri||"",queryString:args.queryString||"",asy:args.asy!==false,method:"POST"==(args.method||con.method).toUpperCase()?"POST":"GET"},"all");var a="retry,timeout,rspType,customQS".split(",");for(var i=0,l=a.length;i<l;i++){args[a[i]]=(a[i] in args)?args[a[i]]:con[a[i]]}_.merge(self,args,"all");if(con.events){_.merge(self,con.events,"without")}_.merge(self,con._ev,"without");if(self.customQS){self.queryString=self.customQS(self.queryString)}if(!self._useForm&&typeof self.queryString!="string"){self.queryString=con.buildQS(self.queryString)}return self},Instance:{_fun:_.fun(),_flag:0,_response:"",_retryNo:0,_end:false,_message:function(){},_time:function(){var self=this,c=self.constructor;self._clear();if(self._retryNo<self.retry){self._retryNo++;self._e("Retry",self._retryNo);self.start()}else{self._e("Timeout");self._e("Error",new Error("timout"))}},_e:function(n,o){var self=this,r;try{r=_.tryF(self["on"+n],[o],self)}catch(e){linb.logger&&linb.logger.trace(e)}if(n=="Response"||n=="Error"||n=="Abort"){self._end=true;if(self._flag>0){clearTimeout(self._flag);self._flag=0}self._e("End");self._clear()}},abort:function(){this._e("Abort")}},Static:{$i:true,id:1,method:"GET",retry:2,timeout:10000,rspType:"text",randkey:"randkey",callback:"callback",buildQS:function(h){var a=[],i,o;for(i in h){o=h[i];a.push(encodeURIComponent(i)+"="+encodeURIComponent(o))}return a.join("&")},_ev:{onRetry:function(retry){this._message("retry:"+retry)},onTimeout:function(){this._message("timeout")},onStart:function(){linb.thread.suspend(this.threadid)},onEnd:function(){linb.thread.resume(this.threadid)},onResponse:function(){var self=this;if(false===_.tryF(self.beforeSuccess,[self._response,self.rspType,self.threadid],self)){return }_.tryF(self.onSuccess,[self._response,self.rspType,self.threadid],self)},onError:function(e){var self=this;_.tryF(self.beforeFail,[e,self.threadid],self);_.tryF(self.onFail,[self._response,self.rspType,self.threadid],self)}},response:function(txt,r,i,l){var self=this,obj,o;try{if(r){i=parseFloat(i);l=parseFloat(l);if(o=self.pool[r]){o=o.__||(o.__=[]);o[i]=txt;while(l--){if(typeof o[i]=="undefined"){return }}if(obj=_.unserialize(o.join(""))){o._response=obj;o._e("Response")}}}else{obj=typeof txt=="string"?_.unserialize(txt):txt;if(obj&&(o=self.pool[obj[self.randkey]])){for(i=0;i<o.length;i++){o[i]._response=obj;o[i]._e("Response")}}}}catch(e){linb.logger&&linb.logger.trace(e)}},createif:function(doc,content,id,src,onLoad){var n=doc.createElement(linb.browser.ie?"<iframe name='"+id+"'>":"iframe"),w,d;if(id){n.id=n.name=id}if(src){n.src=src}if(onLoad){n.onload=onLoad}n.style.display="none";doc.body.appendChild(n);w=frames[frames.length-1];d=w.document;d.open();d.write(content||"");d.close();return[n,w,d]},crossDomain:function(uri){var me=arguments.callee,r=me.r||(me.r=/(http(s)?\:\/\/)?([\w\.]+(:[\d]+)?)(.*)/),t;if((t=uri.indexOf(":"))==-1||t>uri.indexOf("/")){return false}if(uri.indexOf("file:")===0){return !!location.host}return location.host!=uri.replace(r,"$3")},group:function(group,callback,onStart,onEnd){var i,f=function(o,i,group){group[i]=linb.thread(null,[function(threadid){o.threadid=threadid;o.start()}])};for(i in group){f(group[i],i,group)}return linb.thread.group(null,group,callback,onStart,onEnd)},background:function(arr,callback,onStart,onEnd,threadid){var i=0,fun=function(threadid){var o=arr[i++];o.threadid=threadid;this(o).start();if(arr.length<=i){return linb.thread(threadid).abort()}};linb.thread(threadid||null,[fun],100,callback,onStart,onEnd,true).start()}}});Class("linb.ajax","linb.io",{Instance:{_XML:null,start:function(){var self=this,t;if(t=_.tryF(self.beforeStart,[],self)){return _.tryF(self.onSuccess,[t,self.rspType,self.threadid],self)}if(!self._retryNo){self._e("Start")}try{with(self){var x=_XML=new XMLHttpRequest();if(asy){x.onreadystatechange=function(){if(self&&x&&x.readyState==4){self._complete.apply(self);self._clear()}}}if(!_retryNo&&method!="POST"){if(queryString){uri=uri.split("?")[0]+"?"+queryString}queryString=null}if(x.overrideMimeType){x.overrideMimeType("text/xml")}x.open(method,uri,asy);if(method!="POST"){x.setRequestHeader("Content-type","application/x-www-form-urlencoded")}x.setRequestHeader("X-Requested-With","XMLHttpRequest");if(x.overrideMimeType){x.setRequestHeader("Connection","close")}try{x.send(queryString)}catch(e){}if(asy){if(x&&timeout>0){_flag=_.asyRun(function(){if(self&&!self._end){self._time()}},self.timeout)}}else{_complete()}}}catch(e){self._e("Error",e)}return self},abort:function(){var self=this,x=self._XML;if(x){x.onreadystatechange=self._fun;x.abort();self._XML=null}arguments.callee.upper.call(self)},_clear:function(){var self=this,x=self._XML;if(x){x.onreadystatechange=self._fun;self._XML=null}},_complete:function(){with(this){var x=_XML,status=x.status;_response=rspType=="text"?x.responseText:x.responseXML;if(typeof status=="undefined"||status===0||status==304||(status>=200&&status<300)){_e("Response")}else{_e("Error",new Error("XMLHTTP return "+status))}}}}});Class("linb.sajax","linb.io",{Instance:{start:function(){var self=this,id,c=self.constructor,t,n,ok=false;if(t=_.tryF(self.beforeStart,[],self)){return _.tryF(self.onSuccess,[t,self.rspType,self.threadid],self)}if(!self._retryNo){self._e("Start")}id=self.id;if(c.pool[id]){c.pool[id].push(self)}else{c.pool[id]=[self]}var w=c._n=document;n=self.node=w.createElement("script");n.src=self.uri+(self.queryString?"?"+self.queryString:"");n.type="text/javascript";n.charset="utf-8";n.id="linb:script:"+self.id;n.onload=n.onreadystatechange=function(){var t=this.readyState;if(!ok&&(!t||t=="loaded"||t=="complete")){ok=true;if(self.rspType=="script"){self._e("Response")}else{self._loaded()}}};n.onerror=function(){self._loaded()};w.body.appendChild(n);if(self.timeout>0){self._flag=_.asyRun(function(){if(self&&!self._end){self._time()}},self.timeout)}},_clear:function(){var self=this,n=self.node,c=self.constructor,div=c.div||(c.div=c._n.createElement("div")),pool=self.constructor.pool;pool.length=0;delete pool[self.id];if(n){self.node=n.id=n.onload=n.onreadystatechange=n.onerror=null;if(self.rspType!="script"){div.appendChild(n.parentNode&&n.parentNode.removeChild(n)||n);div.innerHTML=""}}},_loaded:function(){var self=this;_.asyRun(function(){if(self.id&&self.constructor.pool[self.id]){self._e("Error",new Error("script error"))}},200)}},Static:{pool:{},customQS:function(obj){var c=this.constructor,k=c.randkey,b=c.callback,nr=(this.rspType!="script"),rand=nr?k+"="+this.id+"&":"";if(typeof obj=="string"){return(obj&&obj+"&")+rand+(nr?b+"=linb.sajax.response":"")}else{if(nr){obj[k]=this.id;obj[b]="linb.sajax.response"}return obj}}}});Class("linb.iajax","linb.io",{Instance:{_useForm:true,start:function(){var self=this,c=self.constructor,i,id,t,n,k,o,b,form,ok=false;if(t=_.tryF(self.beforeStart,[],self)){return _.tryF(self.onSuccess,[t,self.rspType,self.threadid],self)}if(!self._retryNo){self._e("Start")}id=self.id;if(c.pool[id]){c.pool[id].push(self)}else{c.pool[id]=[self]}var a=c.createif(document,null,(id="linb:if:"+self.id));self.node=a[0];self.frm=a[1];form=self.form=document.createElement("form");form.style.display="none";form.action=self.uri;form.method=self.method;form.target=id;k=self.queryString||{};for(i in k){if(typeof k[i]=="string"){t=document.createElement("input");t.id=t.name=i;t.value=k[i];form.appendChild(t)}else{if(k[i]&&k[i].nodeName=="INPUT"){k[i].id=k[i].name=i;form.appendChild(k[i]);b=true}}}if(self.method=="POST"&&b){form.enctype="multipart/form-data";if(form.encoding){form.encoding=form.enctype}}document.body.appendChild(form);form.submit();if(!linb.browser.opr){(function(){if(self._c()){self._tf=setTimeout(arguments.callee,50)}})()}if(self.timeout>0){self._flag=_.asyRun(function(){if(self&&!self._end){self._time()}},self.timeout)}},_c:function(){var self=this;if(!self._end){var frms=self.frm.frames,s,i,l,t;if(l=frms.length){try{if(frms[0].location.href.split("#")[0]!=self.constructor.dummy){return true}s=[];for(i=0;i<l;i++){t=(frms[i].location.href).split("#")[1];if(t.indexOf("s=")!=-1){t=t.split("s=")[1];t=t.split("&")[0]}s.push(t||"")}}catch(e){return true}self.constructor.response(decodeURIComponent(s.join("").replace(/\+/g," ")));return false}}return true},_clear:function(){var self=this,n=self.node,f=self.form,c=self.constructor,div=c.div||(c.div=document.createElement("div"));self.form=self.node=self.frm=null;clearTimeout(self._tf);if(n){div.appendChild(n.parentNode.removeChild(n))}if(f){div.appendChild(f.parentNode.removeChild(f))}div.innerHTML=""}},Static:{method:"POST",retry:0,pool:{},getDummyRes:function(){var ns=this,arr,o,d=document,i=linb.ini,b=linb.browser,h=window.location.href,f=ns.crossDomain;if(ns.dummy){return ns.dummy}if(b.opr){return ns.dummy=i.path+i.file_xd}if(b.gek){arr=d.getElementsByTagName("link");for(var i=0,j=arr.length;i<j;i++){o=arr[i];if(o.rel=="stylesheet"&&!f(o.href)){return ns.dummy=o.href.split("#")[0]}}}if(!d.getElementById("linb:img:bg")){o=d.createElement("img");o.src=i.path+i.file_bg;o.style.display="none";d.body.appendChild(o)}arr=d.getElementsByTagName("img");for(var i=0,j=arr.length;i<j;i++){o=arr[i];if(!f(o.src)){return ns.dummy=o.src.split("#")[0]}}},tpl:function(){return'<iframe src="'+this.getDummyRes()+'#"></iframe>'},customQS:function(obj){var c=this.constructor;obj.method="ipost";obj.tpl=c.tpl();obj[c.randkey]=this.id;return obj}}});Class("linb.SC",null,{Constructor:function(path,onEnd,flag,args){var p=linb.cache.SC,r;if(r=p[path]||(p[path]=_.get(window,path.split(".")))){_.tryF(onEnd,[],r)}else{args=args||{};args.$cb=onEnd;r=p[path]=linb.SC._call(path||"",args,flag)}return r},Static:{$gc:function(k){for(var i in linb.cache.SC){if(i.indexOf(".")==-1){window[i]=undefined}}linb.cache.SC={}},evalPath:function(path,obj){var i,l,o=obj||window,arr=path.split(".");if(path==""){return o}for(i=0,l=arr.length;i<l;++i){if(typeof o[arr[i]]=="undefined"){return null}else{o=o[arr[i]]}}return o},_call:function(s,args,flag){flag=!!flag;var i,t,r,o,funs=[],ep=linb.SC.evalPath,ct=linb.cache.text,f=function(text,n,threadid){var self=this;if(text){if(!ep(s)){if(self.$p){(self.$cache||ct)[self.$name]=text}else{try{eval(text)}catch(e){throw new Error('eval error "'+e+self.$tag+'" in SC')}}}}_.tryF(self.$cb,[self.$name,text,threadid],ep(s))},fe=function(text){var self=this;_.tryF(self.$cb,[self.$name,text,self.threadid],ep(s))};if(!(r=ep(s))){if(t=ct[s]){flag=false;f.call({$cb:args.$cb},t);delete ct[s]}if(!(r=ep(s))){o=linb.getPath(s,".js","js");args=args||{};args.$tag=s;var ajax;if(flag&&!args.$p){args.rspType="script";ajax=linb.sajax}else{args.asy=flag;ajax=linb.ajax}ajax(o,"",f,fe,null,args).start();if(!flag){r=ep(s)}}}else{if(args.$cb){f.call(args)}}return r},prepare:function(arr,cache,callback,onEnd,id){var bak={},args={$p:1,$cache:cache};for(var i=0,l=arr.length;i<l;i++){bak[arr[i]]=1}if(callback||onEnd){args.$cb=function(key,str){_.tryF(callback,[key,str]);delete bak[key];if(_.isEmpty(bak)){_.tryF(onEnd,[id]);onEnd=null}}}for(var i=0,s;s=arr[i++];){this._call(s,_.merge({$name:s},args),true)}},background:function(arr,callback,onStart,onEnd,id){var i=0,j,self=this,fun=function(threadid){while(self.evalPath(j=arr[i++])&&arr.length>i){}if(arr.length<=i){linb.thread(threadid).abort()}else{self._call(j,{threadid:threadid},true)}};linb.thread(id||null,[fun],1000,callback,onStart,onEnd,true).start()},clearPrepare:function(){var i,h=linb.cache.text;for(i in h){try{eval(h[i])}catch(e){throw new Error('eval error "'+e+'" in SC')}}linb.cache.text={}},group:function(arr,callback,onEnd,id){if(arr){var self=this;self.clearPrepare();self.prepare(arr,linb.cache.text,callback,function(){self.clearPrepare();_.tryF(onEnd,[id]);onEnd=null},id)}else{_.tryF(onEnd,[id])}}}});new function(){var M={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},H={"$window$":"window","$this$":"this"},A=/[\x00-\x1f\x7f-\x9f\\\"]/g,B=/[^\x00-\xff]/g,C=/^\s*\x7b/,R=function(n){return n<10?"0"+n:n},F="function",N="number",L="boolean",S="string",O="object",T={};T[L]=function(x){return String(x)};T[N]=function(x){return isFinite(x)?String(x):"null"};T[S]=function(x){return H[x]||'"'+(A.test(x)?x.replace(A,function(a,b){if(b=M[a]){return b}b=a.charCodeAt();return"\\u00"+Math.floor(b/16).toString(16)+(b%16).toString(16)}):B.test(x)?x.replace(B,function(a,b){if(b=M[a]){return b}b=a.charCodeAt();return"\\u"+Math.floor(b/16).toString(16)+(b%16).toString(16)}):x)+'"'};T[O]=function(x){var me=arguments.callee,map=me.map||(me.map={prototype:1,constructor:1,toString:1,valueOf:1});if(x){var a=[],b=[],c=x.constructor,f,i,l,v;if((typeof x==O||typeof x==F)&&typeof c!=F){return"$alien"}else{if(c==Array){a[0]="[";l=x.length;for(i=0;i<l;++i){if(f=T[typeof (v=x[i])]){if(typeof (v=f(v))==S){b[b.length]=v}}}a[2]="]"}else{if(c==Date){return'"'+x.getUTCFullYear()+"-"+R(x.getUTCMonth()+1)+"-"+R(x.getUTCDate())+"T"+R(x.getUTCHours())+":"+R(x.getUTCMinutes())+":"+R(x.getUTCSeconds())+'Z"'}else{if(typeof x.beforeSerialized==F){x=x.beforeSerialized()}a[0]="{";for(i in x){if(!map[i]){if(f=T[typeof (v=x[i])]){if(typeof (v=f(v))==S){b[b.length]=T.string(i)+":"+v}}}}a[2]="}"}}}a[1]=b.join(",");return a[0]+a[1]+a[2]}return"null"};T[F]=function(x){return x.$path?x.$path:String(x)};_.serialize=function(o,b,f){return((f=T[b?O:typeof o])&&f(o))||""};_.unserialize=function(t){try{return eval(C.test(t)?"("+t+")":t)}catch(e){return false}}};Class("linb.iProfile",null,{Instance:{links:function(o,id,target,lid){var self=this;target=target||self;o[lid||self.$id]=target;if(o instanceof Array){o.push(target)}self._links[id]=o;return self},antiLinks:function(id){var self=this,o;if(!self._links){return }if(!(o=self._links[id])){return }if(o instanceof Array){o.removeValue(o[self.$id])}delete o[self.$id];delete self._links[id];return self},antiAllLinks:function(){var self=this,id=self.$id,l=self._links,o,i;for(i in l){o=l[i];if(o instanceof Array){o.removeValue(o[id])}delete o[id]}return self}},Static:{$i:true,getFromCacheId:function(id){return linb._object[id]}}});_.id=function(){var self=this,me=arguments.callee;if(self.constructor!==me||self.a){return(me._||(me._=new me)).next()}self.a=[-1];self.b=[""];self.value=""};_.id.prototype={constructor:_.id,_chars:"abcdefghijklmnopqrstuvwxyz".split(""),next:function(i){with(this){var m,k,l,i=(i||i===0)?i:b.length-1;if((m=a[i])>=25){m=0;if(i===0){a.splice(0,0,1);b.splice(0,0,"a");l=a.length;for(k=1;k<l;++k){a[k]=0;b[k]="0"}++i}else{next(i-1)}}else{++m}a[i]=m;b[i]=_chars[m];return value=b.join("")}}};Class("linb.event",null,{Constructor:function(e,o,fordrag,tid){var self=linb.event,dd=0,id,dragdrop=linb.dragDrop,src,type,pre,obj;if(!(e=e||window.event)||!(src=o)){return false}type=e.type;if(tid){src._tid=tid}if("mouseover"==type||"mouseout"==type){dd=(dragdrop&&dragdrop.drop2)?1:2;if(dd!=1&&fordrag){return self.rtnFalse}if(!self._handleMouseHover(e,src,self.getSrc(e),dd==1)){return self.rtnFalse}if(dd==1){pre=dragdrop&&dragdrop._current}}if((obj=self.focusHook).length&&self._kb[type]&&(e.$key||e.keyCode||e.charCode)==9&&false===self._handleFocusHook(self.getSrc(e),obj=obj[obj.length-1])){return }id=self.getId(src)||tid;if(obj=self._getProfile(id)){if(type=="mousedown"){_.tryF(linb.dom._blurTrigger,[obj,e,src],src)}if(type=="resize"){type="rewh";if(linb.browser.ie&&window===src){var w=linb.browser.contentBox&&document.documentElement.clientWidth||document.body.clientWidth,h=linb.browser.contentBox&&document.documentElement.clientHeight||document.body.clientHeight;if(obj._w==w&&obj._h==h){return }obj._w=w;obj._h=h}}var j,f,name,r=true,funs=[];for(j=0;j<=2;++j){if(dd==1&&j!==0&&!e.$force){break}if(dd==2&&j===0){continue}name=self._type[type+j]||(self._type[type+j]=self._getEventName(type,self._eventtag[j]));if(!e.$e||e.$all||(name==e.$name)){Array.prototype.push.apply(funs,obj.getEV(id,name,src))}}f=function(a){var i,v,k=arguments.callee.funs;for(i=0;v=k[i++];){if(false===v.call(src,obj,a||e,src,o)){return false}}return true};f.funs=funs;r=f();if(dragdrop){if(type=="drag"){dragdrop._onDrag=f}else{if(type=="dragover"){dragdrop._onDragover=f}}}if(dd==1){if("mouseover"==type&&dragdrop._current==src&&pre&&pre!=src){self({type:"mouseout",target:pre,$e:true,$name:"beforeMouseout",preventDefault:function(){this.returnValue=false},stopPropagation:function(){this.cancelBubble=true}},pre);dragdrop._current=src}if("mouseout"==type&&!dragdrop._current&&pre&&pre==src){self._ddtemp=id;_.asyRun(function(){delete linb.event._ddtemp})}if(src==dragdrop._current){r=false}}if(r===false){self.stopBubble(e)}return r}},Static:{rtnFalse:linb.browser.opr?undefined:false,_type:{},_kb:{keydown:1,keypress:1,keyup:1},_reg:/([\.\w]+)(-[\.\w]+)?(:[\.\w]+:)([\.\w]*)/,_eventhandler:function(){return linb.event(arguments[0],this)},_eventhandler2:function(){return linb.event(arguments[0],this,1)},_eventtag:"before,on,after".split(","),_events:("mouseover,mouseout,mousedown,mouseup,mousemove,click,dblclick,keydown,keypress,keyup,location,rewh,scroll,blur,focus,contextmenu,load,unload,change,reset,select,submit,abort,error,ready,dragbegin,drag,dragstop,dragleave,dragenter,dragover,drop").split(","),_getEventName:function(s,pos){var me=arguments.callee,map=me.map||(me.map={});return map[s+pos]||(s=s.charAt(0).toUpperCase()+s.substring(1))&&(map[s+pos]=pos?(pos+s.charAt(0).toUpperCase()+s.substring(1)):function(s){var i,j,a=[];for(i=0;j=linb.event._eventtag[i];i++){a[i]=j+s}return a}(s))},_getEventType:function(name){var me=arguments.callee,map=me.map||(me.map={});return map[name]||(map[name]=name.replace(/^(on|before|after)/,"").toLowerCase())},_getProfile:function(id){return id&&linb.cache.dom[id.replace(this._reg,"$1$3")]},_handleFocusHook:function(src,target){if(src===document){return true}var node=src;do{if(node==target[0]){return true}}while((node&&(node=node.parentNode)));_.tryF(target[1]);return false},_handleMouseHover:function(e,target,src,dd){if(target==document){return true}if(linb.browser.gek&&(src.tagName=="INPUT"||src.tagName=="TEXTAREA")){return true}var node=(e.type=="mouseover"?e.fromElement:e.toElement)||e.relatedTarget;if(dd&&e.type=="mouseover"&&this._ddtemp){do{if(node&&node.id&&node.id==this._ddtemp){return true}}while(node&&(node=node.parentNode)&&node!==document&&node!==window)}try{do{if(node==target){return false}}while(node&&(node=node.parentNode))}catch(a){}return true},focusHook:[],eventhandler:"return linb.event(arguments[0],this)",eventhandler2:"return linb.event(arguments[0],this,1)",getSrc:function(e,a){return((a=e.target||e.srcElement||null)&&linb.browser.kde&&a.nodeType==3)?a.parentNode:a},getId:function(o){return(window===o)?"___window":(document===o)?"___document":o?o.id:""},getBtn:function(e){return linb.browser.ie?e.button==4?"middle":e.button==2?"right":"left":e.which==2?"middle":e.which==3?"right":"left"},getPos:function(e){e=e||window.event;if(typeof e.pageX=="number"){return{left:e.pageX,top:e.pageY}}else{var m=linb.browser.contentBox?document.documentElement:document.body;return{left:e.clientX+m.scrollLeft,top:e.clientY+m.scrollTop}}},getKey:function(e){e=e||window.event;var res=[],t,k=e.$key||e.keyCode||e.charCode||0;if(typeof k=="string"){res[0]=k}else{var key=String.fromCharCode(k),type=e.type;if((type=="keypress"&&k>=33&&k<=128)||((k>=48&&k<=57)||(k>=65&&k<=90))){res[0]=key}else{if(!(t=arguments.callee.map)){t=arguments.callee.map={};var k,arr=("3,enter,8,backspace,9,tab,12,numlock,13,enter,19,pause,20,capslock,27,esc,32,space,33,pageup,34,pagedown,35,end,36,home,37,left,38,up,39,right,40,down,44,printscreen,45,insert,46,delete,50,down,52,left,54,right,56,up,91,win,92,win,93,apps,96,0,97,1,98,2,99,3,100,4,101,5,102,6,103,7,104,8,105,9,106,*,107,+,109,-,110,.,111,/,112,f1,113,f2,114,f3,115,f4,116,f5,117,f6,118,f7,119,f8,120,f9,121,f10,122,f11,123,f12,144,numlock,145,scroll,186,;,187,=,189,-,190,.,191,/,192,`,219,[,220,\\,221,],222,',224,meta,63289,numlock,63276,pageup,63277,pagedown,63275,end,63273,home,63234,left,63232,up,63235,right,63233,down,63272,delete,63302,insert,63236,f1,63237,f2,63238,f3,63239,f4,63240,f5,63241,f6,63242,f7,63243,f8,63244,f9,63245,f10,63246,f11,63247,f12,63248,print").split(",");for(var i=1,l=arr.length;i<l;i=i+2){t[arr[i-1]]=arr[i]}arr.length=0;t[188]=","}res[0]=t[k]||key}}if((e.modifiers)?(e.modifiers&Event.CONTROL_MASK):(e.ctrlKey||e.ctrlLeft||k==17||k==57391)){if(k==17||k==57391){res[0]=""}res.push("1")}else{res.push("")}if((e.modifiers)?(e.modifiers&Event.SHIFT_MASK):(e.shiftKey||e.shiftLeft||k==16||k==57390)){if(k==16||k==57390){res[0]=""}res.push("1")}else{res.push("")}if((e.modifiers)?false:(e.altKey||e.altLeft||k==18||k==57388)){if(k==18||k==57388){res[0]=""}res.push("1")}else{res.push("")}return res},getEventPara:function(e){var pos=this.getPos(e),keys=this.getKey(e),h={pageX:pos.left,pageY:pos.top,keyCode:keys[0],ctrlKey:keys[1],shiftKey:keys[2],altKey:keys[3]};for(var i in e){if(i.charAt(0)=="$"){h[i]=e[i]}}return h},stopBubble:function(e){e=e||window.event;if(e.stopPropagation){e.stopPropagation()}e.cancelBubble=true;this.stopDefault(e)},stopDefault:function(e){e=e||window.event;if(e.preventDefault){e.preventDefault()}e.returnValue=false},hookKey:function(key,ctrl,shift,alt,fun,args,target){var p=linb.cache.hookKey,k=(key||"").toLowerCase()+":"+(ctrl?"1":"")+":"+(shift?"1":"")+":"+(alt?"1":"");if(fun===null){delete p[k]}else{p[k]=[fun,args,target]}return this}}});Class("linb.template","linb.iProfile",{Constructor:function(parent,template,events,properties,domId){var self=this;self.$domId=self.KEY+":"+(self.serialId=self.pickSerialId())+":";self.domId=typeof domId=="string"?domId:self.$domId;self._links={};self.template={"":[["<div></div>"],[]]};self.properties={};self.events={};self.$id=_.id();self.links(self.constructor._cache,"self").links(linb._object,"linb");self.box=self.constructor;linb.cache.dom[self.domId]=linb.cache.dom[self.$domId]=this;if(template){self.setTemplate(template)}if(events){self.setEvents(events)}if(properties){self.setProperties(properties)}if(parent){self.renderTo(parent)}return self},Instance:{$gc:function(){this.destroy()},setDomId:function(id){var t=this,c=linb.cache.dom,e;if(t.domId!=t.$domId){delete c[t.domId]}if(e=document.getElementById(t.domId)){e.id=id}c[t.domId=id]=t;return t},getDomId:function(){return this.domId},destroy:function(){var self=this,t=linb.cache.domId;if(self.root){var me=this.constructor,c=me.c||(me.c=document.createElement("div"));c.appendChild(self.root);self.root=null;c.innerHTML=""}(t[self.KEY]||(t[self.KEY]=[])).push(self.serialId);delete linb.cache.dom[self.domId];delete linb.cache.dom[self.$domId];self.antiAllLinks();self.template=self.properties=self.events=null},empty:function(){this.root.innerHTML=""},getDomNode:function(){return this.root||(this.root=document.getElementById(this.domId))},setEvents:function(key,value){var self=this;if(typeof key=="object"){self.events=key}else{self.events[key]=value}return self},toString:function(){return this.build(this.properties)},_buildTpl:function(str){if(typeof str=="string"){var me=arguments.callee,reg=me.reg||(me.reg=/([^{}]*)\{([\w]+)\}([^{}]*)/g),obj=[[],[]],a0=obj[0],a1=obj[1];str.replace(reg,function(a,b,c,d){if(b){a0[a0.length]=b}a1[a0.length]=a0[a0.length]=c;if(d){a0[a0.length]=d}return""});return obj}else{return str}},setTemplate:function(key,value){var self=this,t=self.template,f=self._buildTpl,h;if(typeof key=="object"){h={};for(var i in key){h[i]=f(key[i])}self.template=h}else{if(typeof value=="string"){t[key]=f(value)}else{t[""]=f(key)}}return self},setProperties:function(properties){this.properties=properties;return this},pickSerialId:function(){var arr=linb.cache.domId[this.KEY];if(arr&&arr[0]){return arr.shift()}return this.constructor._ctrlId.next()},render:function(){var self=this,str=self.toString(),o;if(o=self.getDomNode()){var b,r=(b=o.previousSibling)?o.previousSibling:o.parentNode;if(linb.browser.gek){o.id="";var range=o.ownerDocument.createRange();range.setStartBefore(o);o.parentNode.replaceChild(range.createContextualFragment(str),o)}else{o.outerHTML=str}if(r){self.root=b?r.nextSibling:r.firstChild}}else{var me=this.constructor,c=me.c||(me.c=document.createElement("div"));c.innerHTML=str;self.root=c.removeChild(c.firstChild)}return self.root},renderTo:function(node){if(typeof node=="string"){node=document.getElementById(node)}node.appendChild(this.render())},getEV:function(id,name,src){var evs=this.events,evkey=src.getAttribute("evkey"),evg=evkey&&evs&&evs[evkey]||evs,ev=evg&&evg[name];return typeof ev=="function"?[ev]:[]},build:function(properties,tag,result){if(!properties){return""}var self=this,me=arguments.callee,s,t,n,isA=properties.constructor==Array,r1=me.r1||(me.r1=/\[\$e\]/g),r2=me.r2||(me.r2=/(^\s*<\w+)(\s|>)(.*)/),template=self.template,temp=template[tag||""],r=!result;result=result||[];if(isA){if(typeof temp!="function"){temp=me}for(var i=0;t=properties[i++];){properties[t.id]=t;temp.call(self,t,tag,result)}}else{if(typeof temp=="function"){temp.call(self,properties,tag,result)}else{tag=tag?tag+".":"";var a0=temp[0],a1=temp[1];for(var i=0,l=a0.length;i<l;i++){if(n=a1[i]){if(n in properties){t=properties[n];if(template[s=tag+n]){me.call(self,t,s,result)}else{result[result.length]=t}}}else{result[result.length]=a0[i]}}}}if(r){return result.join("").replace(r1,"return linb.event(arguments[0],this,0,'"+self.domId+"')").replace(r2,'$1 id="'+self.domId+'" $2$3')}}},Static:{showTips:function(pro,node,pos){var id=node.getAttribute("evid"),key=node.getAttribute("evkey");if(!id){return false}var p=pro.properties,h=key?p[key]:p,item=h[id];linb.UI.Tips.show(pos,item);return true},_cache:[],_ctrlId:new _.id()}});Class("linb.date",null,{Initialize:function(){var self=this;self._mapKeys(self.TIMEUNIT);var a=self._key1,b=self._key2,u=self.UNIT={};for(var i=0,l=a.length;i<l;i++){u[a[i]]=1}for(var i=0,l=b.length;i<l;i++){u[b[i]]=1}u.w=1},Static:{_key1:"MILLISECOND,SECOND,MINUTE,HOUR,DAY,WEEK,MONTH,QUARTER,YEAR,DECADE,CENTURY".split(","),_key2:"ms,s,n,h,d,ww,m,q,y,de,c".split(","),TIMEUNIT:{MILLISECOND:1,SECOND:1000,MINUTE:60000,HOUR:3600000,DAY:86400000,WEEK:604800000,MONTH:2592000000,QUARTER:7776000000,YEAR:31557600000,DECADE:315576000000,CENTURY:3155760000000},TEXTFORMAT:{utciso:function(d,f){f=linb.date.fix;return d.getUTCFullYear()+"-"+f(d.getUTCMonth()+1)+"-"+f(d.getUTCDate())+"T"+f(d.getUTCHours())+":"+f(d.getUTCMinutes())+":"+f(d.getUTCSeconds())+"Z"},iso:function(d,f){f=linb.date.fix;return d.getFullYear()+"-"+f(d.getMonth()+1)+"-"+f(d.getDate())+"T"+f(d.getHours())+":"+f(d.getMinutes())+":"+f(d.getSeconds())},ms:function(d){return linb.date.fix(d.getMinutes(),3)+linb.wrapRes("date.MS")},s:function(d){return linb.date.fix(d.getSeconds())+linb.wrapRes("date.S")},n:function(d){return linb.date.fix(d.getMinutes())+linb.wrapRes("date.N")},h:function(d){return linb.date.fix(d.getHours())+linb.wrapRes("date.H")},d:function(d){return d.getDate()+linb.wrapRes("date.D")},w:function(d,firstDayOfWeek){return linb.wrapRes("date.WEEKS."+(d.getDay()-firstDayOfWeek+7)%7)},ww:function(d,firstDayOfWeek){return linb.date.getWeek(d,firstDayOfWeek)+linb.wrapRes("date.W")},m:function(d){return(d.getMonth()+1)+linb.wrapRes("date.M")},q:function(d){return(parseInt((d.getMonth()+3)/3-1)+1)+linb.wrapRes("date.Q")},y:function(d){return d.getFullYear()+linb.wrapRes("date.Y")},de:function(d){return parseInt(d.getFullYear()/10)+linb.wrapRes("date.DE")},c:function(d){return parseInt(d.getFullYear()/100)+linb.wrapRes("date.C")},hn:function(d){return linb.wrapRes("date.HN-"+d.getHours()+"-"+d.getMinutes())},dhn:function(d){return linb.wrapRes("date.DHN-"+d.getDate()+"-"+d.getHours()+"-"+d.getMinutes())},mdhn:function(d){return linb.wrapRes("date.MDHN-"+(d.getMonth()+1)+"-"+d.getDate()+"-"+d.getHours()+"-"+d.getMinutes())},hns:function(d){return linb.wrapRes("date.HNS-"+d.getHours()+"-"+d.getMinutes()+"-"+d.getSeconds())},hnsms:function(d){return linb.wrapRes("date.HNSMS-"+d.getHours()+"-"+d.getMinutes()+"-"+d.getSeconds()+"-"+d.getMinutes())},yq:function(d){return linb.wrapRes("date.YQ-"+d.getFullYear()+"-"+(parseInt((d.getMonth()+3)/3-1)+1))},ym:function(d){return linb.wrapRes("date.YM-"+d.getFullYear()+"-"+(d.getMonth()+1))},md:function(d){return linb.wrapRes("date.MD-"+(d.getMonth()+1)+"-"+d.getDate())},ymd:function(d){return linb.wrapRes("date.YMD-"+d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate())},ymdh:function(d){return linb.wrapRes("date.YMDH-"+d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+"-"+d.getHours())},ymdhn:function(d){return linb.wrapRes("date.YMDHN-"+d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+"-"+d.getHours()+"-"+d.getMinutes())},ymdhns:function(d){return linb.wrapRes("date.YMDHNS-"+d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+"-"+d.getHours()+"-"+d.getMinutes()+"-"+d.getSeconds())},all:function(d){return linb.wrapRes("date.ALL-"+d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+"-"+d.getHours()+"-"+d.getMinutes()+"-"+d.getSeconds()+"-"+d.getMilliseconds())}},TIMEZONE:[{id:"Asia(East,North)",sub:[{id:"Brunei",v:"+0800"},{id:"Burma",v:"+0630"},{id:"Cambodia",v:"+0700"},{id:"China",v:"+0800"},{id:"China(HK,Macau)",v:"+0800"},{id:"China(TaiWan)",v:"+0800"},{id:"China(Urumchi)",v:"+0700"},{id:"East Timor",v:"+0800"},{id:"Indonesia",v:"+0700"},{id:"Japan",v:"+0900"},{id:"Kazakhstan(Aqtau)",v:"+0400"},{id:"Kazakhstan(Aqtobe)",v:"+0500"},{id:"Kazakhstan(Astana)",v:"+0600"},{id:"Kirghizia",v:"+0500"},{id:"Korea",v:"+0900"},{id:"Laos",v:"+0700"},{id:"Malaysia",v:"+0800"},{id:"Mongolia",v:"+0800",tag:"03L03|09L03"},{id:"Philippines",v:"+0800"},{id:"Russia(Anadyr)",v:"+1300",tag:"03L03|10L03"},{id:"Russia(Kamchatka)",v:"+1200",tag:"03L03|10L03"},{id:"Russia(Magadan)",v:"+1100",tag:"03L03|10L03"},{id:"Russia(Vladivostok)",v:"+1000",tag:"03L03|10L03"},{id:"Russia(Yakutsk)",v:"+0900",tag:"03L03|10L03"},{id:"Singapore",v:"+0800"},{id:"Thailand",v:"+0700"},{id:"Vietnam",v:"+0700"}]},{id:"Asia(South,West)",sub:[{id:"Afghanistan",v:"+0430"},{id:"Arab Emirates",v:"+0400"},{id:"Bahrain",v:"+0300"},{id:"Bangladesh",v:"+0600"},{id:"Bhutan",v:"+0600"},{id:"Cyprus",v:"+0200"},{id:"Georgia",v:"+0500"},{id:"India",v:"+0530"},{id:"Iran",v:"+0330",tag:"04 13|10 13"},{id:"Iraq",v:"+0300",tag:"04 13|10 13"},{id:"Israel",v:"+0200",tag:"04F53|09F53"},{id:"Jordan",v:"+0200"},{id:"Kuwait",v:"+0300"},{id:"Lebanon",v:"+0200",tag:"03L03|10L03"},{id:"Maldives",v:"+0500"},{id:"Nepal",v:"+0545"},{id:"Oman",v:"+0400"},{id:"Pakistan",v:"+0500"},{id:"Palestine",v:"+0200"},{id:"Qatar",v:"+0300"},{id:"Saudi Arabia",v:"+0300"},{id:"Sri Lanka",v:"+0600"},{id:"Syria",v:"+0200",tag:"04 13|10 13"},{id:"Tajikistan",v:"+0500"},{id:"Turkey",v:"+0200"},{id:"Turkmenistan",v:"+0500"},{id:"Uzbekistan",v:"+0500"},{id:"Yemen",v:"+0300"}]},{id:"North Europe",sub:[{id:"Denmark",v:"+0100",tag:"04F03|10L03"},{id:"Faroe Is.(DK)",v:"+0100"},{id:"Finland",v:"+0200",tag:"03L01|10L01"},{id:"Iceland",v:"+0000"},{id:"Jan Mayen(Norway)",v:"-0100"},{id:"Norwegian",v:"+0100"},{id:"Svalbard(NORWAY)",v:"+0100"},{id:"Sweden",v:"+0100",tag:"03L01|10L01"}]},{id:"Eastern Europe",sub:[{id:"Armenia",v:"+0400"},{id:"Austria",v:"+0100",tag:"03L01|10L01"},{id:"Azerbaijan",v:"+0400"},{id:"Belarus",v:"+0200",tag:"03L03|10L03"},{id:"Czech",v:"+0100"},{id:"Estonia",v:"+0200"},{id:"Georgia",v:"+0500"},{id:"Germany",v:"+0100",tag:"03L01|10L01"},{id:"Hungarian",v:"+0100"},{id:"Latvia",v:"+0200"},{id:"Liechtenstein",v:"+0100"},{id:"Lithuania",v:"+0200"},{id:"Moldova",v:"+0200"},{id:"Poland",v:"+0100"},{id:"Rumania",v:"+0200"},{id:"Russia(Moscow)",v:"+0300",tag:"03L03|10L03"},{id:"Slovakia",v:"+0100"},{id:"Switzerland",v:"+0100",tag:"03L01|10L01"},{id:"Ukraine",v:"+0200"},{id:"Ukraine(Simferopol)",v:"+0300"}]},{id:"Western Europe",sub:[{id:"Andorra",v:"+0100",tag:"03L01|10L01"},{id:"Belgium",v:"+0100",tag:"03L01|10L01"},{id:"Channel Is.(UK)",v:"+0000",tag:"03L01|10L01"},{id:"France",v:"+0100",tag:"03L01|10L01"},{id:"Gibraltar(UK)",v:"+0100",tag:"03L01|10L01"},{id:"Ireland",v:"+0000",tag:"03L01|10L01"},{id:"Isle of Man(UK)",v:"+0000",tag:"03L01|10L01"},{id:"Luxembourg",v:"+0100",tag:"03L01|10L01"},{id:"Monaco",v:"+0100"},{id:"Netherlands",v:"+0100",tag:"03L01|10L01"},{id:"United Kingdom",v:"+0000",tag:"03L01|10L01"}]},{id:"South Europe",sub:[{id:"Albania",v:"+0100"},{id:"Bosnia",v:"+0100"},{id:"Bulgaria",v:"+0200"},{id:"Croatia",v:"+0100"},{id:"Greece",v:"+0200",tag:"03L01|10L01"},{id:"Holy See",v:"+0100"},{id:"Italy",v:"+0100",tag:"03L01|10L01"},{id:"Macedonia",v:"+0100"},{id:"Malta",v:"+0100"},{id:"Montenegro",v:"+0100"},{id:"Portugal",v:"+0000",tag:"03L01|10L01"},{id:"San Marino",v:"+0100"},{id:"Serbia",v:"+0100"},{id:"Slovenia",v:"+0100"},{id:"Span",v:"+0100",tag:"03L01|10L01"}]},{id:"North America",sub:[{id:"Canada(AST)",v:"-0400",tag:"04F02|10L02"},{id:"Canada(CST)",v:"-0600",tag:"04F02|10L02"},{id:"Canada(EST)",v:"-0500",tag:"04F02|10L02"},{id:"Canada(MST)",v:"-0700",tag:"04F02|10L02"},{id:"Canada(NST)",v:"-0330",tag:"04F02|10L02"},{id:"Canada(PST)",v:"-0800",tag:"04F02|10L02"},{id:"Greenland(DK)",v:"-0300"},{id:"US(Central)",v:"-0600",tag:"03S02|11F02"},{id:"US(Eastern)",v:"-0500",tag:"03S02|11F02"},{id:"US(Mountain)",v:"-0700",tag:"03S02|11F02"},{id:"US(Pacific)",v:"-0800",tag:"03S02|11F02"},{id:"US(Alaska)",v:"-0900"},{id:"US(Arizona)",v:"-0700"}]},{id:"South America",sub:[{id:"Anguilla(UK)",v:"-0400"},{id:"Antigua&amp;Barbuda",v:"-0400"},{id:"Antilles(NL)",v:"-0400"},{id:"Argentina",v:"-0300"},{id:"Aruba(NL)",v:"-0400"},{id:"Bahamas",v:"-0500"},{id:"Barbados",v:"-0400"},{id:"Belize",v:"-0600"},{id:"Bolivia",v:"-0400"},{id:"Brazil(AST)",v:"-0500",tag:"10F03|02L03"},{id:"Brazil(EST)",v:"-0300",tag:"10F03|02L03"},{id:"Brazil(FST)",v:"-0200",tag:"10F03|02L03"},{id:"Brazil(WST)",v:"-0400",tag:"10F03|02L03"},{id:"British Virgin Is.(UK)",v:"-0400"},{id:"Cayman Is.(UK)",v:"-0500"},{id:"Chilean",v:"-0300",tag:"10F03|03F03"},{id:"Chilean(Hanga Roa)",v:"-0500",tag:"10F03|03F03"},{id:"Colombia",v:"-0500"},{id:"Costa Rica",v:"-0600"},{id:"Cuba",v:"-0500",tag:"04 13|10L03"},{id:"Dominican",v:"-0400"},{id:"Ecuador",v:"-0500"},{id:"El Salvador",v:"-0600"},{id:"Falklands",v:"-0300",tag:"09F03|04F03"},{id:"Grenada",v:"-0400"},{id:"Guadeloupe(FR)",v:"-0400"},{id:"Guatemala",v:"-0600"},{id:"Guiana(FR)",v:"-0300"},{id:"Guyana",v:"-0400"},{id:"Haiti",v:"-0500"},{id:"Honduras",v:"-0600"},{id:"Jamaica",v:"-0500"},{id:"Martinique(FR)",v:"-0400"},{id:"Mexico(Mazatlan)",v:"-0700"},{id:"Mexico(Tijuana)",v:"-0800"},{id:"Mexico(Mexico)",v:"-0600"},{id:"Montserrat(UK)",v:"-0400"},{id:"Nicaragua",v:"-0500"},{id:"Panama",v:"-0500"},{id:"Paraguay",v:"-0400",tag:"10F03|02L03"},{id:"Peru",v:"-0500"},{id:"Puerto Rico(US)",v:"-0400"},{id:"So. Georgia&amp;So. Sandwich Is.(UK)",v:"-0200"},{id:"St. Kitts&amp;Nevis",v:"-0400"},{id:"St. Lucia",v:"-0400"},{id:"St. Vincent&amp;Grenadines",v:"-0400"},{id:"Suriname",v:"-0300"},{id:"Trinidad&amp;Tobago",v:"-0400"},{id:"Turks&amp;Caicos Is.(UK)",v:"-0500"},{id:"Uruguay",v:"-0300"},{id:"Venezuela",v:"-0400"},{id:"Virgin Is.(US)",v:"-0400"}]},{id:"Africa(North)",sub:[{id:"Algeria",v:"+0100"},{id:"Egypt",v:"+0200",tag:"04L53|09L43"},{id:"Libyan",v:"+0200"},{id:"Morocco",v:"+0000"},{id:"Sudan",v:"+0200"},{id:"Tunisia",v:"+0100"}]},{id:"Africa(Western)",sub:[{id:"Benin",v:"+0100"},{id:"Burkina Faso",v:"+0000"},{id:"Canary Is.(SP)",v:"-0100"},{id:"Cape Verde",v:"-0100"},{id:"Chad",v:"+0100"},{id:"Gambia",v:"+0000"},{id:"Ghana",v:"+0000"},{id:"Guinea",v:"+0000"},{id:"Guinea-Bissau",v:"+0000"},{id:"Ivory Coast",v:"+0000"},{id:"Liberia",v:"+0000"},{id:"Mali",v:"+0000"},{id:"Mauritania",v:"+0000"},{id:"Niger",v:"+0100"},{id:"Nigeria",v:"+0100"},{id:"Senegal",v:"+0000"},{id:"Sierra Leone",v:"+0000"},{id:"Togo",v:"+0000"},{id:"Western Sahara",v:"+0000"}]},{id:"Africa(Central)",sub:[{id:"Cameroon",v:"+0100"},{id:"Cen.African Rep.",v:"+0100"},{id:"Congo,Democratic",v:"+0100"},{id:"Congo,Republic",v:"+0100"},{id:"Equatorial Guinea",v:"+0100"},{id:"Gabon",v:"+0100"},{id:"Sao Tome&amp;Principe",v:"+0000"}]},{id:"Africa(East)",sub:[{id:"Burundi",v:"+0200"},{id:"Comoros",v:"+0300"},{id:"Djibouti",v:"+0300"},{id:"Eritrea",v:"+0300"},{id:"Ethiopia",v:"+0300"},{id:"Kenya",v:"+0300"},{id:"Madagascar",v:"+0300"},{id:"Malawi",v:"+0200"},{id:"Mauritius",v:"+0400"},{id:"Mayotte(FR)",v:"+0300"},{id:"Mozambique",v:"+0200"},{id:"Reunion(FR)",v:"+0400"},{id:"Rwanda",v:"+0200"},{id:"Seychelles",v:"+0300"},{id:"Somalia",v:"+0300"},{id:"Tanzania",v:"+0300"},{id:"Uganda",v:"+0300"}]},{id:"Africa(South)",sub:[{id:"Angola",v:"+0100"},{id:"Botswana",v:"+0200"},{id:"Lesotho",v:"+0200"},{id:"Namibia",v:"+0200",tag:"09F03|04F03"},{id:"Saint Helena(UK)",v:"-0100"},{id:"South Africa",v:"+0200"},{id:"Swaziland",v:"+0200"},{id:"Zambia",v:"+0200"},{id:"Zimbabwe",v:"+0200"}]},{id:"Oceania",sub:[{id:"American Samoa(US)",v:"-1100"},{id:"Australia(Adelaide)",v:"+0930",sub:"10L03|03L03"},{id:"Australia(Brisbane)",v:"+1000"},{id:"Australia(Darwin)",v:"+0930"},{id:"Australia(Hobart)",v:"+1000",sub:"10L03|03L03"},{id:"Australia(Perth)",v:"+0800"},{id:"Australia(Sydney)",v:"+1000",sub:"10L03|03L03"},{id:"Cook Islands(NZ)",v:"-1000"},{id:"Eniwetok",v:"-1200"},{id:"Fiji",v:"+1200",sub:"11F03|02L03"},{id:"Guam",v:"+1000"},{id:"Hawaii(US)",v:"-1000"},{id:"Kiribati",v:"+1100"},{id:"Marshall Is.",v:"+1200"},{id:"Micronesia",v:"+1000"},{id:"Midway Is.(US)",v:"-1100"},{id:"Nauru Rep.",v:"+1200"},{id:"New Calednia(FR)",v:"+1100"},{id:"New Zealand",v:"+1200",sub:"10F03|04F63"},{id:"New Zealand(CHADT)",v:"+1245",sub:"10F03|04F63"},{id:"Niue(NZ)",v:"-1100"},{id:"Nor. Mariana Is.",v:"+1000"},{id:"Palau",v:"+0900"},{id:"Papua New Guinea",v:"+1000"},{id:"Pitcairn Is.(UK)",v:"-0830"},{id:"Polynesia(FR)",v:"-1000"},{id:"Solomon Is.",v:"+1100"},{id:"Tahiti",v:"-1000"},{id:"Tokelau(NZ)",v:"-1100"},{id:"Tonga",v:"+1300",tag:"10F63|04F63"},{id:"Tuvalu",v:"+1200"},{id:"Vanuatu",v:"+1100"},{id:"Western Samoa",v:"-1100"},{id:"Data Line",v:"-1200"}]}],_mapKeys:function(obj){var self=this,t=self._key2,m=self._key1;for(var i=0,l=m.length;i<l;i++){obj[t[i]]=obj[m[i]]}},_validUnit:function(unit){return this.UNIT[unit]?unit:"d"},_isDate:function(target){return !!target&&target.constructor==Date},_date:function(value,df){return this._isDate(value)?value:this._isDate(df)?df:new Date},_isNumb:function(target){return typeof target=="number"&&isFinite(target)},_numb:function(value,df){return this._isNumb(value)?value:this._isNumb(df)?df:0},_timeZone:-((new Date).getTimezoneOffset()/60),firstDayOfWeek:0,get:function(date,unit,firstDayOfWeek){var self=this;date=self._date(date);unit=self._validUnit(unit);firstDayOfWeek=self._numb(firstDayOfWeek,self.firstDayOfWeek);var map=arguments.callee.map||(arguments.callee.map={ms:function(d){return d.getMilliseconds()},s:function(d){return d.getSeconds()},n:function(d){return d.getMinutes()},h:function(d){return d.getHours()},d:function(d){return d.getDate()},ww:function(d,fd){return linb.date.getWeek(d,fd)},w:function(d,fd){return(7+d.getDay()-fd)%7},m:function(d){return d.getMonth()},q:function(d){return parseInt((d.getMonth()+3)/3-1)},y:function(d){return d.getFullYear()},de:function(d){return parseInt(d.getFullYear()/10)},c:function(d){return parseInt(d.getFullYear()/100)}});return map[unit](date,firstDayOfWeek)},fix:function(s,l,c){l=l||2;c=c||"0";s=String(s);if(s.length<l){for(var i=s.length;i<l;i++){s=c+s}}return s},add:function(date,unit,count){var self=this,tu=self.TIMEUNIT,map,date2;date=self._date(date);unit=self._validUnit(unit);if(!(map=arguments.callee.map)){map=arguments.callee.map={MILLISECOND:function(date,count){date.setTime(date.getTime()+count*tu.ms)},SECOND:function(date,count){date.setTime(date.getTime()+count*tu.s)},MINUTE:function(date,count){date.setTime(date.getTime()+count*tu.n)},HOUR:function(date,count){date.setTime(date.getTime()+count*tu.h)},DAY:function(date,count){date.setTime(date.getTime()+count*tu.d)},WEEK:function(date,count){date.setTime(date.getTime()+count*tu.ww)},MONTH:function(date,count){var a=date.getDate(),b;count=date.getMonth()+count;this.YEAR(date,Math.floor(count/12));date.setMonth((count%12+12)%12);if((b=date.getDate())!=a){this.DAY(date,-b)}},QUARTER:function(date,count){this.MONTH(date,count*3)},YEAR:function(date,count){var a=date.getDate(),b;date.setFullYear(date.getFullYear()+count);if((b=date.getDate())!=a){this.DAY(date,-b)}},DECADE:function(date,count){this.YEAR(date,10*count)},CENTURY:function(date,count){this.YEAR(date,100*count)}};self._mapKeys(map)}map[unit](date2=new Date(date),count);return date2},diff:function(d1,d2,unit,firstDayOfWeek){var self=this;d1=self._date(d1);d2=self._date(d2);unit=self._validUnit(unit);firstDayOfWeek=self._numb(firstDayOfWeek,self.firstDayOfWeek);var tu=self.TIMEUNIT,map;if(!(map=arguments.callee.map)){map=arguments.callee.map={MILLISECOND:function(date1,date2){return date2.getTime()-date1.getTime()},SECOND:function(date1,date2){var d1=self.getRoundDown(date1,"s"),d2=self.getRoundDown(date2,"s"),t=d2.getTime()-d1.getTime();return t/tu.s},MINUTE:function(date1,date2){var d1=self.getRoundDown(date1,"n"),d2=self.getRoundDown(date2,"n"),t=d2.getTime()-d1.getTime();return t/tu.n},HOUR:function(date1,date2){var d1=self.getRoundDown(date1,"h"),d2=self.getRoundDown(date2,"h"),t=d2.getTime()-d1.getTime();return t/tu.h},DAY:function(date1,date2){var d1=self.getRoundDown(date1,"d",1),d2=self.getRoundDown(date2,"d",1),t=d2.getTime()-d1.getTime();return t/tu.d},WEEK:function(date1,date2,firstDayOfWeek){var d1=self.getRoundDown(date1,"ww",1,firstDayOfWeek),d2=self.getRoundDown(date2,"ww",1,firstDayOfWeek),t=d2.getTime()-d1.getTime();return t/tu.ww},MONTH:function(date1,date2){return(date2.getFullYear()-date1.getFullYear())*12+(date2.getMonth()-date1.getMonth())},QUARTER:function(date1,date2){return(date2.getFullYear()-date1.getFullYear())*4+parseInt((date2.getMonth()-date1.getMonth())/3)},YEAR:function(date1,date2){return parseInt((date2.getFullYear()-date1.getFullYear()))},DECADE:function(date1,date2){return parseInt((date2.getFullYear()-date1.getFullYear())/10)},CENTURY:function(date1,date2){return parseInt((date2.getFullYear()-date1.getFullYear())/100)}};self._mapKeys(map)}return map[unit](new Date(d1),new Date(d2),firstDayOfWeek)},getRoundDown:function(date,unit,count,firstDayOfWeek){var self=this,tu=self.TIMEUNIT,map,date2;date=self._date(date);unit=self._validUnit(unit);firstDayOfWeek=self._numb(firstDayOfWeek,self.firstDayOfWeek);count=self._numb(count,1);if(!(map=arguments.callee.map)){var clearInDay=function(d){d.setMilliseconds(0);d.setSeconds(0);d.setMinutes(0);d.setHours(0)},clearInYear=function(d){clearInDay(d);d.setDate(1);d.setMonth(0)};map=arguments.callee.map={MILLISECOND:function(date,count){var x=date.getMilliseconds();date.setMilliseconds(x-(x%count))},SECOND:function(date,count){date.setMilliseconds(0);var x=date.getSeconds();date.setSeconds(x-(x%count))},MINUTE:function(date,count){date.setMilliseconds(0);date.setSeconds(0);var x=date.getMinutes();date.setTime(date.getTime()-(x%count)*tu.n)},HOUR:function(date,count){date.setMilliseconds(0);date.setSeconds(0);date.setMinutes(0);var x=date.getHours();date.setHours(x-(x%count))},DAY:function(date,count){clearInDay(date);var x=date.getDate();date.setDate(x-(x%count))},WEEK:function(date,count,firstDayOfWeek){clearInDay(date);var d=(date.getDay()+7-firstDayOfWeek)%7,d2,x;a=new Date();date.setTime(date.getTime()-d*tu.d);clearInYear(a);a.setFullYear(date.getFullYear());d2=(a.getDay()+7-firstDayOfWeek)%7;a.setTime(a.getTime()-d2*tu.d);x=(date.getTime()-a.getTime())/tu.d/7;date.setTime(date.getTime()-(x%count)*tu.ww)},MONTH:function(date,count){clearInDay(date);date.setDate(1);var x=date.getMonth();date.setMonth(x-(x%count))},QUARTER:function(date,count){count=self._numb(count,1);return this.MONTH(date,count*3)},YEAR:function(date,count){clearInYear(date);var x=date.getFullYear();date.setFullYear(x-(x%count))},DECADE:function(date,count){clearInYear(date);date.setFullYear(Math.floor(date.getFullYear()/10)*10)},CENTURY:function(date,count){clearInYear(date);date.setFullYear(Math.floor(date.getFullYear()/100)*100)}};self._mapKeys(map)}map[unit](date2=new Date(date),count,firstDayOfWeek);return date2},getRoundUp:function(date,unit,count,firstDayOfWeek){var self=this;date=self._date(date);unit=self._validUnit(unit);firstDayOfWeek=self._numb(firstDayOfWeek,self.firstDayOfWeek);count=self._numb(count,1);var originalTime=date.getTime(),date2=self.getRoundDown(date,unit,count,firstDayOfWeek);if(date2.getTime()<originalTime){date2=self.add(date2,unit,count)}return date2},_pack:function(date,timeZone,flag){var self=this;date=self._date(date);return new Date(date.getTime()+(flag?-1:1)*(timeZone-self._timeZone)*self.TIMEUNIT.h)},packTimeZone:function(date,timeZone){return this._pack(date,timeZone)},unpackTimeZone:function(date,timeZone){return this._pack(date,timeZone,true)},getWeek:function(date,firstDayOfWeek){var self=this,date2;date=self._date(date);firstDayOfWeek=self._numb(firstDayOfWeek,self.firstDayOfWeek),y=date.getFullYear();date=self.add(self.getRoundDown(date,"ww",1,firstDayOfWeek),"d",6);if(date.getFullYear()!=y){return 1}date2=self.getRoundDown(date,"y",1);date2=self.add(self.getRoundDown(date2,"ww",1,firstDayOfWeek),"d",6);return self.diff(date2,date,"ww")+1},getDayInYear:function(date){var self=this;date=self._date(date);var date2=self.getRoundDown(date,"y",1);return self.diff(date2,date,"d")+1},parse:function(s){s=String(s);var self=this,utc,me=arguments.callee,dp=me.dp||(me.dp={FullYear:2,Month:4,Date:6,Hours:8,Minutes:10,Seconds:12,Milliseconds:14}),match=s.match(me.iso||(me.iso=/^((-\d+|\d{4,})(-(\d{2})(-(\d{2}))?)?)?T((\d{2})(:(\d{2})(:(\d{2})(\.(\d{1,3})(\d)?\d*)?)?)?)?(([+-])(\d{2})(:(\d{2}))?|Z)?$/)),date=new Date(0);if(match){if(match[4]){match[4]--}if(match[15]>=5){match[14]++}utc=match[16]||match[18]?"UTC":"";for(var i in dp){var v=match[dp[i]];if(!v){continue}date["set"+utc+i](v);if(date["get"+utc+i]()!=match[dp[i]]){return null}}if(match[18]){var h=Number(match[17]+match[18]),m=Number(match[17]+(match[20]||0));date.setUTCMinutes(date.getUTCMinutes()+(h*60)+m)}return date}else{var r=Date.parse(s);return r?date.setTime(r)&&date:null}},getText:function(date,unit,firstDayOfWeek){var self=this;date=self._date(date);firstDayOfWeek=self._numb(firstDayOfWeek,self.firstDayOfWeek);unit=unit||"";return self.TEXTFORMAT[unit](date,firstDayOfWeek)}}});Class("linb.css",null,{Static:{getHead:function(){return this._head||(this._head=document.getElementsByTagName("head")[0]||document.documentElement)},exists:function(key,value){for(var head=this.getHead(),i=0,t=head.childNodes,l;l=t[i++];){if(l[key]==value){return l}}return false},add:function(txt,id,last){var e,fc,head=this.getHead();if(id&&this.exists("id",id)){return }e=document.createElement("style");e.type="text/css";if(id){e.id=id}if(linb.browser.ie){e.styleSheet.cssText=txt||""}else{e.appendChild(document.createTextNode(txt||""))}if(!last){for(var i=0,t=head.childNodes,l=t.length;i<l;i++){if(t[i].nodeName.toLowerCase()=="link"&&t[i].type=="text/css"){fc=t[i]}}if(fc){head.insertBefore(e,fc)}else{head.appendChild(e)}}else{head.appendChild(e)}return e},include:function(href,before){var e,fc,head=this.getHead();if(href&&this.exists("href",href)){return }e=document.createElement("link");e.type="text/css";e.rel="stylesheet";e.href=href;e.media="all";if(before){for(var i=0,t=head.childNodes,l=t.length;i<l;i++){if(t[i].type=="text/css"){fc=t[i]}}if(fc){head.insertBefore(e,fc)}else{head.appendChild(e)}}else{head.appendChild(e)}return e},remove:function(key,value){var head=this.getHead();if(value=this.exists(key,value)){head.removeChild(value)}}}});new function(){_.merge(_,{breakO:function(target){var n=arguments[1]||1,l=1+(arguments[2]||0),self=arguments.callee,_t="_$gc_",_o=self.o||(self.o={}),i,b,p;if(target&&(typeof target=="object"||typeof target=="function")&&target!==window&&target!==Object&&target!==Date&&target!==Array&&target!==document){if(_t in target){return }else{try{target[_t]=1}catch(e){return }}p=(p=target.constructor)?p.prototype:_o;for(i in target){if(i!=_t){if(l<n&&target[i]&&(typeof target[i]=="object"||typeof target[i]=="function")){self(target[i],n,l)}if(!(p&&p[i])&&i!="prototype"&&i!="constructor"){try{delete target[i]}catch(e){}}}}delete target[_t];if(target.constructor==Array){target.length=0}}},each:function(hash,fun,target){target=target||hash;for(var i in hash){if(false===fun.call(target,hash[i],i,hash)){break}}return hash},copy:function(hash){var i,h={};for(i in hash){h[i]=hash[i]}return h},clone:function(hash,fun){if(!!hash&&typeof hash=="object"){var i,v,h=hash.constructor==Array?[]:{},me=arguments.callee;for(i in hash){if(fun?fun(i):true){h[i]=((v=hash[i])&&typeof v=="object")?me(v,fun):v}}return h}else{return hash}},filter:function(hash,fun,target){var i,bak={};for(i in hash){if(false===fun.call(target,hash[i],i,hash)){bak[i]=1}}for(i in bak){delete hash[i]}},toArr:function(value,flag){if(!value){return[]}var arr=[];if(typeof flag!=="undefined"){for(var i in value){arr[arr.length]=flag?i:value[i]}}else{for(var i=0,l=value.length;i<l;++i){arr[i]=value[i]}}return arr},Error:function(e){return e?(e.message||e.description||e.toString()):""}});_.merge(_,{exists:function(target){return typeof target!="undefined"},isNull:function(target){return(typeof target=="object")&&!target},isObj:function(target){return !!target&&(typeof target=="object"||typeof target=="function")},isBool:function(target){return typeof target=="boolean"},isNumb:function(target){return typeof target=="number"&&isFinite(target)},isDate:function(target){return !!target&&target.constructor==Date},isFun:function(target){return typeof target=="function"&&target.constructor!=RegExp},isArr:function(target){return !!target&&target.constructor==Array},isHash:function(target){return !!target&&typeof target=="object"&&target.constructor==Object},isReg:function(target){return !!target&&target.constructor==RegExp},isStr:function(target){return typeof target=="string"},arr:function(value,df){return _.isArr(value)?value:_.isArr(df)?df:[]},bool:function(value,df){return _.isBool(value)?value:_.isBool(df)?df:false},date:function(value,df){return _.isDate(value)?value:_.isDate(df)?df:new Date},fun:function(value,df){return _.isFun(value)?value:_.isFun(df)?df:function(){}},hash:function(value,df){return _.isHash(value)?value:_.isHash(df)?df:{}},numb:function(value,df){return _.isNumb(value)?value:_.isNumb(df)?df:0},str:function(value,df){return _.isStr(value)?value:_.isStr(df)?df:""}},"all");_.merge(String.prototype,{toArr:function(c){return this.split(c||",")},left:function(len){return this.slice(0,len)},right:function(len){with(this){return slice(length-len,length)}},exists:function(str){return this.indexOf(str)>-1},startWith:function(str){return this.indexOf(str)===0},endWith:function(str){var l=this.length-str.length;return l>=0&&this.lastIndexOf(str)===l},repeat:function(time){var arr=new Array(time+1);return arr.join(this)},initial:function(){return this.charAt(0).toUpperCase()+this.substring(1)},trim:function(){return this.ltrim().rtrim()},ltrim:function(){var s=arguments.callee;return this.replace(s.r||(s.r=/^ */),"")},rtrim:function(){var s=arguments.callee;return this.replace(s.r||(s.r=/ *$/),"")},toDom:function(flag){var p=linb.dom.getMatix().html(this,false).get(0),t,r=[],i;for(var i=0,t=p.childNodes,l=t.length;i<l;i++){r[r.length]=t[i]}if(flag!==false){if(linb.browser.ie){while(t=p.firstChild){p.removeChild(t)}}else{p.innerHTML=""}}return linb(r)}});_.merge(Array.prototype,{each:function(fun,target,order){var self=this,i,l=self.length;target=target||self;if(!order){for(i=0;i<l;i++){if(fun.call(target,self[i],i,self)===false){break}}}else{for(i=l-1;i>=0;i--){if(fun.call(target,self[i],i,self)===false){break}}}return self},indexOf:function(value){for(var i=0,l=this.length;i<l;i++){if(this[i]===value){return i}}return -1},subIndexOf:function(sub,value){if(typeof value=="undefined"){return -1}for(var i=0,l=this.length;i<l;i++){if(this[i][sub]===value){return i}}return -1},exists:function(value){return this.indexOf(value)>-1},insertAny:function(arr,index,flag){var self=this,a,l=self.length;index=index===0?0:(index||l);if(index<0||index>l){index=l}a=self.splice(index,l-index);if(arr.constructor!=Array||flag){self[self.length]=arr}else{self.push.apply(self,arr)}self.push.apply(self,a);return index},copy:function(){var i,l,arr=[];for(i=0,l=this.length;i<l;i++){arr[arr.length]=this[i]}return arr},merge:function(arr,flag){var self=this,i,l;if(flag!==false){var copy=[];for(i=0,l=self.length;i<l;i++){copy[copy.length]=self[i]}for(i=0,l=arr.length;i<l;i++){if(copy.indexOf(arr[i])==-1){self[self.length]=arr[i]}}copy.length=0}else{for(i=0,l=self.length;i<l;i++){if(arr.indexOf(self[i])>-1){self.splice(i,1)}}}return self},removeFrom:function(index,length){this.splice(index,length||1);return this},clean:function(){var self=this,i,l,a=self.copy();self.length=0;for(i=0,l=a.length;i<l;i++){if(self.indexOf(a[i])==-1){self[self.length]=a[i]}}return self},removeValue:function(value){var self=this;for(var l=self.length,i=l-1;i>=0;i--){if(self[i]===value){self.splice(i,1)}}return self},filter:function(fun,target){var self=this,i,l,arr=[],o;for(i=0,l=self.length;i<l;i++){arr[arr.length]=self[i]}self.length=0;for(i=0,l=arr.length;i<l;i++){if(fun.call(target||arr,arr[i],i,arr)!==false){self[self.length]=arr[i]}}return self}},"all");Array.prototype.boxing=Array.prototype.reBoxing=function(key,flag){var t=linb.iBox.$type[key];if(t){return new (linb.SC(t))(this,flag)}}};Class("linb.iBox",null,{Before:function(key,parent_key,o){if(linb.iBox){linb.iBox.$type[key.replace("linb.","")]=linb.iBox.$type[key]=key}},Instance:{ini:function(){return this},get:function(index){return this._nodes[index]||this._nodes},create:function(){return this},length:function(){return this._nodes.length},each:function(fun){var self=this;for(var i=0,j=self._nodes,l=j.length;i<l;i++){if(false===fun.call(self,j[i],i)){break}}return self},push:function(o){return this._nodes.push(o)},pop:function(){return this._nodes.pop()},exists:function(node){return this._nodes.exists(node)},isEmpty:function(){return !this._nodes.length},add:function(e,flag){var self=this,arr=self.constructor.clean(e);self._nodes.merge(arr,flag);return self},minus:function(e){return this.add(e,false)},unBoxing:function(){return this.get()},reBoxing:function(key,flag){var self=this,t=linb.iBox.$type[key||"dom"];if(t==self.KEY){return self}if(t=linb.SC(t)){return t.pack(self._nodes,flag)}}},Static:{$i:true,$type:{},pack:function(e,flag){var o=new this(false);o._nodes=e?flag===false?e:this.clean(e):null;return o},clean:function(e){return e},plugIn:function(key,fun){this.prototype[key]=fun;return this},support:function(key){return typeof this.prototype[key]=="function"},create:function(tag,id){var arr,o,t,me=arguments.callee,r1=me.r1||(me.r1=/^\s*<((\n|\r|.)*?)>\s*$/);if(tag.constructor==Array){arr=[];tag.each(function(v,i){arr.insertAny(me.apply(null,v instanceof Array?v:[v])._nodes,-1)});return arr}if(typeof tag=="string"){if(id===true){o=linb([document.createTextNode(tag)])}else{if(t=linb.iBox.$type[tag]){arr=[];for(var i=1,l=arguments.length;i<l;i++){arr[i-1]=arguments[i]}o=new (linb.SC(t))(false);o.ini.apply(o,arr).create()}else{if(r1.test(tag)){o=tag.toDom()}else{o=document.createElement(tag);o.id=typeof id=="string"?id:_.id();o=linb(o)}}}}else{o=new (linb.SC(tag.key))(tag).create()}return o}},Initialize:function(){linb.create=function(){return linb.iBox.create.apply(linb.iBox,arguments)}}});Class("linb.DomProfile","linb.iProfile",{Instance:{$gc:function(){var self=this,t;if(self.addition&&(t=self.domNode)){_.each(self.addition,function(o,i){t[i]=null})}linb.cache.dom[self.id]=null},getEV:function(id,name){var funs=[],t;if(t=_.get(linb.cache.dom,[id,"events",name])){for(var i=0,l=t.length;i<l;i++){if(typeof t[t[i]]=="function"){funs[funs.length]=t[t[i]]}}}return funs}}});Class("linb.dom","linb.iBox",{Instance:{id:function(value,flag){var t,me=arguments.callee,cache=linb.cache.dom,f=me.f||(me.f=function(o,value,flag){if(!flag){if(t=cache[o.id]){cache[value]=t;delete cache[o.id]}}o.id=value});if(typeof value=="string"){return this.each(function(o){f(o,value,flag)})}else{return this.get(0).id}},$sum:function(fun,args){var arr=[],r;this.each(function(o){r=fun.apply(o,args||[]);if(r){arr.insertAny(r)}});return linb(arr)},children:function(){return this.$sum(function(){return _.toArr(this.childNodes)})},clone:function(flag){return this.$sum(function(flag){return this.cloneNode(flag?true:false)},arguments)},$iterator:function(type,dir,inn,fun,top){return this.$sum(function(type,dir,inn,fun,top){var self=arguments.callee;if(typeof fun!="function"){var count=fun||0;fun=function(n,index){return index==count}}var index=0,m,n=this,flag=0,t;while(n){if(n.nodeType==1){if(fun(n,index++)===true){break}}if(type=="x"){n=dir?n.nextSibling:n.previousSibling}else{if(type=="y"){n=dir?self.call(dir===1?n.lastChild:n.firstChild,"x",(dir!==1),true,0,top):n.parentNode}else{inn=_.bool(inn,true);m=null;n=dir?(t=inn&&n.firstChild)?t:(t=n.nextSibling)?t:(m=n.parentNode):(t=inn&&n.lastChild)?t:(t=n.previousSibling)?t:(m=n.parentNode);if(m){while(!(m=dir?n.nextSibling:n.previousSibling)){n=n.parentNode;if(!n){if(flag){return null}else{flag=true;m=dir?document.body.firstChild:document.body.lastChild;break}}}n=m}inn=true}}}return n},arguments)},dig:function(tag,attr,exp){tag=tag||"*";var f="getElementsByTagName",me=arguments.callee,f1=me.f1||(me.f1=function(tag,attr,exp){var all=this[f](tag),arr=[];if(exp.test(this[attr])){arr[arr.length]=this}for(var o,i=0;o=all[i];i++){if(exp.test(o[attr])){arr[arr.length]=o}}return arr}),f2=me.f2||(me.f2=function(tag,attr,exp){var all=this[f](tag),arr=[];if(this[attr]==exp){arr[arr.length]=this}for(var o,i=0;o=all[i];i++){if(o[attr]==exp){arr[arr.length]=o}}return arr}),f3=me.f3||(me.f3=function(tag,attr,exp){var all=this[f](tag),arr=[];if(this[attr]){arr[arr.length]=this}for(var o,i=0;o=all[i];i++){if(o[attr]){arr[arr.length]=o}}return arr}),f4=me.f4||(me.f4=function(tag){return _.toArr(this[f](tag))}),f5=me.f5||(me.f5=function(tag,attr){var all=this[f](tag),arr=[];if(attr(this)){arr[arr.length]=this}for(var o,i=0;o=all[i];i++){if(attr(o)){arr[arr.length]=o}}return arr});return this.$sum(attr?typeof attr=="function"?f5:exp?exp.constructor==RegExp?f1:f2:f3:f4,[tag,attr,exp])},$add:function(fun,target){target=linb(target);var v=this.get(0);target.each(function(target){fun.call(v,target)});return this},addFirst:function(target){return this.$add(function(target){var self=this;if(self.firstChild!=target){if(self.firstChild){self.insertBefore(target,self.firstChild)}else{self.appendChild(target)}}},target)},addLast:function(target){return this.$add(function(target){if(this.lastChild!=target){this.appendChild(target)}},target)},addPre:function(target){return this.$add(function(target){if(this.previousSibling!=target){this.parentNode.insertBefore(target,this)}},target)},addNext:function(target){var t;return this.$add(function(target){var self=this;if((t=self.nextSibling)!=target){if(t){self.parentNode.insertBefore(target,t)}else{self.parentNode.appendChild(target)}}},target)},attach:function(target,force){var o=this.get(0),ui,t,d,b,k;if(target["linb.Profile"]){target=target.boxing()}if(_.isArr(target)){target=linb.iBox.pack(target,false)}if(!target["linb.iBox"]){target=target.boxing()}ui=target.create();target.each(function(v){d=v.domNode||v;if(d.style.visibility!="hidden"){b=true;k=d.style.visibility;d.style.visibility="hidden"}if(force||d.parentNode!=o){o.appendChild(d)}if(t=v.renderedTrigger){for(var i=0,l=t.length;i<l;i++){t[i].call(v)}}if(b){d.style.visibility=k}});return this},replace:function(target,flag){var r,v;target=linb(target);if(v=target.get(0)){this.get(0).parentNode.replaceChild(v,this.get(0));this.remove(flag);r=linb([v]);if(target instanceof Array){for(var i=1,l=target.length;i<l;i++){r.addNext(target[i])}}}return r},swap:function(target){var self=this;target=linb(target);var t=linb.dom.getMatix().html("*",false);self.replace(t,false);target.replace(self,false);t.replace(target,false);linb([document.body]).addFirst(t.empty(false));return self},remove:function(flag){var me=arguments.callee,c=me.c||(me.c=document.createElement("div"));if(flag===false){this.each(function(o,i){if(o.parentNode){o.parentNode.removeChild(o)}})}else{this.each(function(o){c.appendChild(o)});c.innerHTML="";_.resetRun("dom.$gc",linb.dom.$gc,300)}return this},empty:function(flag){return this.each(function(o){linb([o]).html("",flag)})},gc:function(){linb.dom.$gc();return this},html:function(str,flag){var s="",t,bak,o=this.get(0);flag=flag!==false;if(typeof str!="undefined"){if(o.nodeType==3){o.nodeValue=str}else{if(!(bak=o.firstChild)&&str==""){return this}if(!flag&&linb.browser.ie){while(t=o.firstChild){o.removeChild(t)}}if(flag){o.innerHTML=""}o.innerHTML=str;if(flag&&bak){_.resetRun("dom.$gc",linb.dom.$gc,300)}}return this}else{return(o.nodeType==3)?o.nodeValue:o.innerHTML}},outerHTML:function(str){var self=this,t,s="",o=self.get(0),id=o.id;if(typeof str!="undefined"){if(o.addition&&(t=o.domNode)){_.each(o.addition,function(o,i){t[i]=null})}if(linb.browser.gek){var n=self.replace(str.toDom(),false);self._nodes[0]=n.get(0)}else{var b,r=(b=o.previousSibling)?o.previousSibling:o.parentNode;o.outerHTML=str;if(r){self._nodes[0]=b?r.nextSibling:r.firstChild}}linb([o]).remove();return self}else{if(linb.browser.gek){var dom=linb.dom,m=dom.getMatix(),n=dom.getMatix(2),np=n.parent(),p;if(p=o.parentNode){self.replace(n,false)}m.addLast(o);s=m.html();if(p){n.replace(o,false)}m.empty();np.addFirst(n);return s}else{return o.outerHTML}}},text:function(str){var s="";if(typeof str!="undefined"){return this.each(function(o){var b=false,m,n=o;while(m=n.childNodes[0]){if(m.nodeType!=1){m.nodeValue=str;b=true;break}n=m}if(!b){n.innerHTML=str}})}else{var f=function(o){var i,a=o.childNodes,l=a.length,str="";for(i=0;i<l;i++){if(a[i].nodeType!=8){str+=(a[i].nodeType!=1)?a[i].nodeValue:f(a[i])}}return str};this.each(function(o){s+=f(o)});return s}},attr:function(key,value){var self=this,t,me=arguments.callee,map=me.map||(me.map={"class":"className",className:"className","for":"htmlFor",value:"value",disabled:"disabled",checked:"checked",selected:"selected",readonly:"readOnly"});if((t=(typeof key!="string"))||value!==undefined){if(!t){t={};t[key]=value;key=t}_.each(key,function(value,key){if(value===null){self.each(function(o){if(map[key]){o[map[key]]=null}else{if(o.removeAttribute){o.removeAttribute(key)}else{o[key]=null}}})}else{self.each(function(o){if(map[key]){o[map[key]]=value}else{if(o.setAttribute){o.setAttribute(key,value)}o[key]=value}})}});return self}else{var o=self.get(0);return map[key]?o[map[key]]:((o.getAttribute?o.getAttribute(key):0)||o[key])}},setPxStyle:function(key,value){var f=linb.dom.setPxStyle;return this.each(function(o){f(o,key,value)})},setStyle:function(key,value){return key=="opacity"?this.opacity(value):this.each(function(o){if(o.nodeType!=1){return }if(typeof key=="string"){o.style[key]=value}else{for(var i in key){if(i=="opacity"){linb([o]).opacity(key[i])}else{o.style[i]=key[i]}}}})},getStyle:function(key,flag){var o=this.get(0);return o.nodeType!==1?"":key=="opacity"?this.opacity():linb.dom.getStyle(o,key,flag)},opacity:function(value){if(typeof value!="undefined"){var key;value=parseFloat(value)||0;value=value>0.9999?"":linb.browser.ie?"alpha(opacity="+100*value+")":value;return this.each(function(o){if(o.nodeType!=1){return }style=o.style;if(linb.browser.ie){key="filter";value=style.filter.replace(/alpha\([^\)]*\)/ig,"")+value}else{key="opacity"}style[key]=value})}else{var node=this._nodes[0];if(!node||node.nodeType!=1){return 1}var style=node.style;if(linb.browser.ie){value=style.filter?(parseFloat(style.filter.match(/alpha\(opacity=(.*)\)/)[1])||0)/100:1}else{value=style.opacity}return value}},show:function(left,top){var style,t,auto="auto",v=linb.dom.hide_value;return this.each(function(o){if(o.nodeType!=1){return }style=o.style;if(t=(top||(style.top==v&&(o._top||auto)))){style.top=t}if(t=(left||(style.left==v&&(o._left||auto)))){style.left=t}if(t=o._position){if(style.position!=t){style.position=t}}if(style.visibility!="visible"){style.visibility="visible"}if(linb.browser.ie6){t=style.wordWrap=="normal";_.asyRun(function(){style.wordWrap=t?"break-word":"normal"})}})},hide:function(){var style,t;return this.each(function(o){if(o.nodeType!=1){return }style=o.style;t=linb([o]);o._position=style.position;o._top=style.top;o._left=style.left;if(style.position!="absolute"){style.position="absolute"}style.top=style.left=linb.dom.hide_value})},setRegion:function(hash,flag,force){var self=this,i,t,m,node=self._nodes[0],dom=linb.dom,f=dom.setPxStyle,m={};for(var j=0,c=dom.boxArr;i=c[j++];){m[i]=((i in hash)&&hash[i]!==null)?f(node,i,hash[i]):false}if(flag){if(force){m.width=m.height=m.left=m.top=true}if(dom.hasHandler(node,"onrewh")&&(m.width||m.height)){self.onRewh(true,{width:m.width,height:m.height})}if((dom.hasHandler(node,"onlocation")&&m.left||m.top)){self.onLocation(true,{left:m.left,top:m.top})}}return self},cssSize:function(size,flag){var self=this,node=self._nodes[0],dom=linb.dom,f=dom.setPxStyle,b1,b2;if(size){var t;b1=size.width!==null?f(node,"width",size.width):false;b2=size.height!==null?f(node,"height",size.height):false;if(flag&&(b1||b2)&&dom.hasHandler(node,"onrewh")){self.onRewh(true,{width:b1,height:b2})}return self}else{return{width:self.W(node,1)||0,height:self.H(node,1)}}},cssPos:function(pos,flag){var node=this._nodes[0],dom=linb.dom,f=dom.setPxStyle,b1,b2;if(pos){var t;b1=pos.left!=null?f(node,"left",pos.left):false;b2=pos.top!==null?f(node,"top",pos.top):false;if(flag&&(b1||b2)&&dom.hasHandler(node,"onlocation")){this.onLocation(true,{left:b1,top:b2})}return this}else{f=dom.getStyle;return{left:parseInt(f(node,"left"))||0,top:parseInt(f(node,"top"))||0}}},getRegion:function(flag,parent){var self=this,pos=flag?self.absPos(null,parent):self.cssPos(),size=self.cssSize();return{left:pos.left,top:pos.top,width:size.width,height:size.height}},absPos:function(pos,target){var r,t,browser=linb.browser,ns=this,node=ns.get(0),keepNode=node,parent=node.parentNode,op=node.offsetParent,doc=node.ownerDocument,dd=doc.documentElement,db=doc.body,_d=/^inline|table.*$/i,getStyle=linb.dom.getStyle,fixed=getStyle(node,"position")=="fixed",me=arguments.callee,add=me.add||(me.add=function(pos,l,t){pos.left+=parseInt(l)||0;pos.top+=parseInt(t)||0}),border=me.border||(me.border=function(node,pos){add(pos,getStyle(node,"borderLeftWidth"),getStyle(node,"borderTopWidth"))}),TTAG=me.TTAG||(me.TTAG={TABLE:1,TD:1,TH:1}),HTAG=me.HTAG||(me.HTAG={BODY:1,HTML:1}),posDiff=me.posDiff||(me.posDiff=function(o,target){var cssPos=o.cssPos(),absPos=o.absPos(null,target);return{left:absPos.left-cssPos.left,top:absPos.top-cssPos.top}});target=target?linb(target).get(0):doc;if(pos){if(pos.left===null&&pos.top===null){return ns}var d=posDiff(ns,target);ns.cssPos({left:pos.left===null?null:(pos.left-d.left),top:pos.top===null?null:(pos.top-d.top)});r=ns}else{if(node.getBoundingClientRect){pos=node.getBoundingClientRect();add(pos,Math.max(dd.scrollLeft,db.scrollLeft)-dd.clientLeft,Math.max(dd.scrollTop,db.scrollTop)-dd.clientTop)}else{pos={left:0,top:0};add(pos,node.offsetLeft,node.offsetTop);while(op&&op!=target&&op!=target.offsetParent){add(pos,op.offsetLeft,op.offsetTop);if(browser.kde||(browser.gek&&!TTAG[op.tagName])){border(op,pos)}if(!fixed&&getStyle(op,"position")=="fixed"){fixed=true}if(op.tagName!="BODY"){keepNode=op.tagName=="BODY"?keepNode:op}op=op.offsetParent}while(parent&&parent.tagName&&parent!=target&&!HTAG[parent.tagName]){if(!_d.test(getStyle(parent,"display"))){add(pos,-parent.scrollLeft,-parent.scrollTop)}if(browser.gek&&getStyle(parent,"overflow")!="visible"){border(parent,pos)}parent=parent.parentNode}if((browser.gek&&getStyle(keepNode,"position")!="absolute")){add(pos,-db.offsetLeft,-db.offsetTop)}if(fixed){add(pos,Math.max(dd.scrollLeft,db.scrollLeft),Math.max(dd.scrollTop,db.scrollTop))}}r=pos}return r},hasClass:function(str){var arr=this.get(0).className.split(/\s+/);return arr.exists(str)},addClass:function(str){var arr,t,me=arguments.callee,reg=(me.reg||(me.reg=/\s+/));return this.each(function(o){arr=(t=o.className).split(reg);if(!arr.exists(str)){o.className=t+" "+str}})},removeClass:function(str){var arr,i,l,a,t,bs=typeof str=="string",me=arguments.callee,reg=(me.reg||(me.reg=/\s+/));return this.each(function(o){arr=o.className.split(reg);l=arr.length;a=[];for(i=0;t=arr[i];i++){if(bs?(t!=str):(!str.test(String(t)))){a[a.length]=t}}if(l!=a.length){o.className=a.join(" ")}})},reClass:function(reg,replace){var n,r;return this.each(function(o){r=(n=o.className).replace(reg,replace);if(n!=r){o.className=r}})},addEventHandler:function(name,flag){var id,c,event=linb.event,type="on"+event._getEventType(name),f=event._eventhandler,fs=event.eventhandler,fi=event.getId,dom=linb.cache.dom;return this.each(function(o){if((window===o||document===o)&&type=="onrewh"){type="onresize"}id=fi(o);if(!id){id=o.id=_.id()}if(flag===false){if(o.setAttribute){o.setAttribute(type,fs)}}else{if(o[type]){return }o[type]=f}if(!(c=dom[id])){c=dom[id]=new linb.DomProfile();c.domNode=o;c.domId=id}(c.addition||(c.addition={}))[type]=1})},removeEventHandler:function(name){var type="on"+linb.event._getEventType(name);return this.each(function(o){if(o[type]){o[type]=null}if(o.getAttribute&&o.getAttribute(type)){o.removeAttribute(type)}})},clearEventHandler:function(){return this.each(function(o){linb.event._events.each(function(s){if(o[s="on"+s]){o[s]=null}if(o.getAttribute&&o.getAttribute(s)){o.removeAttribute(s)}})})},addEvent:function(name,fun,event_id,index,tagVar){var self=this,c,t,id,type,fi=linb.event.getId,dom=linb.cache.dom,event=linb.event;if(!(name instanceof Array)){name=[[name,fun,event_id]]}name.each(function(o,i){name=o[0];fun=o[1];event_id="$"+o[2];type=event._getEventType(name);if(typeof event_id!="string"){event_id="$"+_.id()}self.addEventHandler(name).each(function(o){id=fi(o);if(!id){id=o.id=_.id()}c=dom[id];t=c.events||(c.events={});c=t[name]||(t[name]=[]);if(typeof event_id=="undefined"){c.length=0;c=t[name]=[];index=-1}if(tagVar){c.$tagVar=tagVar}c[event_id]=fun;c.removeValue(event_id);c.insertAny(event_id,index)})});return self},removeEvent:function(name,event_id,flag){var self=this,c,t,k,id,i,type,fi=linb.event.getId,dom=linb.cache.dom,event=linb.event;if(!(name instanceof Array)){name=[[name,event_id]]}name.each(function(o,i){name=o[0];event_id="$"+o[1];type=event._getEventType(name);self.each(function(o){if(!(id=fi(o))){return }if(!(c=dom[id])){return }if(!(t=c.events)){return }if(flag){event._getEventName(type).each(function(o){delete t[o]})}else{if(typeof event_id=="string"){if(k=t[name]){if(k.exists(event_id)){k.removeValue(event_id)}delete k[event_id]}}else{delete t[name]}}})});return self},getEvent:function(name,event_id){var id;if(!(id=linb.event.getId(this.get(0)))){return }if(event_id){return _.get(linb.cache.dom,[id,"events",name,"$"+event_id])}else{var r=[],arr=_.get(linb.cache.dom,[id,"events",name]);arr.each(function(o,i){r[r.length]=[o,arr[o]]});return r}},clearEvent:function(){this.clearEventHandler();return this.each(function(o){var id,c,t;if(!(id=linb.event.getId(o))){return }if(!(c=linb.cache.dom[id])){return }_.filter(c.addition,function(i,v){if(v.startWith("on")){return false}});_.breakO(c.events,2);delete c.events})},addObserver:function(name,event_id,index,fun,args,target){return this.addEvent(name,function(){for(var para=[],i=0,l=arguments.length,n;n=arguments[i];i++){para[para.length]=(args&&args[i])||n}return _.tryF(fun,para,target||this)},event_id,index)},removeObserver:function(name,event_id){return this.removeEvent(name,event_id)},fireEvent:function(name,args){var type=linb.event._getEventType(name),t,s="on"+type,me=arguments.callee,f=linb.event._eventhandler,f1=me.f1||(me.f1=function(){this.returnValue=false}),f2=me.f2||(me.f2=function(){this.cancelBubble=true});args=args||{};return this.each(function(o){if(typeof o[s]!="function"){if(!o[s]&&!(o.getAttribute&&o.getAttribute(s))){return }o[s]=f}_.merge(args,{type:type,target:o,button:1,$e:true,$name:name,preventDefault:f1,stopPropagation:f2},"all");if("blur"==type||"focus"==type){o[type].call(o,args)}else{o[s].call(o,args)}})},canFocus:function(){var me=arguments.callee,map=me.map||(me.map={a:1,input:1,select:1,textarea:1,button:1}),node;return !!((node=this._nodes[0])&&node.focus&&map[node.tagName.toLowerCase()]&&linb.dom.getStyle(node,"display")!="none"&&linb.dom.getStyle(node,"visibility")!="hidden"&&node.offsetWidth>0&&node.offsetHeight>0)},selectable:function(v){var me=arguments.callee,f=me.f||(me.f=function(){return false});return this.each(function(o){if(linb.browser.gek){o.style.MozUserSelect=v?"all":"none"}else{o.unselectable=v?"off":"on";o.onselectstart=v?null:f}})},activate:function(){if(this.canFocus()){var node=this.get(0);node.focus();if(node.select){node.select()}}},focus:function(flag){if(flag||this.canFocus()){this.get(0).focus()}},blur:function(){if(this.canFocus()){this.get(0).blur()}},enable:function(value){if(typeof value!="undefined"){this.disabled(!value)}else{return !this.disabled()}return this},inlineBlock:function(flag){if(flag){if(linb.browser.gek){this.display("-moz-inline-block").display("-moz-inline-box")}else{this.display("inline-block")}}else{this.display("")}return this},topZindex:function(flag){var i=1000,j=0,k,node=this.get(0),p=node.offsetParent,t,o;if(node.nodeType!=1||!p){return 1}t=p.childNodes;for(k=0;o=t[k];k++){if(o==node||o.nodeType!=1||o.style.display=="none"||o.style.visibility=="hidden"||o.zIndexIgnore){continue}j=parseInt(o.style&&o.style.zIndex)||0;i=i>j?i:j}i++;if(i>=linb.dom.top_zIndex){linb.dom.top_zIndex=i+1000}if(flag){node.style.zIndex=i}else{j=parseInt(node.style.zIndex)||0;return i>j?i:j}return this},busy:function(flag){var self=this,dom=linb.dom;if(dom._busy){return }var id=self.id();if(typeof dom._cursor[id]=="undefined"){dom._cursor[id]=_.str(self.cursor());self.cursor("wait");dom.busy(flag)}return self},free:function(){var self=this,dom=linb.dom;if(!dom._busy){return }var id=self.id();if(typeof dom._cursor[id]!="undefined"){cursor=_.str(dom._cursor[id],"default");self.cursor(cursor);delete dom._cursor[id]}dom.free();return self},UIAction:function(fun){var self=this;linb.thread(null,[function(){self.busy()},fun,function(){self.free()}]).start()},nextFocus:function(dir,inn,set){dir=_.bool(dir,true);var self=this.get(0),node=this.$iterator("",dir,inn,function(node){return node!==self&&linb([node]).canFocus()});if(!node.isEmpty()&&set!==false){node.focus()}return node},fx:function(args,onStart,onEnd,time,step,type,id){var me=arguments.callee,hash=me.lib||(me.lib={line:function(x){return x},inexp:function(x){return(x==0)?0:Math.pow(2,10*(x-1))},outexp:function(x){return(x==1)?1:-Math.pow(2,-10*x)+1},insine:function(x){return -1*Math.cos(x*(Math.PI/2))+1},outsine:function(x){return Math.sin(x*(Math.PI/2))},inoutsine:function(x){return -1/2*(Math.cos(Math.PI*x)-1)}}),color=me.color||(me.color=function(type,args,step,j){var f,fun,value=0+(100-0)*hash[type](j/step),from=args[0],to=args[1];if(typeof from!="string"||typeof to!="string"){return"#fff"}if(value<0){return from}else{if(value>100){return to}}f=function(str){return(str.charAt(0)!="#")?("#"+str):str};from=f(from);to=f(to);f=function(str,i,j){return parseInt(str.slice(i,j),16)||0};fun=function(o){return{red:f(o,1,3),green:f(o,3,5),blue:f(o,5,7)}};from=fun(from);to=fun(to);f=function(from,to,value,c){var r=from[c]+Math.round((value/100)*(to[c]-from[c]));return(r<16?"0":"")+r.toString(16)};return"#"+f(from,to,value,"red")+f(from,to,value,"green")+f(from,to,value,"blue")});time=time||200;step=step||5;type=typeof hash[type]!="undefined"?type:"line";var self=this,threadid=id||_.id(),delay=time/step,i,j=0,value,funs=[function(threadid){if(++j>step){linb.thread(threadid).abort();return false}_.each(args,function(o,i){if(typeof o=="function"){o(j,step)}else{value=String((i.toLowerCase().endWith("color"))?color(type,o,step,j):(o[0]+(o[1]-o[0])*hash[type](j/step)));(self[i])?(self[i](value)):(self.setStyle(i,value))}})}];return linb.thread(threadid,funs,delay,null,onStart,onEnd,true)},popToTop:function(pos,parent,type){var region,target=this;type=(type||1).toString();parent=linb(parent||document.body);target.setStyle({position:"absolute",left:"0",top:"0",visibility:"hidden",display:"block",zIndex:linb.dom.top_zIndex});parent.attach(target,true);if(pos["linb.dom"]||pos.nodeType){var node=linb(pos),abspos=node.absPos(null,parent);region={left:abspos.left,top:abspos.top,width:node.offsetWidth(),height:node.offsetHeight()}}else{region=pos.region||{left:pos.left-8,top:pos.top-8,width:16,height:16}}pos={left:0,top:0};var t=linb(window),box={};box.left=t.scrollLeft();box.top=t.scrollTop();box.width=t.width()+box.left;box.height=t.height()+box.top;var w=target.offsetWidth(),h=target.offsetHeight(),hi,wi;switch(type){case"1":hi=false;wi=true;break;case"2":hi=true;wi=false;break;case"3":hi=false;wi=false;break;case"4":hi=wi=true;break}if(hi){if(region.top+h<box.height){pos.top=region.top}else{pos.top=region.top+region.height-h}}else{if(region.top+region.height+h<box.height){pos.top=region.top+region.height}else{pos.top=region.top-h}}if(wi){if(region.left+w<box.width){pos.left=region.left}else{pos.left=region.left+region.width-w}}else{if(region.left+region.width+w<box.width){pos.left=region.left+region.width}else{pos.left=region.left-w}}if(pos.left+w>box.width){pos.left=box.width-w}if(pos.left<box.left){pos.left=box.left}if(pos.top+h>box.height){pos.top=box.height-h}if(pos.top<box.top){pos.top=box.top}target.cssPos(pos).setStyle({visibility:"visible",display:"block"});return this},setBlurTrigger:function(id,trigger,group){var ns=this,doc=document,sid="$blur_triggers$",target=group?group:linb(ns.get()),fun=linb.dom._blurTrigger||(linb.dom._blurTrigger=function(p,e){var me=arguments.callee,p=linb.event.getPos(e),arr=me.arr,a=arr.copy(),b,pos,size;a.each(function(i){b=true;if(!(v=arr[i].target)){b=false}else{v.each(function(o){if(!linb.dom.byId(o.id)){return b=false}})}if(!b){arr.removeValue(i);delete arr[i]}});a=arr.copy();a.each(function(i){v=arr[i];b=true;v.target.each(function(o){if(o.parentNode){o=linb([o]);pos=o.absPos();size=o.cssSize();if(p.left>=pos.left&&p.top>=pos.top&&p.left<=(pos.left+size.width)&&p.top<=(pos.top+size.height)){return b=false}}});if(b){_.tryF(v.trigger,[],v.target);arr.removeValue(i);delete arr[i]}else{return false}},null,true);a.length=0}),arr=fun.arr||(fun.arr=[]);if(!doc.onmousedown){doc.onmousedown=linb.event._eventhandler}if(!trigger){arr.removeValue(id);delete arr[id]}else{if(!arr[id]){arr[id]={trigger:trigger,target:target};arr.push(id)}}return this},ieTrigger:function(flat){var self=this;_.asyRun(function(){self.setStyle("wordWrap","break-word")});_.asyRun(function(){self.setStyle("wordWrap","normal")});return this}},Static:{hide_value:"-10000px",top_zIndex:10000,boxArr:"width,height,left,top,right,bottom".toArr(),_cursor:{},setPxStyle:function(node,key,value){var style=node.style;if(value||value===0){value=(String(parseFloat(value))==String(value))?(parseInt(value)||0)+"px":value;if((key=="width"||key=="height")&&value.charAt(0)=="-"){value="0"}if(style[key]!=value){style[key]=value;return true}}return false},$gc:function(){var i,o,w,cache=linb.cache.dom,bak=[];for(i in cache){o=cache[i];if((!o)||(window===o.domNode)||(document===o.domNode)){continue}if(!document.getElementById(o.domId)){o.$gc();bak[bak.length]=i;if(o.$domId&&o.$domId!=o.domId){bak[bak.length]=o.$domId}}}for(i=0;i<bak.length;){delete cache[bak[i++]]}if(linb.browser.ie6){CollectGarbage()}},clean:function(e){var t,i,a,arr=window===e?[window]:document===e?[e]:e.constructor==Array?e:e["linb.dom"]?e._nodes:e.toDomNodes?e.toDomNodes():typeof e=="function"?e.apply(arguments[2],arguments[1]):typeof e!="string"?[e]:e.charAt(0)=="{"?linb.SC(e.slice(1,e.length-1)).getAll().reBoxing()._nodes:[e];if(arr[0]&&!arr[0].nodeType){a=[];for(i=0;i<arr.length;i++){if(t=(typeof (t=arr[i])=="string"?document.getElementById(t):(t&&t.domNode)?t.domNode:t)||null){a[a.length]=t}}}else{a=arr}return a},getStyle:function(node,key,flag){if(!node.style){return""}var value=node.style[key];if(!value||flag){var me=arguments.callee,t,map=me.map||(me.map={"float":1,cssFloat:1,styleFloat:1}),cache=me.cache||(me.cache={}),key=cache[key]||(cache[key]=key.replace(/\-(\w)/g,function(a,b){return b.toUpperCase()}));if(map[key]){key=linb.browser.ie?"styleFloat":"cssFloat"}value=((t=document.defaultView)&&t.getComputedStyle)?(t=t.getComputedStyle(node,null))?t[key]:"":(node.currentStyle&&node.currentStyle[key])}return value||""},_matixid:"linb.matix::",isMatix:function(id){return id&&id.startWith(this._matixid)},getMatix:function(index){var i=1,id,o,count=0,me=arguments.callee,m=me.m,doc=document;index=index||1;while(1){id=this._matixid+i;if(o=linb.dom.byId(id)){if(!o.firstChild&&++count==index){return linb([o])}}else{if(!m){me.m=m=doc.createElement("div");var style=m.style;style.position="absolute";style.visibility="hidden";style.left=style.top=linb.dom.hide_value}o=m.cloneNode(false);o.id=id;doc.body.insertBefore(o,doc.body.firstChild);return linb([o])}i++}},setCover:function(arg1,arg2,arg3,arg4){var me=arguments.callee,id="linb.temp:cover:",id2="linb.temp:message:",o1,o2,body=linb([document.body]),ini=linb.ini;if((o1=linb(id)).isEmpty()){body.addFirst(o1=linb.create('<div id="'+id+'" style="position:absolute;display:none;left:0;top:0;z-index:0;background-image:url('+ini.path+'bg.gif)">'))}if((o2=linb(id2)).isEmpty()&&arg2){body.addFirst(o2=linb.create('<div id="'+id2+'" style="position:absolute;display:none;"><img src="'+ini.path+'loading.gif" border="0"/><div style="font-size:12px;"></div></div>'))}if(arg1===false){if(typeof arg4=="string"){if(typeof me._key=="string"&&me._key!=arg4){return }}if(me.show){o1.setStyle({display:"none",zIndex:"0"});body.cursor("");o2.display("none").last().empty();me.show=false}}else{if(typeof arg4=="string"){me._key=arg4}var t=linb([window],false),w=t.scrollWidth(),h=t.scrollHeight();if(!me.show){o1.setStyle({width:w+"px",height:h+"px",display:"block",zIndex:(linb.dom.top_zIndex+200),cursor:"wait"});body.cursor("wait");me.show=true}if(arg2){var x=t.scrollLeft()+t.width()/2,y=t.scrollTop()+t.height()/2;o2.left(x).top(y).display("block").zIndex(linb.dom.top_zIndex+300);if(typeof arg1=="string"){o2.last().get(0).innerHTML=(arg3?o2.html():"")+arg1}}}},byId:function(e){return document.getElementById(e)},hasHandler:function(node,name){return !!(node[name]||(node.getAttribute&&node.getAttribute(name)))},submit:function(action,data,method,target,enctype){data=_.hash(data);method=_.str(method,"get");action=_.str(action);target=_.str("_blank");var _t=[];_.each(data,function(o,i){_t.push('<textarea name="'+i+'">'+(typeof o=="object"?_.serialize(o):o)+"</textarea>")});var d=('<form target="'+target+'" action="'+action+'" method="'+method+(enctype?'" enctype="'+enctype:"")+'">'+_t.join("")+'<input type="hidden" name="rnd" value="'+_()+'"></form>').toDom();linb.dom.getMatix().addLast(d);d.get(0).submit();d.remove()},busy:function(flag,key){var dom=linb.dom;if(flag!==false){dom.setCover(true,0,0,key)}dom._busy=true},free:function(key){var dom=linb.dom;dom.setCover(false,0,0,key);dom._busy=false},UIAction:function(fun){linb.thread(null,[function(){linb.dom.busy()},fun,function(){linb.dom.free()}]).start()},fxProxy:function(from,to,onStart,onEnd,time,step,type,id){var args={},me=arguments.callee,arr=me.arr||(me.arr=arr="left,top,width,height".toArr()),node=me.node=(me.node=linb.create("<div style='border:dashed 1px blue;position:absolute;left:-10000px;'></div>"));arr.each(function(i){args[i]=[from[i],to[i]]});linb(document.body).addLast(node);node.zIndex(linb.dom.top_zIndex+10);return node.fx(args,onStart,function(){node.cssSize({width:0,height:0}).remove(false);_.tryF(onEnd)},time,step,type,id)}},After:function(d){var self=this;_.each({parent:["y",false],pre:["x",false],next:["x",true],first:["y",true],last:["y",1]},function(o,i){self.plugIn(i,function(index){if(typeof index=="string"){css=index;index=0}if(index===0){return this}else{return this.$iterator(o[0],o[1],true,index||1)}})});"nodeName,nodeType,tagName,offsetLeft,offsetTop,offsetParent,scrollWidth,scrollHeight".toArr().each(function(o){self.plugIn(o,function(value){var t=this.get(0),w=window,d=document;if(t==w||t==d){if("scrollWidth"==o||"scrollHeight"==o){var a=d.documentElement,b=d.body;return Math.max(a[o],b[o])}else{t=linb.browser.contentBox?d.documentElement:d.body}}return t[o]})});var p="padding",m="margin",b="border",c="client",o="offset",r="real",w="width",h="height",W="Width",H="Height",T="Top",L="Left",t="top",l="left",R="Right",B="Bottom";[[p+"H",p+T,p+B],[p+"W",p+L,p+R],[b+"H",b+T+W,b+B+W],[b+"W",b+L+W,b+R+W],[m+"W",m+L,m+R],[m+"H",m+T,m+B]].each(function(o){var node,fun=linb.dom.getStyle;self.plugIn(o[0],function(){node=this.get(0);return(parseInt(fun(node,o[1]))+parseInt(fun(node,o[2])))||0})});[["W",w,p+"W",b+"W",m+"W",c+W,o+W],["H",h,p+"H",b+"H",m+"H",c+H,o+H]].each(function(o){self.plugIn(o[0],function(node,index,value){var n,r,t,style=node.style,me=arguments.callee,contentBox=linb.browser.contentBox,r1=me.r1||(me.r1=/%$/),getStyle=linb.dom.getStyle,f=linb.dom.setPxStyle,type=typeof value;if(type=="undefined"||type=="boolean"){if(value===true){n=(getStyle(node,"display")=="none");if(n){var temp=linb.dom.getMatix().html("*",false);linb([node]).swap(temp);var b,p,d;b=style.visibility,p=style.position,d=style.display;p=p||"";b=b||"";d=d||"";style.visibility="hidden";style.position="absolute";style.display="block"}}switch(index){case 1:r=getStyle(node,o[1]);if(isNaN(parseInt(r))||r1.test(r)){r=me(node,2)-(contentBox?linb([node])[o[2]]():0)}r=parseInt(r)||0;break;case 2:r=node[o[5]];if(!r){r=node[o[6]]-linb([node])[o[3]]()}break;case 3:r=node[o[6]];if(!r){r=me(node,1)+(contentBox?(t=linb([node]))[o[2]]():0)+t[o[3]]()}break;case 4:r=me(node,3);r+=linb([node])[o[4]]();break}if(n){style.display=d;style.position=p;style.visibility=b;linb([node]).swap(temp);temp.empty(false)}return parseInt(r)||0}else{switch(index){case 1:if(f(node,o[1],value)){if(linb.dom.hasHandler(node,"onrewh")){var args={};args[o[1]]=1;linb([node]).onRewh(true,args)}}break;case 2:me(node,1,value-(contentBox?linb([node])[o[2]]():0));break;case 3:me(node,1,value-(t=linb([node]))[o[3]]()-(contentBox?t[o[2]]():0));break;case 4:me(node,1,value-(t=linb([node]))[o[4]]()-t[o[3]]()-(contentBox?t[o[2]]():0));break}}})});[[c+W,"W",2],[o+W,"W",3],[r+W,"W",4],[c+H,"H",2],[o+H,"H",3],[r+H,"H",4]].each(function(o){self.plugIn(o[0],function(value){var type=typeof value;if(type=="undefined"||type=="boolean"){return this[o[1]](this.get(0),o[2])}else{return this.each(function(v){this[o[1]](v,o[2],value)})}})});[[l+"By",l,o+L],[t+"By",t,o+T],[w+"By",w,o+W],[h+"By",h,o+H]].each(function(o){self.plugIn(o[0],function(value,flag){if(value===0){return this}var t,m,v,args,k=o[1];return this.each(function(node){t=node.style;m=t[k];if(m=="auto"){m=this[o[2]](node)}v=(parseInt(m)||0)+value;if(k=="width"||k=="height"){v=v>0?v:0}t[k]=v+"px";if(flag){args={};args[k]=1;if((k=="left"||k=="top")&&linb.dom.hasHandler(node,"onlocation")){linb([node]).onLocation(true,args)}if((k=="width"||k=="height")&&linb.dom.hasHandler(node,"onrewh")){linb([node]).onRewh(true,args)}}},this)})});self.addCustomEvent=function(o){if(!(o instanceof Array)){o=[o]}var self=this,f;o.each(function(o){f=function(fun,event_id,flag,tagVar){if(typeof fun=="function"){return this.addEvent(o,fun,event_id,flag,tagVar)}else{if(fun===null){return this.removeEvent(o,event_id,flag)}}var args=arguments[1]||{};args.$all=(arguments[0]===true);return this.fireEvent(o,args)};f.$event$=1;self.plugIn(o,f)});return self};"disabled,readonly,checked,className,value,title,name,href,src".toArr().each(function(o){self.plugIn(o,function(value){return this.attr(o,value)})});"scrollLeft,scrollTop,tabIndex".toArr().each(function(o){self.plugIn(o,function(value,flag){if(typeof value!="undefined"){return this.each(function(v){v[o]=value})}else{var v=this.get(0);if(v===window||v===document){var a=document.documentElement,b=document.body;if("scrollTop"==o){return window.pageYOffset||Math.max(a[o],b[o])}if("scrollLeft"==o){return window.pageXOffset||Math.max(a[o],b[o])}}return v[o]}})});"cursor,backgroundColor,display,overflow,color,background,position,zIndex,visibility,border".toArr().each(function(o){self.plugIn(o,function(value){if(value===undefined){var node=this._nodes[0];if(!node||node.nodeType!=1){return }var r=linb.dom.getStyle(node,o);if("zIndex"==o){r=parseInt(r)||0}return r}else{return this.setStyle(o,value)}})});self.boxArr.each(function(o){self.plugIn(o,function(value){var self=this,node=self._nodes[0],type=typeof value,doc=document,t;if(!node||node.nodeType==3){return }if(type=="undefined"||type=="boolean"){if((o=="width"&&(t="Width"))||(o=="height"&&(t="Height"))){if(doc===node){return Math.max(doc.body["scroll"+t],doc.body["offset"+t])}if(window===node){return window["inner"+t]||(linb.browser.contentBox&&doc.documentElement["client"+t])||doc.body["client"+t]}}if(o=="width"){value=parseInt(node.style.width)||self.W(node,1,value)}else{if(o=="height"){value=parseInt(node.style.height)||self.H(node,1,value)}else{value=linb.dom.getStyle(node,o)}}return value=="auto"?value:(parseInt(value)||0)}else{var f=linb.dom.setPxStyle,t,a;return self.each(function(v){if(v.nodeType!=1){return }switch(o){case"right":case"bottom":f(v,o,value);break;default:if(v.style[o]!==value){if(o=="width"){self.W(v,1,value)}else{if(o=="height"){self.H(v,1,value)}else{if(f(v,o,value)){if((o=="top"||o=="left")&&linb.dom.hasHandler(node,"onlocation")){a={};a[o]=1;linb([v]).onLocation(true,a)}}}}}}})}})});linb.event._events.each(function(o){linb.event._getEventName(o).each(function(o){self.addCustomEvent(o)})})},Initialize:function(){linb([document]).onKeydown(function(p,e){var event=linb.event,set;event.currentKey=event.getKey(e);if(event.currentKey){set=linb.cache.hookKey[event.currentKey.join(":")];if(set&&(_.tryF(set[0],set[1],set[2])===false)){event.stopBubble(e);return false}}return true},"document").onKeyup(function(p,e){linb.event.currentKey=null},"document");linb([window]).afterUnload(function(){linb.SC.$gc();linb.thread.$gc();linb([window,document]).clearEvent();linb([document.body]).empty();linb.dom.$gc();_.breakO([linb,Class,_],3);window.Class=window.linb=window._=undefined},"window",-1)}});Class("linb.Com",null,{Constructor:function(){var self=this;self._nodes=[];self.host=self;self.properties=self.properties||{};self.events=self.events||{}},Instance:{setHost:function(h){this.host=h;return this},setProperties:function(key,value){var self=this;if(!key){self.properties={}}else{if(typeof key=="string"){self.properties[key]=value}else{_.merge(self.properties,key,"all")}}return self},setEvents:function(key,value){var self=this;if(!key){self.events={}}else{if(typeof key=="string"){self.events[key]=value}else{_.merge(self.events,key,"all")}}return self},fireEvent:function(name,args){var t,self=this;if(t=self.events[name]){if(typeof t=="string"){t=self.host[t]}args=args||[];args.splice(0,0,self,self.threadid);if(typeof t=="function"){t.apply(self.host,args)}}},innerCall:function(name){var self=this;_.tryF(self[name],[self.threadid],self)},show:function(onEnd,parent,showId,threadid){var self=this,f=function(){if(self.customAttach){self.customAttach.call(self,parent,showId,threadid)}else{(parent||linb([document.body])).attach(self.getUIObj(),showId)}_.tryF(onEnd,[self,threadid],self.host);self.fireEvent("afterShow")};self.threadid=threadid;self.fireEvent("beforeShow");if(self.created){f()}else{self.create(f,threadid)}},create:function(onEnd,threadid){var self=this,suspend=linb.thread.suspend,resume=linb.thread.resume,t,funs=[];self.threadid=threadid;self.fireEvent("beforeCreated");funs.push(function(threadid){self.threadid=threadid});if((t=self.base)&&t.length){funs.push(function(threadid){suspend(threadid);linb.SC.group(self.base,function(key){self.fireEvent("onLoadBaseClass",[key])},function(){resume(threadid)})})}if(self.loadResource){funs.push(function(){self.fireEvent("onLoadResource");self.innerCall("loadResource")})}if((t=self.required)&&t.length){funs.push(function(threadid){suspend(threadid);linb.SC.group(self.required,function(key){self.fireEvent("onCodeLoaded",[key])},function(){resume(threadid)})})}if(self.iniComponents){funs.push(function(){self.fireEvent("beforeIniComponents");self.innerCall("iniComponents");self.fireEvent("afterIniComponents")})}if(self.iniExComs){funs.push(function(){self.innerCall("iniExComs")})}funs.push(function(threadid){self.loaded=true;if(self.background){linb.SC.background(self.background)}self.fireEvent("onReady");_.tryF(onEnd,[self,threadid],self.host);self.fireEvent("afterCreated")});if(self.iniUI){funs.push(function(){self.innerCall("iniUI")})}linb.thread.asyUI(threadid,funs,function(){self.created=true})},iniComponents:function(){return this._nodes},requestData:function(group,threadid,onEnd){var thread=linb.thread;thread.asyUI(threadid,[function(t){thread.suspend(threadid||t);linb.io.group(group,null,null,function(){_.tryF(onEnd);thread.resume(threadid||t)}).start()}])},clean:function(){this.properties={};this.events={};this.getUIObj().clean()},build:function(threadid,onEnd,flag){_.tryF(onEnd)},fillData:function(threadid,onEnd,flag){_.tryF(onEnd)},getUIObj:function(){var nodes=this._nodes.copy();nodes.filter(function(o){return !!o.box.hasDomRoot});return linb.UI.pack(nodes,false)},detach:function(index){if(this._nodes){this.getUIObj().detach()}return this},reBoxing:function(key){return this.getUIObj().reBoxing(key)},attachTo:function(obj,key){obj.attach(this.getUIObj(),key)},destroy:function(threadid){var self=this;self.threadid=threadid;self.fireEvent("beforeDestroy");linb.UI.pack(self._nodes,false).destroy();self._nodes.length=0;_.breakO(self)}},Static:{EventHandlers:{beforeShow:function(){},beforeCreated:function(){},onLoadBaseClass:function(key){},onLoadResource:function(){},beforeIniComponents:function(){},afterIniComponents:function(){},onLoadWidgets:function(key){},onReady:function(){},afterCreated:function(){},afterShow:function(){}},load:function(cls,onEnd,lang,flag){linb.main(function(){linb.SC(cls,function(){var a=this,f=function(){if(flag!==false){(new a()).show()}_.tryF(onEnd,[a],a)};if(lang){linb.reLang(lang,f)}else{f()}},true)})}}});Class("linb.Cookies",null,{Static:{set:function(key,value,days,path,domain,secure){key=encodeURIComponent(key);value=encodeURIComponent(value);var ep,date;if(typeof days=="number"&&isFinite(days)){date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));ep=date.toUTCString()}document.cookie=key+"="+value+(ep?"; expires="+ep:"")+(path?"; path="+path:"")+(domain?"; domain="+domain:"")+(secure?"; secure;":"");return this},get:function(key){key=encodeURIComponent(key);var nEQ=key+"=",ca=document.cookie.split(";"),i,c;for(i=0;i<ca.length;i++){c=ca[i];while(c.charAt(0)==" "){c=c.substring(1,c.length)}if(c.indexOf(nEQ)===0){return decodeURIComponent(c.substring(nEQ.length,c.length))}}return""},remove:function(key){return this.set(key,"",-1).set(key,"/",-1)},getURIParas:function(str,key){if(!str){return key?"":{}}var arr,hash={},a=str.split("&"),o;for(var i=0,l=a.length;i<l;i++){o=a[i];arr=o.split("=");hash[decodeURIComponent(arr[0])]=decodeURIComponent(arr[1])}return key?hash[key]:hash}}});Class("linb.dragDrop",null,{Static:{_eh:"_dd",_id:"linb.dd:proxy:",_idi:"linb.dd:td:",_size:50,_type:{blank:1,move:1,shape:1,copy:1,icon:1,none:1},_Icons:{none:"top",move:"-16px",ref:"-32px",add:"-48px"},$:{},_left:function(value){with(this){if(docking_offset>0&&docking_x&&docking_x.length){var l=docking_x.length;while(l--){if(Math.abs(value-docking_x[l])<=docking_offset){return docking_x[l]}}}if(grid_width>1){return Math.floor(value/grid_width)*grid_width}return value}},_top:function(value){with(this){if(docking_offset>0&&docking_y&&docking_y.length){var l=docking_y.length;while(l--){if(Math.abs(value-docking_y[l])<=docking_offset){return docking_y[l]}}}if(grid_height>1){return Math.floor(value/grid_height)*grid_height}return value}},_ini:function(o){with(this){var _t=linb(window);_box={width:_t.width()+_t.scrollLeft(),height:_t.height()+_t.scrollTop()};ox=x;oy=y;if(proxy=o){proxystyle=o.get(0).style;_absPos=proxy.absPos(null,target_parent);_cssPos=proxy.cssPos();cssPos_offset_x=x-_cssPos.left;cssPos_offset_y=y-_cssPos.top;absPos_offset_x=x-_absPos.left;absPos_offset_y=y-_absPos.top;limit_left=x-offset_left;limit_right=x+offset_right;limit_top=y-offset_top;limit_bottom=y+offset_bottom;proxyPos.left=pre.left=_cssPos.left;proxyPos.top=pre.top=_cssPos.top;if("move"!==type){_zIndex=proxy.zIndex();proxy.zIndex(linb.dom.top_zIndex*10)}if(opacity){proxy.opacity(0.8)}}}},_reset:function(){var d=this;d.$reset&&d.$reset();d.start=null;d.showDDMark(0);d.resetProxy();d.type="shape";d.cursor="move";d._cursor=d._button="";d.move=true;d._begin=_();d.mousemove=d.mouseup=d.onselectstart=d.ondragstart="*";d.pre={left:0,top:0};d.proxyPos={left:0,top:0};d.docking_x=d.docking_y=[];d.target_clone=true;d.grid_width=d.grid_height=1;d._timer=d.docking_offset=-1;d._defer=d.defer=d._zIndex=d.x=d.y=d.ox=d.absPos_offset_y=d.absPos_offset_x=d.cssPos_offset_x=d.oy=d.cssPos_offset_y=d.limit_left=d.limit_right=d.limit_top=d.limit_bottom=0;d.working=d.offset_bottom=d.offset_left=d.offset_right=d.offset_top=d.drop2=d._stop=d.opacity=d.horizontal=d.vertical=d.topZindex=false;d.target_style=d.proxystyle=d._onDrag=d._onDragover=d.key=d.data=d.dragKey=d.dragData=d._current_bak=d._current=d._source=d._data=d.proxy=d.proxyIn=d._absPos=d._cssPos=d._box=d.pack=d.unpack=d.target_left=d.target_top=d.target_width=d.target_height=d.target_parent=null;return d},abort:function(){this._stop=true},_end:function(){with(this){if(proxy){unpack?unpack():_unpack();if(opacity){proxy.opacity(1)}}var d=document;if(onselectstart!="*"){d.body.onselectstart=onselectstart}if(ondragstart!="*"){d.ondragstart=ondragstart}if(mousemove!="*"){d.onmousemove=mousemove}if(mouseup!="*"){d.onmouseup=mouseup}}return this},drag:function(e,node,profile,key,data){var self=this;with(self){_end()._reset();e=e||window.event;if(linb.event.getBtn(e)!=="left"){return true}_source=node=linb(node);_cursor=_source.cursor();if(!node.id()){node.id(_.id(),true)}_defer=defer=_.numb(profile&&profile.defer,defer);if(profile){if(true===profile.cursor){profile.cursor=_cursor}type=typeof profile.icon=="string"?"icon":_type[type]?type:"shape"}profile=_.hash(profile);var d=document,_pos=linb.event.getPos(e);profile.x=_pos.left;profile.y=_pos.top;profile._button=linb.event.getBtn(e);dragKey=key||(profile&&profile.key);dragData=data||(profile&&profile.data);self.start=function(e){var t;_source.beforeDragbegin();if(working||_stop){_end()._reset();return false}_.merge(self,profile,"all");_ini(pack?pack():(type=="none")?null:_pack(_pos,node));if(profile.x>=_box.width||profile.y>=_box.height){_end()._reset();return true}working=true;_source.onDragbegin();if(defer<=0){mousemove=d.onmousemove;mouseup=d.onmouseup}d.onmousemove=$onDrag;d.onmouseup=$onDrop;_source.afterDragbegin();if(defer>0){$onDrag.call(self,e)}};if(linb.browser.ie){ondragstart=d.ondragstart;onselectstart=d.body.onselectstart;d.ondragstart=d.body.onselectstart=null;if(d.selection){_.tryF(d.selection.empty)}}linb.event.stopBubble(e);if(node.get(0)!==d){linb(d).onMousedown(true,linb.event.getEventPara(e))}if(defer<=0){_.tryF(self.start,[e],self);return false}else{mouseup=d.onmouseup;d.onmouseup=function(e){linb.dragDrop._end()._reset();return _.tryF(document.onmouseup,[e],null,true)};mousemove=d.onmousemove;d.onmousemove=function(e){if(--_defer<=0){linb.dragDrop.start(e)}return false}}}},$onDrag:function(e){with(linb.dragDrop){e=e||window.event;if((!working)||_stop||(linb.browser.ie&&(!e.button))){$onDrop(e);return true}var _pos=linb.event.getPos(e);x=_pos.left;y=_pos.top;if(!working){return false}if(proxy){if(!vertical){proxyPos.left=Math.floor(_left(((offset_left!==false||offset_right!==false)?((x<=limit_left)?limit_left:(x>=limit_right)?limit_right:x):x)-cssPos_offset_x));if(proxyPos.left-pre.left){proxystyle.left=proxyPos.left+"px"}pre.left=proxyPos.left}if(!horizontal){proxyPos.top=Math.floor(_top(((offset_top!==false||offset_bottom!==false)?((y<=limit_top)?limit_top:(y>=limit_bottom)?limit_bottom:y):y)-cssPos_offset_y));if(proxyPos.top-pre.top){proxystyle.top=proxyPos.top+"px"}pre.top=proxyPos.top}}else{}if(_onDrag!=1){if(_onDrag){_onDrag(e)}else{_onDrag=1;_source.onDrag(true,linb.event.getEventPara(e))}}return false}},$onDrop:function(e){with(linb.dragDrop){e=e||window.event;_end();if(working){var r=_source.onDragstop(true,linb.event.getEventPara(e));if(_current){linb(_current.id).onDrop(true,linb.event.getEventPara(e))}}_reset();linb.event.stopBubble(e);_.tryF(document.onmouseup,[e]);return !!r}},getOffset:function(){with(this){return proxy?{x:proxyPos.left-ox+cssPos_offset_x,y:proxyPos.top-oy+cssPos_offset_y}:{x:x-ox,y:y-oy}}},showDDMark:function(o,mode){var self=this,s1='<div style="position:absolute;z-index:'+linb.dom.top_zIndex+";font-size:0;line-height:0;border-",s2=":dashed 1px blue;",region=self._Region,bg="backgroundColor";if(region&&region.parent()){region.remove(false)}if(self._R){self._R.setStyle(bg,self._RB);delete self._R;delete self._RB}if(o){if(!region){region=self._Region=linb.create(s1+"top"+s2+'left:0;top:0;width:100%;height:0;"></div>'+s1+"right"+s2+'right:0;top:0;height:100%;width:0;"></div>'+s1+"bottom"+s2+'bottom:0;left:0;width:100%;height:0;"></div>'+s1+"left"+s2+'width:0;left:0;top:0;height:100%;"></div>')}o=linb(o);if(o.display()=="block"){o.addLast(region)}else{self._RB=o.getStyle(bg);self._R=o;o.setStyle(bg,"#FA8072")}self.setDropableIcon(mode||"move")}else{self.setDropableIcon("none")}},setDropableIcon:function(mode){_.resetRun("showDDMark",null);var self=this,i=self.proxyIn,ic=self._Icons;if(i&&self.type=="icon"){i.setStyle("backgroundPosition","left "+(ic[mode]||ic.none))}},setProxy:function(child,pos){var t,temp,self=this,dom=linb.dom;if(!dom.byId(self._id)){linb([document.body]).addFirst(dom.create('<div id="'+self._id+'" style="left:0;top:0;border:0; padding:'+self._size+'px; position: absolute;"><div id="'+self._idi+'">&nbsp;</div></div>'))}t=linb(self._id);if(self.drop2){t.setStyle("padding",0)}else{pos.left-=self._size;pos.top-=self._size;if(!self.target_parent){dom.setCover(true);linb([document.body]).cursor(self.cursor)}}if(temp=self.target_parent){linb(temp).addLast(t)}if(child){linb(self._idi).addLast(child);self.proxyIn=child}else{self.proxyIn=linb(self._idi)}t.setStyle({display:"",zIndex:dom.top_zIndex*10,cursor:self.cursor}).absPos(pos,temp);return t},resetProxy:function(){var self=this,dom=linb.dom,id1=self._id,id2=self._idi;if(dom.byId(id1)){var t,k,o=linb(id2),t=linb(id1);o.html("&nbsp;");o=o.get(0);k=o.style;if(linb.browser.ie){for(var i in k){if(typeof k[i]!="function"){try{k[i]=""}catch(e){}}}}else{o.setAttribute("style","")}linb([document.body]).addFirst(t.setStyle({zIndex:0,cursor:"",display:"none",padding:self._size+"px"}));self.proxyIn=self.proxystyle=null;dom.setCover(false)}},getProxyPos:function(){var self=this,pos=linb(self._id).absPos();pos.left+=self._size;pos.top+=self._size;return pos},_pack:function(mPos,node){var target,pos={},size={},d=this,t;if(d.target_left===null||null===d.target_top){t=node.absPos(null,d.target_parent)}pos.left=null!==d.target_left?d.target_left:t.left;pos.top=null!==d.target_top?d.target_top:t.top;switch(d.type){case"copy":var t;size.width=_.numb(d.target_width,node.cssSize().width);size.height=_.numb(d.target_height,node.cssSize().height);var n=node.clone(d.target_clone).id("",true).setStyle({position:"relative",cursor:d.cursor,margin:0,cssFloat:"none"}).cssSize(size);if(d.opacity){n.opacity(0.5)}if(d.target_style){n.setStyle(d.target_style)}n.dig().id("",true);target=d.setProxy(n,pos);break;case"shape":size.width=null!==d.target_width?d.target_width:node.offsetWidth();size.height=null!==d.target_height?d.target_height:node.offsetHeight();size.width-=2;size.height-=2;target=d.setProxy(linb.dom.create("div").setStyle({border:"dashed 1px",fontSize:"0",lineHeight:"0"}).cssSize(size),pos);break;case"blank":target=d.setProxy(null,pos);break;case"icon":size.width=_.numb(d.target_width,16);size.height=_.numb(d.target_height,16);pos.left=_.numb(d.target_left,mPos.left-linb(window).scrollLeft()+size.width);pos.top=_.numb(d.target_top,mPos.top-linb(window).scrollTop()+size.height);target=d.setProxy(linb.dom.create('<div style="font-size:0;line-height:0;background:url('+d.icon+") no-repeat left "+(d.icon_top?d.icon_top:"top")+'" />').cssSize(size),pos);break;case"move":target=node;if(target.position()!="absolute"){target.position("absolute").absPos(pos)}target.cursor(d.cursor)}return target},_unpack:function(){var d=this,t,f;if(d.move&&("move"!=d.type)){if((t=linb(d._source))){if(!t.isEmpty()){if(t.position()!="absolute"){t.position("absolute")}if(linb.browser.ie){t.setRegion({right:"auto",bottom:"auto"})}t.absPos(this.getProxyPos());if(d.topZindex){t.topZindex(true)}}}}if("move"==d.type){d._source.cursor(d._cursor)}},ignore:function(){this._current=null},unRegister:function(id,key){var o=linb(id),eh=this._eh;o.removeEvent("beforeMouseover",eh).removeEvent("beforeMouseout",eh).removeEvent("beforeMousemove",eh);o.each(function(o){var c=linb.cache.dom[o.id];if(c=c.addition){delete c._dropKeys}o._dropKeys=null})},register:function(id,key){var o=linb(id),eh=this._eh;o.beforeMouseover(function(){var t=linb.dragDrop,self=this;if(t.dragKey&&self._dropKeys[t.dragKey]){t._current=self;t._onDragover=null;linb([self]).onDragenter(true);if(t._current){_.resetRun("showDDMark",t.showDDMark,0,[self],t)}}},eh);o.beforeMouseout(function(){var t=linb.dragDrop,self=this;if(t.dragKey&&self._dropKeys[t.dragKey]){linb([self]).onDragleave(true);t._current=t._onDragover=null;_.resetRun("showDDMark",t.showDDMark,0,[null],t)}},eh).beforeMousemove(function(a,e){var t=linb.dragDrop,h=t._onDragover,self=this;if(h==1){return }if(t._current==self&&t.dragKey&&self._dropKeys[t.dragKey]){if(h){h(e)}else{t._onDragover=1;linb([self]).onDragover(true,linb.event.getEventPara(e))}}},eh);o.each(function(o){var c=linb.cache.dom[o.id];(c.addition||(c.addition={}))["_dropKeys"]=null;(o._dropKeys||(o._dropKeys={}))[key]=true});return this}},After:function(){this._reset();_.each({startDrag:function(e,profile,key,data){linb.dragDrop.drag(e,this.get(0),profile,key||"",data||null);return this},dragable:function(flag,profile,key,data){var self=this,dd=linb.dragDrop;if(typeof flag=="undefined"){flag=true}else{if(typeof flag=="object"){profile=flag;flag=true}}if(flag===true){self.addEvent("onMousedown",function(p,e){if(linb.event.getSrc(e)!=this){return true}linb([this]).startDrag(e,profile,key,data)},dd._eh,-1)}else{self.removeEvent("onMousedown",dd._eh)}return self},dropable:function(flag,key){key=key||"default";var d=linb.dragDrop;return this.each(function(o){if(flag){d.register(o,key)}else{d.unRegister(o,key)}})}},function(o,i){linb.dom.plugIn(i,o)})}});Class("linb.BookMark",null,{Static:{fid:"linb:bookmark",iniBookMark:function(callback){var self=this;self.callback=callback;var hash=location.hash;self.lastHash=hash;if(linb.browser.ie){if(self.lastHash==""){self.lastHash="#"}var n=document.createElement("div");n.style.display="none";document.body.appendChild(n);n.innerHTML='<iframe id="'+this.fid+'" style="display: none;"></iframe>';var ihistory=document.getElementById(this.fid),iframe=ihistory.contentWindow.document;iframe.open();iframe.close();iframe.location.hash=hash}else{if(linb.browser.kde){self.backStack=[];self.backStack.length=history.length;self.forwardStack=[];self.isFirst=true}}self.callback(hash.replace(/^#/,""));setInterval(self.threadCheck,100);return self},threadCheck:function(){var self=linb.BookMark;if(linb.browser.ie){var ihistory=document.getElementById(self.fid),iframe=ihistory.contentWindow.document;hash=iframe.location.hash;if(hash!=self.lastHash){self.lastHash=location.hash=hash;self.callback(hash.replace(/^#/,""))}}else{if(linb.browser.kde){if(!self.dontCheck){var historyDelta=history.length-self.backStack.length;if(historyDelta){self.isFirst=false;if(historyDelta<0){for(var i=0;i<Math.abs(historyDelta);i++){self.forwardStack.unshift(self.backStack.pop())}}else{for(var i=0;i<historyDelta;i++){self.backStack.push(self.forwardStack.shift())}}var cachedHash=self.backStack[self.backStack.length-1];if(cachedHash!=undefined){self.lastHash=location.hash;self.callback(cachedHash)}}else{if(self.backStack[self.backStack.length-1]==undefined&&!self.isFirst){if(document.URL.indexOf("#")>=0){self.callback(document.URL.split("#")[1])}else{var current_hash=location.hash;self.callback("")}self.isFirst=true}}}}else{var hash=location.hash;if(hash!=self.lastHash){self.lastHash=hash;self.callback(hash.replace(/^#/,""))}}}},setBookMark:function(hash,flag){var self=this;if(hash){hash=hash.replace(/^#+/,"")}if(self.lastHash=="#"+hash){return false}if(linb.browser.ie){var ihistory=document.getElementById(self.fid),iframe=ihistory.contentWindow.document;iframe.open();iframe.close();iframe.location.hash=location.hash=self.lastHash="#"+hash}else{if(linb.browser.kde){self.dontCheck=true;self.backStack.push(hash);self.forwardStack.length=0;self.isFirst=true;var t=self;_.asyRun(function(){t.dontCheck=false;t=null},300);location.hash=self.lastHash=hash}else{location.hash=self.lastHash="#"+hash}}if(flag){self.lastHash=location.hash}else{self.callback(hash)}},hookLinkClick:function(fun,target){linb([document]).onClick(function(p,e,src){var s=location.href.split("#")[0],t=linb.event,o=t.getSrc(e),b,i=0,b;do{if(o.tagName=="A"){b=true;break}if(++i>8){break}}while(o=o.parentNode);if(b&&!t.getKey(e)[2]&&t.getBtn(e)=="left"){if(o.href.indexOf(s+"#")!=-1){_.tryF(fun,[o.href.replace(s,"")],target)}return false}},"hookA",0);return this}}});Class("linb.ComFactory",null,{Static:{_pro:{},_cache:{},_domId:"linb:ComFactory:",getProfile:function(key){return key?this._pro[key]:this._pro},setProfile:function(key,value){if(typeof key=="string"){this._pro[key]=value}else{this._pro=key}},clear:function(){_.each(this._cache,function(o){o.destroy()});this._cache={}},setCom:function(id,obj){this._cache[id]=obj;obj.comRefId=id},getComFromCache:function(id){return this._cache[id]},broadcast:function(hash){var i,j,o,p,c=this._cache;for(j in hash){p=hash[j];for(i in c){o=c[i];if(typeof p=="function"){p.call(o,i)}}}},getCom:function(id,threadid,onEnd){var c=this._cache,p=this._pro,ini=p._iniMethod;if(c[id]){_.tryF(onEnd,[threadid],c[id]);return c[id]}else{if(!(p=p[id])){return null}var self=arguments.callee,me=this,children=p.children;var iniMethod=p.iniMethod||ini||"create",clsPath=p.cls,props=p.props,cls,task=function(cls,props,threadid){var o=new cls();if(props){_.merge(o,props,"all")}linb.ComFactory.setCom(id,o);var args=[function(com){var arr=com.getUIObj().get(),fun=function(arr,firstlayer){var self1=arguments.callee;arr.each(function(v,i){if(v.key=="linb.UI.Tag"){var tag=v,cid=tag.properties.tagKey;if(cid&&children&&children[cid]){self.apply(me,[children[cid],threadid,function(){com[cid]=this;this.parent=com;var ui=this.getUIObj(),root;if(!(root=ui.get(0))){return }linb.UI.Tag.replace(tag,root);if(firstlayer&&com._nodes[i]==tag){com._nodes[i]=root}}])}}if(v.children){var a=[];v.children.each(function(o){a[a.length]=o[0]});self1(a)}})};fun(arr,1)}];args.push(threadid||null);if(onEnd){linb.thread(threadid).insert({task:onEnd,args:[threadid],target:o})}linb.thread(threadid).insert({task:function(threadid){this.fireEvent("afterComposed")},args:[threadid],target:o});_.tryF(o[iniMethod],args,o)};linb.thread.asyUI(threadid,[function(threadid){var f=function(a,b,threadid){var cls;if(cls=linb.SC.evalPath(clsPath)){linb.thread(threadid).insert({task:task,args:[cls,props,threadid]})}};linb.SC(clsPath,function(){f(0,0,threadid)},true,{threadid:threadid})}])}},newCom:function(cls,onEnd,threadid){var o;if(o=linb.SC.evalPath(cls)){_.tryF(onEnd,[threadid],new o)}else{linb.thread.asyUI(threadid,[function(threadid){linb.SC(cls,function(){var o=new (linb.SC.evalPath(cls))();_.tryF(onEnd,[threadid],o)},true,{threadid:threadid})}])}},store:function(id){var m,t,c=this._cache,domId=this._domId;if(t=c[id]){if(!(m=linb.dom.byId(domId))){linb(document.body).addFirst(linb.create('<div id="'+domId+'" style="display:none;"></div>'))}m=linb(domId);t.detach();m.addLast(t.reBoxing())}},prepareWidgets:function(){var self=this,fun=function(threadid){var r=false;_.each(linb.UI,function(o){if(o.$linb$&&o["linb.UI"]&&o.$Appearances["default"]&&!o.cssNone){var path=linb.getPath(o.KEY,"/default/css.css","appearance");if(!linb.UI.$cache_csspath[path]){o=(new o).get(0);o.toString();o.destroy();r=true;return false}}});if(!r){linb.thread(threadid).abort()}};linb.thread(null,[fun],100,null,null,null,true).start()},prepareComs:function(arr){var self=this,funs=[];arr.each(function(i){funs.push(function(){self.getCom()})});linb.thread(null,funs,500).start()}}});Class("linb.logger",null,{Static:{err:function(sMsg,sUrl,sLine){if(linb.browser.gek&&sMsg=="Error loading script"){return true}var self=linb.logger;try{self.log("An error raised!"," >> Location: "+sUrl+" ( line "+sLine+" )"," >> Message: "+sMsg);if(self._oe){self._oe(sMsg,sUrl,sLine)}}catch(e){return false}return true},trace:function(o,fun,arr,flag){var fun=fun||arguments.callee.caller,arr=arr||[];if(fun){arr.push('function "'+(fun.$name$||"")+'" in Class "'+(fun.$original$||"")+'"');if(fun.caller){try{arguments.callee(null,fun.caller,arr,1)}catch(e){}}}if(!flag){var a=[];a.push(" >> Error Info:");if(typeof o=="object"){for(var i in o){a.push(" -- "+i+" : "+o[i])}}else{a.push(o)}a.push(" >> Error Path: "+arr.join(" < "));linb.logger.log.apply(linb.logger,a)}},log:function(){var win,doc,div,str,self=this,arr=arguments;if(!(win=self._win)||self._win.closed){win=self._win=window.open("","_blank","width=520,height=300,scrollbars=1,resizable=1,status=0,location=0,menubar=0,toolbar=0");if(!win){return }win.moveTo(0,0);doc=win.document;doc.write("<html><head><title>Debug Log of LINB</title></head><body style='font-size:12px'></body></html>");doc.close()}win.focus();doc=win.document;div=doc.createElement("div");div.style.border="solid 1px #CDCDCD";div.appendChild(doc.createTextNode("At "+new Date));doc.body.appendChild(div);for(var i=0,l=arr.length;i<l;i++){str=arr[i];div=doc.createElement("div");div.appendChild(doc.createTextNode(str));doc.body.appendChild(div)}}},Initialize:function(){if(linb.browser.gek&&window.console){linb.log=function(){if(window.console){console.log.call(console,[_.toArr(arguments),(_()-linb.log.time)+"ms"])}linb.log.time=_()}}linb.message=function(content,caption,type,width,time){width=width||200;var div,h,me=arguments.callee,stack=me.stack||(me.stack=[]),t=linb(window),left=t.scrollLeft()+t.width()/2-width/2,height=t.height(),st=t.scrollTop();if(!(div=stack.pop())){div='<div style="font-size:0;line-height:0;border:solid 1px #cdcdcd;position:absolute;overflow:visible;top:-50px;z-index:'+linb.dom.top_zIndex+'; background:#fefefe"><div style="font-size:14px;overflow:hidden;font-weight:bold;padding:2px;"></div><div style="padding:5px;"></div></div>';div=linb.create(div);if(div.edge){div.edge()}linb(document.body).addLast(div)}div.setStyle({left:left+"px",width:width+"px",visibility:"visible"}).first().html(caption||"").next().html(content||"");if(me.last&&div!=me.last){var l=me.last.left();me.last.fx({left:[l,l+(me.last.width+width)/2+20]}).start()}me.last=div;me.last.width=width;h=div.height();if(linb.browser.ie6){div.cssSize({height:h,width:width+1})}div.fx({top:[st-h-20,st+20]}).start();_.asyRun(function(){div.fx({top:[st+20,height+20]},null,function(){stack.push(div);div.hide()}).start()},time||5000)}}});new function(){Class("linb.Profile","linb.iProfile",{Instance:{setEvents:function(events){_.merge(this,events,"all");return this},getEvents:function(){var self=this,t,hash={};_.each(self.box.$EventHandlers,function(o,i){if(self[i]){hash[i]=self[i]}});return hash},_applySetAction:function(fun,value){return fun.call(this,value)},$gc:function(){this.antiAllLinks().resetCache();_.breakO(this)},resetCache:_.fun(),destroy:_.fun(),boxing:function(){return this},beforeSerialized:function(){var t,self=this,o=(t=self.box.beforeSerialized)?t(self):self,r={alias:o.alias,key:o.key};if(o.host){r.host="$this$"}if(o.$domId!=o.domId){r.domId=o.domId}if(o.appearance&&o.appearance!="default"){r.appearance=o.appearance}if(o.behavior&&o.behavior._id!="default"){r.behavior=o.behavior._id}if(o.template&&o.template._id!="default"){r.template=o.template._id}var c={},p=o.box.$DataStruct,map=linb.Base.$specialChars;_.merge(c,o.properties,function(o,i){return(i in p)&&p[i]!==o&&!map[i.charAt(0)]});if(!_.isEmpty(c)){r.properties=c}if(!_.isEmpty(t=this.getEvents())){r.events=t}var eh=o.box.$EventHandlers;_.filter(r.events,function(o,i){return o!=eh[i]});if(_.isEmpty(r.events)){delete r.events}if(!_.isEmpty(o.CA)){r.CA=_.copy(o.CA)}if(!_.isEmpty(o.CB)){r.CB=_.copy(o.CB)}if(!_.isEmpty(o.CC)){r.CC=_.copy(o.CC)}if(!_.isEmpty(o.CF)){r.CF=_.copy(o.CF)}if(o.children&&o.children.length){r.children=o.children;r.children.sort(function(x,y){x=parseInt(x[0].properties.tabindex);y=parseInt(y[0].properties.tabindex);return x>y?1:x==y?0:-1})}return r},copy:function(){var o=new this.constructor;_.merge(o,this,"all");return o},clone:function(flag){var c=_.unserialize(_.serialize(this));if(!flag){var f=function(c,host){var self=arguments.callee;delete c.alias;if(host){c.host=host}if(c.children){c.children.each(function(a){self(a[0],host)})}};f(c,this.host)}return c}}});Class("linb.Base","linb.iBox",{Constructor:function(alias,properties,events){var self=this,c=self.constructor,profile;if(typeof alias=="object"){events=alias.events;properties=alias.properties;alias=alias.alias}profile=new linb.Profile;_.merge(profile,{properties:properties||{},alias:alias||c.pickAlias(),$id:_.id(),_links:[],box:c,key:c.KEY,object:self},"all");c._namePool[profile.alias]=1;profile.setEvents(events);profile.links(c._cache,"self").links(linb.Base._cache,"base").links(linb._object,"linb");profile.boxing=function(){return self};self._nodes=[profile]},Instance:{ini:function(properties,events,host){var profile=this.get(0);_.merge(profile.properties,properties,"all");profile.setEvents(events||profile.events||{});delete profile.events;profile.host=host;return this},$gc:function(){delete this.box._namePool[this.alias]},alias:function(str){var self=this;if(str){delete self.constructor._namePool[self.get(0).alias];self.get(0).alias=str;self.constructor._namePool[str]}else{return self.get(0).alias}return self},host:function(value,alias){var self=this;if(value){self.get(0).host=value;if(alias){self.alias(alias);value[alias]=self}return self}else{return self.get(0).host}}},After:function(){var self=this,me=arguments.callee,temp,t,k,u,m,i,j,v;self._nameId=0;self._namePool={};self._nameTag=(t=self.KEY.split("."))[t.length-1].toLowerCase();self._cache=[];if(self===linb.Base){return }m=me.a1||(me.a1="$Keys,$DataModel,$DataStruct,$EventHandlers".toArr());for(j=0;v=m[j++];){if(t=self.$parent){k={};for(i=0;u=t[i++];){_.merge(k,u[v])}self[v]=_.clone(k)}else{self[v]={}}}u=self.$Keys;for(i in u){if((t=u[i].split("-")).length){u[i]=self.KEY+"-"+t[t.length-1]}}u.KEY=u.$key=self.KEY;self.setDataModel(self.DataModel);delete self.DataModel;self.setEventHandlers(self.EventHandlers);delete self.EventHandlers;m=me.a5||(me.a5="createdTrigger,renderedTrigger".toArr());for(j=0;v=m[j++];){temp=[];if(t=self.$parent){for(i=0;u=t[i];i++){if(u=u["$"+v]){temp.push.apply(temp,u)}}}if(self[v]){temp.push(self[v])}self["$"+v]=temp;delete self[v]}},Static:{$i:true,$specialChars:{_:1,$:1},$gc:function(){var self=this,k=self.$key;_.breakO([self.$DataModel,self.$DataStruct,self.$EventHandlers,self],2);Class.$gc(k)},getDefaultProp:function(){return _.copy(this.$DataStruct)},setDataModel:function(hash){var self=this,t,o,n,m,r,sc=linb.Base.$specialChars;var ds=self.$DataStruct,properties=self.$DataModel;for(var i in hash){if(!properties[i]){properties[i]={}}if(_.isHash(o=hash[i])){t=properties[i];_.merge(t,o,"all");ds[i]=typeof o.ini!="undefined"?o.ini:typeof ds[i]!="undefined"?ds[i]:undefined}else{if(null===o){r=i.initial();delete ds[i];delete properties[i];delete self.prototype["get"+r];delete self.prototype["set"+r]}else{ds[i]=o;if(typeof o!="function"){properties[i].ini=o}}}}_.each(hash,function(o,i){if(o===null||sc[i.charAt(0)]||typeof o=="function"){return }r=i.initial();if(!(o&&o.readonly)){t=o.set;n="set"+r;m=self.prototype[n];self.prototype[n]=typeof t=="function"?Class._fun(t,n,self.KEY):typeof m=="function"?m:Class._fun(function(value,flag){return this.each(function(v){if(v.properties[i]===value&&!flag){return }var ovalue=v.properties[i],m=_.get(v.box.$DataModel,[i,"action"]);v.properties[i]=value;if(typeof m=="function"&&v._applySetAction(m,value,ovalue)===false){v.properties[i]=ovalue}})},n,self.KEY)}t=o.get;n="get"+r;m=self.prototype[n];self.prototype[n]=typeof t=="function"?Class._fun(t,n,self.KEY):typeof m=="function"?m:Class._fun(function(){return this.get(0).properties[i]},n,self.KEY)});return self},getDataModel:function(key){var o=this.$DataModel;return key?o[key]:o},setEventHandlers:function(o){_.each(o,function(o,i){if(null===o){delete this.$EventHandlers[i];delete this.prototype[i]}else{this.$EventHandlers[i]=o;var f=function(fun){var args=arguments,type=typeof fun;if(args.length==1&&(type=="function"||type=="string")){return this.each(function(v){if(v.domNode){v.resetCache()}v[i]=fun})}else{if(args.length==1&&null===fun){return this.each(function(v){v.resetCache();delete v[i]})}else{var v=this.get(0),t=v[i],k=v.host||v;if(typeof t=="string"){t=k[t]}if(typeof t=="function"){return _.tryF(t,args,k)}}}};f.$event$=1;return this.plugIn(i,f)}},this)},getEventHandlers:function(){return this.$EventHandlers},getByCacheId:function(id){var o;if(o=this._cache[id]){return o.object}},pickAlias:function(){var t,p=this._namePool,a=this._nameTag;while(p[t=(a+(++this._nameId))]){}return t},unserialize:function(str){var o=_.unserialize(str);return new this(o)}}});Class("linb.iDataBinder","linb.Base",{Constructor:function(){this._nodes=[]},Instance:{getDataBinder:function(){var profile=this.get(0);return linb.iDataBinder.getDataBinder(profile.properties.dataBinder)},resetValue:function(hash){this.each(function(profile){profile.boxing().resetValue((hash&&hash[profile.properties.dataField])||profile.value)});return this},checkValid:function(){return linb.UI.iWidget.pack(this._nodes).checkUIValueValid()},getValue:function(){if(this.checkValid()){var hash={};this.each(function(profile){var p=profile.properties,b=profile.boxing(),v;if(profile.domNode){b.updateValue()}v=b.getValue();hash[p.dataField]=v});return hash}else{return null}}},Static:{$i:true,_pool:{},clear:function(){this._pool={}},link:function(name,pro){var o=this._pool[name];if(!o){o=this._pool[name]=new linb.iDataBinder()}if(pro&&!o._nodes.exists(pro)){o._nodes.push(pro)}},unlink:function(name,pro){var o=this._pool[name];if(o){o._nodes.removeValue(pro)}},getDataBinder:function(name){return this._pool[name]},DataModel:{dataBinder:{ini:"",set:function(v){var ds,r;return this.each(function(profile,flag){var p=profile.properties,old=p.dataBinder;if(old==v&&!flag){return }if(old){linb.iDataBinder.unlink(old,profile)}p.dataBinder=v;linb.iDataBinder.link(v,profile)})}},dataField:""},createdTrigger:function(){var self=this,b=self.boxing(),t;if(t=self.dataBinder){b.setDataBinder(t)}if(t=self.dataField){b.setDataField(t)}}}})};new function(){Class("linb.UIProfile","linb.Profile",{Instance:{$gc:function(){var self=this,t;if(!self.serialId){return }self.resetCache();if(self.addition&&(t=self.domNode)){for(var i in self.addition){t[i]=null}}if(!self.$exID){t=linb.cache.domId;(t[self.key]||(t[self.key]=[])).push(self.serialId)}else{delete self.$exID}delete linb.cache.dom[self.domId];delete linb.cache.dom[self.$domId];delete self.box._namePool[self.alias];self.antiAllLinks();_.breakO(self)},_linkParent:function(id,parent){var profile=this;profile.parent=parent;profile.childrenId=id;profile.antiLinks("$parent");profile.links(parent.children,"$parent",[profile,id])},_reg:/^[\w]*$/,setDomId:function(id){var t=this,c=linb.cache.dom,reg=t._reg;if(typeof id!="string"||!reg.test(id)){id=t.$domId}if(t.domId!=t.$domId){delete c[t.domId]}if(t.domNode){t.domNode.id=id}c[t.domId=id]=t;return t},getDomId:function(){return this.domId},destroy:function(){var self=this;if(self.root){self.root.remove()}else{self.$gc()}},resetCache:function(key){_.breakO(this.$cache_egetter,2);_.breakO(this.$cache_domid)},getEV:function(id,name){var self=this,$k=id+"+"+name,g=self.$cache_egetter||(self.$cache_egetter={});if(g[$k]){return g[$k]}var dom=linb.cache.dom,funs=[],t,key;if((t=dom[id])&&(t=t.events)&&(t=t[name])){for(var i=0,l=t.length;i<l;i++){if(typeof t[t[i]]=="function"){funs[funs.length]=t[t[i]]}}}key=id.split(":")[0].split("-")[1];if(typeof (((t=self._CB)&&(key?(t=t[key]):1))&&(t=t[name]))=="function"){funs[funs.length]=t}else{if(typeof (((t=self.CB)&&(key?(t=t[key]):1))&&(t=t[name]))=="function"){funs[funs.length]=t}else{if(typeof (((t=self.behavior)&&(key?(t=t[key]):1))&&(t=t[name]))=="function"){funs[funs.length]=t}}}return g[$k]=funs},toString:function(flag){var self=this,i,o,m,a,c,self,children,h={},id,me=arguments.callee,reg=me.reg||(me.reg=/<!--([^>^\s]*)-->/g);if(!self.string||flag){c=self.box;_.merge(self.properties,c.$DataStruct);self.data={};c.prepareData(self,true);if(c.dynamicTemplate){c.dynamicTemplate(self)}self.string=c.build(self);delete self.data;if(m=self.children){for(i=0;o=m[i++];){if(!o[0]["linb.UIProfile"]){a=new (linb.SC(o[0].key));a.ini.call(a,o[0]);o[0]=a.get(0)}}}}if(m=self.children){for(i=0;o=m[i++];){id=o[1]||"";a=h[id]||(h[id]=[]);a[a.length]=o[0].toString()}}return self.string.replace(reg,function(a,b){return h[b]?h[b].join(""):""})},boxing:function(){var self=this,t;if(!((t=self.object)&&t._nodes[0]==self&&t._nodes.length==1)){t=self.object=self.box.pack([self],false)}return t},_applySetAction:function(fun,value,ovalue){if(this.domNode){return fun.call(this,value,ovalue)}},makeRootId:function(key){return(key||this.key)+":"+this.serialId+":"},getKey:function(id){return id.split(":")[0]},getSubSerialId:function(id){return id.split(":")[2]},getSerialId:function(id){return id.split(":")[1]},getNodeId:function(key,serialId,subSerialId){return key+":"+serialId+":"+subSerialId},pickSubId:function(key){var self=this,r,o=self.cache_subid||(self.cache_subid={});if((o[key]||(o[key]=[]))[0]){return o[key].shift()}o=self.subId||(self.subId={});r=(o[key]||(o[key]=new _.id)).next();return r},cacheSubId:function(id,key){var o=this.cache_subid||(this.cache_subid={});(o[key]||(o[key]=[])).push(id)},getClass:function(key,tag,flag){var self=this;key=self.keys[key]||key;var me=arguments.callee,map=me.map||(me.map={}),reg=me.reg||(me.reg=/\./g),hash=self.appearance+":"+key+":"+tag+":"+flag;if(map[hash]){return map[hash]}if(self.classKey){key=key.replace(self.key,self.classKey)}var str=(((!flag&&self.appearance!="default")?self.appearance+"--":"")+key).replace(reg,"-").toLowerCase();str=str+(tag||"");return map[hash]=str},addTagClass:function(key,tag,nodes,flag){var self=this;key=self.keys[key]||key;if(!nodes){nodes=self.getSubNode(key)}var c=self.box.$clscache||(self.box.$clscache={}),k=key+":"+tag,cls="[^\\s]*"+self.getClass(key,"",true),reg=c[k]||(c[k]=new RegExp(cls+"[-\\w]*"+tag+"[-\\w]*")),r2=c[cls+"*2"]||(c[cls+"*2"]=new RegExp("("+cls+"[-\\w]*)","g")),r3=c[cls+"*3"]||(c[cls+"*3"]=new RegExp("("+cls+")"));nodes.removeClass(reg);if(!flag){nodes.reClass(r2,"$1 $1"+tag)}else{nodes.reClass(r3,"$1 $1"+tag)}return self},removeTagClass:function(key,tag,nodes){var self=this;key=self.keys[key]||key;if(!nodes){nodes=self.getSubNode(key)}var c=self.box.$clscache||(self.box.$clscache={}),k=key+":"+tag,reg=c[k]||(c[k]=new RegExp(self.getClass(key,"",true)+"[-\\w]*"+tag+"[-\\w]*"));nodes.removeClass(reg);return self},getSubNodeId:function(key,itemId){var arr=this.$domId.split(":");arr[0]=key;arr[2]=itemId||"";return arr.join(":")},getSubNode:function(key,itemId,flag){var self=this;key=self.keys[key]||key;var r,t,s,h=self._domNode||(self._domNode={});if(itemId===true){r=linb([self.domNode]).dig("*","id",new RegExp("^"+key+":"+self.serialId))}else{if(flag){delete h[key]}if(!itemId&&h[key]&&h[key]._nodes.length==1){return h[key]}r=(t=linb.dom.byId(s=self.getSubNodeId(key,itemId)))?linb([t]):linb([self.domNode]).dig("*","id",s);if(!itemId&&!flag){h[key]=r}}return r},getSubNodes:function(arr,itemId){var i=0,a=[],o;for(;o=arr[i++];){a.push(this.getSubNode(o,itemId).get(0))}return linb(a)},getSubNodeByItemId:function(key,id){return(id=this.getSubSerialIdByItemId(id))?this.getSubNode(key,id):linb([])},getItemByItemId:function(id){var t;if((t=this.ItemIdMapSubSerialId)&&(t=t[id])){return this.SubSerialIdMapItem[t]}},getItemByDom:function(src){return this.SubSerialIdMapItem&&this.SubSerialIdMapItem[this.getSubSerialId(src.id||src)]},getItemIdByDom:function(src){var t;return(t=this.getItemByDom(src))&&t.id},getSubSerialIdByItemId:function(id){var t;return(t=this.ItemIdMapSubSerialId)&&t[id]},itemsSearch:function(items,fun,deep,single){deep=deep||false;single=single||false;var r=[];var f=arguments.callee.f||(arguments.callee.f=function(items,fun,deep,single,r){var me=arguments.callee;items.each(function(o){if(fun===true||fun.call(null,o)){r.push(o);if(single){return false}}if(deep&&o.sub&&o.sub.length){me(o.sub,fun,deep,single,r)}})});f(items,fun,deep,single,r);return r}}});Class("linb.UI","linb.Base",{Constructor:function(){if(arguments[0]!==false){return this.ini.apply(this,arguments)}},Before:function(key,parent_key,o){linb.iBox.$type[key.replace("linb.UI.","").replace("linb.","")]=linb.iBox.$type[key]=key;return true},After:function(){linb.Base.After.apply(this,arguments);var self=this,me=arguments.callee,temp,t,k,u,b,c,m,i,j,e,w,v;self._ctrlId=new _.id();self._idCache=[];m=me.a2||(me.a2="$Templates,$Behaviors,$Appearances".toArr());for(j=0;v=m[j++];){k={};if(t=self.$parent){for(e=0;b=t[e++];){for(i in b[v]){t=b[v][i];u=k[i]||(k[i]={});for(c in t){w=t[c];u[c]=u[c]||{};_.merge(u[c],w)}}}self[v]=_.clone(k)}else{self[v]={}}}m=me.a3||(me.a3="Templates,Behaviors,Appearances".toArr());w=me.a4||(me.a4="setTemplate,setBehavior,setAppearance".toArr());for(j=0;v=m[j];j++){u=self[v];for(i in u){self[w[j]](i,u[i])}delete self[v]}if(self.PublicAppearance){linb.css.add(self.buildCSSText(self.PublicAppearance,linb.getPath(self.KEY,"/css.css","appearance")));delete self.PublicAppearance}if(self.Dropable&&self.Dropable.length){self.Dropable.each(function(o){self.dropable(o)});delete self.Dropable}if(self.Dragable&&self.Dragable.length){self.Dragable.each(function(o){self.dragable(o)});delete self.Dragable}},Instance:{getSubNode:function(){var p=this.get(0);return p.getSubNode.apply(p,arguments)},toString:function(){return this._nodes.join("")},toDomNodes:function(){var t,arr=[];this._nodes.each(function(o){if(t=o.domNode){arr.push(t)}});return arr},setDomId:function(id){this.get(0).setDomId(id);return this},getDomId:function(){return this.get(0).getDomId()},ini:function(properties,events,host,template,behavior,appearance,children,CA,CB,CC,CF){var self=this,profile,c=self.constructor,t="default";if(properties&&properties["linb.UIProfile"]){self._nodes=[profile=properties]}else{self._nodes=[profile=new linb.UIProfile]}profile.box=c;profile.key=self.$key;profile.$id=_.id();profile.keys=c.$Keys;if(properties&&properties.key&&linb.iBox.$type[properties.key]){_.merge(profile,properties);properties=null}profile.properties=properties||profile.properties||{};profile.host=host||profile.host||null;profile.appearance=appearance||profile.appearance||t;profile.behavior=c.getBehavior(behavior||profile.behavior||t);profile.CA=CA||profile.CA||{};profile.CB=CB||profile.CB||{};profile.CC=CC||profile.CC||{};profile.CF=CF||profile.CF||{};if(c.iniProfile){c.iniProfile.call(profile)}profile.template=c.getTemplate(template||profile.template||t);profile.setEvents(events||profile.events||{});delete profile.events;if(!profile.serialId){profile.serialId=c.pickSerialId()}profile.$domId=profile.makeRootId();profile.domId=profile.domId||profile.$domId;profile.alias=profile.alias||c.pickAlias();c._namePool[profile.alias]=1;profile.createdTrigger=c.$createdTrigger.copy();profile.renderedTrigger=c.$renderedTrigger.copy();profile.addition=profile.behavior?profile.behavior.$eventhandler:null;profile._links={};profile.links(linb.UI._cache,"UI").links(c._cache,"self").links(linb._object,"linb");children=children||profile.children||[];profile.children=[];for(var i=0,v;v=children[i++];){if(!v[0]["linb.UIProfile"]){v[0]=new (linb.SC(v[0].key))(v[0]).get(0)}v[0]._linkParent(v[1],profile)}return self},_set:function(o,flag){var self=arguments.callee,t;o.root=linb([o.domNode=linb.dom.byId(o.domId)]);linb.cache.dom[o.domId]=linb.cache.dom[o.$domId]=o;if(t=o.createdTrigger){for(var i=0,l=t.length;i<l;i++){t[i].call(o)}delete o.createdTrigger}if(flag&&(t=o.renderedTrigger)){for(var i=0,l=t.length;i<l;i++){t[i].call(o)}}if(o.children){for(var i=0,v;v=o.children[i++];){self(v[0],true)}}},create:function(flag){var arr=[],i,o,n=this._nodes,me=arguments.callee,set=this._set;for(i=0;o=n[i++];){if(!o.domNode){arr[arr.length]=o}}if(arr.length){linb.dom.getMatix().html(arr.join(""),false);for(i=0;o=arr[i++];){set(o,flag)}}return this},render:function(){var i,o,n=this._nodes,node,me=arguments.callee,set=this._set,para=me.para||(me.para=function(node){var r=node.getRegion();r.tabindex=node.tabIndex();r.zIndex=node.zIndex();r.position=node.position();return r});for(i=0;o=n[i++];){if(!(node=linb(o.alias)).isEmpty()){_.merge(o.properties,para(node));node.outerHTML(o.toString());window[o.alias]=o.boxing();set(o,true)}}return this},hide:function(){return this.each(function(o){if(o.domNode){o.root.hide();o.properties.exDock=true}})},show:function(l,t){return this.each(function(o){if(o.domNode){o.properties.exDock=false;o.root.show(l,t)}})},display:function(value){return this.each(function(o){if(o.domNode){o.root.display(value?"":"none")}})},destroy:function(){this.each(function(o){if(o.beforeDestroy&&o.boxing().beforeDestroy(o)===false){return }if(o.destroyTrigger){o.destroyTrigger()}if(o.root){o.root.remove()}else{o.$gc()}})},clean:function(){return this},activate:function(){return this},clone:function(flag){var arr=[];this.each(function(o){arr.insertAny(linb.create(o.clone(flag)).get())});return this.constructor.pack(arr,false)},refresh:function(){var para,b,p,s,sid,fun,host,box,children;return this.each(function(o){if(!o.domNode){return }if(b=!!o.parent){p=o.parent.boxing();para=o.childrenId}else{p=o.root.parent()}var replace=linb.create("span");o.root.replace(replace,true);children=o.children.copy();o.children.length=0;children.each(function(o){delete o[0].$dockParent;replace.addLast(o[0].root)});box=o.box;host=o.host;s=o.beforeSerialized();fun=o.$addOns;o.$exID=1;o.boxing().destroy();linb.dom.$gc();s.host=host;_.merge(o,s,"all");o=new box(o).create();if(fun){fun.call(fun.target,o.get(0))}replace.empty(false);replace.replace(o.get(0).root);if(b){p.attach(o,para)}else{p.attach(o)}children.each(function(v){o.attach.apply(o,v)});replace.remove()})},template:function(str){var self=this,o,t;if(typeof str=="string"){self.each(function(o){if(o.domNode){if(!o.template||o.template._id!=_.str(str)){t=o.box.getTemplate(_.str(str));if(!t){return }o.template=t;return self.refresh()}}else{o.template=str}});return self}else{return self.get(0).template}},behavior:function(str){var v,t,m;if(typeof str=="string"){this.each(function(o){if(o.behavior._id!=_.str(str)){if(o.domNode){t=o.behavior;if(v=t.$eventhandler){for(var j in v){o.root.removeEventHandler(j.slice(2))}}for(var i in o.keys){if(t[i]&&(v=t[i].$eventhandler)){for(var j in v){o.getSubNode(i,true).removeEventHandler(j.slice(2))}}}}t=o.box.getBehavior(_.str(str));if(!t){return }o.behavior=t;if(o.domNode){if(v=t.$eventhandler){for(var j in v){o.root.addEventHandler(j.slice(2))}}for(var i in o.keys){if(t[i]&&(v=t[i].$eventhandler)){for(var j in v){o.getSubNode(i,true).addEventHandler(j.slice(2))}}}}}});return this}else{return this.get(0).behavior}},appearance:function(str){var v,t;if(typeof str=="string"){return this.each(function(o){if(o.appearance!=str){t=o.getClass("KEY");o.appearance=str;if(!o.box.cssNone){o.box.setCSSFile(o.box.cssPathKey||o.key,o.appearance)}if(o.domNode){o.root.dig("*","id",new RegExp("^"+o.key+"(-[w]+)?:"+o.serialId)).reClass(new RegExp("([\\w]+\\-\\-)?"+t,"g"),o.getClass("KEY"))}}})}else{return this.get(0).appearance}},attach:function(ui,id){if(id!==false){this.appendChild(ui,id)}var pro=this.get(0);if(pro.domNode){(pro.keys.PANEL?pro.getSubNode(pro.keys.PANEL):pro.root).attach(ui)}return this},appendChild:function(target,id){if(target["linb.UIProfile"]){target=target.boxing()}if(_.isArr(target)){target=linb.UI.pack(target,false)}if(!target["linb.UI"]){target=target.reBoxing("UI")}return this.each(function(v){target.each(function(profile){profile._linkParent(id,v)})})},detach:function(){return this.each(function(profile){profile.antiLinks("$parent");delete profile.parent;delete profile.childrenId})},addPanel:function(para,children,item){var pro=linb.UI.PanelBar.getDefaultProp();_.merge(pro,para,"with");_.merge(pro,{left:0,top:0,dock:"fill",tag:para.tag||para.id},"all");var pb=new linb.UI.PanelBar(pro);this.attach(pb,item&&item.id);children.each(function(o){pb.attach(o[0])})},dragable:function(dragKey,dragData,key){return this.each(function(o){o.getSubNode(o.keys[key]||"KEY",true).beforeMousedown(function(pro,e,src){linb([src]).startDrag(e,{drop2:true,key:dragKey,data:typeof dragData=="function"?dragData():dragData,icon:linb.ini.path+"ondrag.gif",dragMode:"move",cursor:"pointer",move:false,defer:1})},"",-1).beforeDragbegin(function(profile,e,src){linb([src]).onMouseout(true,{$force:true}).onMouseup(true)},"",-1)})},unDragable:function(key){return this.each(function(o){o.getSubNode(o.keys[key]||"KEY",true).beforeMousedown(null,"").beforeDragbegin(null,"");o.resetCache()})},setCustomFunction:function(key,value){return this.each(function(o){if(typeof key=="string"){if(typeof value=="function"){o.CF[key]=value}else{delete o.CF[key]}}else{o.CF=key||{}}})},setCustomClass:function(key,value){var me=arguments.callee;var fun=(me.fun||(me.fun=function(pro,i,h,flag){var node=pro.getSubNode(i,true),b;if(!node.isEmpty()){h[i].split(/\s+/).each(function(o){if(!flag){node.addClass(o)}else{node.removeClass(o)}})}}));return this.each(function(o){var bak=_.copy(o.CC);if(typeof key=="string"){if(o.domNode){if(key in bak){fun(o,key,bak,true)}}if(!value){delete o.CC[key]}else{o.CC[key]=value;if(o.domNode){fun(o,key,bak)}}}else{if(!!key&&typeof key=="object"){if(o.domNode){for(var i in bak){fun(o,i,bak,true)}for(var i in key){fun(o,i,key)}}o.CC=key}else{if(o.domNode){for(var i in bak){fun(o,i,bak,true)}}o.CC={}}}})},setCustomAppearance:function(key,value){var me=arguments.callee;var fun=(me.fun||(me.fun=function(pro,i,h,flag){var node=pro.getSubNode(i,true),b;if(h[i]&&!node.isEmpty()){h[i].split(";").each(function(o,i){if((b=o.split(":")).length==2){b[0]=b[0].replace(/\-(\w)/g,function(a,b){return b.toUpperCase()});try{node.setStyle(b[0],flag?"":b[1])}catch(e){}}})}}));return this.each(function(o){var bak=_.copy(o.CA);if(typeof key=="string"){if(o.domNode){if(key in bak){fun(o,key,bak,true)}}if(!value){delete o.CA[key]}else{o.CA[key]=value;if(o.domNode){fun(o,key,bak)}}}else{if(!!key&&typeof key=="object"){if(o.domNode){for(var i in bak){fun(o,i,bak,true)}for(var i in key){fun(o,i,key)}}o.CA=key}else{if(o.domNode){for(var i in bak){fun(o,i,bak,true)}}o.CA={}}}})},setCustomBehavior:function(key,value){return this.each(function(o){if(typeof key=="string"){if(o.keys[key]){o.CB[key]=value||{}}}else{o.CB=key||{}}o.resetCache()})}},Initialize:function(){linb.css.add(linb.UI.buildCSSText({body:{$order:0,font:["13px arial,helvetica,clean,sans-serif",linb.browser.ie?"x-small":""],"font-size":linb.browser.ie6?"100.01%":linb.browser.ie?"small":"",margin:0,padding:0,cursor:"default"},"div,span,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,form,fieldset,input,button,p,blockquote,th,td":{$order:1,margin:0,padding:0},table:{$order:2,"font-size":"inherit",font:linb.browser.ie?"100%":"","border-collapse":"collapse","border-spacing":0,"empty-cells":"show"},"div,span,fieldset,img,abbr,acronym":{$order:3,border:0},"address,caption,cite,dfn,em,strong,th,var":{$order:4,"font-style":"normal","font-weight":"normal"},"pre, code ":{$order:5,"font-size":linb.browser.ie?"100%":"","font-style":"normal","font-weight":"normal",margin:0,padding:0},"ol,ul ":{$order:6,"list-style":"none"},"caption,th":{$order:7,"text-align":"left"},"h1,h2,h3,h4,h5,h6":{$order:8,"font-size":"100%"},a:{$order:10,"text-decoration":"none",cursor:"pointer","-moz-user-select":linb.browser.gek?"none":""},"a:hover":{$order:11,color:"red"},"a:focus":{$order:11,"-moz-outline-offset":linb.browser.gek?"-1px ! important":""},button:{$order:11,cursor:"pointer","border-width":"1px"},"select, input, textarea":{$order:12,font:"99% arial,helvetica,clean,sans-serif"},strong:{$order:14,"font-weight":"bold"},em:{$order:15,"font-style":"italic"},div:{$order:15,"vertical-align":linb.browser.ie?"auto":null,"font-size":"12px"},span:{$order:16,display:linb.browser.gek?["-moz-inline-block","-moz-inline-box"]:linb.browser.ie6?"inline":"inline-block",zoom:linb.browser.ie6?1:null,"vertical-align":"middle"},"body *":{$order:17,"line-height":"1.22em"},".ui-dirty, .ui-dirty *":{$order:18,color:"#f00"},".ui-invalid, .ui-invalid *":{$order:19,"background-color":"Aqua"},"#linb_lang":{$order:20,"vertical-align":"text-top"}}),"linb.UI");linb.cache.$dropPool={}},Static:{$i:true,$cache_csspath:{},$css_tag_dirty:"ui-dirty",$css_tag_invalid:"ui-invalid",$tag_left:"{",$tag_right:"}",$tag_special:"#",$ID:"#id#",$DOMID:"#domid#",$CLS:"#cls#",subSerialIdTag:"_serialId",$childTag:"<!--{id}-->",hasDomRoot:true,unserialize:function(str,flag){var a=_.unserialize(str),f=function(o){delete o.serialId;o.children.each(f)};a.each(function(o){if(!flag){f(o)}});return linb.create(a)},clean:function(e){if(e&&e._nodes&&e._nodes[0]&&e._nodes[0]["linb.UIProfile"]){return e._nodes}else{var r=this._dom2ui(linb.dom.pack(e)._nodes);r.filter(function(o){return o.box["linb.UI"]});return r}},_dom2ui:function(arr){var i=0,a=[],t,key=this.KEY;arr.each(function(o){if((t=linb.cache.dom[o.id])&&t.key){a[i++]=t}});return a},$gc:function(){var k=this.$key;_.breakO([linb.cache.template[k],linb.cache.domId[k]],2);_.breakO([this._cache,this._idCache,this.$DataModel,this.$Templates,this.$Behaviors,this],2);delete linb.iBox.$type[k.replace("linb.UI.","")];this.$gc=null;Class.$gc(k)},getAll:function(){return this.pack(this._cache)},getByCacheId:function(ids){var arr=[],t,n=this._cache;ids=ids instanceof Array?ids:[ids];ids.each(function(id){if(t=n[id]){arr[arr.length]=t}});return linb.UI.pack(arr,false)},pickSerialId:function(){var arr=linb.cache.domId[this.$key];if(arr&&arr[0]){return arr.pop()}return this._ctrlId.next()},getCSSImgPara:function(path,para,appearance,key){return function(k){var p=linb.getPath(key||k,null,"appearance")+(appearance?appearance:"default")+"/"+path;return"url("+p+") "+(para||"")}},getImgPath2:function(path,para,appearance){return function(key){var s=linb.getPath(key,"/"+(appearance?appearance:"default")+"/"+path,"appearance");return para.replace("{*}",s)}},$doTemplate:function(profile,template,properties,tag,result){var self=arguments.callee,s,t,n,isA=properties.constructor==Array;var temp=template[tag||""],r=!result;var result=result||[];if(isA){if(typeof temp!="function"){temp=self}for(var i=0;t=properties[i++];){temp(profile,template,t,tag,result)}}else{if(typeof temp=="function"){temp(profile,template,properties,tag,result)}else{tag=tag?tag+".":"";var a0=temp[0],a1=temp[1];for(var i=0,l=a0.length;i<l;i++){if(n=a1[i]){if(n in properties){t=properties[n];if(template[s=tag+n]&&t){self(profile,template,t,s,result)}else{result[result.length]=t}}}else{result[result.length]=a0[i]}}}}if(r){return result.join("")}},$buildTemplate:function(profile,template,key,obj,arr){if(template&&String(template.tagName).toLowerCase()=="text"){arr[arr.length]=template.text;return }var self=arguments.callee,t,o,bak,behavior=profile.behavior?key?profile.behavior[key]:profile.behavior:null,map1=self.map1||(self.map1={tagName:1,text:1}),map2=self.map2||(self.map2={image:1,input:1}),r2=self.r2||(self.r2=/[a-z]/),r3=self.r3||(self.r3=/^(on|before|after)/),r7=self.r7||(self.r7=/([^{}]*)\{([\w]+)\}([^{}]*)/g);var lkey,first=false,u=linb.UI;if(!template){template=profile.template}lkey=key?profile.keys[key]:profile.key;if(!template.tagName){template.tagName="span"}if(template.id!==null){template.id=key?lkey+":"+u.$ID+":"+u.$tag_left+u.subSerialIdTag+u.$tag_right:u.$DOMID}else{delete template.id}if(template.className!==null){t=u.$CLS+(key?"-"+key.toLowerCase():"");bak=template.className||"";template["class"]=t+" "+bak+" "+u.$tag_special+(key||"KEY")+"_CC"+u.$tag_special}delete template.className;template.style=(template.style||"")+";"+u.$tag_special+(key||"KEY")+"_CA"+u.$tag_special;var a=[],b={},tagName=template.tagName,text=template.text,sc=linb.Base.$specialChars;for(var i in template){if(!sc[i.charAt(0)]&&!map1[i]){o=template[i];if(!r2.test(i)){if(typeof o=="object"){if(!o.$order){o.$order=0}o.$key=i;a[a.length]=o}}else{b[i]=o}}}a.sort(function(x,y){x=x.$order;y=y.$order;return x>y?1:x==y?0:-1});if(!arr){first=true;arr=[]}arr[arr.length]="<"+tagName+" ";for(var i in b){arr[arr.length]=i+'="'+b[i]+'" '}if(template.className!==null){template.className=bak}delete template["class"];if(behavior&&(t=behavior.$eventhandler)){for(var i in t){if(t[i]){arr[arr.length]=i+'="'+t[i]+'" '}}}arr[arr.length]="{attributes}>";if(!map2[tagName]&&text){arr[arr.length]=text}for(var i=0,l=a.length;i<l;){o=a[i++];self(profile,o,o.$key,obj,arr)}if(!map2[tagName]){arr[arr.length]="</"+tagName+">"}if(first){var a0=obj[0],a1=obj[1];arr.join("").replace(r7,function(a,b,c,d){if(b){a0[a0.length]=b}a1[a0.length]=a0[a0.length]=c;if(d){a0[a0.length]=d}return""})}},_rpt:function(profile,temp){var u=linb.UI,me=arguments.callee,key=this.KEY,tag=u.$tag_special,r1=me.r1||(me.r1=new RegExp(u.$ID,"img")),r2=me.r2||(me.r2=new RegExp(tag+"([A-Z0-9]+)_CA"+tag,"g")),r3=me.r3||(me.r3=new RegExp(tag+"([A-Z0-9]+)_CC"+tag,"g")),r4=me.r4||(me.r4=new RegExp(u.$CLS,"img")),n,t;temp=temp.replace(r1,profile.serialId).replace(r4,profile.getClass("KEY")).replace(u.$DOMID,profile.domId);if(n=profile.CA){temp=temp.replace(r2,function(a,b){return(t=n[b])?t:""})}else{temp=temp.replace(r2,"")}if(n=profile.CC){temp=temp.replace(r3,function(a,b){return(t=n[b])?t:""})}else{temp=temp.replace(r3,"")}return temp},build:function(profile,flag){var template,t,m,u=linb.UI,temp=[[],[]],self=this,key=self.KEY,cache=linb.cache.template,hash=profile._hash="a:"+(profile.template._id||"")+";b:"+(profile.template._did||"")+";c:"+(profile.behavior._id||"")+";d:"+(profile.behavior._did||"")+";!"+(profile._exhash||"");if(!(template=_.get(cache,[key,hash]))){if(!self.cssNone){self.setCSSFile(self.cssPathKey||key,profile.appearance)}u.$buildTemplate(profile,null,null,temp);_.set(cache,[key,hash,""],temp);if(t=profile.template.$dynamic){for(var i in t){if(typeof (m=t[i])!="function"){var temp=[[],[]];for(var j in m){if(typeof m[j]=="object"){u.$buildTemplate(profile,m[j],j,temp)}}m=temp}_.set(cache,[key,hash,i],m)}}template=_.get(cache,[key,hash])}if(!template||flag){return""}return self._rpt(profile,u.$doTemplate(profile,template,profile.data))},subBuild:function(profile,key,arr){return this._rpt(profile,linb.UI.$doTemplate(profile,_.get(linb.cache.template,[this.KEY,profile._hash]),arr,key))},_setDefaultBehavior:function(hash){var f=function(arr,type,mode){var fun=function(profile,e,src){var t,id=src.id,item,cid=profile.getSubSerialId(id),prop=profile.properties,nodes,funs,box;if(prop.disabled){return }item=profile.SubSerialIdMapItem&&profile.SubSerialIdMapItem[cid];if(item&&item.disabled){return }switch(typeof arr){case"string":nodes=profile.getSubNode(arr,cid).get();break;case"function":funs=[arr];break;case"object":nodes=[];funs=[];for(var o,i=0,l=arr.length;i<l;i++){o=arr[i];if(typeof o=="string"){nodes.insertAny(profile.getSubNode(o,cid).get())}else{funs.push(o)}}}if(nodes&&nodes.length){nodes=linb(nodes);box=profile.boxing();if(arguments.callee.mode==1){if(type=="mouseover"&&profile.beforeHoverEffect){if(false==box.beforeHoverEffect(profile,item,src,"mouseover")){return }}if(type=="mousedown"&&profile.beforeClickEffect){if(false==box.beforeClickEffect(profile,item,src,"mousedown")){return }}profile.addTagClass("KEY","-"+type,nodes)}else{if(type=="mouseup"){if(profile.beforeClickEffect&&false==box.beforeClickEffect(profile,item,src,"mouseup")){return }profile.removeTagClass("KEY","-mousedown",nodes)}else{if(profile.beforeHoverEffect&&false==box.beforeHoverEffect(profile,item,src,"mouseout")){return }profile.removeTagClass("KEY","(-mouseover|-mousedown)",nodes)}}nodes.length=0}if(funs&&funs.length){funs.each(function(o){_.tryF(o,[profile],profile)});funs.length=0}};fun.mode=mode;return fun},t;if(hash._hoverEffect){_.each(hash._hoverEffect,function(o,i){t=["","KEY","$key"].exists(i)?hash:(hash[i]||(hash[i]={}));if(!o){t.afterMouseover=t.afterMouseout=null}else{t.afterMouseover=f(o,"mouseover",1);t.afterMouseout=f(o,"mouseout",2)}})}if(hash._clickEffect){_.each(hash._clickEffect,function(o,i){t=["","KEY","$key"].exists(i)?hash:(hash[i]||(hash[i]={}));if(!o){t.afterMousedown=t.afterMouseup=null}else{t.afterMousedown=f(o,"mousedown",1);t.afterMouseup=f(o,"mouseup",2)}})}if(hash._keyHook){_.merge(hash,{afterKeydown:function(profile,e,src){if(profile.onHotKeydown){var key=linb.event.getKey(e);return false!==profile.boxing().onHotKeydown(profile,key[0],!!key[1],!!key[2],!!key[3],e,src)}},afterKeypress:function(profile,e,src){if(profile.onHotKeypress){var key=linb.event.getKey(e);return false!==profile.boxing().onHotKeypress(profile,key[0],!!key[1],!!key[2],!!key[3],e,src)}},afterKeyup:function(profile,e,src){if(profile.onHotKeyup){var key=linb.event.getKey(e);return false!==profile.boxing().onHotKeyup(profile,key[0],!!key[1],!!key[2],!!key[3],e,src)}}},"all")}if(hash._focusHook){_.each(hash._focusHook,function(o,i){var map=arguments.callee,k,m1=map.m1||(map.m1={KEY:1,$key:1});if(m1[i]){return }var m2=map.m2||(map.m2={input:1,textarea:1}),m3=map.m3||(map.m3={tab:1,enter:1,up:1,down:1,left:1,right:1}),m4=map.m4||(map.m4={tab:1,up:1,down:1,left:1,right:1}),t=hash[i]||(hash[i]={});if(null===o){t.afterKeydown=null}else{t.afterKeydown=function(profile,e,src){var k=linb.event.getKey(e),key=k[0],shift=k[2],b=false;if(m2[k=src.tagName.toLowerCase()]){if(m3[key]){var reg=linb.UI.getCaretPos(src),txt=src.value;switch(key){case"up":if(!/[\n\r]/.test(txt.substr(0,reg[0]))){b=true}break;case"left":if(reg[0]===0&&(reg[1]!==txt.length||reg[1]===0)){b=true}break;case"down":if(!/[\n\r]/.test(txt.substr(reg[1],txt.length))){b=true}break;case"right":if(reg[1]===txt.length&&(reg[0]!==0||reg[1]===0)){b=true}break;default:if(k=="input"){b=true}}}}else{if(m4[key]){b=true}}if(b){if(profile.beforeNextFocus&&false===profile.boxing().beforeNextFocus(profile,key,!!shift,e)){return false}if(key!="tab"){linb(src).nextFocus(("up"==key||"left"==key)?false:true)}}}}})}},mapKeys:function(v){var self=this;v.each(function(i){self.$Keys[i]=self.KEY+"-"+i})},setAppearance:function(i,o){var t;if(t=this.$Appearances[i]){_.merge(t,o,"all")}else{this.$Appearances[i]=o}return this},getAppearance:function(key){if(typeof key=="string"){return this.$Appearances[key]}else{return this.$Appearances}},setTemplate:function(key,hash,did){var self=this,me=arguments.callee,t;var build=me.build||(me.build=function(template){var o,s=arguments.callee,r2=s.r2||(s.r2=/[a-z]/);for(var i in template){if(!linb.Base.$specialChars[i.charAt(0)]){if(!r2.test(i)){this.$Keys[i]=this.$key+"-"+i;o=template[i];if(typeof o=="object"){s.call(this,o)}}}}});build.call(self,hash);t=self.$Templates;t[key]=_.hash(t[key]);hash._id=key;if(typeof did=="string"){hash._did=did;t[key][did]=hash}else{t[key]["$"]=hash}if(t=hash.$dynamic){for(var i in t){for(var j in t[i]){me.call(self,key,t[i],j)}}}return this},getTemplate:function(key,did){var self=this;if(typeof key=="string"){var r=self.$Templates[key];if(!r){linb.request(linb.getPath(self.KEY,"/"+key+".js","template"),"",function(str){self.setTemplate(key,_.unserialize(str),did)},null,null,{asy:false});r=this.$Templates[key]}return r?typeof did=="string"?r[did]:r.$:null}else{return self.$Templates}},setBehavior:function(key,hash,did){this._setDefaultBehavior(hash);var check=linb.Base.$specialChars,handler=linb.event.eventhandler,m,n,i,j,o,v,type,t=this.$Behaviors;var eventType=linb.event._getEventType,me=arguments.callee,r2=me.r2||(me.r2=/[a-z]/);t[key]=t[key]||{};if(typeof did=="string"){t[key][did]=t[key][did]||{};n=t[key][did];n._did=did}else{t[key].$=t[key].$||{};n=t[key].$}n._id=key;if(hash.KEY){_.merge(hash,hash.KEY,"all");delete hash.KEY}for(i in hash){o=hash[i];if(!check[i.charAt(0)]){if(!r2.test(i)){m=n[i]=_.hash(t[i]);for(j in o){v=o[j];if(!check[j.charAt(0)]){type=eventType(j);if(v){m[j]=v;(m.$eventhandler||(m.$eventhandler={}))["on"+type]=handler}else{delete m[j];if(n.$eventhandler){delete n.$eventhandler["on"+type]}}}}}else{type=eventType(i);if(o){n[i]=o;(n.$eventhandler||(n.$eventhandler={}))["on"+type]=handler}else{delete n[i];if(n.$eventhandler){delete n.$eventhandler["on"+type]}}}}}return this},getBehavior:function(key,did){var self=this;if(typeof key=="string"){var r=self.$Behaviors[key];if(!r&&key!="default"){linb.request(linb.getPath(self.KEY,"/"+key+".js","behavior"),"",function(str){self.setBehavior(key,_.unserialize(str),did)},null,null,{asy:false});r=self.$Behaviors[key]}return r?typeof did=="string"?r[did]:r.$:null}else{return self.$Behaviors}},cancelLink:function(e){if(!linb.event.getKey(e)[2]){return false}},getCaretPos:function(input){input.focus();if(linb.browser.ie){if(input.tagName=="INPUT"){var i,r=document.selection.createRange().duplicate(),dr=input.createTextRange();r.move("character",0);dr.move("character",0);try{dr.setEndPoint("EndToEnd",r);i=String(dr.text).replace(/\r/g,"").length}catch(e){i=0}return[i,i]}else{var c="\x01",sel=document.selection.createRange(),txt=sel.text,l=txt.length,dul=sel.duplicate();try{dul.moveToElementText(input)}catch(e){}sel.text=txt+c;len=(dul.text.indexOf(c));sel.moveStart("character",-1);sel.text="";if(len==-1){len=input.value.length}return[len,len]}}else{return[input.selectionStart,input.selectionEnd]}},setCSSFile:function(key,appearance,flag){var self=this,path=linb.getPath(self.KEY,"/"+appearance+"/css.css","appearance"),t;if(!linb.UI.$cache_csspath[path]){if(t=self.$Appearances[appearance]){linb.css.add(self.buildCSSText(t,appearance=="default"?"":appearance),path)}else{if(!flag){linb.css.include(path)}}linb.UI.$cache_csspath[path]=true}return self},buildCSSText:function(hash,appearance){var self=this,t,v,o,reg,replace,ks;var debug=linb.debug,enter=debug?"\n":"",me=arguments.callee,r1=me.r1||(me.r1=/(^|\s|,)([0-9A-Z_]+)/g),r2=me.r2||(me.r2=/\./g),h=[],r=[],browser=linb.browser,ie6=browser.ie6,ie=browser.ie,gek=browser.gek;if(!self.$cssKeys){o=self.$cssKeys={};t=self.$Keys;for(var i in t){o[i]=t[i].replace(r2,"-")}}ks=self.$cssKeys;if(appearance){t=ks.KEY.toLowerCase();reg=new RegExp("([\\w]+\\-\\-)?"+t,"g");replace=appearance+"--"+t}for(var i in hash){o=hash[i];t=i.replace(r1,function(a,b,c){return b+"."+(ks[c]||c)}).toLowerCase();if(appearance){t=t.replace(reg,replace)}o.$order=parseInt(o.$order)||0;o.$=t;h[h.length]=o}h.sort(function(x,y){x=x.$order;y=y.$order;return x>y?1:x==y?0:-1});for(var i=0,l=h.length;i<l;){o=h[i++];r[r.length]=o.$+"{"+enter;if(t=o.$before){r[r.length]=enter+t+enter}if(t=o.$text){r[r.length]=enter+t+enter}for(var j in o){switch(j.charAt(0)){case"$":continue;break;case"_":if(!ie6){continue}break;case"*":if(!ie){continue}break;case"-":if(!gek){continue}break}if((v=o[j])||o[j]===0){if(debug){j="    "+j}switch(typeof v){case"string":case"number":r[r.length]=j+":"+v+";"+enter;break;case"function":r[r.length]=j+":"+v(self.KEY)+";"+enter;break;default:v.each(function(k){if(k){r[r.length]=j+":"+k+";"+enter}})}}}if(v=o.$after){r[r.length]=enter+v+enter}r[r.length]="}"+enter}return r.join("")},pickObj:function(o){return _.clone(o,function(i){return i.charAt(0)!="_"})},dropable:function(key,getDropKeys){var self=this,h2=linb.event.eventhandler2;if(!getDropKeys){getDropKeys=self.getDropKeys}(linb.cache.$dropPool[self.KEY]=linb.cache.$dropPool[self.KEY]||[]).push(key);self.$dropKey=self.$Keys[key];var behaviors={beforeMouseover:function(profile,e,src){var self=this,dd=linb.dragDrop,key=dd.dragKey,data=dd.data,item,box,t,args;if(!key||!data||!(new RegExp("\\b"+key+"\\b")).test(getDropKeys(profile,self))){return }box=profile.boxing();if(box.getItemByDom){item=box.getItemByDom(src)}args=[profile,e,self,key,data,item];if(profile.onDropTest&&(false===box.onDropTest.apply(box,args))){return }if((t=profile.$onDropTest)&&(false===t.apply(profile,args))){return }dd._current=src;if(profile.onDropMarkShow&&(false===box.onDropMarkShow.apply(box,args))){}else{if((t=profile.$onDropMarkShow)&&(false===t.apply(profile,args))){}else{_.resetRun("showDDMark",dd.showDDMark,0,[self],dd)}}if(t=profile.$onDragEnter){t.apply(profile,args)}if(profile.onDragEnter){box.onDragEnter.apply(box,args)}return false},beforeMouseout:function(profile,e,src){var self=this,dd=linb.dragDrop,key=dd.dragKey,data=dd.data,item,box,args;if(dd._current==src){box=profile.boxing();args=[profile,e,self,key,data,item];if(box.getItemByDom){item=box.getItemByDom(src)}if(profile.onDropMarkClear&&(false===box.onDropMarkClear.apply(box,args))){}else{if((t=profile.$onDropMarkClear)&&(false===t.apply(profile,args))){}else{_.resetRun("showDDMark",dd.showDDMark,0,[null],linb.dragDrop)}}if(t=profile.$onDragLeave){t.apply(profile,args)}if(profile.onDragLeave){box.onDragLeave.apply(box,args)}dd._current=null}return false},beforeDrop:function(profile,e,src){var self=this,dd=linb.dragDrop,key=dd.dragKey,data=dd.data,item,box=profile.boxing(),args;if(box.getItemByDom){item=box.getItemByDom(src)}args=[profile,e,self,key,data,item];if(profile.onDropMarkClear&&(false===box.onDropMarkClear.apply(box,args))){}else{if((t=profile.$onDropMarkClear)&&(false===t.apply(profile,args))){}}if(t=profile.$onDrop){t.apply(profile,args)}if(profile.onDrop){box.onDrop.apply(box,args)}}};_.each(self.$Behaviors,function(o,i){var v;if(key=="KEY"){v=o.$}else{if(!o.$[key]){o.$[key]={}}v=o.$[key]}_.merge(v,behaviors,"all");if(!v.$eventhandler){v.$eventhandler={}}_.merge(v.$eventhandler,{onmouseover:h2,onmouseout:h2,ondrop:h2})});if(!self.prototype.empty){self.prototype.empty=function(){return this.each(function(o){o.getSubNode(key).empty()})}}self.setEventHandlers({onDragEnter:function(profile,e,node,key,data,item){},onDragLeave:function(profile,e,node,key,data,item){},onDrop:function(profile,e,node,key,data,item){},onDropTest:function(profile,e,node,key,data,item){},onDropMarkShow:function(profile,e,node,key,data,item){},onDropMarkClear:function(profile,e,node,key,data,item){}});if(!self.$DataModel.dropKeys){self.setDataModel({dropKeys:""})}return self},dragable:function(key,getDragKey,getDragData){var self=this,h2=linb.event.eventhandler2;if(!getDragKey){getDragKey=self.getDragKey}if(!getDragData){getDragData=self.getDragData}_.each(self.$Behaviors,function(o,i){var v;if(key=="KEY"){v=o.$}else{if(!o.$[key]){o.$[key]={}}v=o.$[key]}_.merge(v,{beforeMousedown:function(profile,e,src){if(!profile.properties.dragKey){return }var pos=linb.event.getPos(e);linb([src]).startDrag(e,{drop2:true,icon:linb.ini.path+"ondrag.gif",dragMode:"move",target_left:pos.left+12,target_top:pos.top+12,cursor:"pointer",defer:1,move:false,key:getDragKey(profile,this),data:getDragData(profile,this)})},beforeDragbegin:function(profile,e,src){linb(src).onMouseout(true,{$force:true}).onMouseup(true)}},"all");if(!v.$eventhandler){v.$eventhandler={}}_.merge(v.$eventhandler,{onmousedown:h2,ondragbegin:h2})});return self},copyItem:function(item,hash){if(!hash){hash={}}var i,o,w=linb.wrapRes;for(i in item){if(i.charAt(0)=="$"){continue}if(!(i in hash)){hash[i]=(typeof (o=item[i])=="string"&&o.charAt(0)=="$")?w(o.slice(1)):o}}hash.iconDisplay=item.icon?"":"display:none";return hash},setCacheList:function(listKey,list){_.set(linb.cache,["list","List",listKey],list);return this},getCacheListType:function(listKey){return typeof _.get(linb.cache,["list","List",listKey])},getCacheList:function(listKey){var r=_.get(linb.cache,["list","List",listKey]);if(typeof r=="function"){r=r()}return _.clone(r)}}})};new function(){var u="linb.UI.";Class(u+"iWidget",["linb.UI","linb.iDataBinder"],{Instance:{getValue:function(){return this.get(0).properties.value},getUIValue:function(){return this.get(0).properties.$UIvalue},getCtrlValue:function(){return this.get(0).properties.$UIvalue},setUIValue:function(value){this.get(0).properties.$UIvalue=value;return this},setCtrlValue:function(value){return this},setDirtyMark:function(){return this},resetValue:function(value){var self=this;self.setCtrlValue(value||"");self.each(function(profile){profile.properties.$UIvalue=profile.properties.value=value||"";profile.inValid=1});self.setDirtyMark();return self},updateUIValue:function(value,force){var self=this;this.each(function(profile){var prop=profile.properties,r,ovalue=prop.$UIvalue,box=profile.boxing();if(ovalue!==value||force){if(false===profile.box.checkValid(profile,value)||(profile.beforeValueUpdated&&false===(r=box.beforeValueUpdated(profile,ovalue,value)))){return }if(typeof r!="undefined"){value=r}if(profile.domNode){box.setCtrlValue(value)}prop.$UIvalue=value;if(profile.domNode){box.setDirtyMark()}if(profile.afterValueUpdated){box.afterValueUpdated(profile,ovalue,value)}}});return this},updateValue:function(){this.each(function(profile){var prop=profile.properties;prop.value=prop.$UIvalue});return this.setDirtyMark()},isDirtied:function(){var p=this.get(0).properties;return p.value!==p.$UIvalue},checkUIValueValid:function(){var r=true;this.each(function(profile){var prop=profile.properties;r=profile.box.checkValid(profile,prop.$UIvalue)&&r;if(profile.domNode){profile.boxing().setDirtyMark()}});return r},disabled:function(value){return this.each(function(o){o.root.opacity(value?0.5:1)})}},Static:{$i:true,DataModel:{$UIvalue:"",tag:"",tagVar:{ini:{}},dragKey:"",value:{ini:null,set:function(value,flag){this.each(function(profile){var p=profile.properties,r,ovalue=p.value,box=profile.boxing();if(ovalue!==value||flag){if(profile.box.checkValid(profile,value)===false){return }if(profile.beforeValueSet&&false===(r=box.beforeValueSet(profile,ovalue,value))){return }if(typeof r!="undefined"){value=r}if(profile.domNode){box.setCtrlValue(value)}p.value=p.$UIvalue=value;profile.inValid=1;if(profile.domNode){box.setDirtyMark()}if(profile.afterValueSet){box.afterValueSet(profile,ovalue,value)}}});return this}},disabled:{ini:false,action:function(v){this.boxing().disabled(v)}},dock:{ini:"none",listbox:["none","top","bottom","left","right","center","middle","origin","width","height","fill","cover"],action:function(v){var self=this;if(self.domNode){self.box.dock(self,true)}}},exDock:{ini:false,action:function(v){var self=this;if(!v&&self.domNode&&self.properties.dock!="none"){self.box.dock(self,true,true)}}},dockOrder:{ini:1,action:function(v){var self=this;if(self.domNode&&self.properties.dock!="none"){self.box.dock(self,true,true)}}},dockMargin:{ini:{left:0,top:0,right:0,bottom:0},action:function(v){var self=this;if(self.domNode&&self.properties.dock!="none"){self.box.dock(self,true,true)}}},dockFloat:{ini:false,action:function(v){var self=this;if(self.domNode&&self.properties.dock!="none"){self.box.dock(self,true,true)}}},dockMinW:0,dockMinH:0,tips:""},Behaviors:{"default":{}},EventHandlers:{beforeValueSet:function(profile,oldValue,newValue,showValue){},afterValueSet:function(profile,oldValue,newValue,showValue){},beforeValueUpdated:function(profile,oldValue,newValue,showValue){},afterValueUpdated:function(profile,oldValue,newValue,showValue){},beforeHoverEffect:function(profile,item,src,type){},beforeClickEffect:function(profile,item,src,type){},beforeNextFocus:function(profile,e,shift,src){},afterCreated:function(profile){},afterRendered:function(profile){},beforeDestroy:function(profile){},onHotKeydown:function(profile,key,control,shift,alt,e,src){},onHotKeypress:function(profile,key,control,shift,alt,e,src){},onHotKeyup:function(profile,key,control,shift,alt,e,src){}},createdTrigger:function(){var self=this,b=self.boxing(),p=self.properties;p.$UIvalue=p.value;if(typeof p.value!="undefined"){b.setCtrlValue(p.value)}if(p.disabled){b.disabled(true)}self.inValid=1;self.created=true;if(self.afterCreated){b.afterCreated(self)}},renderedTrigger:function(){var me=arguments.callee,self=this,b=self.boxing(),p=self.properties,s=self.box;if(s.resize){var wc=me.wc||(me.wc={top:1,bottom:1,width:1,fill:1,cover:1}),hc=me.hc||(me.hc={left:1,right:1,height:1,fill:1,cover:1});wc=wc[p.dock]?null:p.width;hc=hc[p.dock]?null:p.height;if(wc!==null||hc!==null){s.resize(self,wc,hc)}}if(p.dock&&p.dock!="none"){s.dock(this,true)}if(self.afterRendered){b.afterRendered(self)}},dock:function(profile,flag,force){var prop=profile.properties,margin=prop.dockMargin,node=profile.root,value=prop.dock||"none",p=node.parent(),auto="auto",pid=p.id(),order=function(x,y){x=parseInt(x.properties.dockOrder)||0;y=parseInt(y.properties.dockOrder)||0;return x>y?1:x==y?0:-1},win=false,region,inMatix="$inMatix",f,t,_adjust=function(v){return linb.browser.ie6?v-v%2:v};if(linb.dom.isMatix(pid)){return }if(profile.$dockParent!=pid||profile.$dockType!=value||force){profile.$dockParent=pid;profile.$dockType=value;profile.antiLinks("$dock");profile.antiLinks("$dock1");profile.antiLinks("$dock2");switch(value){case"middle":region={right:auto,bottom:auto,left:prop.left||"",width:prop.width||"",height:prop.height||""};break;case"center":region={right:auto,bottom:auto,top:prop.top||"",width:prop.width||"",height:prop.height||""};break;case"origin":region={right:auto,bottom:auto,width:prop.width||"",height:prop.height||""};break;case"top":region={left:margin.left,right:margin.right,bottom:auto,height:prop.height||""};break;case"bottom":region={left:margin.left,right:margin.right,top:auto,height:prop.height||""};break;case"left":region={right:auto,width:prop.width||""};break;case"right":region={left:auto,width:prop.width||""};break;case"width":region={bottom:auto,height:prop.height||"",top:prop.top||""};break;case"height":region={right:auto,width:prop.width||"",left:prop.left||""};break;case"fill":case"cover":region={right:auto,bottom:auto};break;case"none":region={left:prop.left,top:prop.top,width:prop.width||"",height:prop.height||""};break}node.setRegion(region,true);if(p.get(0)===document.body){p=linb([window]);win=true;if(win&&!linb.cache._resizeTime){linb.cache._resizeTime=1}}if(value!="none"){f=p.getEvent("onRewh","dock");if(!f){f=function(p,arg){var me=arguments.callee,map=me.map||(me.map={middle:1,center:1}),arr=me.arr,rePos=me.rePos,node=me.node,style=node.get(0).style,win=me.win,obj,i,k,o,key,target;if(arg.$dockid||!win||(_()-linb.cache._resizeTime>100)){obj={left:0,top:0,right:0,bottom:0,width:parseInt(style&&style.width)||node.width(),height:parseInt(style&&style.height)||node.height()};for(k=0;key=arr[k++];){target=me[key];if(target.length){if(!map[key]){arg.width=arg.height=1}for(i=0;o=target[i++];){if(!o.properties.exDock){rePos(o,obj,key,arg.$dockid,win||arg.width,win||arg.height)}}}}if(obj.later){_.each(obj.later,function(o){try{o.node.setRegion(o,true,true)}catch(e){_.asyRun(function(){o.width+=1;o.height+=1;o.node.setRegion(o,true,true)})}})}if(win){linb.cache._resizeTime=_()}}};f.node=p;f.arr=["top","bottom","left","right","center","middle","width","height"];f.arr.each(function(key){f[key]=[]});f.win=win;f.rePos=function(profile,obj,value,id,w,h){var flag=false;if(id&&profile.$id!=id){flag=true}var prop=profile.properties,flt=prop.dockFloat,margin=prop.dockMargin,node=profile.root,style=profile.domNode.style,left,top,right,bottom,temp,other,x=parseInt(prop._dockBorderWidth)||0,y=parseInt(prop._dockBorderHeight)||0,region={};switch(value){case"middle":node.top((obj.height-node.height())/2);break;case"center":node.left((obj.width-node.width())/2);break;case"top":if(!flag){left=margin.left;right=margin.right;top=(flt?0:obj.top)+margin.top;if(parseFloat(style.top)!=top){region.top=top}temp=obj.width-left-right-x;if(parseFloat(style.width)!=temp){region.width=_adjust(temp)}if(!_.isEmpty(region)){node.setRegion(region,true)}}if(!flt){obj.top+=(node.offsetHeight()+margin.top+margin.bottom)}break;case"bottom":if(!flag){left=margin.left;right=margin.right;bottom=(flt?0:obj.bottom)+margin.bottom;if(parseFloat(style.bottom)!=bottom){region.bottom=bottom}temp=obj.width-left-right-x;if(parseFloat(style.width)!=temp){region.width=_adjust(temp)}if(!_.isEmpty(region)){node.setRegion(region,true)}}if(!flt){obj.bottom+=(node.offsetHeight()+margin.top+margin.bottom)}break;case"left":if(!flag){left=(flt?0:obj.left)+margin.left;top=(flt?0:obj.top)+margin.top;bottom=(flt?0:obj.bottom)+margin.bottom;if(parseFloat(style.left)!=left){region.left=left}if(parseFloat(style.top)!=top){region.top=top}temp=obj.height-top-bottom-y;if(parseFloat(style.height)!=temp){region.height=_adjust(temp)}if(!_.isEmpty(region)){node.setRegion(region,true)}}if(!flt){obj.left+=(node.offsetWidth()+margin.left+margin.right)}break;case"right":if(!flag){right=(flt?0:obj.right)+margin.right;top=(flt?0:obj.top)+margin.top;bottom=(flt?0:obj.bottom)+margin.bottom;if(parseFloat(style.right)!=right){region.right=right}if(parseFloat(style.top)!=top){region.top=top}temp=obj.height-top-bottom-y;if(parseFloat(style.height)!=temp){region.height=_adjust(temp)}if(!_.isEmpty(region)){node.setRegion(region,true)}}if(!flt){obj.right+=(node.offsetWidth()+margin.left+margin.right)}break;case"width":if(!w){return }left=(prop.dock=="cover"?0:(flt?0:obj.left))+margin.left;right=(prop.dock=="cover"?0:(flt?0:obj.right))+margin.right;top=prop.dock=="width"?(parseInt(prop.top)||0):((prop.dock=="cover"?0:(flt?0:obj.top))+margin.top);temp=obj.width-left-right-x;obj.later=obj.later||{};obj.later[profile.$id]=obj.later[profile.$id]||{};_.merge(obj.later[profile.$id],{node:node,width:_adjust(prop.dockMinW?Math.max(prop.dockMinW,temp):temp),left:left,top:top},"all");break;case"height":if(!h){return }top=(prop.dock=="cover"?0:(flt?0:obj.top))+margin.top;bottom=(prop.dock=="cover"?0:(flt?0:obj.bottom))+margin.bottom;left=prop.dock=="height"?(parseInt(prop.left)||0):((prop.dock=="cover"?0:(flt?0:obj.left))+margin.left);temp=obj.height-top-bottom-y;obj.later=obj.later||{};obj.later[profile.$id]=obj.later[profile.$id]||{};_.merge(obj.later[profile.$id],{node:node,height:_adjust(prop.dockMinH?Math.max(prop.dockMinH,temp):temp),left:left,top:top},"all");break}};p.onRewh(f,"dock")}if(value=="fill"||value=="cover"){profile.links(f.height,"$dock1");profile.links(f.width,"$dock2");f.height.sort(order);f.width.sort(order)}else{if(value=="origin"){profile.links(f.center,"$dock1");profile.links(f.middle,"$dock2")}else{profile.links(f[value],"$dock");f[value].sort(order)}}linb.cache._resizeTime=1;profile.$dock=f}}if(value!="none"&&flag){profile.$dock(profile,{width:1,height:1,$dockid:["width","height","fill","cover"].exists(value)?profile.$id:null,$type:value})}},checkValid:function(profile,value){return true},beforeSerialized:function(profile){var r=profile.boxing(),b,o=profile.copy(),p=o.properties=_.copy(profile.properties);switch(p.dock){case"top":case"bottom":delete p.width;delete p.left;delete p.top;delete p.right;delete p.bottom;break;case"left":case"right":delete p.height;delete p.left;delete p.top;delete p.right;delete p.bottom;break;case"width":delete p.width;break;case"height":delete p.height;break;case"fill":case"cover":delete p.width;delete p.height;break}if(p.items&&p.items.length){t=linb.Base.$specialChars;p.items=_.clone(p.items,function(i){return !t[i.charAt(0)]})}if(p.listKey&&!p.$first){p.items.length=0}return o},getDropKeys:function(profile,node){return profile.properties.dropKeys},getDragKey:function(profile,node){return profile.properties.dragKey},getDragData:function(profile,node){return{profile:profile,domId:node.id}},prepareData:function(profile,flag){var prop=profile.properties,data=profile.data,dm=this.getDataModel(),me=arguments.callee,map=me.map||(me.map="left,top,bottom,right,width,height".toArr()),a=[""],t;if(prop.id){delete prop.id}if("caption" in dm&&prop.caption!==null){prop.caption=prop.caption==undefined?profile.alias:prop.caption}if("$border" in dm){data.bWidth=prop.width-(t=(prop.$border||0)*2);data.bHeight=prop.height-t}for(var j=0,i;i=map[j];j++){if(prop[i]||prop[i]===0){if(String(parseFloat(prop[i]))==String(prop[i])){a[a.length]=i+":"+(parseInt(prop[i])||0)+"px"}else{if(prop[i]!="auto"&&prop[i]){a[a.length]=i+":"+prop[i]}}}}if(prop.position){a[a.length]="position:"+prop.position}if(prop.visibility){a[a.length]="visibility:"+prop.visibility}if(prop.zIndex){a[a.length]="z-index:"+prop.zIndex}if(prop.display){a[a.length]="display:"+(prop.display=="inline-block"?linb.browser.gek?"-moz-inline-block;display:-moz-inline-box":"inline-block":prop.display)}a[a.length]="";data._style=a.join(";");if("href" in dm){data.href=prop.href||"javascript:;"}if("tabindex" in dm){data.tabindex=prop.tabindex||"-1"}if("items" in dm){profile.ItemIdMapSubSerialId={};profile.SubSerialIdMapItem={};if((t=prop.items)&&t.constructor==Array&&t.length===0){t=prop.items=[]}if(!t||t.constructor!=Array){t=prop.items=linb.UI.getCacheList(prop.listKey||(this.$recursive?"test1":"test2"))}if(!t||t.constructor!=Array){t=prop.items=[]}data.items=this.prepareItems(profile,t)}data=linb.UI.copyItem(prop,data);profile.prepared=true;return data},prepareItems:function(profile,items,pid){var result=[],item,dataItem,SubID=linb.UI.subSerialIdTag,id,tabindex=profile.properties.tabindex;for(var i=0,l=items.length;i<l;i++){item=items[i];dataItem={id:item.id,_tabindex:tabindex};if(pid){dataItem._parent=pid}id=profile.pickSubId("items");dataItem[SubID]=profile.ItemIdMapSubSerialId[item.id]=id;profile.SubSerialIdMapItem[id]=item;linb.UI.copyItem(item,dataItem);if(this.prepareItem){this.prepareItem(profile,dataItem,item,pid)}result.push(dataItem)}return result}},Initialize:function(){var self=this,hash={};"left,top,width,height,right,bottom".toArr().each(function(o){hash[o]={ini:"auto",action:function(value){var self=this,p=self.properties,b=false,args={$type:p.dock};if(self.domNode){switch(p.dock){case"top":if(o!="height"&&o!="top"){return }args.width=args.height=1;break;case"bottom":if(o!="height"&&o!="bottom"){return }args.width=args.height=1;break;case"left":if(o!="width"&&o!="left"){return }args.width=args.height=1;break;case"right":if(o!="width"&&o!="right"){return }args.width=args.height=1;break;case"width":if("width"==o){return }args.width=1;break;case"height":if("height"==o){return }args.height=1;break;case"fill":case"cover":if(o=="width"&&o=="height"){return }args.width=args.height=1;break}self.root[o](value);if(p.dock!="none"){_.tryF(self.$dock,[self,args],self)}}}}});_.merge(hash,{zIndex:{ini:1,action:function(value){if(this.domNode){this.root.zIndex(value)}}},tabindex:{ini:1},position:{ini:"absolute",listbox:["relative","absolute"],action:function(value){if(this.domNode){this.root.position(value)}}},visibility:{ini:"",combobox:["","visible","hidden"],action:function(value){if(this.domNode){this.root.visibility(value)}}},display:{ini:"",combobox:["","none","block","inline","inline-block"],action:function(value){if(this.domNode){if(value=="inline-block"){this.root.inlineBlock(true)}else{this.root.display(value)}}}}});self.setDataModel(hash);"left,top,width,height,right,bottom,zIndex,position,visibility".toArr().each(function(key){var n="refresh"+key.initial();self.prototype[n]=Class._fun(function(){var self=this;self.each(function(profile){var t=(profile.domNode)?profile.root[key]():profile.properties[key];self["set"+key.initial()](t)});return self["get"+key.initial()]()},n,self.KEY)})}});Class(u+"Widget",u+"iWidget",{Static:{$i:true,cssNone:false,Templates:{"default":{className:"linb-uishell ",style:"{_style}",FRAME:{className:"linb-uiframe ",BORDER:{style:"width:{bWidth}px;height:{bHeight}px;",className:"linb-uiborder "}}}},PublicAppearance:{".linb-uishell":{display:linb.browser.gek?["-moz-inline-block","-moz-inline-box"]:"inline-block",overflow:"hidden",border:0,padding:0,margin:0},".linb-uiframe":{$order:1,display:"block",position:"relative",overflow:"hidden",border:0,padding:0,margin:0,width:"100%",height:"100%","-moz-box-flex":"1"},".linb-uiborder":{$order:2,display:"block",position:"absolute",border:0,padding:0,margin:0,left:0,top:0,width:"100%",height:"100%"}},Behaviors:{"default":{_keyHook:true,onRewh:function(profile,e,src){var style=profile.domNode.style,w=null,h=null;if(e.width){w=parseInt(style.width)||0}if(e.height){h=parseInt(style.height)||0}profile.box.resize(profile,w,h)}}},DataModel:{caption:{action:function(value){this.getSubNode("CAPTION").html(value)}},icon:{ini:"",action:function(value){this.getSubNode("ICON").display(value?"":"none").setStyle("backgroundImage","url("+(value||"")+")")}},iconPos:{ini:"",action:function(value){this.getSubNode("ICON").setStyle("backgroundPosition",value)}},$paddingTop:0,$paddingLeft:0,$paddingBottom:0,$paddingRight:0,$border:0},createdTrigger:function(){var self=this,p=self.properties,o=self.boxing();_.asyRun(function(){if((!self.$noB)&&p.border&&o._border){o._border(p.border)}if((!self.$noR)&&p.resizable&&o.setResizable){o.setResizable(p.resizable,true)}if((!self.$noS)&&p.shadow&&o._shadow){o._shadow(p.shadow)}})},resize:function(profile,w,h){var o=profile.getSubNode("BORDER"),t=profile.properties,left=null,top=null,width=null,height=null;if(null!==w){w-=(t.$border*2+t.$paddingLeft+t.$paddingRight);if(linb.browser.ie6){w=(parseInt(w/2))*2}left=t.$paddingLeft;width=w}if(null!==h){h-=(t.$border*2+t.$paddingTop+t.$paddingBottom);if(linb.browser.ie6){h=(parseInt(h/2))*2}top=t.$paddingTop;height=h;if(linb.browser.ie6&&null===w){o.ieTrigger()}}o.setRegion({left:left,top:top,width:width,height:height});return{width:width,height:height}}}});Class(u+"iList","linb.UI",{Instance:{activate:function(){var profile=this.get(0),items=profile.getSubNode("ITEM",true);if(!items.isEmpty()){items.focus()}return this},insertItems:function(arr,base,before){if(!arr||!arr.length){return }var self=this.constructor,node,items,index,r,data,box,b=this.afterInsertItems;return this.each(function(profile){box=profile.box;items=profile.properties.items;index=items.subIndexOf("id",base);if(index==-1){items.insertAny(arr)}else{items.insertAny(arr,before?index:index+1)}data=box.prepareItems(profile,arr,base);if(profile.domNode){var ss=self.subBuild(profile,"items",data);if(index==-1){node=profile.getSubNode(box.ITEMSKEY||profile.keys.ITEMS||profile.keys.KEY);if(typeof before=="boolean"){r=ss.toDom();if(before||items.length==1){node.addFirst(r)}else{node.addLast(r)}}else{node.html(ss)}}else{r=ss.toDom();node=profile.getSubNodeByItemId(box.ITEMKEY||"ITEM",base);if(before===true){node.addPre(r)}else{node.addNext(r)}}}if(b){profile.boxing().afterInsertItems(profile,data,base,before)}})},removeItems:function(arr){if(!(arr instanceof Array)){arr=[arr]}var obj,v,b=this.beforeRemoveItems;remove=function(profile,arr,target,ns,force){var self=arguments.callee;if(!ns){ns=linb([])}arr.filter(function(o){var serialId,b;if(force||(b=target.exists(o.id))){if(serialId=profile.ItemIdMapSubSerialId[o.id]){delete profile.SubSerialIdMapItem[serialId];delete profile.ItemIdMapSubSerialId[o.id];profile.cacheSubId(serialId,"items");if(!force){if(!(obj=profile.getSubNode("ITEM",serialId)).isEmpty()){ns.add(obj)}}}}if(o.sub){self(profile,o.sub,target,ns,force||b)}if(b){for(var i in o){o[i]=null}return false}},null,true);ns.remove()};if(b){profile.boxing().beforeRemoveItems(profile,arr)}return this.each(function(profile){remove(profile,profile.properties.items,arr);if(v=profile.properties.value){if((v=v.split(";")).length>1){v.filter(function(o){return !arr.exists(o)});profile.properties.value=v.join(";")}else{if(arr.exists(profile.properties.value)){profile.properties.value=null}}}})},clearItems:function(key){return this.each(function(profile){if(!profile.SubSerialIdMapItem){return }profile.getSubNode(profile.keys[key]||profile.keys.ITEMS||"KEY",true).empty();_.each(profile.SubSerialIdMapItem,function(o,serialId){profile.cacheSubId(serialId,"items")});if(profile.properties.items){profile.properties.items.length=0}profile.SubSerialIdMapItem={};profile.ItemIdMapSubSerialId={};profile.properties.value=null})}},Initialize:function(){var a1={id:"a",caption:"itema",tips:"item a"},a2={id:"b",caption:"itemb",tips:"item b"},a3={id:"c",caption:"itemc",tips:"item c"},a0={id:"a",caption:"itema",tips:"item a",sub:[{id:"aa",caption:"suba"},{id:"ab",caption:"subb"}]};this.setCacheList("test1",[a0,a2,a3]).setCacheList("test2",[a1,a2,a3]);"getItemByItemId,getItemByDom,getIdBySubId,getSubSerialIdByItemId".toArr().each(function(s){this[s]=function(){var t=this.get(0);return t[s].apply(t,arguments)}},this.prototype)},Static:{$i:true,cssNone:true,DataModel:{listKey:{ini:"",set:function(v,flag){return this.each(function(o){if(o.properties.listKey!=v||flag){var t=linb.UI.getCacheList(v);if(t){o.boxing().setItems(t)}else{o.boxing().setItems(o.properties.items)}o.properties.listKey=v}})}},items:{ini:{},set:function(v){return this.each(function(o){if(o.domNode){o.boxing().clearItems().insertItems(v)}o.properties.items=v})}}},showTips:function(profile,node,pos){var t=profile.properties,id=node.id,sid=profile.getSubSerialId(id),map=profile.SubSerialIdMapItem,item=map&&map[sid];if(t.disabled){return }if(item&&item.disabled){return }if(item&&item.tips){linb.UI.Tips.show(pos,item);return true}else{return false}}}});"iContainer,iForm,iMisc,iNavigator,iSchedule".toArr().each(function(i){Class(u+i,null,{Static:{$i:true}})});Class(u+"Link",u+"iWidget",{Static:{cssNone:true,Templates:{"default":{tagName:"a",style:"text-decoration:underline;{_style}",href:"{href}",tabindex:"{tabindex}",text:"{caption}"}},Behaviors:{"default":{onClick:function(profile,e,src){if(!profile.properties.disabled&&profile.onClick){return profile.boxing().onClick(profile,e,src)}}}},DataModel:{dataBinder:null,dataField:null,caption:{action:function(v){this.root.text(v)}},href:{ini:"javascript:;",action:function(v){if(this.domNode){this.root.href(v)}}}},EventHandlers:{onClick:function(profile,e){}}}});Class(u+"Div",u+"iWidget",{Static:{cssNone:true,Templates:{"default":{tagName:"div",style:(linb.browser.gek?"overflow:auto;outline:none;":";")+(linb.browser.ie6?"zoom:1;":";")+"{_style}",tabindex:"-1",text:"{html}"+linb.UI.$childTag}},DataModel:{dataBinder:null,dataField:null,value:null,disabled:null,width:"100",height:"100",html:{ini:"",action:function(v){this.domNode.innerHTML=v}}},prepareData:function(profile){arguments.callee.upper.call(this,profile)},EventHandlers:{beforeValueSet:null,afterValueSet:null,beforeValueUpdated:null,afterValueUpdated:null,beforeHoverEffect:null,beforeNextFocus:null,beforeClickEffect:null}}});Class(u+"Tag",u+"Div",{Static:{Templates:{"default":{tagName:"div",style:"overflow:auto;border:dashed blue 1px;text-align:center;background:#FAF0E6;{_style}",text:"{tagKey}"+linb.UI.$childTag}},DataModel:{html:null,tagKey:{ini:"",action:function(v){this.root.html(v)}}},_l:"left,top,bottom,right,width,height,zIndex,tabindex,position,dock,dockFloat,dockMinW,dockMinH,dockOrder,dockMargin".toArr(),replace:function(tagProfile,profile){this._l.each(function(s){if(s in tagProfile.properties){profile.properties[s]=tagProfile.properties[s]}});_.merge(profile.CA,tagProfile.CA,"all");_.merge(profile.CC,tagProfile.CC,"all");if(tagProfile.parent){var clink=tagProfile.parent.children,linkObj=clink[tagProfile.$id],index=clink.indexOf(linkObj);tagProfile.parent.boxing().attach(profile,linkObj[1]);clink[index]=clink.pop();tagProfile.antiLinks("$parent");delete tagProfile.parent}}}});Class(u+"Panel",[u+"Div",u+"iContainer"],{Static:{Dropable:["KEY"]}})};Class("linb.UI.Block",["linb.UI.Widget","linb.UI.iContainer"],{Initialize:function(){var self=this,d="default",t=self.getTemplate(d);_.merge(t.FRAME.BORDER,{PANEL:{tagName:"div",text:"{html}"+linb.UI.$childTag}},"all");self.setTemplate(d,t);t=self.getAppearance(d)||{};_.merge(t,{PANEL:{position:"absolute",left:0,top:0,overflow:"auto","background-color":"#fff"}});self.setAppearance(d,t)},Static:{Dropable:["PANEL"],DataModel:{dataBinder:null,dataField:null,value:null,disabled:null,caption:null,icon:null,iconPos:null,tips:null,html:{ini:"",action:function(v){this.getSubNode("PANEL").html(v)}},width:100,height:100},EventHandlers:{beforeValueSet:null,afterValueSet:null,beforeValueUpdated:null,afterValueUpdated:null,beforeHoverEffect:null,beforeClickEffect:null,beforeNextFocus:null},resize:function(profile,w,h){var size=arguments.callee.upper.apply(this,arguments);profile.getSubNode("PANEL").cssSize(size,true)}}});Class("linb.UI.Edge","linb.UI.iWidget",{Instance:{_attachTo:function(target,parent,tieId){var self=this,v=self.get(0);parent.attach(self);v.$edgeId=linb(target).id();if(v.properties.borderActive){var t=v.behavior.TAG,s=linb(tieId),k="afterMouse",m;if(s){s.addObserver(m=k+"over","tag",-1,t[m],[v]).addObserver(m=k+"out","tag",-1,t[m],[v]).addObserver(m=k+"down","tag",-1,t[m],[v]).addObserver(m=k+"up","tag",-1,t[m],[v])}}return target}},Initialize:function(){_.each({edge:function(properties,target,tieId){return new linb.UI.Edge(properties)._attachTo(target||this,this,tieId)},isEdged:function(){var s=this.id(),b=false;linb.UI.Edge._cache.each(function(o){if(o.$edgeId==s){b=true;return false}});return b},getEdge:function(){var s=this.id(),b=null;linb.UI.Edge._cache.each(function(o){if(o.$edgeId==s){b=o;return false}});return b&&b.boxing()},unEdge:function(){var s=this.id();linb.UI.Edge._cache.each(function(o){if(o.$edgeId==s){o.boxing().destroy()}});return this}},function(o,i){linb.dom.plugIn(i,o)});_.each({_border:function(key,args){return this.each(function(o){var target=o.getSubNode("BORDER");if(target.isEdged()){return }var v=o.boxing(),d=o.properties,n=v.reBoxing(),w=n.width(),h=n.height(),bs=d._borderSize;d.$paddingLeft+=bs;d.$paddingTop+=bs;d.$paddingBottom+=bs;d.$paddingRight+=bs;args=args||{};_.merge(args,{offset:bs/2,enlarge:bs/2},"without");o.$border=target.edge(args,target,o.makeRootId());if(d.$fix){v.setWidth(w+bs).setHeight(h+bs)}else{o.box.resize(o,w,h)}o.resetCache();if(target.isShadow&&target.isShadow()){var o=target.getShadow();o.setOffset(o.getOffset()+bs/2+1)}})},_unBorder:function(){return this.each(function(o){var target=o.getSubNode("BORDER");if(!target.isEdged()){return }var v=o.boxing(),d=o.properties,n=v.reBoxing(),w=n.width(),h=n.height(),bs=d._borderSize;d.$paddingLeft-=bs;d.$paddingTop-=bs;d.$paddingBottom-=bs;d.$paddingRight-=bs;target.unEdged();o.box.resize(o,w,h);if(target.isShadow()){var o=target.getShadow();o.setOffset(o.getOffset()-bs/2-1)}delete o.$border})}},function(o,i){linb.UI.Widget.plugIn(i,o)});linb.UI.Widget.setDataModel({border:{ini:false,action:function(v){var b=this.boxing();if(v){b._border(v)}else{b._unBorder()}}},_borderSize:4})},Static:{Templates:{"default":{tagName:"div",TAG:{},T:{style:"width:100%;left:0;top:-{edge}px;height:{hSize}px;"},RT:{style:"top:-{edge}px;right:-{edge}px;width:{hSize}px;height:{hSize}px;"},R:{style:"height:100%;top:0;right:-{edge}px;width:{hSize}px;"},RB:{style:"right:-{edge}px;bottom:-{edge}px;width:{hSize}px;height:{hSize}px;"},B:{style:"width:100%;left:0;bottom:-{edge}px;height:{hSize}px;"},LB:{style:"left:-{edge}px;bottom:-{edge}px;width:{hSize}px;height:{hSize}px;"},L:{style:"height:100%;top:0;left:-{edge}px;width:{hSize}px;"},LT:{style:"top:-{edge}px;left:-{edge}px;width:{hSize}px;height:{hSize}px;"}}},Appearances:{"default":{KEY:{position:"static",display:"inline","_font-size":0,"_line-height":0,visibility:"hidden","z-index":"50"},TAG:{"_font-size":0,"_line-height":0},"T, RT, R, RB, B, LB, L, LT":{$order:1,position:"absolute",display:"block",border:0,"z-index":30,visibility:"visible","_font-size":0,"_line-height":0},"RT, RB, LB, LT":{"z-index":40},T:{background:linb.UI.getCSSImgPara("v.gif"," repeat-x left top")},B:{background:linb.UI.getCSSImgPara("v.gif"," repeat-x left bottom")},"KEY-mouseover T, KEY-mouseover B":{$order:1,"background-image":linb.UI.getCSSImgPara("v_mouseover.gif")},"KEY-checked T, KEY-checked B, KEY-mousedown T, KEY-mousedown B":{$order:2,"background-image":linb.UI.getCSSImgPara("v_mousedown.gif")},L:{background:linb.UI.getCSSImgPara("h.gif"," repeat-y left top")},R:{background:linb.UI.getCSSImgPara("h.gif"," repeat-y right top")},"KEY-mouseover L, KEY-mouseover R":{$order:1,"background-image":linb.UI.getCSSImgPara("h_mouseover.gif")},"KEY-checked L, KEY-checked R, KEY-mousedown L, KEY-mousedown R":{$order:2,"background-image":linb.UI.getCSSImgPara("h_mousedown.gif")},LT:{background:linb.UI.getCSSImgPara("corner.gif"," no-repeat left top")},RT:{background:linb.UI.getCSSImgPara("corner.gif"," no-repeat right top")},RB:{background:linb.UI.getCSSImgPara("corner.gif"," no-repeat right bottom")},LB:{background:linb.UI.getCSSImgPara("corner.gif"," no-repeat left bottom")},"KEY-mouseover LT, KEY-mouseover RT, KEY-mouseover RB, KEY-mouseover LB":{$order:1,"background-image":linb.UI.getCSSImgPara("corner_mouseover.gif")},"KEY-checked LT, KEY-checked RT, KEY-checked RB, KEY-checked LB, KEY-mousedown LT, KEY-mousedown RT, KEY-mousedown RB, KEY-mousedown LB":{$order:2,"background-image":linb.UI.getCSSImgPara("corner_mousedown.gif")}}},Behaviors:{"default":{_hoverEffect:{TAG:"KEY"},_clickEffect:{TAG:"KEY"}}},DataModel:{offset:2,enlarge:2,borderActive:false},prepareData:function(profile){var t=profile.properties,s=parseInt(t.offset);t.hSize=s*2;t.edge=s+parseInt(t.enlarge);arguments.callee.upper.call(this,profile)}}});Class("linb.UI.Shadow","linb.UI.iWidget",{Instance:{getTarget:function(){return this.get(0)._target},attachTo:function(o){o=o.reBoxing();var self=this;self.get(0)._target=o.get(0);o.attach(self);return o}},Initialize:function(){_.each({shadow:function(properties){var o=this.get(0);return new linb.UI.Shadow(properties).attachTo(linb([o],false))},isShadow:function(){var s=this.get(0),b=false;linb.UI.Shadow._cache.each(function(o){if(o._target==s){b=true;return false}});return b},getShadow:function(){var s=this.get(0),b=null;linb.UI.Shadow._cache.each(function(o){if(o._target==s){b=o;return false}});return b.boxing()},unShadow:function(){var s=this.get();linb.UI.Shadow._cache.each(function(o){if(s.exists(linb(o._target).get(0))){o.boxing().destroy()}});return this}},function(o,i){linb.dom.plugIn(i,o)});_.each({_shadow:function(key){return this.each(function(o){var target=o.getSubNode("BORDER");if(target.isShadow()){return }var v=o.boxing(),d=o.properties,n=v.reBoxing(),w=n.width(),h=n.height();o.$shadow=target.shadow({size:d._shadowSize,offset:d.$paddingBottom||d.$border});d.$paddingBottom+=d._shadowSize;d.$paddingRight+=d._shadowSize;if(d.$fix){v.setWidth(w+d._shadowSize).setHeight(h+d._shadowSize)}else{o.box.resize(o,w,h)}})},_unShadow:function(){return this.each(function(o){var target=o.getSubNode("BORDER");if(!target.isShadow()){return }target.unShadow();var v=o.boxing(),d=o.properties,n=v.reBoxing(),w=n.width(),h=n.height();d.$paddingBottom-=d._shadowSize;d.$paddingRight-=d._shadowSize;o.box.resize(o,w,h);delete o.$shadow})}},function(o,i){linb.UI.Widget.plugIn(i,o)});linb.UI.Widget.setDataModel({shadow:{ini:false,action:function(v){var b=this.boxing();if(v){b._shadow(v)}else{b._unShadow()}}},_shadowSize:8})},Static:{Templates:{"default":{tagName:"div",R:{tagName:"div",style:"top:{offset}px;width:{size}px;right:-{pos}px;"},RB:{tagName:"div",style:"height:{size}px;width:{size}px;right:-{rbpos}px;bottom:-{rbpos}px;"},B:{tagName:"div",style:"left:{offset}px;height:{size}px;bottom:-{pos}px;"}}},Appearances:{"default":{KEY:{width:0,height:0,_display:"inline"},"B, RB, R":{position:"absolute",display:"block","*font-size":0,"*line-height":0},B:{left:0,width:"100%",background:linb.browser.ie6?"":linb.UI.getCSSImgPara("B.png","repeat-x left bottom"),_filter:linb.UI.getImgPath2("B.png",'progid:DXImageTransform.Microsoft.AlphaImageLoader(src="{*}",sizingMethod="crop")')},RB:{background:linb.browser.ie6?"":linb.UI.getCSSImgPara("RB.png","left top"),_filter:linb.UI.getImgPath2("RB.png",'progid:DXImageTransform.Microsoft.AlphaImageLoader(src="{*}",sizingMethod="crop")')},R:{top:0,height:"100%",background:linb.browser.ie6?"":linb.UI.getCSSImgPara("R.png","repeat-y right top"),_filter:linb.UI.getImgPath2("R.png",'progid:DXImageTransform.Microsoft.AlphaImageLoader(src="{*}",sizingMethod="crop")')}}},DataModel:{size:{ini:8,action:function(value){var self=this,offset=self.properties.offset;self.getSubNode("R").width(value).top(offset).right(-value-offset);self.getSubNode("RB").width(value).height(value).right(-value-offset).bottom(-value-offset);self.getSubNode("B").height(value).left(offset).bottom(-value-offset)}},offset:{ini:0,action:function(value){this.boxing().setSize(this.properties.size,true)}}},prepareData:function(profile){arguments.callee.upper.call(this,profile);var t=profile.data;t.pos=(parseInt(t.size)||0)+(parseInt(t.offset)||0);t.rbpos=t.pos-1},renderedTrigger:function(){if(linb.browser.ie){this.root.ieTrigger()}},hide:function(profile,value){linb([profile.domNode]).children().display(value?"none":"block")}}});Class("linb.UI.Resizer","linb.UI.iWidget",{Instance:{getRegion:function(){var profile=this.get(0),target=profile._target,l,t,b,r,ll,tt,ww,hh,c=[];if(target){target._nodes.sort(function(x,y){x=parseInt(x.style.zIndex)||0;y=parseInt(y.style.zIndex)||0;return x>y?1:x==y?0:-1});target.each(function(o,i){var o=linb([o]);if(i===0){l=o.offsetLeft();t=o.offsetTop();r=l+(ww=o.offsetWidth());b=t+(hh=o.offsetHeight());c.push([{left:l,top:t},{width:ww,height:hh},o.id()])}else{l=Math.min(l,ll=o.offsetLeft());t=Math.min(t,tt=o.offsetTop());r=Math.max(r,ll+(ww=o.offsetWidth()));b=Math.max(b,tt+(hh=o.offsetHeight()));c.push([{left:ll,top:tt},{width:ww,height:hh},o.id()])}})}profile.regionBlocks=c;c.each(function(o){o[0].left-=l;o[0].top-=t;o[1].width-=2;o[1].height-=2});return{l:l,t:t,b:b,r:r}},rePosSize:function(){var self=this;self.each(function(o){var t,t1=o.root,t2=o._target;if(!t2||t2.isEmpty()){return }if(!o.properties.child){t=o.region=o.boxing().getRegion();t1.cssPos({left:t.l,top:t.t}).offsetWidth(t.r-t.l).offsetHeight(t.b-t.t)}if(!o.regPool){o.regPool=linb([])}if(t=o.regions){o.regPool.add(t);t.display("none")}o.regions=linb([]);if(o.regionBlocks){var t,fun=function(p,e){var b=o.boxing(),t=b.getTarget(),key=linb.event.currentKey;if(o.onRegionClick&&false!==b.onRegionClick(o,e)){if(t.length()>1){if(key&&key[2]){t.minus(linb(this.tid));b.resetTarget(t)}else{b.focus(this.tid)}}}};o.regionBlocks.each(function(v){if(o.regPool.length()){t=o.regPool.pop();linb(t).cssPos(v[0]).cssSize(v[1])}else{t='<div style="position:absolute;border:dashed 1px blue;left:{l}px;top:{t}px;width:{w}px;height:{h}px;"></div>'.replace("{l}",v[0].left).replace("{t}",v[0].top).replace("{w}",v[1].width).replace("{h}",v[1].height).toDom();t.onClick(fun);t=t.get(0)}o.regions.push(t);t.tid=v[2]});o.root.addLast(o.regions.display("block"))}});self.focus();return self},getTarget:function(){return this.get(0)._target},resetTarget:function(target,flag){var self=this,profile=self.get(0),rb=self.reBoxing(),ids;if(profile.properties.child){return }delete profile.$focus;if(target&&!target.isEmpty()){profile._target=target;self.rePosSize();rb.zIndex(linb.dom.top_zIndex).display("block")}else{profile._target=linb([]);rb.zIndex(0).display("none")}if(target&&!target.isEmpty()){ids=[];target.reBoxing("UI").each(function(o,i){ids.push(o.$id)})}else{ids=null}if(flag!==false){profile.boxing().onItemsSelected(profile,ids,profile.$id)}return self},attachTo:function(target,parent){var self=this,v=self.get(0);v._target=linb(target);v._parent=parent||linb(document.body);v._parent.attach(self);self.resetTarget(v._target);v.$resizeId=linb(target).id();return self},focus:function(id){var profile=this.get(0),index=-1;if(!profile.regions){return }profile.regions.border("dashed 1px blue");var arr=profile._target.get();if(id){index=arr.subIndexOf("id",id)}if(index==-1&&profile.$focus!=undefined){index=profile.$focus}if(index==-1&&arr.length>1){index=arr.length-1}if(index!=-1){profile.regions.border("dashed 1px blue");linb([profile.regions.get(index)]).border("solid 1px red");profile.$focus=index;if(profile.onFocusChange){profile.boxing().onFocusChange(profile,index)}}return this},getFocus:function(){return this.get(0).$focus},active:function(flag){return this.each(function(profile){profile.getSubNode("MOVE").setStyle("backgroundPosition","-17px top");profile.getSubNodes(["LT","T","RT","R","RB","B","LB","L"]).background(linb.browser.ie?"url("+linb.ini.path+"bg.gif)":"transparent");if(flag!==false){profile.boxing().onActive(profile)}})},inActive:function(){return this.each(function(profile){if(profile.$onDrag){return }profile.getSubNode("MOVE").setStyle("backgroundPosition","-17px -17px");profile.getSubNodes(["LT","T","RT","R","RB","B","LB","L"]).background("#808080")})},show:function(){this.each(function(o){o.root.display(o.$display||"block")});if(linb.browser.ie){this.reBoxing().ieTrigger()}return this},hide:function(){this.each(function(o){o.$display=o.root.display()});this.reBoxing().display("none");return this}},Initialize:function(){this.mapKeys(["HANDLER","HIDDEN"]);_.each({resizable:function(properties,target,onUpdate){properties=_.hash(properties);var o=this.get(0),r=new linb.UI.Resizer(properties).attachTo(target,linb([o]));if(onUpdate){r.onUpdate(onUpdate)}return r},unResizable:function(){var s=this.id();linb.UI.Resizer._cache.each(function(o){if(o.$resizeId==s){o.boxing().destroy()}});return this},isResizable:function(){var s=this.id(),b=false;linb.UI.Resizer._cache.each(function(o){if(o.$resizeId==s){b=true;return false}});return b},getResizer:function(){var s=this.id(),b=null;linb.UI.Resizer._cache.each(function(o){if(o.$resizeId==s){b=o;return false}});return b.boxing()}},function(o,i){linb.dom.plugIn(i,o)});_.each({_resize:function(key,args){return this.each(function(o){var target=o.getSubNode("BORDER"),d=o.properties;if(target.isResizable()){return }args=args||{};_.merge(args,{child:true,cover:true,parent:target},"without");var update=function(pro,target,size,cssPos){var profile=arguments.callee.profile,node=profile.root,prop=profile.properties,t;if(size){var w=null,h=null;if(t=size.width){node.widthBy(t);prop.width=w=node.width()}if(t=size.height){node.heightBy(t);prop.height=h=node.height()}profile.box.resize(profile,w,h)}if(cssPos){if(t=cssPos.left){node.leftBy(t);prop.left=node.left()}if(t=cssPos.top){node.topBy(t);prop.top=node.top()}}};update.profile=o;o.$resizer=target.resizable(args,target,update)})},_unResize:function(){return this.each(function(o){var target=o.getSubNode("BORDER");if(!target.isResizable()){return }target.unResizable();delete o.$resizer})}},function(o,i){linb.UI.Widget.plugIn(i,o)});linb.UI.Widget.setDataModel({resizable:{ini:false,action:function(v){var b=this.boxing();if(v){var t=this.properties,arg={};_.merge(arg,t,"all",["minHeight","minWidth","maxHeight","maxWidth"]);b._resize(v,arg)}else{b._unResize()}}}})},Static:{Templates:{"default":{tagName:"div",style:"{_style}"}},Appearances:{"default":{KEY:{position:"absolute",margin:"0 -1px -1px 0",visibility:"visible","_font-size":0,"_line-height":0,"*background":"url("+linb.ini.path+"bg.gif)","z-index":60,cursor:"move"},MOVE:{position:"absolute",display:"block","z-index":100,visibility:"visible",background:linb.UI.getCSSImgPara("icon.gif"," no-repeat -17px top",null,"linb.UI.Public"),"_font-size":0,"_line-height":0},HANDLER:{$order:0,position:"absolute",display:"block",border:"solid 1px","z-index":100,visibility:"visible","_font-size":0,"_line-height":0},T:{$order:1,left:"50%",cursor:"n-resize"},RT:{$order:1,cursor:"ne-resize","z-index":110},R:{$order:1,top:"50%",cursor:"e-resize"},RB:{$order:1,cursor:"se-resize","z-index":110},B:{$order:1,left:"50%",cursor:"s-resize"},LB:{$order:1,cursor:"sw-resize","z-index":110},L:{$order:1,top:"50%",cursor:"w-resize"},LT:{$order:1,cursor:"nw-resize","z-index":110},HIDDEN:{$order:10,"border-width":0}}},Behaviors:{"default":{onClick:function(p){p.boxing().active()},onMousedown:function(profile,e,src){profile.box.onMousedown(profile,e,src,{move:true})},onDragbegin:function(profile,e,src){profile.box.onDragbegin(profile,e,src)},onDrag:function(profile,e,src){profile.box.onDrag(profile,e,src,{move:true})},onDragstop:function(profile,e,src){profile.box.onDragstop(profile,e,src,{move:true})},LT:{onMousedown:function(profile,e,src){profile.box.onMousedown(profile,e,src,{left:true,top:true})},onDragbegin:function(profile,e,src){profile.box.onDragbegin(profile,e,src)},onDrag:function(profile,e,src){profile.box.onDrag(profile,e,src,{left:true,top:true})},onDragstop:function(profile,e,src){profile.box.onDragstop(profile,e,src,{left:true,top:true})}},RT:{onMousedown:function(profile,e,src){profile.box.onMousedown(profile,e,src,{right:true,top:true})},onDragbegin:function(profile,e,src){profile.box.onDragbegin(profile,e,src)},onDrag:function(profile,e,src){profile.box.onDrag(profile,e,src,{right:true,top:true})},onDragstop:function(profile,e,src){profile.box.onDragstop(profile,e,src,{right:true,top:true})}},LB:{onMousedown:function(profile,e,src){profile.box.onMousedown(profile,e,src,{left:true,bottom:true})},onDragbegin:function(profile,e,src){profile.box.onDragbegin(profile,e,src)},onDrag:function(profile,e,src){profile.box.onDrag(profile,e,src,{left:true,bottom:true})},onDragstop:function(profile,e,src){profile.box.onDragstop(profile,e,src,{left:true,bottom:true})}},RB:{onMousedown:function(profile,e,src){profile.box.onMousedown(profile,e,src,{right:true,bottom:true})},onDragbegin:function(profile,e,src){profile.box.onDragbegin(profile,e,src)},onDrag:function(profile,e,src){profile.box.onDrag(profile,e,src,{right:true,bottom:true})},onDragstop:function(profile,e,src){profile.box.onDragstop(profile,e,src,{right:true,bottom:true})}},L:{onMousedown:function(profile,e,src){profile.box.onMousedown(profile,e,src,{left:true})},onDragbegin:function(profile,e,src){profile.box.onDragbegin(profile,e,src)},onDrag:function(profile,e,src){profile.box.onDrag(profile,e,src,{left:true})},onDragstop:function(profile,e,src){profile.box.onDragstop(profile,e,src,{left:true})}},T:{onMousedown:function(profile,e,src){profile.box.onMousedown(profile,e,src,{top:true})},onDragbegin:function(profile,e,src){profile.box.onDragbegin(profile,e,src)},onDrag:function(profile,e,src){profile.box.onDrag(profile,e,src,{top:true})},onDragstop:function(profile,e,src){profile.box.onDragstop(profile,e,src,{top:true})}},R:{onMousedown:function(profile,e,src){profile.box.onMousedown(profile,e,src,{right:true})},onDragbegin:function(profile,e,src){profile.box.onDragbegin(profile,e,src)},onDrag:function(profile,e,src){profile.box.onDrag(profile,e,src,{right:true})},onDragstop:function(profile,e,src){profile.box.onDragstop(profile,e,src,{right:true})}},B:{onMousedown:function(profile,e,src){profile.box.onMousedown(profile,e,src,{bottom:true})},onDragbegin:function(profile,e,src){profile.box.onDragbegin(profile,e,src)},onDrag:function(profile,e,src){profile.box.onDrag(profile,e,src,{bottom:true})},onDragstop:function(profile,e,src){profile.box.onDragstop(profile,e,src,{bottom:true})}}}},DataModel:{proxy:true,child:false,visible:true,cover:false,Static:false,reHeight:true,reWidth:true,changable:true,move:true,left:100,top:100,height:100,width:100,position:"absolute",display:"block",visibility:"visible",minHeight:12,minWidth:12,maxHeight:5000,maxWidth:5000,offset:2,enlarge:0,dragArgs:{}},EventHandlers:{onUpdate:function(profile,target,size,cssPos){},onActive:function(profile){},onFocusChange:function(profile,index){},onItemsSelected:function(profile,ids){},onRegionClick:function(profile,e){}},dynamicTemplate:function(profile){var pro=profile.properties,size,pos,temp,hash=profile._exhash="$child:"+pro.child+";visible:"+pro.visible+";cover:"+pro.cover+";Static:"+pro.Static+";reheight:"+pro.reHeight+";rewidth:"+pro.reWidth+";move:"+pro.move+";";var map=arguments.callee.map||(arguments.callee.map={MOVE:{tagName:"div",style:"top:50%;left:50%;margin-left:-6px;margin-top:-6px;width:13px;height:13px;"},T:{tagName:"div",style:"top:-{edge}px;margin-left:-{edge}px;width:{hSize}px;height:{hSize}px;"},RT:{tagName:"div",style:"top:-{edge}px;right:-{edge}px;width:{hSize}px;height:{hSize}px;"},R:{tagName:"div",style:"right:-{edge}px;margin-top:-{edge}px;width:{hSize}px;height:{hSize}px;"},RB:{tagName:"div",style:"bottom:-{edge}px;right:-{edge}px;width:{hSize}px;height:{hSize}px;"},B:{tagName:"div",style:"bottom:-{edge}px;margin-left:-{edge}px;width:{hSize}px;height:{hSize}px;"},LB:{tagName:"div",style:"bottom:-{edge}px;left:-{edge}px;width:{hSize}px;height:{hSize}px;"},L:{tagName:"div",style:"left:-{edge}px;margin-top:-{edge}px;width:{hSize}px;height:{hSize}px;"},LT:{tagName:"div",style:"left:-{edge}px;top:-{edge}px;width:{hSize}px;height:{hSize}px;"},cover:{T:{tagName:"div",style:"width:100%;left:0;top:-{edge}px;height:{hSize}px;"},RT:{tagName:"div",style:"top:-{edge}px;right:-{edge}px;width:{hSize}px;height:{hSize}px;"},R:{tagName:"div",style:"height:100%;top:0;right:-{edge}px;width:{hSize}px;"},RB:{tagName:"div",style:"right:-{edge}px;bottom:-{edge}px;width:{hSize}px;height:{hSize}px;"},B:{tagName:"div",style:"width:100%;left:0;bottom:-{edge}px;height:{hSize}px;"},LB:{tagName:"div",style:"left:-{edge}px;bottom:-{edge}px;width:{hSize}px;height:{hSize}px;"},L:{tagName:"div",style:"height:100%;top:0;left:-{edge}px;width:{hSize}px;"},LT:{tagName:"div",style:"top:-{edge}px;left:-{edge}px;width:{hSize}px;height:{hSize}px;"}}});var tid=profile.template._id,template=profile.box.getTemplate(tid,hash);if(!template){var t,n;template=_.clone(profile.box.getTemplate(tid));t=pro.cover?map.cover:map;if(pro.move){template.MOVE=t.MOVE}if(pro.reHeight){if(!pro.Static){template.T=t.T}template.B=t.B}if(pro.reWidth){if(!pro.Static){template.L=t.L}template.R=t.R;if(pro.reHeight){if(!pro.Static){template.LB=t.LB;template.RT=t.RT;template.LT=t.LT}template.RB=t.RB}}n=profile.getClass("KEY","-handler")+" ";if(t=template.T){t.className=n}if(t=template.RT){t.className=n}if(t=template.R){t.className=n}if(t=template.RB){t.className=n}if(t=template.B){t.className=n}if(t=template.LB){t.className=n}if(t=template.L){t.className=n}if(t=template.LT){t.className=n}if(!pro.visible){n=profile.getClass("KEY","-hidden")+" ";if(t=template.T){t.className+=n}if(t=template.RT){t.className+=n}if(t=template.R){t.className+=n}if(t=template.RB){t.className+=n}if(t=template.B){t.className+=n}if(t=template.LB){t.className+=n}if(t=template.L){t.className+=n}if(t=template.LT){t.className+=n}}profile.box.setTemplate(tid,template,hash)}profile.template=template},prepareData:function(profile){var t=profile.properties;t.hSize=parseInt(t.offset)*2;t.edge=t.offset+t.enlarge;if(t.child){t.offset=0;t.visible=false;t.cover=true;t.position="static";t.display="inline";t.left=t.top=t.width=t.height=0}if(!t.visible){t.visibility="hidden"}arguments.callee.upper.call(this,profile)},renderedTrigger:function(){this.boxing().rePosSize()},createdTrigger:function(){this.domNode.zIndexIgnore=true;if(!this.onUpdate){this.onUpdate=function(profile,target,size,cssPos){if(target){if(size){target.widthBy(size.width,true).heightBy(size.height,true)}if(cssPos){target.leftBy(cssPos.left).topBy(cssPos.top)}}}}},onMousedown:function(profile,e,src,ddparas){if(!profile.properties.changable){return }var ck=linb.event.currentKey;if(ck&&(ck[1]||(linb.browser.kde&&ck[0]=="space"))){profile.boxing().resetTarget(null);var pos=linb.event.getPos(e);var hash={defer:1,drop2:true,icon:linb.ini.path+"ondrag.gif",dragMode:"move",target_left:pos.left+12,target_top:pos.top+12,cursor:"pointer",move:false};_.merge(hash,profile.properties.dragArgs,"all");hash.grid_width=hash.grid_height=0;hash.data.pos=profile.boxing().reBoxing().cssPos();linb([]).startDrag(e,hash)}else{var hash,o,absPos,pos,posbak,size;if(profile.properties.child){pos=linb.event.getPos(e);linb([src]).startDrag(e,{defer:1,move:false,type:"blank",cursor:true,target_left:pos.left,target_top:pos.top})}else{o=profile.root;var absPos=o.absPos();pos=o.cssPos();posbak=_.copy(pos);size=o.cssSize();if(ddparas.move){var absPos=linb.event.getPos(e),posbak=_.copy(pos)}else{var absPos=o.absPos();pos=o.cssPos();posbak=_.copy(pos);size=o.cssSize();if(ddparas.left){if(ddparas.top){}else{if(ddparas.bottom){pos.top=pos.top+size.height}else{pos.top=pos.top+size.height/2}}}if(ddparas.right){pos.left=pos.left+size.width;if(ddparas.top){}else{if(ddparas.bottom){pos.top=pos.top+size.height}else{pos.top=pos.top+size.height/2}}}if(ddparas.top&&!ddparas.left&&!ddparas.right){pos.left=pos.left+size.width/2}if(ddparas.bottom&&!ddparas.left&&!ddparas.right){pos.left=pos.left+size.width/2;pos.top=pos.top+size.height}}if((t=profile.properties.dragArgs)&&(t=t.grid_width)){var offx=linb.dragDrop._size%t;if(ddparas.left){pos.left+=offx}else{if(ddparas.right){pos.left+=offx}else{if(ddparas.move){pos.left+=offx}}}}if((t=profile.properties.dragArgs)&&(t=t.grid_height)){var offy=linb.dragDrop._size%t;if(ddparas.top){pos.top+=offy}else{if(ddparas.bottom){pos.top+=offy}else{if(ddparas.move){pos.top+=offy}}}}pos.left+=parseInt((absPos.left-posbak.left)/t)*t;pos.top+=parseInt((absPos.top-posbak.top)/t)*t;var hash={defer:1,move:false,type:"blank",cursor:true,target_left:pos.left,target_top:pos.top};_.merge(hash,profile.properties.dragArgs,"all");hash.target_parent=profile._parent;hash.key=null;linb([src]).startDrag(e,hash)}}},onDragbegin:function(profile,e){if(profile.properties.child){var o=profile._target,pos=o.absPos(),w=o.offsetWidth(),h=o.offsetHeight();profile.proxy=linb.dom.getMatix();profile.proxy.html(" ",false).setStyle({border:"1px dashed",visibility:"visible"}).absPos(pos).offsetWidth(w).offsetHeight(h).zIndex(linb.dom.top_zIndex+20)}else{var o=linb([profile.domNode]);profile.proxy=o}profile.o_pos=profile.proxy.cssPos();profile.o_w2=profile.o_w=o.width();profile.o_h2=profile.o_h=o.height();profile.$onDrag=true},onDrag:function(profile,e,src,ddparas){var o=ddparas;profile.oos=profile.oos||{};var os=linb.dragDrop.getOffset();if(os.x==profile.oos.width&&os.y==profile.oos.height){return }profile.oos=os;var x,y,w,h,t=profile.properties;if(o.left){w=profile.o_w-os.x;x=profile.o_pos.left+os.x;if(w<t.minWidth){w=t.minWidth;x=profile.o_w+profile.o_pos.left-w}else{if(w>t.maxWidth){w=t.maxWidth;x=profile.o_w+profile.o_pos.left-w}}profile.proxy.width(w).left(x)}else{if(o.right){w=profile.o_w+os.x;if(w<t.minWidth){w=t.minWidth}else{if(w>t.maxWidth){w=t.maxWidth}}profile.proxy.width(w)}}if(o.left||o.right){var byw=w-profile.o_w2;if(profile.regions&&byw!==0){profile.regions.widthBy(byw);profile.o_w2=w}}if(o.top){h=profile.o_h-os.y;y=profile.o_pos.top+os.y;if(h<t.minHeight){h=t.minHeight;y=profile.o_h+profile.o_pos.top-h}else{if(h>t.maxHeight){h=t.maxHeight;y=profile.o_h+profile.o_pos.top-h}}profile.proxy.height(h).top(y)}else{if(o.bottom){h=profile.o_h+os.y;if(h<t.minHeight){h=t.minHeight}else{if(h>t.maxHeight){h=t.maxHeight}}profile.proxy.height(h)}}if(o.top||o.bottom){var byh=h-profile.o_h2;if(profile.regions&&byh!==0){profile.regions.heightBy(byh);profile.o_h2=h}}if(o.move){x=profile.o_pos.left+os.x;y=profile.o_pos.top+os.y;profile.proxy.top(y).left(x)}},onDragstop:function(profile,e,src,args){var cssPos,size,pos;var o=profile.proxy;if(!args.move){size={width:o.width()-profile.o_w,height:o.height()-profile.o_h}}if(args.left||args.top||args.move){cssPos=o.cssPos();pos={left:cssPos.left-profile.o_pos.left,top:cssPos.top-profile.o_pos.top}}profile.boxing().onUpdate(profile,profile._target,size,pos);if(profile.properties.child){if(linb.browser.ie6){profile._target.ieTrigger()}profile.proxy.html("",false).setStyle({visibility:"hidden",zIndex:"0",width:"0",height:"0"})}profile.boxing().active();profile.$onDrag=false}}});Class("linb.UI.Tips",null,{Constructor:function(){return null},Initialize:function(){var dd=linb.dragDrop,tips=this;dd.$reset=function(){tips.pos={left:dd.x,top:dd.y}};linb.css.add(".linb-ui-tips{font-size:0;line-height:0;position:absolute;border:solid gray 1px;background-color:#FFF8DC;overflow:visible;} .linb-ui-tips-i{font-size:12px;margin:1px 2px 2px 2px;}.linb-ui-tips-i span{display:inline;}",linb.getPath(this.KEY,"/css.css","appearance"));linb([document]).afterMousemove(function(obj,e,src){if(dd.working){return }var event=linb.event,p,n;if((p=_.resetRun.cache)&&p["$Tips"]){tips.pos=event.getPos(e)}if(tips.from){_.resetRun("$Tips3",null);tips._showF()}else{if(tips.showed&&tips.move){p=event.getPos(e);n=tips.Node.style;n.left=(parseInt(n.left)||0)+(p.left-tips._pos.left)+"px";n.top=(parseInt(n.top)||0)+(p.top-tips._pos.top)+"px";tips._pos=p}}},"$Tips",-1).afterMouseover(function(obj,e,src){var event=linb.event,rt=event.rtnFalse,node=event.getSrc(e),id,tid=node._tid,from,tempid,evid,pass;if(node&&node.id==linb.langId){node=node.parentNode}if(!node||(!tid&&!(id=node.id)||(tid&&!(evid=node.getAttribute("evid"))))){return rt}id=tid?tid:id;tempid=tid?tid+evid:id.replace(event._reg,"$1$3$4");if(tips.markId&&tempid==tips.markId){return rt}if((from=event._getProfile(id))&&from.box){tips.markId=tempid;_.resetRun("$Tips",function(){tips.from=from;tips.enode=node;_.resetRun("$Tips3",function(){if(tips.from){tips._showF()}},100)},tips.delayTime)}return rt},"$Tips",-1).afterMouseout(function(obj,e,src){if(tips.markId){var event=linb.event,id,tempid,evid,tid=event.getSrc(e)._tid,clear,node=e.toElement||e.relatedTarget;try{if(node&&node.id==linb.langId){node=node.parentNode}if(!node||(!tid&&!(id=node.id)||(tid&&node.id))){clear=1}}catch(e){clear=1}if(!clear){tempid=tid?tid+node.getAttribute("evid"):id.replace(event._reg,"$1$3$4");clear=tempid!==tips.markId}if(clear){if(tips.showed){tips.hide()}else{tips.asyHide()}}return event.rtnFalse}},"$Tips",-1);this.Types={"default":new function(){this._r=/(\$)([\w\.]+)/g;this.show=function(item,pos){if(!pos){return }var self=this,node,s,w,h;if(!(node=self.node)){node=self.node=linb.create('<div class="linb-ui-tips"><div class="linb-ui-tips-i"></div></div>');self.n=node.first();if(linb.dom.support("shadow")){node.shadow()}}if(document.body.lastChild!=node.get(0)){linb([document.body]).addLast(node)}s=item.tips;if(s=s.toString()){s=s.replace(self._r,function(a,b,c){return linb.wrapRes(c)});var style=node.get(0).style;style.width=style.height="auto";self.n.get(0).innerHTML=s;w=Math.min(tips.maxWidth,node.width());if(linb.browser.ie){style.width=Math.round(w/2)*2+2+"px";h=self.n.height();style.height=Math.round(h/2)*2+2+"px"}else{style.width=w+"px"}node.popToTop({left:pos.left,top:pos.top,region:{left:pos.left,top:pos.top-12,width:24,height:32}},null,1)}};this.hide=function(){this.node.zIndex(0).hide()}}}},Static:{maxWidth:300,move:true,delayTime:200,autoHideTime:5000,_showF:function(){var self=this,from=self.from,node=self.enode,id,o,t,b=false;self.from=self.enode=null;if(!node||!from||!(o=from.box)){return }self._pos=pos=self.pos;if(!b){b=(o.showTips&&o.showTips(from,node,pos))}if(!b&&(t=from.properties)&&(t.tips)){self.show(pos,t);b=true}if(!b){self.hide()}else{if(!self.move){_.resetRun("$Tips2",self.hide,self.autoHideTime,null,self)}}},show:function(pos,item){var self=this,t;if(self.item==item){return }if(self.curTemplate){self.curTemplate.hide()}if(!item||!item.tips){return }t=self.curTemplate=self.Types[item.tipsTemplate]||self.Types["default"];t.show(item,pos);self.Node=t.node.get(0);self.item=item;self.showed=true},hide:function(flag){var self=this;if(flag||self.showed){if(self.curTemplate){self.curTemplate.hide()}self.markId=self.from=self.curTemplate=self.item=self.showed=null}},asyHide:function(){var self=this;_.resetRun("$Tips",null);_.resetRun("$Tips3",null);self.markId=self.from=self.curTemplate=self.item=self.showed=null}}});Class("linb.UI.Label",["linb.UI.Widget","linb.UI.iForm"],{Instance:{_shadowText:function(key){return this.each(function(o){o.getSubNode("SHADOW").display("block")})},_unShadowText:function(key){return this.each(function(o){o.getSubNode("SHADOW").display("none")})}},Initialize:function(){var t=this.getTemplate("default");_.merge(t.FRAME.BORDER,{SHADOW:{$order:1,style:"display:none;",SICON:{style:"background:url({icon}) transparent no-repeat {iconPos};{iconDisplay}",$order:0},SCAPTION:{text:"{caption}",style:"color:#cdcdcd;",$order:1}},BOX:{$order:2,ICON:{style:"background:url({icon}) transparent no-repeat {iconPos};{iconDisplay}",$order:0},CAPTION:{text:"{caption}",$order:1}}},"all");this.setTemplate("default",t)},Static:{Appearances:{"default":{KEY:{"font-size":"12px","line-height":"12px"},BOX:{position:"absolute"},SHADOW:{position:"absolute"},ICON:{width:"16px",height:"16px",margin:"0 4px 0 0"},SICON:{width:"16px",height:"16px",margin:"0 4px 0 0"}}},DataModel:{tabindex:null,caption:{action:function(value){var self=this,p=self.properties,b=self.boxing(),k=self.keys;self.getSubNodes(["CAPTION","SCAPTION"]).html(value,false);if(p.hAlign!="left"){b.setHAlign(p.hAlign,true)}if(p.vAlign!="top"){b.setVAlign(p.vAlign,true)}}},icon:{ini:"",action:function(value){var self=this,k=self.keys;self.getSubNodes(["ICON","SICON"]).display(value?"":"none").setStyle("backgroundImage","url("+(value||"")+")")}},iconPos:{ini:"",action:function(value){var self=this,k=self.keys;self.getSubNodes(["ICON","SICON"]).setStyle(backgroundPosition,value)}},shadowText:{ini:false,action:function(v){var b=this.boxing();v=String(v).toLowerCase()!="false";if(v){b._shadowText(v)}else{b._unShadowText()}}},hAlign:{ini:"right",listbox:["left","center","right"],action:function(v){var self=this,c=self.getSubNode("BOX"),d=self.getSubNode("SHADOW"),t=self.properties;switch(v){case"left":c.setStyle({left:0,right:"auto",marginLeft:"auto"});d.setStyle({left:t._textSshadowSize+"px",right:"auto",marginLeft:"auto"});break;case"right":c.setStyle({left:"auto",right:t._textSshadowSize+"px",marginLeft:"auto"});d.setStyle({left:"auto",right:0,marginLeft:"auto"});break;case"center":c.setStyle({left:"50%",right:"auto",marginLeft:-1*c.get(0).offsetWidth/2+"px"});d.setStyle({left:"50%",right:"auto",marginLeft:-1*c.get(0).offsetWidth/2+t._textSshadowSize+"px"});break}}},vAlign:{ini:"top",listbox:["top","middle","bottom"],action:function(v){var self=this,c=self.getSubNode("BOX"),d=self.getSubNode("SHADOW"),t=self.properties;switch(v){case"top":c.setStyle({top:0,bottom:"auto",marginTop:"auto"});d.setStyle({top:t._textSshadowSize+"px",bottom:"auto",marginTop:"auto"});break;case"bottom":c.setStyle({top:"auto",bottom:t._textSshadowSize+"px",marginTop:"auto"});d.setStyle({top:"auto",bottom:0,marginTop:"auto"});break;case"middle":c.setStyle({top:"50%",bottom:"auto",marginTop:-1*c.get(0).offsetHeight/2+"px"});d.setStyle({top:"50%",bottom:"auto",marginTop:-1*c.get(0).offsetHeight/2+t._textSshadowSize+"px"});break}}},fontSize:{ini:"",action:function(value){var self=this;self.getSubNodes(["CAPTION","SCAPTION"]).setStyle("fontSize",value)}},fontWeight:{ini:"",action:function(value){var self=this;self.getSubNodes(["CAPTION","SCAPTION"]).setStyle("fontWeight",value)}},width:60,height:20,_textSshadowSize:4},createdTrigger:function(){var p=this.properties,o=this.boxing();if(p.fontSize){o.setFontSize(p.fontSize,true)}if(p.fontWeight){o.setFontWeight(p.fontWeight,true)}if(p.shadowText){o.setShadowText(true,true)}},renderedTrigger:function(){var p=this.properties,o=this.boxing(),s=p.shadowText;if(p.hAlign!="left"||s){o.setHAlign(p.hAlign,true)}if(p.vAlign!="top"||s){o.setVAlign(p.vAlign,true)}},EventHandlers:{beforeValueUpdated:null,afterValueUpdated:null,beforeValueSet:null,afterValueSet:null,beforeNextFocus:null}}});Class("linb.UI.Button",["linb.UI.Widget","linb.UI.iForm"],{Instance:{_border:function(key,args){args=args||{};args.borderActive=true;return arguments.callee.upper.call(this,key,args)},activate:function(){var profile=this.get(0);profile.getSubNode("FOCUS").focus();return this},setCtrlValue:function(value){if(_.isNull(value)||!_.exists(value)){value=false}return this.each(function(profile){if(!profile.properties.toggleKey){return }if(value){profile.addTagClass("BORDER","-checked")}else{profile.removeTagClass("BORDER","-checked")}if(profile.properties.border){var b=profile.boxing().getBorder();if(b){b.setChecked(value)}}})}},Initialize:function(){var t=this.getTemplate("default");_.merge(t.FRAME.BORDER,{FOCUS:{tagName:"a",href:"{href}",tabindex:"{tabindex}",TB:{cellpadding:"0",cellspacing:"0",width:"100%",height:"100%",border:"0",tagName:"table",TR:{tagName:"tr",TD:{align:"{hAlign}",valign:"{vAlign}",tagName:"td",BOX:{ICON:{$order:1,style:"background:url({icon}) transparent no-repeat  {iconPos};{iconDisplay}"},CAPTION:{$order:2,text:"{caption}",className:"{disabled}"}}}}}}},"all");this.setTemplate("default",t);t=this.getAppearance("default");var n=_.copy(t);_.merge(n,{BORDER:{$order:0,"text-decoration":"underline",cursor:"pointer"},"BORDER-mouseover":{$order:1,"font-weight":"bold"},"BORDER-mousedown":{$order:1,"font-style":"italic"}},"all");this.setAppearance("link",n)},Static:{Appearances:{"default":{KEY:{"font-size":"12px","line-height":"12px"},BORDER:{border:"solid 1px #eee","background-color":"#f4f4f4"},"BORDER-mouseover":{$order:1,"border-color":"#fff #cdcdcd #cdcdcd #fff"},"BORDER-mousedown, BORDER-checked":{$order:2,"border-color":"#cdcdcd #fff #fff #cdcdcd","background-color":"#fff"},ICON:{width:"16px",height:"16px",margin:"0 4px 0 0"},TD:{height:"100%"},FOCUS:{overflow:"hidden",display:"block",position:"absolute",left:0,top:0,"z-index":"20",width:"100%",height:"100%","-moz-outline-offset":"-1px !important"},BOX:{display:linb.browser.gek?["-moz-inline-block","-moz-inline-box"]:"inline-block","font-size":"12px","line-height":"14px",overflow:"hidden"}}},Behaviors:{"default":{_hoverEffect:{KEY:["BORDER"]},_clickEffect:{KEY:["BORDER"]},_focusHook:{FOCUS:1},onClick:function(profile,e,src){var p=profile.properties;if(p.disabled){return false}profile.getSubNode("FOCUS").focus();var b=profile.boxing();if(p.toggleKey){b.updateUIValue(!p.$UIvalue);if(profile.onToggle){b.onToggle(profile,e,p.$UIvalue,p.toggleKey)}}if(profile.onClick){b.onClick(profile,e,p.$UIvalue)}}}},DataModel:{hAlign:{ini:"center",listbox:["left","center","right"],action:function(v){var self=this,c=self.getSubNode("TD"),t=self.properties;c.attr("align",v)}},vAlign:{ini:"top",listbox:["top","middle","bottom"],action:function(v){var self=this,c=self.getSubNode("TD"),t=self.properties;c.attr("valign",v)}},tabindex:{action:function(value){var self=this;if(self.domNode){self.getSubNode("FOCUS").tabIndex(value)}}},href:"javascript:;",value:false,toggleKey:"",width:120,height:20,$border:1},createdTrigger:function(){var p=this.properties,o=this.boxing();if(p.toggleKey&&p.value){o.setValue(true,true)}},EventHandlers:{onClick:function(profile,e,value){},onToggle:function(profile,e,value,toggleKey){}}}});Class("linb.UI.CheckBox","linb.UI.Button",{Instance:{activate:function(){var p=this.get(0);p.getSubNode("FOCUS").focus();return this},setCtrlValue:function(value){if(_.isNull(value)||!_.exists(value)){value=false}return this.each(function(profile){if(value){profile.addTagClass("MARK","-checked")}else{profile.removeTagClass("MARK","-checked")}})},setDirtyMark:function(){return this.each(function(profile){if(!profile.domNode){return }var properties=profile.properties,o=profile.getSubNode("CAPTION"),flag=properties.value!==properties.$UIvalue,d=linb.UI.$css_tag_dirty;if(o.beforeDirtyMark&&false===o.boxing().beforeDirtyMark(profile,flag)){return }if(flag){o.addClass(d)}else{o.removeClass(d)}})}},Initialize:function(){var t=this.getTemplate("default");_.merge(t.FRAME.BORDER.FOCUS.TB.TR.TD.BOX,{MARK:{$order:0}},"all");this.setTemplate("default",t)},Static:{Appearances:{"default":{KEY:{"font-family":'"Verdana", "Helvetica", "sans-serif"',"font-size":"12px",border:0,cursor:"pointer","background-color":"#fff"},BORDER:{},FOCUS:{overflow:"hidden",display:"block",position:"absolute",left:0,top:0,"z-index":"200",width:"100%",height:"100%","-moz-outline-offset":"-1px !important"},BOX:{display:linb.browser.gek?["-moz-inline-block","-moz-inline-box"]:"inline-block","font-size":"12px","line-height":"14px",overflow:"hidden",position:"absolute","white-space":"nowrap"},MARK:{cursor:"pointer",width:"16px",height:"16px",background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -112px top",null,"linb.UI.Public")},"MARK-mouseover":{$order:1,"background-position":"-112px -17px"},"MARK-mousedown":{$order:2,"background-position":"-112px -34px"},"MARK-checked":{$order:3,"background-position":"-96px top"},"MARK-checked-mouseover":{$order:4,"background-position":"-96px -17px"},"MARK-checked-mousedown":{$order:5,"background-position":"-96px -34px"},ICON:{cursor:"pointer",width:"16px",height:"16px",margin:"0 4px 0 0"},CAPTION:{"vertical-align":"top"}}},Behaviors:{"default":{_hoverEffect:{KEY:"MARK"},_clickEffect:{KEY:"MARK"},_focusHook:{FOCUS:1},onClick:function(profile,e,src){var p=profile.properties,b=profile.boxing();if(p.disabled){return false}b.updateUIValue(!p.$UIvalue);if(profile.onChecked){b.onChecked(profile,p.$UIvalue)}profile.getSubNode("FOCUS").focus()},FOCUS:{onKeydown:function(profile,e,src){var key=linb.event.getKey(e)[0];if(key=="space"||key=="enter"){profile.root.onClick(true);return false}}}}},DataModel:{value:false,hAlign:"left",toggleKey:null},EventHandlers:{beforeDirtyMark:function(profile,flag){},onClick:null,onToggle:null,onChecked:function(profile,value){}}}});Class("linb.UI.Input",["linb.UI.Widget","linb.UI.iForm"],{Instance:{_setTB:function(type){var profile=this.get(0),p=profile.properties,o,t;if(!profile.host||!p.tipsBinder){return }t=profile.tips=profile.tips||p.tips||"";o=profile.host[p.tipsBinder];if(o&&o.KEY=="linb.UI.Div"){o.get(0).domNode.innerHTML=t.charAt(0)=="$"?linb.wrapRes(t):t;o.reBoxing().setStyle("color",type==1?"gray":type==2?"red":"#000")}},activate:function(){var profile=this.get(0);if(profile.domNode){profile.getSubNode("INPUT").activate()}return this},disabled:function(value){arguments.callee.upper.call(this,value);return this.each(function(o){o.getSubNode("INPUT").readonly(value)})},setCtrlValue:function(value){if(_.isNull(value)||!_.exists(value)){value=""}return this.each(function(profile){profile.getSubNode("INPUT").value(value.toString())})},getCtrlValue:function(){var profile=this.get(0);return profile.getSubNode("INPUT").value()},setDirtyMark:function(){return this.each(function(profile){var properties=profile.properties,o=profile.getSubNode("INPUT"),box=profile.boxing(),d=linb.UI.$css_tag_dirty,v=linb.UI.$css_tag_invalid,flag=properties.value!==properties.$UIvalue;if(profile.beforeDirtyMark&&false===box.beforeDirtyMark(profile,flag)){}else{if(flag){o.addClass(d)}else{o.removeClass(d)}}if(profile.beforeFormatMark&&false===box.beforeFormatMark(profile)){}else{var err=profile.getSubNode("ERROR"),p=profile.properties;if(profile.inValid==2){o.addClass(v);err.display("block");profile.tips=p.tipsErr||p.tips}else{o.removeClass(v);err.display("none");if(profile.inValid==1){profile.tips=p.tips}else{profile.tips=p.tipsOK||p.tips}}box._setTB(profile.inValid)}})},readonly:function(value){return this.each(function(profile){profile.getSubNode("INPUT").readonly(value)})},fireChangeEvent:function(){var profile=this.get(0);profile.getSubNode("INPUT").onChange()}},Initialize:function(){var t=this.getTemplate("default");_.merge(t.FRAME.BORDER,{BOX:{tagName:"div",INPUT:{tagName:"input",type:"{type}",value:"{value}",tabindex:"{tabindex}",cursor:"{cursor}"}}},"all");t.FRAME.ERROR={};this.setTemplate("default",t)},Static:{Appearances:{"default":{KEY:{"font-family":'"Verdana", "Helvetica", "sans-serif"',cursor:"pointer",overflow:"hidden"},BORDER:{"line-height":"0px","font-size":"0px","background-color":"#fff",border:"1px solid #7F9DB9"},"BORDER-focus, BORDER-mouseover":{$order:1,border:"1px solid #FFD700"},BOX:{position:"absolute","z-index":"10",left:0,top:0,overflow:linb.browser.gek?"auto":""},INPUT:{border:0,padding:0,margin:0,"font-size":"12px",position:"relative",overflow:"auto","overflow-y":(linb.browser.gek||linb.browser.ie)?"auto":"","overflow-x":(linb.browser.gek||linb.browser.ie)?"hidden":""},ERROR:{width:"16px",height:"16px",position:"absolute",right:0,top:0,display:"none","font-size":0,background:linb.UI.getCSSImgPara("icon.gif"," no-repeat left top",null,"linb.UI.Public"),"z-index":"50"}}},Behaviors:{"default":{_focusEffect:{INPUT:1},_hoverEffect:{KEY:["BORDER"]},_focusHook:{INPUT:1},INPUT:{onChange:function(profile,e,src){var o=profile.inValid;profile.boxing().updateUIValue(src.value);profile.properties.$UIvalue=src.value;if(o!==profile.inValid){if(profile.domNode){profile.boxing().setDirtyMark()}}},onKeyup:function(profile,e,src){var p=profile.properties;if(p.dynCheck){if(p.$UIvalue!=src.value){profile.box.checkValid(profile,src.value)}profile.boxing().setDirtyMark()}},onFocus:function(profile,e,src){var p=profile.properties;if(p.disabled){return false}if(profile.beforeFocus&&false===profile.boxing().beforeFocus(profile)){}else{profile.addTagClass(profile.key,"-focus",profile.getSubNode("BORDER"))}profile.boxing()._setTB(3)},onBlur:function(profile,e,src){var p=profile.properties;if(p.disabled){return false}if(profile.beforeBlur&&false===profile.boxing().beforeBlur(profile)){}else{profile.removeTagClass("KEY","-focus",profile.getSubNode("BORDER"))}if(p.$UIvalue==src.value){profile.box.checkValid(profile,src.value)}profile.boxing().setDirtyMark()}}}},DataModel:{icon:null,iconPos:null,caption:null,tipsErr:"",tipsOK:"",dynCheck:false,valueFormat:{ini:"",helpinput:[{caption:"required",id:"[^.*]"},{caption:"email",id:"^[\\w\\.=-]+@[\\w\\.-]+\\.[\\w\\.-]{2,4}$"},{caption:"charOnly",id:"^[a-zA-Z]*$"},{caption:"words",id:"^[\\w ]*$"},{caption:"integer",id:"^-?\\d\\d*$"},{caption:"positiveInteger",id:"^\\d\\d*$"},{caption:"number",id:"^-?(\\d\\d*\\.\\d*$)|(^-?\\d\\d*$)|(^-?\\.\\d\\d*$)"},{caption:"filepath",id:"([\\/]?[\\w_]+)+\\.\\w{1,9}$"},{caption:"URL",id:"^(http|https|ftp)\\:\\/\\/[\\w\\-\\.]+\\.[a-zA-Z]{2,3}(:[\\w]*)?\\/?([\\w\\-\\._\\?\\,\\'\\/\\\\\\+&amp;%\\$#\\=~])*$"},{caption:"color",id:"^\\#[0-9A-Fa-f]{6}$"},{caption:"HH:MM",id:"^(([0-1][0-9])|([2][0-3])):([0-5][0-9])$"},{caption:"HH:MM:SS",id:"^(([0-1][0-9])|([2][0-3])):([0-5][0-9])\\:([0-5][0-9])$"},{caption:"YYYY-MM-DD",id:"^([0-9]{4})\\-(([0][0-9])|([1][0-2]))\\-([0-3][0-9])$"},{caption:"DD/MM/YYYY",id:"^(([0-2][0-9])|([3][0-1]))/(([0][0-9])|([1][0-2]))/([0-9]{4})$"},]},value:"",width:120,height:20,tabindex:{action:function(value){if(this.domNode){this.getSubNode("INPUT").tabIndex(value)}}},readonly:{ini:false,action:function(v){v=String(v).toLowerCase()!="false";this.boxing().readonly(v);this.root.cursor(v?"pointer":"")}},type:{ini:"text",listbox:["text","password"],action:function(value){this.getSubNode("INPUT").attr("type",value)}},inputArea:{ini:"input",listbox:["input","textarea"],action:function(value){var str=this.getSubNode("INPUT").outerHTML();str=str.replace(/^(<)[a-zA-Z]+(\s)/i,"$1"+value+"$2");var v=this.boxing().getValue();this.getSubNode("INPUT").outerHTML(str);this.boxing().updateUIValue(v)}},tipsBinder:"",$border:1},EventHandlers:{beforeFocus:function(profile){},beforeBlur:function(profile){},beforeDirtyMark:function(profile,flag){},onFormatCheck:function(profile,value){},beforeFormatMark:function(profile){}},prepareData:function(profile){arguments.callee.upper.call(this,profile);var d=profile.data;d.cursor=d.readonly?"pointer":"default";d.type=d.type||""},dynamicTemplate:function(profile){var properties=profile.properties;var hash=profile._exhash="$inputArea:"+properties.inputArea+";readonly:"+properties.readonly+";",tid=profile.template._id,template=profile.box.getTemplate(tid,hash);properties.$UIvalue=properties.value;if(!template){template=_.clone(profile.box.getTemplate(tid));if(properties.inputArea!="input"){template.FRAME.BORDER.BOX.INPUT.tagName=properties.inputArea;delete template.FRAME.BORDER.BOX.INPUT.type}if(properties.readonly){template.FRAME.BORDER.BOX.INPUT.readonly="readonly"}profile.box.setTemplate(tid,template,hash)}profile.template=template},createdTrigger:function(){var self=this;_.asyRun(function(){self.boxing()._setTB(1)})},checkValid:function(profile,value){var p=profile.properties,vf=p.valueFormat||profile.$valueFormat;if((profile.onFormatCheck&&(profile.boxing().onFormatCheck(profile,value)===false))||(vf&&typeof vf=="string"&&!(new RegExp(vf)).test(value||""))){profile.inValid=2;return false}profile.inValid=3;return true},resize:function(profile,w,h){var size=arguments.callee.upper.apply(this,arguments);var v=linb.dom.pack([],false).add(profile.getSubNode("INPUT")).add(profile.getSubNode("BOX"));if(!_.isNull(w)){v.width(size.width)}if(!_.isNull(h)){v.height(size.height-(linb.browser.ie6?2:linb.browser.ie?1:linb.browser.kde?1:0))}return size}}});Class("linb.UI.ComboInput","linb.UI.Input",{Instance:{setCtrlValue:function(value,flag){return this.each(function(profile){profile.getSubNode("INPUT").value(flag?value:profile.boxing()._getShowValue(value))})},_compareValue:function(v1,v2){var profile=this.get(0),t;if(t=profile.$compareValue||profile.CF.compareValue){return t(profile,v1,v2)}return v1===v2},_getShowValue:function(value){var profile=this.get(0),pro=profile.properties,v,t;if(profile.onClickButton){v=value}else{if(t=profile.$getShowValue||profile.CF.getShowValue){v=t(profile,value)}else{if("listbox"==pro.type||"combobox"==pro.type){if((v=pro.items.subIndexOf("id",value))!=-1){v=pro.items[v].caption;v=v.charAt(0)=="$"?linb.getRes(v.slice(1)):v}else{v=""}}else{v=profile.$showValue||value}}if(typeof v=="string"){v=v.replace(/\<\/?[^>]+\>/g,"")}}return v||value||""},_getEditValue:function(value){var profile=this.get(0),pro=profile.properties,t;if(t=profile.$getEditValue||profile.CF.getEditValue){return t(profile,value)}return value},_fromEditValue:function(value){var profile=this.get(0),pro=profile.properties,t;if(t=profile.$fromEditValue||profile.CF.fromEditValue){return t(profile,value)}return value},_cache:function(){var profile=this.get(0),drop=profile.$drop;if(drop){profile.getSubNode("POOL").addLast(drop.root.display("none"))}delete profile.$poplink},refreshCache:function(){var profile=this.get(0);if(profile.domNode){profile.getSubNode("POOL").empty()}delete profile.$drop;return this},getUploadObj:function(){var profile=this.get(0);if(profile.domNode){var o=profile.getSubNode("UPLOAD",null,true),c=o.clone();o.addPre(c);return o.remove(false)}},resetValue:function(value){this.each(function(p){if(p.properties.type=="upload"){p.getSubNode("UPLOAD").value("")}});return arguments.callee.upper.apply(this,arguments)},_drop:function(){return this.each(function(profile){var pro=profile.properties;if(pro.disabled){return }if(pro.type=="upload"){return }if(profile.$poplink){return }var o,v,box=profile.boxing(),main=box.reBoxing(),pos=main.absPos(),size=main.cssSize();size.width+=2;pos.top+=main.offsetHeight();switch(pro.type){case"getter":case"cmdbox":case"popbox":box.onClickButton(profile,pos,profile.root.get(0));return }var cachekey;switch(pro.type){case"combobox":case"listbox":case"helpinput":if(pro.listKey){if(linb.UI.getCacheListType(pro.listKey)=="function"){profile.$drop=null}else{cachekey=profile.$drop}}else{cachekey=profile.$id}break;default:cachekey=pro.type}if(cachekey){_.filter(profile.box.$drop,function(o){return !!o.domNode});profile.$drop=profile.box.$drop[cachekey]}if(!profile.$drop){switch(pro.type){case"combobox":case"listbox":case"helpinput":linb.SC("linb.UI.List");o=linb.create("List");o.host(profile).setItems(pro.items.copy()).adjustSize();o.beforeValueUpdated(function(pro,ovalue,value,showValue){this.$showValue=showValue;var b2=this.boxing();b2.updateUIValue(value);b2._cache();b2.activate();return false});break;case"timepicker":linb.SC("linb.UI.TimePicker");o=linb.create("TimePicker");o.host(profile);o.beforeClose(function(){this.boxing()._cache();return false});o.beforeValueUpdated(function(p,o,v){this.boxing().updateUIValue(v)._cache()});break;case"datepicker":linb.SC("linb.UI.DatePicker");o=linb.create("DatePicker");o.host(profile);o.beforeClose(function(){this.boxing()._cache();return false});o.beforeValueUpdated(function(p,o,v){this.boxing().updateUIValue(String(v.getTime()))._cache()});break}profile.$drop=o.get(0);if(cachekey){profile.$drop.links(profile.box.$drop,cachekey,null,cachekey)}}o=profile.$drop.boxing();o.host(profile);switch(pro.type){case"combobox":case"listbox":case"helpinput":o.setWidth(profile.root.width());case"timepicker":o.setValue(box.getUIValue(),true);break;case"datepicker":var t=profile.$drop.properties;t.firstDayOfWeek=pro.firstDayOfWeek;if(t=box.getUIValue()){o.setValue(new Date(parseInt(t)),true)}break;case"colorpicker":break}profile.$poplink=o.get(0);var node=o.reBoxing();node.popToTop(profile.root);o.activate();node.setBlurTrigger(profile.key+":"+profile.$id,function(){box._cache()},null,profile.$id);linb.event.hookKey("esc",0,0,0,function(){box._cache();box.activate();linb.event.hookKey("esc",0,0,0,null)})})}},Initialize:function(){this.mapKeys(["UPLOAD"]);var t=this.getTemplate("default");_.merge(t.FRAME.BORDER,{BTN:{$order:4,style:"{popbtnDisplay}",TOP:{},MID:{style:"{typePos}"}},SBTN:{$order:3,style:"{saveDisplay}",STOP:{},SMID:{}}},"all");t.FRAME.POOL={};this.setTemplate("default",t)},Static:{$drop:{},Appearances:{"default":{POOL:{position:"absolute",left:0,top:0,width:0,height:0,display:"none",visibility:"hidden"},UPLOAD:{opacity:0,"*filter":"alpha(opacity=0)","z-index":"3",border:0,height:"100%",position:"absolute",top:0,right:0,cursor:"pointer","font-size":"12px",overflow:"hidden"},"SBTN,BTN":{"z-index":"1",cursor:"pointer",width:"13px","font-size":0,"line-height":0,position:"relative","float":"right",background:linb.UI.getCSSImgPara("cmd.gif"," left bottom no-repeat")},"BTN-mouseover, SBTN-mouseover":{$order:1,"background-position":"-14px bottom"},"BTN-mousedown, SBTN-mousedown":{$order:2,"background-position":"-27px bottom"},"STOP, TOP":{cursor:"pointer",width:"13px","font-size":0,"line-height":0,position:"absolute",top:0,left:0,height:"4px",background:linb.UI.getCSSImgPara("cmd.gif"," left -104px no-repeat")},"BTN-mouseover TOP,SBTN-mouseover STOP":{$order:1,"background-position":"-14px -104px"},"BTN-mousedown TOP,SBTN-mousedown STOP":{$order:2,"background-position":"-27px -104px"},"SMID,MID":{cursor:"pointer",width:"13px","font-size":0,"line-height":0,position:"absolute",bottom:"3px",left:0,height:"13px",background:linb.UI.getCSSImgPara("cmd.gif"," left top no-repeat")},SMID:{"background-position":"-14px -14px"}}},Behaviors:{"default":{_hoverEffect:{KEY:"BORDER",BTN:"BTN",SBTN:"SBTN"},_clickEffect:{BTN:"BTN",SBTN:"SBTN"},_focusHook:{INPUT:1},UPLOAD:{onChange:function(profile,e,src){profile.getSubNode("INPUT").value(src.value).onChange()}},BTN:{onClick:function(profile,e,src){profile.boxing()._drop()}},SBTN:{onClick:function(profile,e,src){if(profile.onSave){profile.boxing().onSave(profile,src)}}},INPUT:{onChange:function(profile,e,src){if(profile.$_onedit||profile.$_inner){return }var o=profile.inValid,instance=profile.boxing(),v=instance._fromEditValue(src.value),uiv=profile.properties.$UIvalue;if(!instance._compareValue(uiv,v)){profile.$_inner=1;delete profile.$_inner;if(v===null){instance.setCtrlValue(uiv)}else{instance.updateUIValue(v);if(o!==profile.inValid){if(profile.domNode){instance.setDirtyMark()}}}}},onKeyup:function(profile,e,src){var p=profile.properties;if(p.dynCheck){if(p.$UIvalue!=src.value){profile.box.checkValid(profile,src.value)}profile.boxing().setDirtyMark()}},onFocus:function(profile,e,src){var p=profile.properties,uiv=p.$UIvalue;if(p.disabled){return false}var instance=profile.boxing(),v=instance._getEditValue(uiv);if(v!==uiv){profile.$_onedit=true;src.value=v;delete profile.$_onedit}if(profile.beforeFocus&&false===profile.boxing().beforeFocus(profile)){}else{profile.addTagClass(profile.key,"-focus",profile.getSubNode("BORDER"))}profile.boxing()._setTB(3)},onBlur:function(profile,e,src){var p=profile.properties,instance=profile.boxing(),uiv=p.$UIvalue,v=instance._fromEditValue(src.value);if(p.disabled){return false}if(profile.beforeBlur&&false===instance.beforeBlur(profile)){}else{profile.removeTagClass("KEY","-focus",profile.getSubNode("BORDER"))}if(instance._compareValue(p.$UIvalue,v)){profile.box.checkValid(profile,v);instance.setCtrlValue(uiv)}instance.setDirtyMark()},onKeydown:function(profile,e,src){var p=profile.properties.type;if(p=="getter"||p=="cmdbox"||p=="popbox"){return }var key=linb.event.getKey(e);if((key[0]=="down"||key[0]=="up")&&key[1]){profile.boxing()._drop();return false}else{if(key=="enter"){profile.getSubNode("INPUT").onBlur()}}},onClick:function(profile,e,src){if(profile.properties.readonly){profile.boxing()._drop()}}}}},EventHandlers:{onSave:function(profile,src){},onClickButton:function(profile,pos,node){}},posMap:{none:"",combobox:"left top",listbox:"left top",upload:"-16px top",getter:"left -27px",helpinput:"left -91px",cmdbox:"left -14px",popbox:"left -40px",timepicker:"left -53px",datepicker:"left -66px",colorpicker:"left -79px"},DataModel:{icon:null,iconPos:null,caption:null,listKey:{ini:"",set:function(v){var t=linb.UI.getCacheList(v);return this.each(function(o){o.boxing().setItems(t?t:o.properties.items);o.properties.listKey=v})}},items:{ini:{},action:function(v){var self=this;self.boxing().setValue(null,true);self.SubSerialIdMapItem={};self.ItemIdMapSubSerialId={};self.box.prepareItems(self,v);if(v.domNode){self.boxing().refreshCache()}}},readonly:{ini:false,action:function(v){this.getSubNode("INPUT").cursor(v?"pointer":"default")}},type:{ini:"combobox",listbox:"none,combobox,listbox,upload,getter,helpinput,cmdbox,popbox,timepicker,datepicker,colorpicker".toArr(),set:function(v){var self=this,pro;if(v.exists(":")){var arr=v.split(":");if(arr[1]=="readonly"){self.setReadonly(true)}v=arr[0]}if(v=="listbox"){self.setReadonly(true)}if(v!="listbox"&&v!="combobox"){self.each(function(p){pro=p.properties;if(!pro.items){pro.items=[]}})}if(v=="timepicker"){self.each(function(p){var o=linb.SC("linb.UI.TimePicker");_.merge(p,{$compareValue:null,$getShowValue:function(profile,value){return value?o.formatValue(value):""},$getEditValue:null,$fromEditValue:function(profile,value){return o.formatValue(value)}},"all");pro=p.properties;if(pro.value){pro.$UIvalue=pro.value=o.formatValue(pro.value)}})}else{if(v=="datepicker"){var date=linb.date;self.each(function(p){pro=p.properties;_.merge(p,{$compareValue:function(p,a,b){return String(a)==String(b)},$getShowValue:function(profile,value){return value?date.getText(new Date(parseInt(value)),"ymd"):""},$getEditValue:function(profile,value){var v=new Date(parseInt(value));return value?(date.get(v,"m")+1)+"/"+date.get(v,"d")+"/"+date.get(v,"y"):""},$fromEditValue:function(profile,value){var v=linb.date.parse(value);if(v){v=linb.date.getRoundDown(v,"d",1)}return v?String(v.getTime()):""}},"all");if(pro.value){var d=date.parse(parseInt(pro.value))||new Date;pro.$UIvalue=pro.value=String(date.getRoundDown(d,"d",1).getTime())}})}else{self.each(function(p){delete p.$compareValue;delete p.$getShowValue;delete p.$getEditValue;delete p.$fromEditValue;pro=p.properties;if(_.isDate(pro.value)){pro.$UIvalue=pro.value=String(pro.value)}})}}return self.each(function(pro){pro.properties.type=v;if(pro.domNode){pro.getSubNode("MID").setStyle("backgroundPosition",pro.box.posMap[v]||"left top")}})}},saveBtn:{ini:false,action:function(v){this.boxing().refresh()}},firstDayOfWeek:0,$border:1},createdTrigger:function(){var self=this,instance=self.boxing(),p=self.properties;instance.setType(p.type,true);if(p.readonly){instance.setReadonly(true,true)}},dynamicTemplate:function(profile){var properties=profile.properties,hash=profile._exhash="$inputArea:"+properties.inputArea+";readonly:"+properties.readonly+";type:"+properties.type+";",tid=profile.template._id,template=profile.box.getTemplate(tid,hash);properties.$UIvalue=properties.value;if(!template){template=_.clone(profile.box.getTemplate(tid));var t=template.FRAME.BORDER;if(properties.inputArea!="input"){t.BOX.INPUT.tagName=properties.inputArea;delete t.BOX.INPUT.type}if(properties.readonly){t.BOX.INPUT.readonly="readonly"}if(properties.type=="upload"){t.UPLOAD={$order:2,tagName:"input",type:"file",size:"1"}}profile.box.setTemplate(tid,template,hash)}profile.template=template},prepareData:function(profile){arguments.callee.upper.call(this,profile);var data=profile.data;if(data.type!="none"){data.typePos="background-position:"+profile.box.posMap[profile.data.type]}data.saveDisplay=data.saveBtn?"":"display:none";data.popbtnDisplay=data.type!="none"?"":"display:none"},resize:function(profile,w,h){var size=linb.UI.Widget.resize.apply(this,arguments),t,v=profile.getSubNode("INPUT"),c=profile.getSubNode("BTN"),prop=profile.properties,save=prop.saveBtn,s=save?profile.getSubNode("SBTN"):null;if(!_.isNull(w)){v.width(size.width-(prop.type=="none"?0:c.offsetWidth())-(save?s.offsetWidth():0))}if(!_.isNull(h)){v.height(size.height-(linb.browser.ie6?2:linb.browser.ie?1:linb.browser.kde?1:0));c.height(size.height);if(s){s.height(size.height)}}}}});Class("linb.UI.Group",["linb.UI.Widget","linb.UI.iForm"],{Instance:{activate:function(){var profile=this.get(0);profile.getSubNode("LEGEND").focus();return this}},Initialize:function(){var t=this.getTemplate("default");_.merge(t.FRAME.BORDER,{FIELDSET:{tagName:"fieldset",LEGEND:{tagName:"legend",ICON:{style:"background:url({icon}) transparent  no-repeat {iconPos};{iconDisplay}",$order:0},CAPTION:{tagName:"a",href:"javascript:;",tabindex:"{tabindex}",text:"{caption}",$order:1}}},PANEL:{$order:1,tagName:"div",text:linb.UI.$childTag}},"all");this.setTemplate("default",t)},Static:{Dropable:["PANEL"],Appearances:{"default":{FIELDSET:{border:"1px solid #CCCCCC","background-color":"#fff",position:"relative"},PANEL:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"auto"},LEGEND:{"margin-left":"3px"},CAPTION:{"font-family":'"Verdana", "Helvetica", "sans-serif"',"font-size":"12px","line-height":"18px"},ICON:{width:"16px",height:"16px","vertical-align":"middle",margin:"0 4px 0 0"}}},EventHandlers:{beforeValueSet:null,afterValueSet:null,beforeValueUpdated:null,afterValueUpdated:null,beforeHoverEffect:null,beforeClickEffect:null,beforeNextFocus:null},DataModel:{width:100,height:100,tabindex:{action:function(value){if(this.domNode){this.getSubNode("CAPTION").tabIndex(value)}}},$border:1},Behaviors:{"default":{_focusHook:{CAPTION:1}}},resize:function(profile,w,h){var size=arguments.callee.upper.apply(this,arguments),t,v=profile.getSubNode("FIELDSET"),p=profile.getSubNode("PANEL");if(!_.isNull(w)){v.width(t=(size.width-2));p.width(t)}if(!_.isNull(h)){v.height(t=(size.height-2));p.top(20).height(t-20)}}}});Class("linb.UI.ColorPicker","linb.UI.iWidget",{Instance:{setCtrlValue:function(value){return this.each(function(profile){if(!profile.domNode){return }var cls=profile.box,p=profile.properties,v=cls.ensureV(value),hex=cls._to3(v),rgb=cls.hex2rgb(v),hsv=cls.rgb2hsv(rgb),f=function(s,v){profile.getSubNode(s).get(0).firstChild.nodeValue=String(v)},ff=function(v){return Math.round(v*100)};f("R",rgb[0]);f("G",rgb[1]);f("B",rgb[2]);f("HH",hsv[0]);f("S",ff(hsv[1]));f("V",ff(hsv[2]));f("H",hex[0]);f("E",hex[1]);f("X",hex[2]);cls._reExamShow(profile)})}},Initialize:function(){var ns=this,e=linb.event.eventhandler,id=linb.UI.$ID,cls=linb.UI.$CLS,key=ns.KEY,list=ns._slist,l=list.length,i,data,arr=[],evs=' unselectable="on" onmousedown="'+e+'" ondrag="'+e+'" ondragstop="'+e+'" ';ns.mapKeys(["TXT","DD1","DD2","DD3","R","G","B","HH","S","V","H","E","X"]);for(i=0;i<l;i++){arr.push('<a  id="'+key+"-SC:"+id+":"+list[i]+'" href="javascript:;" onmouseover="'+e+'"  onkeydown="'+e+'" onclick="'+e+'" style="background-color:#'+list[i]+'">'+list[i]+"</a>")}data='<div><span class="'+cls+'-txt">R: </span><span id="'+key+"-R:"+id+':" class="'+cls+'-dd2 #DD2_CC#" '+evs+'>R</span><span style="width:8px;height:8px"  unselectable="on" ></span><span class="'+cls+'-txt">H: </span><span id="'+key+"-HH:"+id+':" class="'+cls+'-dd2 #DD2_CC#" '+evs+'>H</span><span>\xB0</span></div><div><span class="'+cls+'-txt">G: </span><span id="'+key+"-G:"+id+':" class="'+cls+'-dd2 #DD2_CC#" '+evs+'>G</span><span style="width:8px;height:8px"  unselectable="on" ></span><span class="'+cls+'-txt">S: </span><span id="'+key+"-S:"+id+':" class="'+cls+'-dd2 #DD2_CC#"  '+evs+'>S</span><span>%</span></div><div><span class="'+cls+'-txt">B: </span><span id="'+key+"-B:"+id+':" class="'+cls+'-dd2 #DD2_CC#" '+evs+'>B</span><span style="width:8px;height:8px"  unselectable="on" ></span><span class="'+cls+'-txt">V: </span><span id="'+key+"-V:"+id+':" class="'+cls+'-dd2 #DD2_CC#" '+evs+'>V</span><span>%</span></div><div><span style="width:38px">HEX: #</span><span id="'+key+"-H:"+id+':" class="'+cls+'-dd3 #DD3_CC#" '+evs+'>H</span><span id="'+key+"-E:"+id+':" class="'+cls+'-dd3 #DD3_CC#" '+evs+'>E</span><span id="'+key+"-X:"+id+':" class="'+cls+'-dd1 #DD1_CC#" '+evs+">X</span></div>";ns.setTemplate("default",{style:"{_style}",tagName:"div",TOP:{$order:0,tagName:"div",DATA:{$order:0,tagName:"div",onselectstart:"return false",text:data},EXAM:{$order:1,tagName:"div"}},SIMPLE:{$order:1,tagName:"div",text:arr.join("")}})},Static:{cssNone:false,DataModel:{value:"FFFFFF",colorName:"#FFFFFF",handleHeight:22,tipsHeight:16,headHeight:20,closeBtn:{ini:true,action:function(v){this.getSubNode("CLOSE").display(v?"":"none")}},$borderW:1},Appearances:{"default":{KEY:{background:"#FFF","-moz-user-select":linb.browser.gek?"none":null},DATA:{"float":"left",width:"112px",height:"86px"},"DATA span":{"float":"left"},"DATA div":{"padding-top":"3px",clear:"both"},TXT:{width:"16px"},EXAM:{"float":"left",height:"80px",width:"80px",background:"red","padding-top":"2px","white-space":"wrap","text-align":"center"},"DD1, DD2, DD3":{display:"block",height:"16px",border:"1px solid #7F9DB9","padding-right":"2px",cursor:"e-resize","text-align":"right",background:"#FFFACD"},DD1:{width:"16px",border:"1px solid #7F9DB9"},DD2:{width:"24px",border:"1px solid #7F9DB9"},DD3:{$order:2,width:"16px","border-right":"none"},SIMPLE:{width:"192px",overflow:"hidden",padding:"4px 0 0 5px","line-height":linb.browser.ie6?"0":null,clear:"both"},"SIMPLE a":{height:"9px",width:"9px","font-size":linb.browser.ie6?"0":null,"float":"left",display:"block",overflow:"hidden","text-indent":"100px",margin:"0",cursor:"pointer",border:"1px solid #F6F7EE"},"SIMPLE a:hover":{border:"1px solid black"}}},Behaviors:{"default":{SC:{onMouseover:function(p,e,s){p.box._setTempUI(p,p.getSubSerialId(s.id))},onClick:function(p,e,s){var sid=p.getSubSerialId(s.id);p.box._updateUIValue(p,sid);return false}},SIMPLE:{onMouseout:function(p,e,s){p.box._reExamShow(p)}},R:{onMousedown:function(p,e,src){p.box._rgbdd1(p,e,src)},onDrag:function(p,e,src){p.box._rgbdd2(p,e,src,0)},onDragstop:function(p,e,src){p.box._rgbdd3(p,e,src,0)}},G:{onMousedown:function(p,e,src){p.box._rgbdd1(p,e,src)},onDrag:function(p,e,src){p.box._rgbdd2(p,e,src,1)},onDragstop:function(p,e,src){p.box._rgbdd3(p,e,src,1)}},B:{onMousedown:function(p,e,src){p.box._rgbdd1(p,e,src)},onDrag:function(p,e,src){p.box._rgbdd2(p,e,src,2)},onDragstop:function(p,e,src){p.box._rgbdd3(p,e,src,2)}},H:{},S:{},V:{},H:{},E:{},X:{}}},prepareData:function(profile){var ns=this;arguments.callee.upper.call(ns,profile)},_slist:"FFFFFF,FFFFF0,FFFFE0,FFFF00,FFFAFA,FFFAF0,FFFACD,FFF8DC,FFF5EE,FFF0F5,FFEFD5,FFEBCD,FFE4E1,FFE4C4,FFE4B5,FFDEAD,FFDAB9,FFD700,FFC0CB,FFB6C1,FFA500,FFA07A,FF8C00,FF7F50,FF69B4,FF6347,FF4500,FF1493,FF00FF,FF00FF,FF0000,FDF5E6,FAFAD2,FAF0E6,FAEBD7,FA8072,F8F8FF,F5FFFA,F5F5F5,F5DEB3,F4A460,F0FFFF,F0FFF0,F0F8FF,F0E68C,F08080,EEE8AA,EE82EE,E9967A,E6E6FA,E1FFFF,DEB887,DDA0DD,DCDCDC,DC143C,DB7093,DAA520,DA70D6,D8BFD8,D3D3D3,D2B48C,D2691E,CD853F,CD5C5C,C71585,C0C0C0,BDB76B,BC8F8F,BA55D3,B22222,B0E0E6,B0C4DE,AFEEEE,ADFF2F,ADD8E6,A9A9A9,A52A2A,A0522D,9932CC,98FB98,9400D3,9370DB,90EE90,8FBC8F,8B4513,8B008B,8B0000,8A2BE2,87CEFA,87CEEB,808080,808000,800080,800000,7FFFAA,7FFF00,7CFC00,7B68EE,778899,708090,6B8E23,6A5ACD,696969,6495ED,5F9EA0,556B2F,4B0082,48D1CC,483D8B,4682B4,4169E1,40E0D0,3CB371,32CD32,2F4F4F,2E8B57,228B22,20B2AA,1E90FF,191970,00FFFF,00FFFF,00FF7F,00FF00,00FA9A,00CED1,00BFFF,008B8B,008080,008000,006400,0000FF,0000CD,00008B,000080,000000".split(","),C16:"0123456789ABCDEF",_rgbdd1:function(profile,e,src){var p=profile.properties,cls=profile.box,f=function(){return cls.hex2rgb(p.$UIvalue)};linb([src]).setStyle("background","red").startDrag(e,{type:"blank",move:false,grid_width:2,cursor:true});profile.$temp=0;profile.$start=f();profile.$temp2=f()},_rgbdd2:function(profile,e,src,i){var count,off=linb.dragDrop.getOffset(),p=profile.properties,old=profile.$temp2,cls=profile.box,v;count=parseInt(profile.$start[i])+parseInt(off.x/2);count=(count%256+256)%256;if(profile.$temp!=count){old[i]=profile.$temp=count;linb([src]).text(count);v=cls.rgb2hex(old);cls._setTempUI(profile,v)}},_rgbdd3:function(profile,e,src,i){if(profile.$start[i]!==profile.$temp){var p=profile.properties,cls=profile.box,old=profile.$start,v;old[i]=profile.$temp;v=cls.rgb2hex(old);cls._updateUIValue(profile,v);cls._reExamShow(profile)}linb([src]).setStyle("background","");profile.$temp=profile.$start=0},_setTempUI:function(p,v){var cls=this,rgb=cls.hex2rgb(v),b=p.boxing(),ex=b.getSubNode("EXAM"),hsv=cls.rgb2hsv(rgb),vv=linb.getRes("color.SIMPLE."+v);ex.setStyle({backgroundColor:"#"+v,color:hsv[2]>0.6?"#000":"#FFF"});ex.text(vv==v?"#"+v:vv)},_updateUIValue:function(profile,v){var p=profile.properties,cls=this,b=profile.boxing(),vv=linb.getRes("color.SIMPLE."+v);b.updateUIValue(v,true);p.colorName=vv==v?"#"+v:vv},_reExamShow:function(p){var cls=p.box,ex=p.boxing().getSubNode("EXAM"),pro=p.properties,sid=pro.$UIvalue,rgb=cls.hex2rgb(sid),hsv=cls.rgb2hsv(rgb);ex.setStyle({backgroundColor:"#"+sid,color:hsv[2]>0.6?"#000":"#FFF"});ex.text(pro.colorName)},_to3:function(s){if(!s){s="FFFFFF"}return[s.substr(0,2),s.substr(2,2),s.substr(4,2)]},_toFF:function(n){var C16=this.C16;n=parseInt(n)||0;n=(n>255||n<0)?0:n;return C16.charAt((n-n%16)/16)+C16.charAt(n%16)},_to255:function(str){var C16=this.C16,s=str.split("");return C16.indexOf(s[0].toUpperCase())*16+C16.indexOf(s[1].toUpperCase())},_webSafe:function(r,g,b){var me=arguments.callee,f=me.f||(me.f=function(n){return Math.round(n/51)*51});if(typeof r=="object"){g=r[1];b=r[2];r=r[0]}return[f(r),f(g),f(b)]},ensureV:function(v){var ns=this,me=arguments.callee,map=me.map||(me.map=(function(){var h={};ns.C16.split("").each(function(o,i){h[o]=1});return h}()));if(!v||typeof v!="string"){return"FFFFFF"}if(v.charAt(0)=="#"){v=v.substr(1,v.length)}var a="",k;for(var i=0;i<6;i++){k=v.charAt(i).toUpperCase();a+=(map[k]?k:"F")}return a},hsv2rgb:function(h,s,v){var me=arguments.callee,f=me.f||(me.f=function(n){return Math.min(255,Math.round(n*256))}),r,g,b,i,k,p,q,t;if(typeof r=="object"){s=h[1];v=h[2];h=h[0]}i=Math.floor((h/60)%6);k=(h/60)-i;p=v*(1-s);q=v*(1-k*s);t=v*(1-(1-k)*s);switch(i){case 0:r=v;g=t;b=p;break;case 1:r=q;g=v;b=p;break;case 2:r=p;g=v;b=t;break;case 3:r=p;g=q;b=v;break;case 4:r=t;g=p;b=v;break;case 5:r=v;g=p;b=q;break}return[f(r),f(g),f(b)]},rgb2hsv:function(r,g,b){if(typeof r=="object"){g=r[1];b=r[2];r=r[0]}r=r/255;g=g/255;b=b/255;var min,max,delta,h,s,v;min=Math.min(Math.min(r,g),b);max=Math.max(Math.max(r,g),b);delta=max-min;switch(max){case min:h=0;break;case r:h=60*(g-b)/delta;if(g<b){h+=360}break;case g:h=(60*(b-r)/delta)+120;break;case b:h=(60*(r-g)/delta)+240;break}s=(max===0)?0:1-(min/max);return[Math.round(h),s,max]},rgb2hex:function(r,g,b){var ns=this;if(typeof r=="object"){g=r[1];b=r[2];r=r[0]}return ns._toFF(r)+ns._toFF(g)+ns._toFF(b)},hex2rgb:function(s){var ns=this;if(!s){s="FFFFFF"}return[ns._to255(s.substr(0,2)),ns._to255(s.substr(2,2)),ns._to255(s.substr(4,2))]}}});Class("linb.UI.DatePicker","linb.UI.iWidget",{Dependency:["linb.date"],Instance:{setCtrlValue:function(value){return this.each(function(profile){if(!profile.domNode){return }var cls=profile.box,p=profile.properties,date=linb.date,mfirst=date.getRoundDown(value,"m");cls._to(profile,mfirst,value);if(profile.keys.CAPTION){profile.getSubNode("CAPTION").html(date.getText(value,"ymd",p.firstDayOfWeek),false)}})}},Initialize:function(){var self=this,e=linb.event.eventhandler,id=linb.UI.$ID,cls=linb.UI.$CLS,cls2=linb.UI.$CLS+"-td-free",key=self.KEY;self.mapKeys(["H","W","TD"]);var colgroup='<colgroup><col width="2%"/><col width="14%"/><col width="14%"/><col width="14%"/><col width="14%"/><col width="14%"/><col width="14%"/><col width="14%"/></colgroup>',thead1='<thead><tr height="1%"><th id="'+key+"-H:"+id+':7" class="'+cls+'-h #H_CC#"></th>',thead2="</tr></thead>",th='<th id="'+key+"-H:"+id+':@" class="'+cls+'-h #H_CC#">@</th>',tbody1="<tbody>",tbody2="</tbody>",tr1="<tr>",tr2="</tr>",td1='<th id="'+key+"-W:"+id+':@"  class="'+cls+'-w #W_CC#">@</th>',td2='<td id="'+key+"-TD:"+id+':@" class="'+cls+'-td ! #TD_CC#"  unselectable="on" onmouseover="'+e+'" onmouseout="'+e+'" onclick="'+e+'" ></td>',body,i,j,k,l,a=[],b=[];for(i=0;i<7;i++){b[b.length]=th.replace(/@/g,i)}k=l=0;for(i=0;i<48;i++){j=i%8;a[a.length]=(j==0?tr1:"")+(j==0?td1:td2).replace(/@/g,j==0?l:k).replace("!",(j==1||j==7)?cls2:"")+(j==7?tr2:"");if(j!==0){k++}else{l++}}body=colgroup+thead1+b.join("")+thead2+tbody1+a.join("")+tbody2;self.setTemplate("default",{tagName:"div",style:"{_style}",onselectstart:"return false",BORDER:{tagName:"div",BAR:{$order:0,style:"height:{handleHeight}px;",tagName:"div",CMDS:{tagName:"div",PRE2:{$order:0},PRE:{$order:1},YEAR:{$order:2,unselectable:"on"},YTXT:{$order:3,style:"display:inline"},MONTH:{$order:4,unselectable:"on"},MTXT:{$order:5,style:"display:inline"},NEXT:{$order:6},NEXT2:{$order:7}},CMDS2:{CLOSE:{style:"{closeDisplay}"}}},BODY:{$order:1,tagName:"table",cellpadding:"0",cellspacing:"0",width:"100%",text:body},TIPS:{$order:2,style:"height:{tipsHeight}px;",tagName:"div",CAPTION:{text:"{caption}",$order:1}}}})},Static:{Appearances:{"default":{KEY:{overflow:"visible",background:"#FFF","-moz-user-select":linb.browser.gek?"none":null},BORDER:{overflow:"visible",position:"relative","border-top":"solid 1px #C1C1C1","border-left":"solid 1px #C1C1C1"},"BAR,BODY,TIPS":{position:"relative"},BAR:{"white-space":"nowrap",background:linb.UI.getCSSImgPara("barvbg.gif"," repeat-x left top",null,"linb.UI.Public"),"border-right":"solid 1px #C1C1C1"},TIPS:{"white-space":"nowrap","text-align":"center",border:"solid #C1C1C1","border-width":"0 1px 1px 0"},"CMDS, CMDS2":{position:"relative",height:"100%","vertical-align":"middle"},CMDS:{"float":"left","padding-left":"4px"},CMDS2:{"float":"right"},"PRE,PRE2,NEXT,NEXT2,CLOSE":{$order:0,position:"relative",margin:"2px",width:"15px",height:"15px","vertical-align":"middle",cursor:"default"},PRE:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat  0 -65px",null,"linb.UI.Public")},"PRE-mouseover":{$order:2,"background-position":"0 -80px"},"PRE-mousedown":{$order:3,"background-position":"0 -95px"},PRE2:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat  -61px -65px",null,"linb.UI.Public")},"PRE2-mouseover":{$order:2,"background-position":"-61px -80px"},"PRE2-mousedown":{$order:3,"background-position":"-61px -95px"},NEXT:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat  -16px -65px",null,"linb.UI.Public")},"NEXT-mouseover":{$order:2,"background-position":"-16px -80px"},"NEXT-mousedown":{$order:3,"background-position":"-16px -95px"},NEXT2:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat  -76px -65px",null,"linb.UI.Public")},"NEXT2-mouseover":{$order:2,"background-position":"-76px -80px"},"NEXT2-mousedown":{$order:3,"background-position":"-76px -95px"},"YEAR,MONTH":{$order:4,margin:"2px",height:"15px","font-weight":"bold",border:"1px solid #7F9DB9","background-color":"#FFFACD","padding-left":"2px",cursor:"e-resize"},YEAR:{width:"32px"},MONTH:{width:"16px"},CAPTION:{},CLOSE:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -64px 0",null,"linb.UI.Public")},"CLOSE-mouseover":{$order:1,"background-position":"-64px -16px"},"CLOSE-mousedown":{$order:2,"background-position":"-64px -32px"},BODY:{overflow:"visible"},"BODY td,BODY th":{$order:1,border:0,"border-right":"solid 1px #C1C1C1","border-bottom":"solid 1px #C1C1C1"},"TD .exday":{color:"#C1C1C1"},TD:{"text-align":"center","background-color":"#FFFACD"},"TD-free":{$order:1,"text-align":"center","background-color":"#FFF"},"TD-mouseover":{$order:3,"background-color":"#d9e8fb"},"TD-checked":{$order:4,"background-color":"#316AC5","font-weight":"bold",color:"#fff"},"W,H":{$order:3,color:"#333333","background-color":"#E8EEF7","vertical-align":"middle","text-align":"center"}}},Behaviors:{"default":{_hoverEffect:{CLOSE:"CLOSE",TD:"TD",PRE:"PRE",PRE2:"PRE2",NEXT:"NEXT",NEXT2:"NEXT2"},_clickEffect:{CLOSE:"CLOSE",TD:"TD",PRE:"PRE",PRE2:"PRE2",NEXT:"NEXT",NEXT2:"NEXT2"},TD:{onClick:function(profile,e,src){var p=profile.properties,id=profile.getSubSerialId(src.id),map=profile.$daymap,v=map[id];if(p.disabled){return false}linb([src]).onMouseout(true,{$force:true});profile.boxing().updateUIValue(v)}},CLOSE:{onClick:function(profile,e,src){var properties=profile.properties;if(properties.disabled){return }var instance=profile.boxing();if(false===instance.beforeClose(profile,src)){return }instance.destroy();return false}},PRE:{onClick:function(profile,e,src){var p=profile.properties;if(p.disabled){return }profile.box._to(profile,linb.date.add(profile.$mfirst,"m",-1,p.firstDayOfWeek))}},NEXT:{onClick:function(profile,e,src){var p=profile.properties;if(p.disabled){return }profile.box._to(profile,linb.date.add(profile.$mfirst,"m",1,p.firstDayOfWeek))}},PRE2:{onClick:function(profile,e,src){var p=profile.properties;if(p.disabled){return }profile.box._to(profile,linb.date.add(profile.$mfirst,"y",-1,p.firstDayOfWeek))}},NEXT2:{onClick:function(profile,e,src){var p=profile.properties;if(p.disabled){return }profile.box._to(profile,linb.date.add(profile.$mfirst,"y",1,p.firstDayOfWeek))}},YEAR:{onMousedown:function(profile,e,src){linb(src).startDrag(e,{type:"blank",move:false,grid_width:20,cursor:true});profile.$temp=profile.$temp2=0},onDrag:function(profile,e,src){var count,off=linb.dragDrop.getOffset();count=parseInt(profile.$year)+(profile.$temp2=parseInt(off.x/20));if(profile.$temp!=count){profile.$temp=count;profile.getSubNode("YEAR").html(count,false)}},onDragstop:function(profile,e,src){if(profile.$temp2){var p=profile.properties,v=linb.date.add(profile.$mfirst,"y",profile.$temp2,p.firstDayOfWeek);profile.box._to(profile,linb.date.getRoundDown(v,"m"))}profile.$temp=profile.$temp2=0}},MONTH:{onMousedown:function(profile,e,src){linb(src).startDrag(e,{type:"blank",move:false,grid_width:20,cursor:true});profile.$temp=profile.$temp2=0},onDrag:function(profile,e,src){var count,off=linb.dragDrop.getOffset();count=parseInt(profile.$month)+(parseInt(off.x/20)%12);count=(count%12+12)%12;if(profile.$temp!=count){profile.$temp=count;profile.$temp2=count-profile.$month+1;profile.getSubNode("MONTH").html(count+1,false)}},onDragstop:function(profile,e,src){if(profile.$temp2){var p=profile.properties,v=linb.date.add(profile.$mfirst,"m",profile.$temp2,p.firstDayOfWeek);profile.box._to(profile,linb.date.getRoundDown(v,"m"))}profile.$temp=profile.$temp2=0}}}},DataModel:{height:152,width:200,value:new Date,handleHeight:22,tipsHeight:16,headHeight:20,closeBtn:{ini:true,action:function(v){this.getSubNode("CLOSE").display(v?"":"none")}},firstDayOfWeek:0,$borderW:1},EventHandlers:{beforeClose:function(profile,src){},onSelect:function(profile,src){}},prepareData:function(profile){arguments.callee.upper.call(this,profile);var data=profile.data,nodisplay="display:none";data.closeDisplay=data.closeBtn?"":nodisplay},createdTrigger:function(){var self=this,p=self.properties,o=self.boxing(),b=self.box;b._setWeekLabel(self);self.getSubNode("YTXT").html(linb.wrapRes("date.Y"),false);self.getSubNode("MTXT").html(linb.wrapRes("date.M"),false)},_getWeekNodes:function(profile){return profile.$week||(profile.$week=profile.getSubNode("W",true))},_getTDNodes:function(profile){return profile.$tds||(profile.$tds=profile.getSubNode("TD",true))},_getDayNodes:function(profile){return profile.$day||(profile.$day=profile.getSubNode("TD",true))},_getHeaderNodes:function(profile){return profile.$header||(profile.$header=profile.getSubNode("H",true))},_setWeekLabel:function(profile){var o=linb.date,f=profile.getSubSerialId;profile.box._getHeaderNodes(profile).each(function(node,i){node.innerHTML=linb.wrapRes("date.WEEKS."+f(node.id))})},_setBGV:function(profile,v,m){var date=linb.date,p=profile.properties,daymap=profile.$daymap||(profile.$daymap=[]),t,n,fd=p.firstDayOfWeek;profile.box._getDayNodes(profile).each(function(node,i){n=date.add(v,"d",i,fd);daymap[i]=n;t=date.get(n,"m",fd)==m?"#":'<p class="exday">#</p>';n=date.get(n,"d",fd);node.innerHTML=t.replace("#",n)});profile.box._getWeekNodes(profile).each(function(node,i){node.innerHTML=date.get(date.add(v,"ww",i,fd),"ww",fd)})},_to:function(profile,mfirst,value){var p=profile.properties,fd=p.firstDayOfWeek,date=linb.date,keys=profile.keys,uiv=value||p.$UIvalue,md=date.get(uiv,"m",fd)+"-"+date.get(uiv,"d",fd),ym1=date.get(uiv,"y",fd)+"-"+date.get(uiv,"m",fd),ym2=date.get(mfirst,"y",fd)+"-"+date.get(mfirst,"m",fd),index=-1,node,temp,_realstart=date.getRoundDown(date.getRoundDown(mfirst,"m"),"ww",1,fd),m=date.get(mfirst,"m",fd);profile.$mfirst=mfirst;this._setBGV(profile,_realstart,m);if(profile.$selnode){profile.removeTagClass("TD","-checked",profile.$selnode)}if(ym1==ym2){profile.$daymap.each(function(o,i){if(date.get(o,"m",fd)+"-"+date.get(o,"d",fd)==md){index=i;return false}});node=this._getTDNodes(profile).get()[index];profile.addTagClass("TD","-checked",profile.$selnode=linb([node]))}if(keys.YEAR){temp=date.get(mfirst,"y",fd);if(profile.$year!=temp){profile.$year=temp;profile.getSubNode("YEAR").html(temp,false)}}if(keys.MONTH){temp=date.get(mfirst,"m",fd)+1;if(profile.$month!=temp){profile.$month=temp;profile.getSubNode("MONTH").html(temp,false)}}}}});Class("linb.UI.TimePicker","linb.UI.iWidget",{Dependency:["linb.date"],Instance:{setCtrlValue:function(value){return this.each(function(profile){if(!profile.domNode){return }var instance=profile.boxing(),cls=profile.box,p=profile.properties,uiv=p.$UIvalue,arr1=cls.ensureV(uiv),arr2=cls.ensureV(value),id=profile.serialId,keys=profile.keys,byId=linb.dom.byId;profile.$hour=arr2[0];if(arr1[1]){cls._uncheck(byId(profile.getNodeId(keys.MI,id,arr1[1])))}cls._check(byId(profile.getNodeId(keys.MI,id,arr2[1])));profile.getSubNode("HOUR").html(arr2[0],false);profile.getSubNode("CAPTION").html(profile.box._showV(profile,profile.box.ensureV(arr2)),false)})},setValue:function(value,flag){var upper=arguments.callee.upper;return this.each(function(profile){var box=profile.box;upper.apply(profile.boxing(),[box.formatValue(value),flag])})}},Initialize:function(){this.mapKeys(["MI"]);var a=[],cls=this._excls,cls2=this._excls2,id=linb.UI.$ID,e=linb.event.eventhandler,t='<span id="'+this.KEY+"-MI:"+id+':@" class="'+cls+' !" onmouseover="'+e+'" onmouseout="'+e+'" onclick="'+e+'"   unselectable="on" >@</span>',i,m;for(i=0;i<60;i++){a[a.length]=t.replace(/@/g,i<10?"0"+i:i).replace("!",(i%5===0)?cls2:"")}m=a.join("");a.length=0;this.setTemplate("default",{tagName:"div",onselectstart:"return false",style:"{_style}",BORDER:{tagName:"div",BAR:{$order:0,tagName:"div",CMDS:{tagName:"div",PRE:{$order:0},HOUR:{$order:1,unselectable:"on"},HOURTXT:{$order:2,style:"display:inline"},NEXT:{$order:3}},CMDS2:{CLOSE:{style:"{closeDisplay}"}}},M:{$order:1,tagName:"div",text:m},TAIL:{$order:2,style:"height:{tipsHeight}px;",tagName:"div",CAPTION:{text:"{caption}",$order:1}}}})},Static:{_excls:"linbex-timepicker",_excls2:"linbex-timepicker2",_excls_mo:"linbex-timepicker-mouseover",_excls_c:"linbex-timepicker-checked",_mover:function(src){var b=this,cn=src.className;if(cn.indexOf(b._excls_mo)==-1){src.className=cn+" "+b._excls_mo}},_mout:function(src){var b=this,cn=src.className;if(cn.indexOf(b._excls_mo)!=-1){src.className=cn.replace(b._excls_mo,"")}},_check:function(src){var b=this,cn=src.className;if(cn.indexOf(b._excls_c)==-1){src.className=cn+" "+b._excls_c}b._mout(src)},_uncheck:function(src){var b=this,cn=src.className;if(cn.indexOf(b._excls_c)!=-1){src.className=cn.replace(b._excls_c,"")}},Appearances:{"default":{KEY:{background:"#FFF","-moz-user-select":linb.browser.gek?"none":null},"BAR,CON":{position:"relative"},BAR:{"white-space":"nowrap",background:linb.UI.getCSSImgPara("barvbg.gif"," repeat-x left top",null,"linb.UI.Public"),height:"22px","text-align":"center",border:"solid #C1C1C1","border-width":"1px 1px 0 1px"},"CMDS, CMDS2":{position:"relative",height:"100%","vertical-align":"middle"},CMDS:{"float":"left","padding-left":"4px"},CMDS2:{"float":"right"},PRE:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat  0 -65px",null,"linb.UI.Public")},"PRE-mouseover":{$order:2,"background-position":"0 -80px"},"PRE-mousedown":{$order:3,"background-position":"0 -95px"},NEXT:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat  -16px -65px",null,"linb.UI.Public")},"NEXT-mouseover":{$order:2,"background-position":"-16px -80px"},"NEXT-mousedown":{$order:3,"background-position":"-16px -95px"},HOUR:{$order:3,margin:"2px",height:"15px",width:"16px","font-weight":"bold",border:"1px solid #7F9DB9","background-color":"#FFFACD",cursor:"e-resize","padding-left":"2px"},"PRE, NEXT, CLOSE":{$order:0,position:"relative",margin:"2px",width:"15px",height:"15px","vertical-align":"middle",cursor:"default"},CLOSE:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -64px 0",null,"linb.UI.Public")},"CLOSE-mouseover":{$order:1,"background-position":"-64px -16px"},"CLOSE-mousedown":{$order:2,"background-position":"-64px -32px"},CON:{height:"103px",padding:"2px",border:"1px solid #91A7B4"},M:{position:"relative","border-left":"1px solid #91A7B4","border-top":"1px solid #91A7B4",width:"220px"},TAIL:{"white-space":"nowrap","text-align":"center",border:"solid #C1C1C1","border-width":"0 1px 1px 1px"},".linbex-timepicker2":{"background-color":"#FFFACD"},".linbex-timepicker":{"font-size":"12px","padding-left":"3px",width:"18px",height:"16px","border-right":"1px solid #91A7B4","border-bottom":"1px solid #91A7B4"},".linbex-timepicker-mouseover":{$order:1,"background-color":"#d9e8fb"},".linbex-timepicker-checked":{$order:2,"background-color":"#316AC5",color:"#fff"}}},Behaviors:{"default":{_hoverEffect:{CLOSE:"CLOSE",PRE:"PRE",NEXT:"NEXT"},_clickEffect:{CLOSE:"CLOSE",PRE:"PRE",NEXT:"NEXT"},HOUR:{onMousedown:function(profile,e,src){linb(src).startDrag(e,{type:"blank",move:false,grid_width:5,cursor:true});profile.$temp2=0},onDrag:function(profile,e,src){var count,off=linb.dragDrop.getOffset(),v=profile.properties.$UIvalue,a=v.split(":");a[0]=(parseFloat(a[0])||0)+parseInt(off.x/10);a[0]=(a[0]%24+24)%24;profile.$temp2=(a[0]<=9?"0":"")+a[0];if(v[0]!=profile.$temp2){profile.getSubNode("HOUR").html(profile.$temp2,false)}},onDragstop:function(profile,e,src){if(profile.$temp2){profile.$hour=profile.$temp2}profile.$temp2=0}},MI:{onMouseover:function(profile,e,src){profile.box._mover(src)},onMouseout:function(profile,e,src){profile.box._mout(src)},onClick:function(profile,e,src){var a=[];a[0]=profile.$hour;a[1]=profile.getSubSerialId(src.id);profile.boxing().updateUIValue(a.join(":"),true)}},PRE:{onClick:function(profile,e,src){var p=profile.properties;if(p.disabled){return }var v=profile.$hour;v=(parseFloat(v)||0)-1;v=(v%24+24)%24;profile.$hour=v=(v<=9?"0":"")+v;profile.getSubNode("HOUR").html(v,false)}},NEXT:{onClick:function(profile,e,src){var p=profile.properties;if(p.disabled){return }var v=profile.$hour;v=(parseFloat(v)||0)+1;v=(v%24+24)%24;profile.$hour=v=(v<=9?"0":"")+v;profile.getSubNode("HOUR").html(v,false)}},CLOSE:{onClick:function(profile,e,src){var properties=profile.properties;if(properties.disabled){return }var instance=profile.boxing();if(false===instance.beforeClose(profile,src)){return }instance.destroy();return false}}}},DataModel:{width:221,value:"00:00",tipsHeight:16,closeBtn:{ini:true,action:function(v){this.getSubNode("CLOSE").display(v?"":"none")}}},EventHandlers:{beforeClose:function(profile,src){}},prepareData:function(profile){arguments.callee.upper.call(this,profile);var data=profile.data,nodisplay="display:none";data.closeDisplay=data.closeBtn?"":nodisplay},createdTrigger:function(){this.getSubNode("HOURTXT").html(linb.wrapRes("date.H"),false)},formatValue:function(v){return this.ensureV(v).join(":")},ensureV:function(v){var a,b=[];if(v&&typeof v=="string"){a=v.split(":")}else{if(v&&typeof v=="object"&&v.constructor==Array){a=v}else{a=[]}}b[0]=parseFloat(a[0])||0;b[1]=parseFloat(a[1])||0;if(b[0]<0){b[0]=0}if(b[0]>23){b[0]=23}if(b[1]<0){b[1]=0}if(b[1]>59){b[1]=59}b[0]=(b[0]<=9?"0":"")+b[0];b[1]=(b[1]<=9?"0":"")+b[1];return b},_showV:function(profile,a){var f=profile.CF;if(typeof f.formatCaption=="function"){return f.formatCaption(a)}else{return a.join(":")}}}});Class("linb.UI.TimeLine",["linb.UI.iWidget","linb.UI.iList","linb.UI.iSchedule"],{Dependency:["linb.date"],Instance:{setCtrlValue:function(value){if(!value){return }if(value.indexOf(":")==-1){return }var profile=this.get(0),p=profile.properties,box=this.constructor,a=value.split(":"),start=new Date(parseInt(a[0])),end=new Date(parseInt(a[1])),pxStart=box._getX(profile,start),pxEnd=box._getX(profile,end),task;if(p.items.length===0){this.insertItems([{id:"$",caption:p.dftCaption,start:start,end:end}],null,true)}else{box._resetItem(profile,{left:pxStart,width:pxEnd-pxStart},profile.getSubNodeByItemId("ITEM",p.items[0].id).get(0))}},disabled:function(value){return this.each(function(o){o.getSubNode("VIEW").opacity(value?0.5:1)})},visibleTask:function(){var profile=this.get(0),p=profile.properties,date=linb.date,items=p.items;if(items.length&&!p.multiTasks){target=new Date(items[0].start);if(target<p.dateStart||target>date.add(p.dateStart,"ms",p.width*p._rate)){profile.box._rePosition(profile,-date.diff(p.dateStart,target,"ms")/p._rate+p._band_left)}}},afterInsertItems:function(profile){profile.box._reArrage(profile)},_cache:function(){var profile=this.get(0),cls=this.constructor,picker=cls._picker;if(picker&&picker.domNode){profile.getSubNode("POOL").addLast(picker.root.display("none"))}}},Static:{Dropable:["ITEMS"],cssNone:false,Templates:{"default":{tagName:"div",style:"{_style}",BORDER:{tagName:"div",style:"height:{_bHeight}px;width:{_bWidth}px;",FOCUS:{tagName:"button"},POOL:{tagName:"div",style:"position:absolute;left:0;top:0;width:0;height:0;display:none;"},BAR:{tagName:"div",style:"{_bardisplay};height:{barHeight}px;",CMDS:{tagName:"div",DATE:{$order:0,style:"{dateDisplay}"},PRE:{$order:2},ZOOMIN:{$order:3,style:"{zoomDisplay}"},ZOOMOUT:{$order:4,style:"{zoomDisplay}"},NEXT:{$order:5}},CMDS2:{tagName:"div",OPT:{style:"{optDisplay}",$order:0},CLOSE:{$order:4,style:"{closeDisplay}"}}},BAND:{$order:2,tagName:"div",style:"left:{_band_left}px;width:{_band_width}px;",BIGLABEL:{tagName:"div",style:"height:{bigLabelHeight}px;z-index:3;{_showBigLabel}",text:"{_bigMarks}"},SMALLLABEL:{$order:1,tagName:"div",style:"height:{smallLabelHeight}px;z-index:4;",text:"{_smallMarks}"}},VIEW:{$order:3,tagName:"div",style:"height:{_viewHeight}px;",ITEMS:{tagName:"div",style:"left:{_band_left}px;width:{_band_width}px;",text:"{items}",ACTIVE:{$order:3,tagName:"div"}},SCROLL:{tagName:"div",SCROLLI:{tagName:"div"}}},TIPS:{$order:4,style:"z-index:2;{_tipsdisplay};height:{tipsHeight}px",tagName:"div"}},$dynamic:{_bigMarks:{LABELT:{id:null,className:null,tagName:"div",style:"width:{width}px;left:{left}px;",text:"{text}"}},_smallMarks:{LABELB:{id:null,className:null,tagName:"div",style:"width:{width}px;left:{left}px;",text:"{text}"}},items:{ITEM:{tagName:"div",style:"left:{_left}px;width:{_width}px;{_top};{_height};",MIN:{$order:0,tagName:"div",style:"{_minDisplay}"},NORMAL:{$order:1,tagName:"div",style:"{_normalDisplay};{_height};{_border}",LEFT:{$order:1,tagName:"div"},HEAD:{$order:2,tagName:"div"},CON:{$order:3,tagName:"div",text:"{caption}"},RIGHT:{$order:4,tagName:"div"}}}}}}},Behaviors:{"default":{_hoverEffect:{PRE:"PRE",NEXT:"NEXT",ZOOMIN:"ZOOMIN",ZOOMOUT:"ZOOMOUT",DATE:"DATE",OPT:"OPT",CLOSE:"CLOSE",MIN:"MIN",NORMAL:"NORMAL"},_clickEffect:{PRE:"PRE",NEXT:"NEXT",ZOOMIN:"ZOOMIN",ZOOMOUT:"ZOOMOUT",DATE:"DATE",OPT:"OPT",CLOSE:"CLOSE",MIN:"MIN"},onRewh:function(profile,e,src){var o=profile.domNode.style,f=parseInt,n=null,w=n,h=n;if(e.height){h=f(o.height)||n}if(e.width){w=f(o.width)||n}if(h){profile.box.resize(profile,w,h)}},CLOSE:{onClick:function(profile,e,src){if(profile.properties.disabled){return }var instance=profile.boxing();if(false===instance.beforeClose(profile,src)){return }instance.destroy();return false}},OPT:{onClick:function(profile,e,src){if(profile.properties.disabled){return }profile.boxing().onTriggerOption(profile,e,src)}},onClick:function(profile,e){profile.box._focus(profile)},BAND:{onMousedown:function(profile,e,src){if(profile.pause){return }var t=profile.properties,r=-t._band_left,date=linb.date,rate=t._rate,ep=linb.event.getPos(e),l=t._band_width-r-t.width;if(t._minDate&&t._smallLabelStart<t._minDate){r-=date.diff(t._smallLabelStart,t._minDate,"ms")/rate}if(t._maxDate&&t._smallLabelEnd>t._maxDate){l-=date.diff(t._maxDate,t._smallLabelEnd,"ms")/rate}if(r<0){r=0}if(l<0){l=0}linb([src]).startDrag(e,{move:false,type:"blank",horizontal:true,target_left:ep.left,target_top:ep.top,offset_left:l,offset_right:r})},onDragstop:function(profile,e,src){profile.box._rePosition(profile);profile.box._focus(profile)},onDrag:function(profile,e,src){var ns=profile.box._getMoveNodes(profile),dd=linb.dragDrop;ns.left(profile.properties._band_left+dd.getOffset().x)}},SCROLL:{onMousedown:function(profile,e,src){return false},onScroll:function(profile,e,src){profile.getSubNode("ITEMS").top(-linb([src]).scrollTop())}},ITEMS:{onMouseover:function(profile,e,src){if(linb.dragDrop.working){return }profile.$itemspos=linb([src]).absPos()},onMousemove:function(profile,e){if(linb.dragDrop.working){if(profile.$$ondrag){var d=linb.dragDrop;profile.box._moveActive(profile,profile.$active,d.x-profile.$dd_ox,profile.properties.unitPixs)}}else{var t=profile.properties,date=linb.date,s=t._smallLabelStart,r=t._rate,u=t.timeFormat,p1=linb.event.getPos(e),p2=profile.$itemspos;if(p2&&t.showTips){profile.box._setTips(profile,date.getText(date.add(s,"ms",(p1.left-p2.left)*r),u))}}},onMouseout:function(profile,e,src){if(linb.dragDrop.working){return }if(profile.properties.showTips){profile.box._setTips(profile,"")}},onMousedown:function(profile,e,src){if(profile.properties.disabled||profile.properties.readonly){return }if(profile.pause){return }var o=profile.getSubNode("ACTIVE"),x=linb.event.getPos(e).left;o.setStyle({display:"block",width:"0"}).absPos({left:x,top:null});o.startDrag(e,{type:"none"})},onMouseup:function(profile,e,src){profile.box._focus(profile)}},ACTIVE:{onDragbegin:function(profile,e,src){profile.$dd_ox=linb.dragDrop.x;profile.$task_l=profile.$dd_oleft=parseInt(src.style.left)||0;profile.$task_w=0;linb([src,src.parentNode]).cursor("e-resize")},onDrag:function(profile,e,src){var x=profile.$dd_oleft,ddx=linb.dragDrop.x,w,offset;if((offset=ddx-profile.$dd_ox)>=0){w=offset}else{x=x+offset;w=-offset}profile.box._moveActive(profile,src,profile.$task_l=x,profile.$task_w=w)},onDragstop:function(profile,e,src){profile.box._deActive(profile);linb([src,src.parentNode]).cursor("");var box=profile.box,start=box._getTime(profile,profile.$task_l),end=box._getTime(profile,profile.$task_l+profile.$task_w),p=profile.properties,task,t,b=profile.boxing();if(profile.properties.multiTasks){task={id:_.id(),caption:p.dftCaption,start:start,end:end};if(profile.beoferAddTasks&&false===b.beoferAddTasks(profile,[task])){}else{b.insertItems([task],null,true)}}else{b.updateUIValue(start+":"+end)}profile.$task_l=profile.$task_w=profile.$dd_ox=profile.$dd_oleft=null}},FOCUS:{onFocus:function(profile,e,src){_.resetRun(profile.KEY+":focus",function(){profile.addTagClass("BAR","-focus")})},onBlur:function(profile,e,src){_.resetRun(profile.KEY+":focus",function(){profile.removeTagClass("BAR","-focus")})},onKeydown:function(profile,e,src){if(profile.pause){return }profile.pause=true;var t=profile.properties,date=linb.date,rate=t._rate,maxOffset=30,o=profile.box._getMoveNodes(profile),x=o.left(),xx=t._band_left,off=t._scroll_offset;off=t._scroll_offset=off>maxOffset?off:off*1.05;switch(linb.event.getKey(e)[0]){case"left":case"up":if(t._minDate&&date.add(t.dateStart,"ms",(xx-x-off)*rate)<t._minDate){off=date.diff(t._minDate,t.dateStart,"ms")/rate+(xx-x)}if(off<0){off=0}o.left(x+off);break;case"right":case"down":if(t._maxDate&&date.add(t.dateStart,"ms",(xx-x+off+t.width)*rate)>t._maxDate){off=date.diff(t.dateStart,t._maxDate,"ms")/rate-(xx-x+t.width)}if(off<0){off=0}o.left(x-off);break}if((x+maxOffset>0)||(x+o.width()-t.width-maxOffset<0)){profile.box._rePosition(profile)}profile.pause=false;return false},onKeyup:function(profile,e){var p=profile.properties;p._scroll_offset=p.scrollRateBase;profile.box._rePosition(profile)}},PRE:{onClick:function(profile,e){if(profile.pause){return }var t=profile.properties,date=linb.date,rate=t._rate,o=profile.box._getMoveNodes(profile),x1=t._band_left,x2=0;if(t._minDate&&t._smallLabelStart<t._minDate){x2-=date.diff(t._smallLabelStart,t._minDate,"ms")/rate}profile.pause=true;o.fx({left:[x1,x2]},null,function(){profile.box._rePosition(profile);profile.pause=false},200,Math.max(5,(x2-x1)/100),"inoutsine").start()}},NEXT:{onClick:function(profile,e){if(profile.pause){return }var t=profile.properties,date=linb.date,rate=t._rate,o=profile.box._getMoveNodes(profile),x1=t._band_left,x2=t.width-t._band_width;if(t._maxDate&&t._smallLabelEnd>t._maxDate){x2+=date.diff(t._maxDate,t._smallLabelEnd,"ms")/rate}if(x1>x2){profile.pause=true;o.fx({left:[x1,x2]},null,function(){profile.box._rePosition(profile);profile.pause=false},200,Math.max(5,(x1-x2)/100),"inoutsine").start()}}},ZOOMIN:{onClick:function(profile,e){if(profile.pause){return }var p=profile.properties,box=profile.box,z=box.zoom,index=z.indexOf(p._unitParas),o;if(index>0){profile.pause=true;p.timeSpanKey=z[index-1][0];o=profile.getSubNodes(["VIEW","BAND"]);o.fx({opacity:[1,0.2]},null,function(){profile.boxing().refresh();profile.box._focus(profile);profile.pause=false},200,5,"insine").start()}}},ZOOMOUT:{onClick:function(profile,e){if(profile.pause){return }var p=profile.properties,box=profile.box,z=box.zoom,index=z.indexOf(p._unitParas),o;if(index<z.length-1){profile.pause=true;p.timeSpanKey=z[index+1][0];o=profile.getSubNodes(["VIEW","BAND"]);o.fx({opacity:[1,0.2]},null,function(){profile.boxing().refresh();profile.box._focus(profile);profile.pause=false},200,5,"insine").start()}}},DATE:{onClick:function(profile,e,src){if(profile.pause){return }var cls=profile.box,box=profile.boxing(),start=profile.properties.dateStart,o,node;if(cls._picker&&cls._picker.domNode){o=cls._picker.boxing()}else{o=linb.create("DatePicker");cls._picker=o.get(0);o.beforeClose(function(){this.boxing()._cache();return false}).beforeValueUpdated(function(p,ov,v){var profile=this,obj=profile.getSubNodes(["VIEW","BAND"]),box=profile.boxing();profile.properties.dateStart=v;box.refresh();profile.box._focus(profile);box._cache()})}o.setValue(start,true).host(profile);node=o.reBoxing();node.popToTop(src);node.setBlurTrigger(profile.key+":"+profile.$id,function(){box._cache()});linb.event.hookKey("esc",0,0,0,function(){box._cache();cls._focus(profile);linb.event.hookKey("esc",0,0,0,null)})}},ITEM:{onMousedown:function(profile,e,src){return false},onDragbegin:function(profile,e,src){var t=profile.getItemByDom(src),type=profile.$dd_type,cursor=type?"e-resize":"move",ac=profile.$active;profile.$dd_ox=linb.dragDrop.x;profile.$dd_oleft=parseInt(src.style.left);profile.$dd_owidth=parseInt(src.style.width);linb([ac]).display("block").cssPos({left:profile.$dd_oleft,top:null}).width(profile.$dd_owidth-2);linb([ac,ac.parentNode]).cursor(cursor)},onDrag:function(profile,e,src){var x,w,offset=linb.dragDrop.x-profile.$dd_ox,ddl=profile.$dd_oleft,ddw=profile.$dd_owidth,type=profile.$dd_type;if(type=="left"){if(offset<ddw){x=ddl+offset;w=ddl+ddw-x}else{x=ddl+ddw;w=offset-ddw}}else{if(type=="right"){if(-offset<ddw){x=ddl;w=ddw+offset}else{x=ddl+offset+ddw;w=-offset-ddw}}else{x=ddl+offset;w=ddw}}profile.box._moveActive(profile,profile.$active,x,w)},onDragstop:function(profile,e,src){var box=profile.box,r=profile.box._deActive(profile),ac=profile.$active;if(profile.properties.multiTasks){box._resetItem(profile,r,src)}else{var start=box._getTime(profile,r.left),end=box._getTime(profile,r.left+r.width);profile.boxing().updateUIValue(start+":"+end)}profile.$dd_type=null;linb([ac,ac.parentNode]).cursor("")}},HEAD:{onMousedown:function(profile,e,src){if(profile.properties.disabled||profile.properties.readonly){return }linb([src]).parent(2).startDrag(e,{defer:1,type:"none"})}},LEFT:{onMousedown:function(profile,e,src){if(profile.properties.disabled||profile.properties.readonly){return }profile.$dd_type="left";linb([src]).parent(2).startDrag(e,{defer:1,type:"none"})}},RIGHT:{onMousedown:function(profile,e,src){if(profile.properties.disabled||profile.properties.readonly){return }profile.$dd_type="right";linb([src]).parent(2).startDrag(e,{defer:1,type:"none"})}}}},DataModel:{$borderW:1,readonly:false,width:400,height:200,leftSpanCount:0,rightSpanCount:0,dftCaption:"task",timeSpanKey:{ini:"",action:function(){this.boxing().refresh()}},unitPixs:28,smallLabelCount:2,smallLabelUnit:{ini:"h",listbox:_.toArr(linb.date.TIMEUNIT,true)},bigLabelCount:12,bigLabelUnit:{ini:"h",listbox:_.toArr(linb.date.TIMEUNIT,true)},timeFormat:{ini:"ymdhn",listbox:_.toArr(linb.date.TEXTFORMAT,true)},bigLabelFormat:{ini:"ymdh",listbox:_.toArr(linb.date.TEXTFORMAT,true)},smallLabelFormat:{ini:"h",listbox:_.toArr(linb.date.TEXTFORMAT,true)},showBar:true,barHeight:22,showTips:true,tipsHeight:16,showBigLabel:true,bigLabelHeight:16,smallLabelHeight:14,taskHeight:16,multiTasks:false,minDate:{ini:"",set:function(v){return this.each(function(o){var p=o.properties,k=p._minDate=linb.date.parse(p.minDate=v);if(k>p.dateStart){o.box._rePosition(o,-linb.date.diff(p.dateStart,k,"ms")/p._rate+p._band_left)}})}},maxDate:{ini:"",set:function(v){return this.each(function(o){var p=o.properties,k=p._maxDate=linb.date.parse(p.maxDate=v),t;if(k<(t=linb.date.add(p.dateStart,"ms",p.width*p._rate))){o.box._rePosition(o,-linb.date.diff(t,k,"ms")/p._rate+p._band_left)}})}},dateBtn:true,closeBtn:false,optBtn:false,items:{ini:[]},dateStart:new Date,scrollRateBase:5},EventHandlers:{beforeClose:function(profile,src){},onTriggerOption:function(profile,e,src){},onGetTasks:function(profile,start,end,minMs,type){},beforeChangeTask:function(profile,item){},beoferAddTasks:function(profile,items){},beforeDelTasks:function(profile,arr){}},Appearances:{"default":{KEY:{"background-color":"#fff"},BORDER:{overflow:"hidden",position:"relative",top:"0",border:"solid 1px #505050"},BAR:{position:"relative","z-index":5,background:linb.UI.getCSSImgPara("barvbg.gif"," repeat-x left top",null,"linb.UI.Public")},"BAR-focus":{$order:2,"background-position":"right -22px"},"CMDS, CMDS2":{position:"relative",height:"100%","vertical-align":"middle"},CMDS:{"float":"left","padding-left":"4px"},CMDS2:{"float":"right"},"CMDS span, CMDS2 span":{$order:0,position:"relative",margin:"4px 4px 2px 0",width:"15px",height:"15px","vertical-align":"middle",cursor:"default"},TIPS:{position:"absolute",left:"0",width:"100%",bottom:"0","background-color":"#ECE9D8","border-top":"solid 1px #505050"},FOCUS:{position:"absolute","font-size":"0",width:"1px",height:"1px",left:"0",top:"0","line-height":"0",border:"0"},"BAND, VIEW, BIGLABEL, SMALLLABEL":{position:"relative"},VIEW:{width:linb.browser.ie6?"100%":null,overflow:"hidden"},SCROLL:{"z-index":500,position:"absolute","font-size":"0","line-height":"0",right:0,top:0,height:"100%",width:"18px",overflow:"auto","overflow-x":linb.browser.opr?null:"hidden"},SCROLLI:{height:"1000px",width:"1px"},"BIGLABEL, SMALLLABEL":{"background-color":"#ECE9D8",cursor:"move"},"BIGLABEL,SMALLLABEL":{"border-bottom":"solid 1px #505050"},ITEMS:{position:"relative",background:linb.UI.getCSSImgPara("bars.gif"," left top")},"BIGLABEL div, SMALLLABEL div":{"border-left":"solid 1px #505050","text-align":"center",position:"absolute",cursor:"move",top:0,height:"100%"},"BIGLABEL div":{$order:2,"text-align":"left","padding-left":"4px"},ACTIVE:{"z-index":300,position:"relative","border-left":"1px dashed","border-right":"1px dashed",left:"-100px",width:"0",background:0,height:"100%"},ZOOMIN:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat  -271px top",null,"linb.UI.Public")},"ZOOMIN-mouseover":{$order:2,"background-position":"-271px -16px"},"ZOOMIN-mousedown":{$order:3,"background-position":"-271px -31px"},ZOOMOUT:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat  -256px top",null,"linb.UI.Public")},"ZOOMOUT-mouseover":{$order:2,"background-position":"-256px -16px"},"ZOOMOUT-mousedown":{$order:3,"background-position":"-256px -31px"},DATE:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat  -46px -65px",null,"linb.UI.Public")},"DATE-mouseover":{$order:2,"background-position":" -46px -80px"},"DATE-mousedown":{$order:3,"background-position":" -46px -95px"},MIN:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat  -31px -65px",null,"linb.UI.Public")},PRE:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat  0 -65px",null,"linb.UI.Public"),top:"0"},"PRE-mouseover":{$order:2,"background-position":"0 -80px"},"PRE-mousedown":{$order:3,"background-position":"0 -95px"},NEXT:{position:"absolute",background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat  -16px -65px",null,"linb.UI.Public"),top:"0"},"NEXT-mouseover":{$order:2,"background-position":"-16px -80px"},"NEXT-mousedown":{$order:3,"background-position":"-16px -95px"},CLOSE:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat  -64px 0",null,"linb.UI.Public")},"CLOSE-mouseover":{$order:1,"background-position":"-64px -16px"},"CLOSE-mousedown":{$order:2,"background-position":"-64px -32px"},OPT:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -240px top",null,"linb.UI.Public")},"OPT-mouseover":{$order:2,"background-position":"-240px -16px"},"OPT-mousedown":{$order:3,"background-position":"-240px -32px"},ITEM:{position:"absolute",overflow:"visible"},"MIN, NORMAL":{position:"relative",height:"16px",overflow:"hidden","z-index":"1"},MIN:{width:"16px",background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -30px -80px",null,"linb.UI.Public"),cursor:"pointer"},"MIN-mouseover":{"background-position":"60px -15px"},"MIN-mousedown":{"background-position":"-60px -30px"},NORMAL:{cursor:"pointer","background-color":"#C6D6F7",border:"solid 1px #203A83"},"NORMAL-mouseover":{"border-color":"red"},"NORMAL div":{position:"absolute",top:0,height:"100%"},HEAD:{background:linb.UI.getCSSImgPara("handler.gif"," left top",null,"linb.UI.Public"),width:"6px",left:"3px",cursor:"move"},"LEFT, RIGHT":{width:"2px","z-index":10},LEFT:{cursor:"e-resize",left:0},RIGHT:{cursor:"w-resize","background-color":"#C6D6F7",right:0},CON:{"padding-left":"2px",left:"9px","z-index":1}}},createdTrigger:function(){var self=this,t=self.properties,cls=self.box;cls._setDropable(self);self.$active=self.getSubNode("ACTIVE").get(0);cls._ajustHeight(self)},buildViewItems:function(){var i,t,arr=this.zoom,s="date.VIEWS.",wrap=linb.wrapRes,a=[];for(i=0;i<arr.length;i++){t=arr[i][0];a.push({id:t,caption:wrap(s+t)})}return a},_setDropable:function(profile){var dd=linb.dragDrop,nf=function(){return false};_.merge(profile,{$onDropMarkShow:function(){dd.setDropableIcon("add");return false},$onDropMarkClear:function(){dd.setDropableIcon();return false},$onDragEnter:function(profile,e,src){var t=profile.properties,ep=linb.event.getPos(e),_left=t.unitPixs/2;linb(profile.$active).display("block");profile.$dd_ox=linb([src]).absPos().left+_left;profile.$$ondrag=true},$onDragLeave:function(profile){profile.$$ondrag=profile.$dd_ox=null;profile.box._deActive(profile)},$onDrop:function(profile){profile.$$ondrag=profile.$dd_ox=null;var r=profile.box._deActive(profile),task={id:_.id(),caption:profile.properties.dftCaption},box=profile.box,b=profile.boxing();task.start=box._getTime(profile,r.left);task.end=box._getTime(profile,r.left+r.width);if(profile.beoferAddTasks&&false===b.beoferAddTasks(profile,[task])){}else{b.insertItems([task],null,true)}}},"all")},prepareData:function(profile){var p=profile.properties,d=profile.data,date=linb.date,us=date.TIMEUNIT,nodisplay="display:none",zoom=profile.box.zoom,m=0,u,i,t,label,temp,_date,width,rate,_unitParas,_dateStart,_barCount,_leftBarCount,_rightBarCount,_barCountall,smallMarks,smallLabelStart,smallLabelEnd,smallLabelUnit,smallLabelCount,smallLabelFormat;if(p.minDate){p._minDate=date.parse(p.minDate)}if(p.maxDate){p._maxDate=date.parse(p.maxDate)}d.dateDisplay=p.dateBtn?"":nodisplay;d.closeDisplay=p.closeBtn?"":nodisplay;d.optDisplay=p.optBtn?"":nodisplay;d._showBigLabel=p.showBigLabel?"":nodisplay;p._scroll_offset=p.scrollRateBase;p._lines=[{}];d._bWidth=p.width-2*p.$borderW;d._bHeight=p.height-2*p.$borderW;p._viewHeight=d._bHeight-(p.showTips&&p.tipsHeight)-(p.showBigLabel?p.bigLabelHeight:0)-p.smallLabelHeight-(p.showBar&&p.barHeight);d._tipsdisplay=p.showTips?"":nodisplay;d._bardisplay=p.showBar?"":nodisplay;if(p.timeSpanKey){zoom.each(function(o){if(o[0]===p.timeSpanKey){_unitParas=p._unitParas=o;return false}});if(!_unitParas){_unitParas=p._unitParas=zoom[p.timeSpanKey="1 d"]}}d.zoomDisplay=_unitParas?"":nodisplay;if(_unitParas){p.unitPixs=_unitParas[1];p.smallLabelCount=_unitParas[2];p.smallLabelUnit=_unitParas[3];p.smallLabelFormat=_unitParas[4];p.bigLabelCount=_unitParas[5];p.bigLabelUnit=_unitParas[6];p.bigLabelFormat=_unitParas[7];p.timeFormat=_unitParas[8]}u=p.unitPixs;smallLabelCount=p.smallLabelCount;smallLabelUnit=p.smallLabelUnit;smallLabelFormat=p.smallLabelFormat;_barCount=(Math.ceil(p.width/u)||0);_leftBarCount=p.leftSpanCount?p.leftSpanCount:_barCount;_rightBarCount=p.rightBarCount?p.rightBarCount:_barCount;_barCountall=_barCount+_leftBarCount+_rightBarCount;rate=p._rate=us[smallLabelUnit]*smallLabelCount/u;if(p._maxDate&&date.add(p.dateStart,"ms",p.width*rate)>p._maxDate){p.dateStart=date.add(p._maxDate,"ms",-p.width*rate)}if(p._minDate&&p.dateStart<p._minDate){p.dateStart=p._minDate}_dateStart=date.getRoundDown(p.dateStart,smallLabelUnit,smallLabelCount);smallLabelStart=p._smallLabelStart=date.add(_dateStart,smallLabelUnit,-_leftBarCount*smallLabelCount);smallLabelEnd=p._smallLabelEnd=date.add(smallLabelStart,smallLabelUnit,_barCountall*smallLabelCount);p._band_width=Math.ceil(date.diff(smallLabelStart,smallLabelEnd,"ms")/rate);p._band_left_fix=p._band_left=-Math.ceil(date.diff(smallLabelStart,p.dateStart,"ms")/rate);smallMarks=p._smallMarks=[];temp=0;label=date.get(smallLabelStart,smallLabelFormat);for(i=0;i<_barCountall;i++){_date=date.add(smallLabelStart,smallLabelUnit,smallLabelCount*(i+1));width=Math.ceil(date.diff(smallLabelStart,_date,"ms")/rate);smallMarks.push({left:temp,width:width-temp,text:label});temp=width;label=date.getText(_date,smallLabelFormat)}if(p.showBigLabel){var _barCount2,off,bigMarks,bigLabelStart,bigLabelEnd,bigLabelCount=p.bigLabelCount,bigLabelUnit=p.bigLabelUnit,bigLabelFormat=p.bigLabelFormat;bigMarks=p._bigMarks=[];bigLabelStart=p._bigLabelStart=date.getRoundDown(smallLabelStart,bigLabelUnit,bigLabelCount);bigLabelEnd=p._bigLabelEnd=date.getRoundUp(smallLabelEnd,bigLabelUnit,bigLabelCount);_barCount2=date.diff(bigLabelStart,bigLabelEnd,bigLabelUnit)/bigLabelCount;off=date.diff(smallLabelStart,bigLabelStart,"ms")/rate;label=date.getText(bigLabelStart,bigLabelFormat);temp=0;for(i=0;i<_barCount2;i++){_date=date.add(bigLabelStart,bigLabelUnit,bigLabelCount*(i+1));width=date.diff(bigLabelStart,_date,"ms")/rate;bigMarks.push({left:Math.ceil(temp+off),width:Math.ceil(width-temp),text:label});temp=width;label=date.getText(_date,bigLabelFormat)}}arguments.callee.upper.call(this,profile)},prepareItem:function(profile,item,oitem,pid){var self=this,t=profile.properties,d=profile.data,index;item._min=false;item._left=self._getX(profile,item.start);item._width=Math.max(self._getX(profile,item.end)-item._left,0);if(t.multiTasks){if(item._width<=16){item._width=16;item._min=true}}item._minDisplay=item._min?"":"display:none";item._normalDisplay=item._min?"display:none":"";index=self._getLinePos(profile,item);item._top=t.multiTasks?"top:"+(t.taskHeight+3)*index+"px":"";item._height="height:"+(t.multiTasks?"16px":"100%");item._border=t.multiTasks?"":"border-top:0;border-bottom:0";t._lines=t._lines||[{}];t._lines[index][item.id]=item;item._line=index;oitem._left=item._left;oitem._width=item._width;oitem._min=item._min;oitem._line=item._line},zoom:[["10 ms",54,10,"ms","ms",100,"ms","hnsms","hnsms"],["100 ms",54,100,"ms","ms",1,"s","hns","hnsms"],["1 s",30,1,"s","s",10,"s","hns","hnsms"],["10 s",30,10,"s","s",60,"s","hns","hnsms"],["1 n",30,1,"n","n",10,"n","dhn","hns"],["5 n",30,5,"n","n",30,"n","mdhn","hns"],["10 n",30,10,"n","n",60,"n","mdhn","hns"],["30 n",30,30,"n","n",4,"h","ymdh","mdhn"],["1 h",30,1,"h","h",6,"h","ymdh","mdhn"],["2 h",30,2,"h","h",12,"h","ymdh","mdhn"],["6 h",30,6,"h","h",24,"h","ymd","mdhn"],["1 d",24,1,"d","w",1,"ww","ymd","ymdh"],["1 w",30,1,"ww","ww",4,"ww","ymd","ymd"],["15 d",30,15,"d","d",2,"m","ymd","ymd"],["1 m",30,1,"m","m",1,"q","yq","ymd"],["1 q",30,1,"q","q",1,"y","y","ymd"],["1 y",48,1,"y","y",10,"y","y","ym"],["1 de",48,1,"de","de",100,"y","y","ym"],["1 c",48,1,"c","c",1000,"y","y","y"]],_focus:function(profile){profile.getSubNode("FOCUS").focus(1)},_getTips:function(profile){var t,s="$dd_tooltip";if(t=profile[s]||(profile[s]=profile.getSubNode("TIPS").get(0).childNodes[0])){return t.nodeValue}else{return profile.getSubNode("TIPS").get(0).innerHTML}},_rr:/\<[^>]*\>/g,_setTips:function(profile,text){var t,s="$dd_tooltip";text=text.replace(this._rr,"");if(t=profile[s]||(profile[s]=profile.getSubNode("TIPS").get(0).childNodes[0])){if(t.nodeValue!=text){t.nodeValue=text}}else{profile.getSubNode("TIPS").get(0).innerHTML=text}},_getX:function(profile,time){var t=profile.properties,d=new Date;d.setTime(time);return(Math.ceil(linb.date.diff(t._smallLabelStart,d,"ms")||0)/t._rate)},_getTime:function(profile,x,flag){var t=profile.properties;t=linb.date.add(t._smallLabelStart,"ms",x*t._rate);return flag?t:t.getTime()},_moveActive:function(profile,src,x,w){var p=Math.ceil,t=profile.properties,d=linb.date,s=t._smallLabelStart,r=t._rate,u=t.timeFormat,ms="ms",y=src.style,z="px",m,n;m=(p(x)||0);n=((p(w)||0)-2);if(n>0){y.left=m+z;y.width=n+z;if(t.showTips){profile.box._setTips(profile,d.getText(d.add(s,ms,x*r),u)+" - "+d.getText(d.add(s,ms,(x+w)*r),u))}}},_deActive:function(profile){var t=profile.$active.style,x=parseInt(t.left)||0,w=(parseInt(t.width)||0)+2;t.left="-1000px";if(profile.properties.showTips){profile.box._setTips(profile,"")}return{left:x,width:w}},_minusLeft:function(profile,marks,node,offsetCount){var t=profile.properties;while((offsetCount--)>0){node.first().remove();temp=marks.shift()}},_minusRight:function(profile,marks,node,offsetCount){var t=profile.properties;while((offsetCount--)>0){node.last().remove();temp=marks.pop()}},_addLeft:function(profile,tag,node,offsetCount,offset){var t=profile.properties,date=linb.date,chr="_",key=chr+tag+"Marks",marks=t[key],labelStart=t[chr+tag+"LabelStart"],labelUnit=t[tag+"LabelUnit"],labelCount=t[tag+"LabelCount"],labelFormat=t[tag+"LabelFormat"],rate=t._rate,addLb=[],temp,label,_date,i;temp=0;label=date.getText(labelStart,labelFormat);for(i=0;i<offsetCount;i++){_date=date.add(labelStart,labelUnit,labelCount*(i+1));width=date.diff(labelStart,_date,"ms")/rate;addLb.push({left:Math.ceil(temp+(offset||0)-3e-13),width:Math.ceil(width-temp),text:label});temp=width;label=date.getText(_date,labelFormat)}addLb.reverse();node.addFirst(profile.box.subBuild(profile,key,addLb).toDom());marks.insertAny(addLb.reverse(),0)},_addRight:function(profile,labelEnd,tag,node,offsetCount,offset){var t=profile.properties,date=linb.date,chr="_",key=chr+tag+"Marks",marks=t[key],labelStart=t[chr+tag+"LabelStart"],labelUnit=t[tag+"LabelUnit"],labelCount=t[tag+"LabelCount"],labelFormat=t[tag+"LabelFormat"],rate=t._rate,addLb=[],_d1,_date,i;_d1=labelEnd;for(i=0;i<offsetCount;i++){_date=date.add(labelEnd,labelUnit,labelCount*(i+1));addLb.push({left:Math.ceil(date.diff(labelStart,_d1,"ms")/rate+(offset||0)-3e-13),width:Math.ceil(date.diff(_d1,_date,"ms")/rate),text:date.getText(_d1,labelFormat)});_d1=_date}node.addLast(profile.box.subBuild(profile,key,addLb).toDom());marks.insertAny(addLb,-1)},_getMoveNodes:function(profile){return profile.$moveban=profile.$moveban||profile.getSubNodes(["BAND","ITEMS"])},_rePosition:function(profile,left){profile.pause=true;var self=this,date=linb.date,t=profile.properties,rate=t._rate,label,m,n,labelsBottom=profile.getSubNode("SMALLLABEL"),band=self._getMoveNodes(profile),x=left||band.left(),offset=x-t._band_left_fix;if(Math.abs(offset)/t.unitPixs>=1||left){var offsetCount=parseInt(offset/t.unitPixs),bak_s=t._smallLabelStart,bak_e=t._smallLabelEnd,_c=-offsetCount*t.smallLabelCount,offsetPxs,_smallLabelStart,_smallLabelEnd;_smallLabelStart=t._smallLabelStart=date.add(t._smallLabelStart,t.smallLabelUnit,_c);_smallLabelEnd=t._smallLabelEnd=date.add(t._smallLabelEnd,t.smallLabelUnit,_c);offsetPxs=Math.ceil(date.diff(_smallLabelStart,bak_s,"ms")/rate);band.left(x-offsetPxs);t._band_width=Math.ceil(date.diff(_smallLabelStart,_smallLabelEnd,"ms")/rate);t.items.each(function(o){o._left+=offsetPxs;profile.box._trimTask(profile,o)});labelsBottom.children().each(function(o){o.style.left=(parseFloat(o.style.left)||0)+offsetPxs+"px"});t._smallMarks.each(function(o){o.left+=offsetPxs});if(offsetCount>0){self._minusRight(profile,t._smallMarks,labelsBottom,offsetCount);self._addLeft(profile,"small",labelsBottom,offsetCount)}else{self._minusLeft(profile,t._smallMarks,labelsBottom,-offsetCount);self._addRight(profile,bak_e,"small",labelsBottom,-offsetCount)}if(t.multiTasks){var arr=[];t.items.each(function(o){if(o._left>=t._band_width||(o._left+o._width)<=0){delete t._lines[o._line][o.id];arr.push(o.id)}});profile.boxing().removeItems(arr);if(profile.onGetTasks){profile.boxing().onGetTasks(profile,offsetCount>0?_smallLabelStart:bak_e,offsetCount>0?bak_s:_smallLabelEnd,t._rate,offsetCount>0?"left":"right")}self._reArrage(profile)}if(t.showBigLabel){var labelsTop=profile.getSubNode("BIGLABEL"),bigLabelUnit=t.bigLabelUnit,bigLabelCount=t.bigLabelCount,off,offsetCount2,offsetCount3,bigLabelStart,bigLabelEnd;bak_e=t._bigLabelEnd;labelsTop.children().each(function(o){o.style.left=(parseFloat(o.style.left)||0)+offsetPxs+"px"});t._bigMarks.each(function(o){o.left+=offsetPxs});bigLabelStart=date.getRoundDown(_smallLabelStart,bigLabelUnit,bigLabelCount);offsetCount2=Math.ceil(date.diff(_smallLabelStart,t._bigLabelStart,bigLabelUnit)/bigLabelCount);offsetCount3=Math.ceil(date.diff(t._bigLabelEnd,_smallLabelEnd,bigLabelUnit)/bigLabelCount);if(offsetCount2){off=date.diff(_smallLabelStart,bigLabelStart,"ms")/rate;t._bigLabelStart=bigLabelStart;if(offsetCount2>0){self._addLeft(profile,"big",labelsTop,offsetCount2,off)}else{self._minusLeft(profile,t._bigMarks,labelsTop,-offsetCount2)}}if(offsetCount3){off=date.diff(_smallLabelStart,bigLabelStart,"ms")/rate;t._bigLabelEnd=date.add(t._bigLabelEnd,bigLabelUnit,offsetCount3*bigLabelCount);if(offsetCount3<0){self._minusRight(profile,t._bigMarks,labelsTop,-offsetCount3)}else{self._addRight(profile,bak_e,"big",labelsTop,offsetCount3,off)}}}}t._band_left=band.left();t.dateStart=self._getTime(profile,-t._band_left,1);profile.pause=false},_trimTask:function(profile,o){var l=-12,x=o._left,w=o._width,bw=profile.properties._band_width;if(x<l){if(x+w<l){w=0}else{w=w+x-l}x=l}if(x>bw+12){x=bw+12}this._setItemNode(profile,o,"left",x+"px");if(x+w>bw-l){w=bw-l-x}if(w>=0){this._setItemNode(profile,o,"width",w+"px")}},_setItemNode:function(profile,item,key,value){var t=item._node||(item._node=profile.getSubNodeByItemId("ITEM",item.id).get(0));t.style[key]=value},_getLinePos:function(profile,o){if(o._min){return 0}var t=profile.properties,b=false,index=0;t._lines.each(function(v,i){if(i===0){return }b=true;_.each(v,function(v){if(o!==v){if(((o._left+o._width)>=v._left)&&((v._left+v._width)>=o._left)){return b=false}}});if(b){index=i;return false}});if(!b){index=t._lines.push({})-1}return index},_reArrage:function(profile){var self=this,o,h,t=profile.properties;t._lines.length=1;t.items.each(function(v){if(v._line===0){return }index=self._getLinePos(profile,v);t._lines[index][v.id]=v;if(v._line!==index){v._line=index;if(t.multiTasks){self._setItemNode(profile,v,"top",(t.taskHeight+3)*index+"px")}}});h=t._linesHeight=(t._lines.length+1)*18;self._ajustHeight(profile)},_resetItem:function(profile,o,src){var p=profile.properties,t=profile.getItemByDom(src),bandW=p._band_width+12,f=function(k,i){return profile.getSubNodeByItemId(k,i)},timeline=profile.box,max=Math.max;if(o.left){t._left=o.left;t.start=timeline._getTime(profile,o.left);src.style.left=o.left+"px"}if(o.width){t._width=max(o.width,0);t.end=timeline._getTime(profile,o.left+o.width);if(p.multiTasks){if(t._width<=16){t._width=o.width=16;if(!t._min){t._min=true;f("NORMAL",t.id).display("none");f("MIN",t.id).display("block")}}else{if(t._min){t._min=false;f("NORMAL",t.id).display("block");f("MIN",t.id).display("none")}if(o.left+o.width>bandW){o.width=bandW-o.left}}}src.style.width=o.width+"px";if(linb.browser.ie&&!p.multiTasks){linb([src.parentNode]).ieTrigger()}}timeline._reArrage(profile)},_ajustHeight:function(profile){var p=profile.properties,f=function(p){return profile.getSubNode(p)},view=f("VIEW"),items=f("ITEMS"),scroll=f("SCROLL"),scrolli=f("SCROLLI"),h,b,ih=p._linesHeight||0,vh=view.height();h=Math.max(ih,vh);items.height(h);scrolli.height(h);b=ih>vh;scroll.display(b?"block":"none");items.top(b?-scroll.scrollTop():0)},showTips:function(profile,node,pos){var t=profile.properties,id=node.id,format=t.timeFormat,sid=profile.getSubSerialId(id),map=profile.SubSerialIdMapItem,item=map&&map[sid],date=linb.date;if(t.disabled){return }if(item&&item.disabled){return }if(item){item.tips='<p style="font-weight:bold">'+item.caption+"</p>"+date.getText(new Date(item.start),format)+":"+date.getText(new Date(item.end),format);linb.UI.Tips.show(pos,item);return true}else{return false}},resize:function(profile,w,h){var p=profile.properties,f=function(k){return profile.getSubNode(k)},off1=2*p.$borderW,off2=3,t;if(h&&h!=p.height&&parseInt(profile.domNode.style.height)){f("BORDER").height(t=h-off1);f("VIEW").height(t=t-(p.showTips&&p.tipsHeight)-off2-(p.showBigLabel?p.bigLabelHeight:0)-p.smallLabelHeight-(p.showBar&&p.barHeight));this._ajustHeight(profile);if(p.height!=h){p.height=h}}if(w&&w!=p.width){f("BORDER").width(w-off1);if(p.width!=w){p.width=w}}}}});Class("linb.UI.List",["linb.UI.iWidget","linb.UI.iForm","linb.UI.iList"],{Instance:{setCtrlValue:function(value){return this.each(function(profile){if(!profile.domNode){return }var box=profile.boxing(),uiv=box.getUIValue(),p=profile.properties,k="ITEM",rm=function(i,j,k){return profile.removeTagClass(i,j,k)},add=function(i,j,k){return profile.addTagClass(i,j,k)},getN=function(k,i){return profile.getSubNode(k,i)},getI=function(i){return profile.getSubSerialIdByItemId(i)};if(p.selMode=="single"){var itemId=getI(uiv);if(uiv&&itemId){rm("ITEM","-checked",getN(k,itemId))}itemId=getI(value);if(itemId){add("ITEM","-checked",getN(k,itemId))}if(itemId){var o=getN(k,itemId);if(o){var top=o.offsetTop(),items=getN("ITEMS"),sh=items.scrollHeight(),st=items.scrollTop(),hh=items.height();if(sh>hh){if(top<st||top>st+hh){items.scrollTop(top)}}}}}else{if(p.selMode=="multi"){uiv=uiv?uiv.split(";"):[];value=value?value.split(";"):[];uiv.each(function(o){if(!value.exists(o)){rm("ITEM","-checked",getN(k,getI(o)))}});value.each(function(o){if(!uiv.exists(o)){add("ITEM","-checked",getN(k,getI(o)))}})}}})},setValue:function(value,flag){var upper=arguments.callee.upper;return this.each(function(profile){if(profile.properties.selMode=="multi"){var arr=value.split(";");arr.sort();value=arr.join(";")}upper.apply(profile.boxing(),[value,flag])})},adjustSize:function(){return this.each(function(profile){var root=profile.root,items=profile.getSubNode("ITEMS"),pool=profile.getSubNode("POOL");items.height("auto");var h=Math.min(profile.properties.maxHeight,items.offsetHeight());profile.properties.height=h;root.height(h)})},activate:function(){return linb.UI.iList.prototype.activate.call(this)},setDirtyMark:function(){return this.each(function(profile){var id=profile.domId,p=profile.properties,flag=p.value!==p.$UIvalue,d=linb.UI.$css_tag_dirty;if(profile.beforeDirtyMark&&false===profile.boxing().beforeDirtyMark(profile,flag)){}else{var o=profile.getSubNode("ITEMS");if(flag){o.addClass(d)}else{o.removeClass(d)}}})}},Static:{cssNone:false,Templates:{"default":{tagName:"div",style:"{_style}",ITEMS:{$order:10,tagName:"div",text:"{items}"},$dynamic:{items:{ITEM:{tagName:"a",href:"javascript:;",tabindex:"{_tabindex}",ICON:{style:"background:url({icon}) transparent  no-repeat {iconPos};{iconDisplay}",$order:0},CAPTION:{tagName:"text",text:"{caption}",$order:1}}}}}},Appearances:{"default":{KEY:{"font-size":"12px"},ITEMS:{"background-color":"#fff",position:"relative",border:"1px solid #91A7B4",overflow:"auto","overflow-x":(linb.browser.ie||linb.browser.gek)?"hidden":""},ITEM:{display:"block","font-family":'"Verdana", "Helvetica", "sans-serif"',border:0,cursor:"pointer",padding:"0 2px 0 2px",position:"relative"},"ITEM-mouseover":{$order:1,"background-color":"#d9e8fb"},"ITEM-checked":{$order:2,"background-color":"#316AC5",color:"#fff"},ICON:{cursor:"pointer",width:"16px",height:"16px",margin:"0 4px 0 0"}}},Behaviors:{"default":{_hoverEffect:{ITEM:"ITEM"},_clickEffect:{ITEM:"ITEM"},onRewh:function(profile,e,src){var o=profile.domNode.style,w=null,h=null;if(e.height){h=parseInt(o.height)||null}if(e.width){w=parseInt(o.width)||null}profile.box.resize(profile,w,h)},ITEM:{onClick:function(profile,e,src){var properties=profile.properties,item=profile.getItemByDom(src),itemId=profile.getSubSerialId(src.id),box=profile.boxing(),rt;if(properties.disabled||item.disabled){return false}switch(properties.selMode){case"none":rt=box.onItemSelected(profile,item,src);break;case"multi":var value=box.getUIValue(),arr=value?value.split(";"):[];if(arr.exists(item.id)){arr.removeValue(item.id)}else{arr.push(item.id)}arr.sort();value=arr.join(";");if(box.getUIValue()==value){rt=false}else{box.updateUIValue(value);if(box.getUIValue()==value){rt=box.onItemSelected(profile,item,src)}}break;case"single":if(box.getUIValue()==item.id){rt=false}else{box.updateUIValue(item.id);if(box.getUIValue()==item.id){rt=box.onItemSelected(profile,item,src)}}break}linb(src).focus();return rt},onKeydown:function(profile,e,src){var keys=linb.event.getKey(e),key=keys[0],shift=keys[2],cur=linb([src],false),first=profile.root.nextFocus(true,true,false),last=profile.root.nextFocus(false,true,false);switch(linb.event.getKey(e)[0]){case"tab":if(shift){if(src!=first.get(0)){first.focus();return false}}else{if(src!=last.get(0)){last.focus();return false}}break;case"left":case"up":var next=cur.nextFocus(false,true,false);if(cur.get(0)==first.get(0)){last.focus()}else{cur.nextFocus(false)}return false;break;case"right":case"down":var next=cur.nextFocus(true,false,false);if(cur.get(0)==last.get(0)){first.focus()}else{cur.nextFocus()}return false;break;case"space":case"enter":linb(src.id).onClick();return false;break}}},ITEMS:{beforeKeypress:function(profile,e){var key=linb.event.getKey(e)[0];if(key=="tab"||key=="enter"){return true}else{if(/^\w$/.test(key)){profile._wordcache=profile._wordcache||"";profile._wordcache+=key.toLowerCase();clearTimeout(profile._wordcachetimeout);var arr=profile.properties.items;arr.each(function(o,i){if(o.caption.toLowerCase().startWith(profile._wordcache)){profile.getSubNodeByItemId("ITEM",o.id).focus();return false}});profile._wordcachetimeout=_.asyRun(function(){profile._wordcache=""},300)}}}}}},DataModel:({icon:null,iconPos:null,caption:null,tabindex:{action:function(value){if(this.domNode){this.getSubNode("ITEM",true).tabIndex(value)}}},selMode:{ini:"single",listbox:["single","none","multi"]},width:120,height:150,maxHeight:300}),EventHandlers:{beforeDirtyMark:function(profile,flag){},onItemSelected:function(profile,item,src){}},resize:function(profile,w,h){var t=profile.properties,temp,l=profile.getSubNode("ITEMS");if(!parseInt(profile.domNode.style.height)){return }l.height(h)}}});Class("linb.UI.LinkList",["linb.UI.List"],{Initialize:function(){var t=this.getTemplate("default");t.$dynamic={items:{ITEM:{style:"{_style};margin:{itemMargin}px",LINK:{$order:1,tagName:"a",href:"{href1}",tabindex:"{_tabindex}",text:"{caption}"}}}};this.setTemplate("default",t)},Static:{Appearances:{"default":{ITEMS:{position:"relative",overflow:"auto","overflow-x":(linb.browser.ie||linb.browser.gek)?"hidden":""},ITEM:{"vertical-align":"middle",position:"relative",background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat left -202px",null,"linb.UI.Public"),"border-right":"solid 1px #C2C1C1",height:"16px","white-space":"nowrap"},"ITEM-mouseover":{},"ITEM-checked":{},LINK:{display:linb.browser.gek?["-moz-inline-block","-moz-inline-box"]:"inline-block","vertical-align":"middle",padding:"1pt 4px 1pt 12px"}}},DataModel:({itemMargin:0,tabindex:{action:function(value){var self=this,keys=self.keys,fun=function(l,v){self.getSubNode(l,true).tabIndex(v)};if(self.domNode){fun("LINK",value)}}}}),Behaviors:{"default":{ITEM:{},LINK:{onClick:function(profile,e){return profile.box.cancelLink(e)},onMousedown:function(profile,e,src){if(linb.event.getBtn(e)!="left"){return }var properties=profile.properties,item=profile.getItemByDom(src),box=profile.boxing();if(properties.disabled||item.disabled){return false}box.onItemClick(profile,item,src)}}}},EventHandlers:{onItemSelected:null,onItemClick:function(profile,item,src){}},prepareItem:function(profile,item){var p=profile.properties;item._tabindex=p.tabindex;item.itemMargin=p.itemMargin}}});Class("linb.UI.Gallery","linb.UI.List",{Initialize:function(){var t=this.getTemplate("default");t.$dynamic={items:{ITEM:{style:"padding:{itemPadding}px;margin:{itemMargin}px;",ITEMFRAME:{style:"width:{itemWidth}px;height:{itemHeight}px;",CAPTION:{tagName:"div",text:"{caption}",$order:0},CONTENT:{tagName:"div",$order:1,ICON:{tagName:"a",href:"{href}",style:"background:url({icon}) transparent center  no-repeat {iconPos};width:{iconWidth}px;height:{iconHeight}px;"}},COMMENT:{tagName:"a",href:"{href}",text:"{comment}",$order:2}}}}};this.setTemplate("default",t)},Static:{Appearances:{"default":{ITEMS:{position:"relative",top:0,left:0,overflow:"auto","overflow-x":(linb.browser.ie||linb.browser.gek)?"hidden":""},ITEM:{display:linb.browser.gek?["-moz-inline-block","-moz-inline-box"]:"inline-block",position:"relative",overflow:"hidden","vertical-align":"top",border:0,padding:0,margin:0},ITEMFRAME:{display:linb.browser.ie?"inline-block":"block",position:"relative",overflow:"hidden",border:0,padding:0,margin:0,width:"100%",height:"100%","-moz-box-flex":"1",border:"1px solid #A7A6AA"},"ITEM-mouseover":{},"ITEM-checked":{},"ITEM-mouseover CAPTION":{$order:1,"background-color":"#d9e8fb"},"ITEM-checked CAPTION":{$order:2,"background-color":"#316AC5",color:"#fff"},"CONTENT, CAPTION":{"text-align":"center",overflow:"hidden","white-space":"nowrap"},CAPTION:{"font-weight":"bold","border-bottom":"1px solid #A7A6AA"},ICON:{display:linb.browser.gek?["-moz-inline-block","-moz-inline-box"]:"inline-block","vertical-align":"middle"},COMMENT:{display:"block",margin:"0 2px 0 2px"}}},DataModel:({itemMargin:{ini:6,action:function(v){if(typeof v!="object"){this.getSubNode("ITEM",true).setPxStyle("margin",v)}else{this.getSubNode("ITEM",true).setStyle(v)}}},itemPadding:{ini:2,action:function(v){if(typeof v!="object"){this.getSubNode("ITEM",true).setPxStyle("padding",v)}else{this.getSubNode("ITEM",true).setStyle(v)}}},itemWidth:{ini:32,action:function(v){this.getSubNode("ITEMFRAME",true).width(v)}},itemHeight:{ini:32,action:function(v){this.getSubNode("ITEMFRAME",true).height(v)}},iconWidth:{ini:16,action:function(v){this.getSubNode("ICON",true).width(v)}},iconHeight:{ini:16,action:function(v){this.getSubNode("ICON",true).height(v)}},tabindex:{action:function(value){if(this.domNode){this.getSubNode("ITEM",true).tabIndex(value)}}},width:200,height:200}),prepareItem:function(profile,item){var p=profile.properties;"itemWidth,itemHeight,iconWidth,iconHeight,itemPadding,itemMargin".toArr().each(function(i){item[i]=item[i]||p[i]});item.capition=item.capition||"";item.comment=item.comment||"";item._tabindex=p.tabindex}}});Class("linb.UI.IconList","linb.UI.List",{Initialize:function(){var t=this.getTemplate("default");t.$dynamic={items:{ITEM:{style:"padding:{itemPadding}px;margin:{itemMargin}px;",ICON:{style:"background:url({icon}) transparent no-repeat {iconPos};width:{itemWidth}px;height:{itemHeight}px;"}}}};this.setTemplate("default",t)},Static:{Appearances:{"default":{ITEMS:{position:"relative",top:0,left:0,overflow:"auto","overflow-x":(linb.browser.ie||linb.browser.gek)?"hidden":""},ITEM:{display:linb.browser.gek?["-moz-inline-block","-moz-inline-box"]:"inline-block",position:"relative",overflow:"hidden","vertical-align":"top"},ICON:{border:"1px solid #CDCDCD"}}},DataModel:({itemMargin:{ini:6,action:function(v){if(typeof v!="object"){this.getSubNode("ITEM",true).setPxStyle("margin",v)}else{this.getSubNode("ITEM",true).setStyle(v)}}},itemPadding:{ini:2,action:function(v){if(typeof v!="object"){this.getSubNode("ITEM",true).setPxStyle("padding",v)}else{this.getSubNode("ITEM",true).setStyle(v)}}},itemWidth:{ini:16,action:function(v){this.getSubNode("ICON",true).width(v)}},itemHeight:{ini:16,action:function(v){this.getSubNode("ICON",true).height(v)}},tabindex:{action:function(value){if(this.domNode){this.getSubNode("ITEM",true).tabIndex(value)}}},width:200,height:200}),prepareItem:function(profile,item){var p=profile.properties;"itemWidth,itemHeight,itemPadding,itemMargin".toArr().each(function(i){item[i]=item[i]||p[i]});item._tabindex=p.tabindex}}});Class("linb.UI.Poll","linb.UI.List",{Instance:{fillDetail:function(item,obj){var profile=this.get(0);profile.getSubNodeByItemId("BODY",item.id).html("",false).attach(item._obj=obj)},setOptCap:function(item,v){return this.each(function(pro){var items=pro.properties.items,i=pro.itemsSearch(pro.properties.items,function(o){return o.id==item.id},false,true);if(i&&(i=i[0])){i.caption=v;if(pro.domNode){pro.getSubNodeByItemId("CAPTION",i.id).html(v)}}})},getBindEditor:function(){return this.get(0)._bind},insertOpt:function(opt,index){if(!opt.id){opt.id=_.id()}var item,items=this.get(0).properties.items,t;if(!_.isNumb(index)){if(t=items.length){item=items[t-1]}}else{item=items[index]}this.insertItems([opt],item&&item.id,false);return this},removeOpt:function(id){this.removeItems([id]);return this},setDirtyMark:function(){return this}},Initialize:function(){var self=this;self.mapKeys(["MARK2","MARK3","EDIT"]);var t=self.getTemplate("default");t.TITLE={$order:"0",tagName:"DIV",style:"{titleDisplay}",text:"{title}",className:"{disabled} {_cls}"};t.TAIL={$order:"20",tagName:"DIV",className:"{disabled} ",text:"{cmds}"};t.$dynamic={items:{OUTER:{tagName:"div",TOGGLE:{style:"{_togdisplay}"},ITEM:{tagName:"a",href:"javascript:;",tabindex:"{_tabindex}",OPTION:{$order:0,tagName:"DIV",MARK:{$order:1,className:"{_optclass}"}},CAPTION:{$order:1,tagName:"DIV",text:"{caption}",className:"{disabled} {_itemcls}"},CHART:{$order:2,tagName:"DIV",style:"{_display}",CAST:{$order:0,text:"{message}"},BAR:{$order:1,style:"background-position: -{_per}px -190px;",BARI:{}},DEL:{$order:2,tagName:"BUTTON",style:"{_del}",text:"{delText}"}},CLEAR:{$order:3,tagName:"DIV"}},BODY:{$order:1,tagName:"DIV",text:"{_body}"}}},cmds:{CMD:{tagName:"{tagName}",tabindex:"{_tabindex}",text:"{caption}"}}};self.setTemplate("default",t);var inlineEdit=function(profile,node,flag,value,item){var o=profile._bind,prop=profile.properties;if(profile.onCustomEdit){profile._bind=profile.boxing().onCustomEdit(profile,node,flag,value,item)}else{if(!o){var pp={type:prop.editorType,saveBtn:true,left:-10000,top:-10000};if(!_.isEmpty(prop.editorProps)){_.merge(pp,prop.editorProps,"all")}profile._bind=o=linb.create(prop.editor,pp);o.onHotKeydown(function(p,key){if(key=="enter"){p.boxing().onSave(p);return false}else{if(key=="esc"){o.hide()}}});profile.root.attach(o)}var r=node.getRegion(true,profile.root);if(r.height>o.getHeight()){o.setHeight(r.height)}else{r.top-=3}if(r.top<0){r.top=0}o.setValue(value||"",true).setWidth(r.width+node.paddingW()).show(r.left+"px",r.top+"px").onSave(function(p){var v=p.properties.$UIvalue,ov=p.properties.value,b=profile.boxing();if(v!=ov){switch(flag){case"1":if(profile.beforeItemChanged&&b.beforeItemChanged(profile,item,v)===false){}else{b.setOptCap(item,v)}break;case"2":if(profile.beforeItemAdded&&b.beforeItemAdded(profile,v)===false){}else{b.insertOpt({caption:v})}break;default:if(profile.beforeTitleChanged&&b.beforeTitleChanged(profile,v)===false){}else{b.setTitle(v)}}}_.asyRun(function(){o.hide()})}).reBoxing().setBlurTrigger(o.KEY+":"+o.$id,function(){o.hide()});_.asyRun(function(){o.activate()})}};t=self.getBehavior("default");var old=t.ITEM.onClick;t.ITEM.onClick=function(profile,e,src){var p=profile.properties,item=profile.getItemByDom(src);if(p.disabled){return }if(p.editable){inlineEdit(profile,profile.getSubNodeByItemId("CAPTION",item.id),item.editable?"2":"1",item.editable?"":item.caption,item)}else{if(item.editable){inlineEdit(profile,profile.getSubNodeByItemId("CAPTION",item.id),"2")}else{old.apply(this,arguments)}}};t.TITLE={onClick:function(profile,e,src){var p=profile.properties,item=profile.getItemByDom(src);if(p.disabled){return }if(p.editable){inlineEdit(profile,profile.getSubNode("TITLE"),"3",p.title)}}};t.DEL={onClick:function(profile,e,src){var p=profile.properties,b=profile.boxing(),item=profile.getItemByDom(src);if(p.disabled){return }if(p.editable){if(profile.beforeItemRemoved&&b.beforeItemRemoved(profile,item)===false){}else{b.removeOpt(item.id)}return false}}};t.CMD={onClick:function(profile,e,src){var p=profile.properties,key=profile.getSubSerialId(src.id);if(p.disabled){return }profile.boxing().onCommand(profile,key,src)}};t.TOGGLE={onClick:function(profile,e,src){var properties=profile.properties,items=properties.items,item=profile.getItemByDom(src),itemId=profile.getSubSerialId(src.id),node=linb([src]),body=profile.getSubNode("BODY",itemId);if(item._show){profile.removeTagClass("TOGGLE","-checked",node);body.display("none")}else{profile.addTagClass("TOGGLE","-checked",node);body.display("block");if(!item._fill){item._fill=true;item._body=profile.onBuildBody?profile.boxing().onBuildBody(profile,item):profile.box.buildBody(profile,item);if(item._body){profile.getSubNode("BODY",itemId).html(item._body,false)}}}item._show=!item._show}};self.setBehavior("default",t)},Static:{ITEMKEY:"OUTER",Appearances:{"default":{KEY:{"font-size":"12px",zoom:linb.browser.ie?1:null,background:"#fff"},"TITLE, ITEMS, TAIL":{position:"relative",overflow:"auto","line-height":"12px",background:"#fff"},TAIL:{zoom:linb.browser.ie?1:null,padding:"5px 0 5px 40px"},CMD:{margin:"3px","white-space":"nowrap","vertical-align":"middle"},TITLE:{"font-weight":"bold",padding:"4px","border-bottom":"1px solid #CDCDCD"},ITEMS:{"overflow-x":(linb.browser.ie||linb.browser.gek)?"hidden":"",zoom:linb.browser.ie?1:null,margin:"4px 4px 4px 5px"},OUTER:{position:"relative",zoom:linb.browser.ie?1:null,"padding-left":"15px","border-bottom":"1px dashed #CDCDCD"},TOGGLE:{cursor:"pointer",position:"absolute",left:0,top:"4px",width:"15px",height:"15px",background:linb.UI.getCSSImgPara("icon.gif"," no-repeat left -16px",null,"linb.UI.Public")},"TOGGLE-checked":{$order:1,"background-position":"left -28px"},BODY:{display:"none","padding-left":"27px"},ITEM:{display:"block",position:"relative",zoom:linb.browser.ie?1:null,padding:"4px 2px 4px 2px"},"ITEM-checked":{},OPTION:{position:"absolute",left:"2px",top:"4px"},CAPTION:{"float":"left",zoom:linb.browser.ie?1:null,"margin-left":"24px",display:linb.browser.ie6?"inline":null},EDIT:{$order:2,"float":"none","background-color":"#f4f4f4",cursor:"pointer",display:linb.browser.ie6?"block":null},CHART:{"float":"right"},CLEAR:{clear:"both","text-align":"right"},"BAR, BARI":{width:"150px",height:"12px",border:0,"line-height":0,"font-size":0},BAR:{"margin-left":"2px",background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -130px -190px",null,"linb.UI.Public")},BARI:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -150px -225px ",null,"linb.UI.Public")},"MARK, MARK2, MARK3":{cursor:"pointer",width:"16px",height:"16px","margin-right":"6px"},MARK:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -144px top",null,"linb.UI.Public")},"ITEM-mouseover MARK":{$order:1,"background-position":" -144px -17px"},"ITEM-mousedown MARK":{$order:2,"background-position":" -144px -34px"},"ITEM-checked MARK":{$order:3,"background-position":" -128px top"},"ITEM-checked-mouseover MARK":{$order:4,"background-position":" -128px -17px"},"ITEM-checked-mousedown MARK":{$order:5,"background-position":" -128px -34px"},MARK2:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -112px top",null,"linb.UI.Public")},"ITEM-mouseover MARK2":{$order:1,"background-position":" -112px -17px"},"ITEM-mousedown MARK2":{$order:2,"background-position":" -112px -34px"},"ITEM-checked MARK2":{$order:3,"background-position":" -96px top"},"ITEM-checked-mouseover MARK2":{$order:4,"background-position":" -96px -17px"},"ITEM-checked-mousedown MARK2":{$order:5,"background-position":" -96px -34px"},MARK3:{$order:11,background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -56px -222px",null,"linb.UI.Public")},"ITEM-mouseover MARK3":{$order:11,"background-position":" -56px -222px"},"ITEM-mousedown MARK3":{$order:11,"background-position":" -56px -222px"},DEL:{margin:"0 0 0 4px"}}},DataModel:{title:{ini:"",action:function(v){this.getSubNode("TITLE").html(v)}},selMode:{ini:"single",listbox:["single","multi"],action:function(){this.boxing().refresh()}},cmds:{ini:null},noTitle:{ini:false,action:function(v){this.getSubNode("TITLE").display(v?"none":"")}},toggle:false,delText:"remove",editable:false,newOption:"",editor:"ComboInput",editorType:"none",editorProps:{ini:{}}},EventHandlers:{beforeDirtyMark:function(profile,flag){},onItemSelected:function(profile,item,src){},beforeTitleChanged:function(profile,v){},onCustomEdit:function(profile,node,flag,vlaue,item){},beforeItemAdded:function(profile,v){},beforeItemRemoved:function(profile,item){},beforeItemChanged:function(profile,item,v){},onCommand:function(profile,key,src){},onBuildBody:function(profile,item){}},dynamicTemplate:function(profile){var properties=profile.properties;var hash=profile._exhash="$selMode:"+properties.selMode+";",tid=profile.template._id,template=profile.box.getTemplate(tid,hash);properties.$UIvalue=properties.value;if(!template){template=_.clone(profile.box.getTemplate(tid));if(properties.selMode=="multi"){template.$dynamic.items.OUTER.ITEM.OPTION.MARK2={$order:1,className:"{_optclass}"};delete template.$dynamic.items.OUTER.ITEM.OPTION.MARK}profile.box.setTemplate(tid,template,hash)}profile.template=template},prepareData:function(profile){arguments.callee.upper.call(this,profile);var p=profile.properties,data=profile.data;if(p.editable){data._cls=profile.getClass("EDIT")}data.titleDisplay=p.noTitle?"display:none":"";var cmds=p.cmds,o;if(cmds&&cmds.length){var sid=linb.UI.subSerialIdTag,a;a=data.cmds=[];for(var i=0,t=cmds,l=t.length;i<l;i++){o=linb.UI.copyItem(t[i]);o.tagName=o.tagName||"button";a.push(o);o._tabindex=p.tabindex;o[sid]=o.id}}},prepareItems:function(profile,arr,pid){var a=arr,b=profile.properties.newOption;if(!profile.prepared){if(profile.properties.editable||b){a=arr.copy();a.push({id:"$custom",editable:true,caption:b||"new"})}}return arguments.callee.upper.apply(this,[profile,a,pid])},prepareItem:function(profile,item){var p=profile.properties,f=profile.CF;item._tabindex=p.tabindex;if(typeof f.formatCaption=="function"){item.caption=f.formatCaption(item.caption)}item._body=item._body||"Loading...";if(item.id!="$custom"){item._togdisplay=((p.toggle&&item.toggle!==false)||item.toggle)?"":"display:none;";item._display="";item.percent=parseFloat(item.percent)||0;if(item.percent<0){item.percent=0}if(item.percent>1){item.percent=1}item._per=150*(1-item.percent)}else{item._optclass=profile.getClass("MARK3");item._togdisplay=item._display="display:none;";item._per=0}if(p.editable||item.editable){item._itemcls=profile.getClass("EDIT")}if(p.editable){item.delText=p.delText}item._del=(p.editable&&!item.editable)?"":"display:none;"},buildBody:function(profile,item){return item.text?"<pre>"+item.text.replace(/</g,"&lt;")+"</pre>":""}}});Class("linb.UI.PanelBar",["linb.UI.Div","linb.UI.iContainer"],{Instance:{removePanel:function(){this.destroy()},getPanelPara:function(){return _.copy(this.get(0).properties)},getPanelChildren:function(){return this.get(0).children}},Static:{cssNone:false,Dropable:["PANEL"],Dragable:["HANDLE"],Templates:{"default":{tagName:"div",style:"{_style}",BORDER:{tagName:"div",HANDLE:{tagName:"div",style:"{handleDisplay};height:{handleHeight}px",TOGGLE:{className:" {toggleCls}",style:"{toggleDisplay}",$order:0},ICON:{style:"background:url({icon}) transparent  no-repeat {iconPos}; {iconDisplay}",$order:0},CAPTION:{tagName:"a",href:"{href}",tabindex:"{tabindex}",text:"{caption}",className:"{disabled}",$order:1},CMDS:{OPT:{style:"{optDisplay}",$order:1},LAND:{style:"{landDisplay}",$order:1},CLOSE:{style:"{closeDisplay}",$order:2}}},PANEL:{$order:1,tagName:"div",style:"{panelDisplay}",text:"{html}"+linb.UI.$childTag}}}},Appearances:{"default":{"KEY BORDER":{zoom:linb.browser.ie6?1:null},PANEL:{position:"relative",left:0,top:0,overflow:"auto",zoom:linb.browser.ie6?1:null,"background-color":"#fff"},HANDLE:{overflow:"hidden",background:linb.UI.getCSSImgPara("barvbg.gif"," repeat-x left top",null,"linb.UI.Public"),position:"relative"},"HANDLE-mouseover":{$order:1,"background-position":"right -22px"},"TOGGLE, ICON":{width:"16px",height:"16px",margin:"2px"},CMDS:{position:"absolute",top:0,right:0,"text-align":"right","vertical-align":"middle",height:"100%",cursor:"default"},"CMDS   span":{position:"relative",margin:"5px 4px 2px 0",width:"15px",height:"15px","vertical-align":"middle",cursor:"default"},TOGGLE:{cursor:"default",background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -16px 0",null,"linb.UI.Public")},"TOGGLE-mouseover":{$order:2,"background-position":"-16px -16px"},"TOGGLE-mousedown":{$order:3,"background-position":"-16px -32px"},"TOGGLE-checked":{$order:4,"background-position":" -48px 0"},"TOGGLE-checked-mouseover":{$order:5,"background-position":" -48px -16px"},"TOGGLE-checked-mousedown":{$order:6,"background-position":" -48px -32px"},OPT:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -240px top",null,"linb.UI.Public")},"OPT-mouseover":{$order:2,"background-position":"-240px -16px"},"OPT-mousedown":{$order:3,"background-position":"-240px -32px"},CLOSE:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -64px 0",null,"linb.UI.Public")},"CLOSE-mouseover":{$order:1,"background-position":"-64px -16px"},"CLOSE-mousedown":{$order:2,"background-position":"-64px -32px"},LAND:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -220px 0",null,"linb.UI.Public")},"LAND-mouseover":{$order:1,"background-position":"-220px -16px"},"LAND-mousedown":{$order:2,"background-position":"-220px -32px"},CAPTION:{"font-size":"12px",padding:"0 16px 0 6px",display:"inline","line-height":"20px"}}},Behaviors:{"default":{_hoverEffect:{HANDLE:"HANDLE",OPT:"OPT",CLOSE:"CLOSE",LAND:"LAND",TOGGLE:"TOGGLE"},_clickEffect:{CLOSE:"CLOSE",OPT:"OPT",LAND:"LAND",TOGGLE:"TOGGLE"},onRewh:function(profile,e,src){var o=profile.root,w=null,h=null;if(e.height){h=o.height()}if(e.width){w=o.width()}profile.box.resize(profile,w,h)},OPT:{onClick:function(profile,e,src){profile.boxing().onTriggerOption(profile,e,src)}},TOGGLE:{onClick:function(profile,e,src){profile.box._toggle(profile,!profile.properties.toggle);return false}},CAPTION:{onClick:function(profile,e,src){if(!profile.onClickHandle||false===profile.boxing().onClickHandle(profile,src)){return profile.box.cancelLink(e)}}},CLOSE:{onClick:function(profile,e,src){var properties=profile.properties;if(properties.disabled){return }var instance=profile.boxing();if(false===instance.beforeClose(profile,src)){return }instance.destroy();return false}},LAND:{onClick:function(profile,e,src){var properties=profile.properties;if(properties.disabled){return }var pos=profile.root.absPos(),size=profile.root.cssSize();var pro=linb.UI.Dialog.getDefaultProp();_.merge(pro,properties,"with");_.merge(pro,{dock:"none",width:size.width,height:size.height,left:pos.left,top:pos.top},"all");var dialog=new linb.UI.Dialog(pro);linb(document.body).attach(dialog);profile.children.each(function(o){dialog.attach(o[0])});profile.boxing().destroy();return false}}}},DataModel:{position:"absolute",zIndex:0,dock:"fill",tabindex:{action:function(value){if(this.domNode){this.getSubNode("HANDLE").tabIndex(value)}}},dragKey:"",href:{ini:"javascript:;",action:function(v){if(this.domNode){this.root.href(v)}}},html:{ini:"",action:function(v){this.getSubNode("PANEL").html(v)}},handleHeight:{ini:20,action:function(v){this.getSubNode("HANDLE").display(v?"":"none")}},caption:linb.UI.Widget.getDataModel("caption"),icon:linb.UI.Widget.getDataModel("icon"),iconPos:linb.UI.Widget.getDataModel("iconPos"),toggle:{ini:true,action:function(v){this.box._toggle(this,v)}},optBtn:{ini:false,action:function(v){this.getSubNode("OPT").display(v?"":"none")}},toggleBtn:{ini:false,action:function(v){this.getSubNode("TOGGLE").display(v?"":"none")}},closeBtn:{ini:false,action:function(v){this.getSubNode("CLOSE").display(v?"":"none")}},landBtn:{ini:false,action:function(v){this.getSubNode("LAND").display(v?"":"none")}}},EventHandlers:{beforeClose:function(profile,src){},onIniPanelView:function(profile){},onFold:function(profile){},onOpen:function(profile){},onTriggerOption:function(profile,e,src){},onClickHandle:function(profile,src){}},prepareData:function(profile){arguments.callee.upper.call(this,profile);var data=profile.data,nodisplay="display:none";data.panelDisplay=data.toggle?"":nodisplay;data.toggleCls=data.toggle?"":profile.getClass("TOGGLE","-checked");data.toggleDisplay=data.toggleBtn?"":nodisplay;data.optDisplay=data.optBtn?"":nodisplay;data.closeDisplay=data.closeBtn?"":nodisplay;data.landDisplay=data.landBtn?"":nodisplay;data.handleDisplay=data.handleHeight?"":nodisplay},resize:function(profile,w,h){if(h&&parseInt(profile.domNode.style.height)){profile.getSubNode("BORDER").height(h);profile.getSubNode("PANEL").height(h-profile.properties.handleHeight)}if(w&&parseInt(profile.domNode.style.width)){profile.getSubNode("PANEL").width(w)}},_toggle:function(profile,value){var p=profile.properties,b=profile.boxing();p.toggle=value;if(value&&!profile.$ini){if(b.onIniPanelView){b.onIniPanelView(profile)}profile.$ini=true}if(value){b.onOpen(profile)}else{b.onFold(profile)}profile.getSubNode("PANEL").display(value?"":"none");if(p.toggleBtn){if(value){profile.removeTagClass("TOGGLE","-checked")}else{profile.addTagClass("TOGGLE","-checked")}}}}});Class("linb.UI.PageBar",["linb.UI.iWidget","linb.UI.iNavigator"],{Instance:{setCtrlValue:function(value){return this.each(function(profile){if(!profile.domNode){return }var t,prop=profile.properties,arr=profile.box._ensureV(value),min=arr[0],cur=arr[1],max=arr[2],keys=profile.keys,fun=function(p,k){return p.getSubNode(k)},first=fun(profile,"FIRST"),pre=fun(profile,"PRE"),prehide=fun(profile,"PREM"),current=fun(profile,"CUR"),next=fun(profile,"NEXT"),nexthide=fun(profile,"NEXTM"),last=fun(profile,"LAST"),change=function(n,i,j){if(i){n.href(prop.uriTpl.replace("*",i))}if(j){n.text(prop.textTpl.replace("*",j))}},display=function(n,f){n.display(f?"":"none")};change(first,min,min);change(prehide,"",".."+".".repeat(String(cur-1-min).length));change(pre,cur-1);change(current,cur,cur);change(next,cur+1);change(nexthide,"",".."+".".repeat(String(max-cur-1).length));change(last,max,max);if((t=cur-min)<=0){display(first,0);display(prehide,0);display(pre,0)}else{if(t==1){display(first,1);display(prehide,0);display(pre,0)}else{if(t==2){display(first,1);display(prehide,0);display(pre,1)}else{display(first,1);display(prehide,1);display(pre,1)}}}if((t=max-cur)<=0){display(last,0);display(nexthide,0);display(next,0)}else{if(t==1){display(last,1);display(nexthide,0);display(next,0)}else{if(t==2){display(last,1);display(nexthide,0);display(next,1)}else{display(last,1);display(nexthide,1);display(next,1)}}}})},setValue:function(value,flag){var upper=arguments.callee.upper;return this.each(function(profile){var arr=profile.box._ensureV(value),a=[];a[0]=arr[0];a[1]=arr[1];a[2]=arr[2];a[0]=a[0]<=0?1:a[0];a[0]=a[0]<a[1]?a[0]:a[1];a[2]=a[2]>a[1]?a[2]:a[1];value=a.join(":");upper.apply(profile.boxing(),[value,flag])})}},Static:{cssNone:false,Templates:{"default":{style:"{_style}",POOL:{style:"position:absolute;display:none;",POP:{tagName:"div"}},LABEL:{text:"{caption}"},FIRST:{tagName:"a",tabindex:"{tabindex}",$order:1},PREM:{tagName:"a",tabindex:"{tabindex}",href:"#",$order:2},PRE:{tagName:"a",tabindex:"{tabindex}",text:"{pre}",$order:3},CUR:{tagName:"a",tabindex:"{tabindex}",$order:4},NEXT:{tagName:"a",tabindex:"{tabindex}",text:"{next}",$order:5},NEXTM:{tagName:"a",tabindex:"{tabindex}",href:"#",$order:6},LAST:{tagName:"a",tabindex:"{tabindex}",$order:7}}},Appearances:{"default":{LABEL:{display:"inline","white-space":"nowrap"},KEY:{padding:linb.browser.ie?"3px":"",display:"inline"},"KEY a, POP a":{$order:1,"font-size":"12px",border:"solid 1px gray",padding:"0 3px 0 3px","vertical-align":"middle",margin:"3px"},"PRE,CUR,NEXT":{"font-weight":"bold"},CUR:{$order:1,background:"#316AC5",color:"#fff"},POP:{border:"dotted 1px gray",background:"#fff",position:"absolute",padding:"3px","line-height":"22px"}}},Behaviors:{"default":{POP:{onClick:function(profile,e){return profile.box.cancelLink(e)},onMousedown:function(profile,e,src){var o=linb(src);r=linb.event.getSrc(e);o.setBlurTrigger(profile.key+":"+profile.$id,null);profile.getSubNode("POOL").addLast(o);if(r.tagName.toLowerCase()=="a"){profile.box._click(profile,r)}}},FIRST:{onClick:function(profile,e){return profile.box.cancelLink(e)},onMousedown:function(profile,e,src){profile.box._click(profile,src);return false}},PREM:{onClick:function(profile,e){return profile.box.cancelLink(e)},onMousedown:function(profile,e,src){profile.box._show(profile,e,src,0);return false}},PRE:{onClick:function(profile,e){return profile.box.cancelLink(e)},onMousedown:function(profile,e,src){profile.box._click(profile,src);return false}},CUR:{onClick:function(profile,e){return profile.box.cancelLink(e)},onMousedown:function(profile,e,src){profile.box._click(profile,src);return false}},NEXT:{onClick:function(profile,e){return profile.box.cancelLink(e)},onMousedown:function(profile,e,src){profile.box._click(profile,src);return false}},NEXTM:{onClick:function(profile,e){return profile.box.cancelLink(e)},onMousedown:function(profile,e,src){profile.box._show(profile,e,src,1);return false}},LAST:{onClick:function(profile,e){return profile.box.cancelLink(e)},onMousedown:function(profile,e,src){profile.box._click(profile,src);return false}}}},DataModel:{dataField:null,dataBinder:null,caption:" Page: ",value:"1:1:1",uriTpl:"#*",textTpl:"*",pre:"&lt;",next:"&gt;",moreStep:100,tabindex:{action:function(value){if(this.domNode){this.root.dig("a").tabIndex(value)}}}},EventHandlers:{onClick:function(profile,src){}},_ensureV:function(v){var a=v.split(":"),b=[],fun=function(a){return parseInt(a)||1};b[0]=fun(a[0]);b[1]=fun(a[1]);b[2]=fun(a[2]);return b},_click:function(profile,src){profile.boxing().onClick(profile,src)},_show:function(profile,e,src,flag){var prop=profile.properties,arr=profile.box._ensureV(prop.value),min=arr[0],cur=arr[1],max=arr[2],keys=profile.keys,fun=function(p,k){return p.getSubNode(k)},pool=fun(profile,"POOL"),pop=fun(profile,"POP"),ceil=function(n){return Math.ceil((n+1)/10)*10},a=[],t,m,n,i,l;if(flag){if((t=max-1-cur)<=0){return }n=cur+1;l=max}else{if((t=cur-1-min)<=0){return }n=1;l=cur-1}m=Math.ceil(t/prop.moreStep);if(m>10){n=ceil(n);l=ceil(l)-1;m=ceil(m)}else{n=n+m}while(n<l){a.push('<a href="'+prop.uriTpl.replace("*",n)+'" onclick="return false">'+prop.textTpl.replace("*",n)+"</a>");n=n+m}pop.width("auto");pop.html(a.join(" "));linb(document.body).addLast(pop);if(pop.width()>300){pop.width(300)}pop.popToTop(src);pop.setBlurTrigger(profile.key+":"+profile.$id,function(){pool.addLast(pop)})}}});Class("linb.UI.Tabs",["linb.UI.iWidget","linb.UI.iList","linb.UI.iContainer"],{Instance:{setCtrlValue:function(value){this.each(function(profile){var id=profile.domId,box=profile.boxing(),uiv=box.getUIValue(),properties=profile.properties,itemId=profile.getSubSerialIdByItemId(uiv),temp,t;if(uiv&&profile.getSubSerialIdByItemId(uiv)){profile.removeTagClass("ITEM","-checked",profile.getSubNode("ITEM",itemId));profile.removeTagClass("BOX","-checked",profile.getSubNode("BOX",itemId));if(properties.hasPanel){box.getPanel(uiv).hide()}}itemId=profile.getSubSerialIdByItemId(value);if(itemId){profile.addTagClass("ITEM","-checked",profile.getSubNode("ITEM",itemId));profile.addTagClass("BOX","-checked",profile.getSubNode("BOX",itemId));if(properties.hasPanel){box.getPanel(value).position("relative").show("auto","auto");t=profile.domNode.style;profile.box.resize(profile,value,parseInt(t.width)||null,parseInt(t.height)||null)}}})},attach:function(ui,id){var self=this,profile=self.get(0),p=profile.properties,node;if(!id){id=p.$UIvalue||p.value}if(id){self.appendChild(ui,id);if(profile.domNode){node=self.getPanel(id);if(!node.isEmpty()){node.attach(ui)}}}return self},getCurPanel:function(){var profile=this.get(0);return this.getPanel(profile.properties.$UIvalue)},getPanel:function(id){var profile=this.get(0);return profile.getSubNodeByItemId("PANEL",id)},addPanel:function(para,children,item){var i={},id=item&&item.id;if(!id){var items=this.getItems();if(items.length){id=items[items.length-1].id}}_.merge(i,{caption:para.caption,icon:para.icon,closeBtn:para.closeBtn||false,landBtn:para.landBtn||false,iconPos:para.iconPos,dragKey:para.dragKey,dropKeys:para.dropKeys,id:para.id||para.tag||_.id()});this.insertItems([i],id);children.each(function(o){this.attach(o[0],i.id)},this)},removePanel:function(id){var self=this,profile=self.get(0),item=profile.getItemByDom(id);self.removeItems(item.id);return self},getPanelPara:function(domId){var profile=this.get(0),item=profile.getItemByDom(domId),para=_.clone(item);if(!para.dragKey){para.dragKey=profile.properties.dragKey}if(!para.dropKeys){para.dropKeys=profile.properties.dropKeys}return para},getPanelChildren:function(domId){var profile=this.get(0),id=profile.getItemIdByDom(domId),arr=[];if(id){profile.children.each(function(o){if(o[1]==id){arr.push(o)}})}return arr},fireItemClickEvent:function(id){var profile=this.get(0),node=profile.getSubNodeByItemId("ITEM",id);if(node.isEmpty()){profile.boxing().updateUIValue(null)}else{node.onMousedown()}return this},afterInsertItems:function(profile,data,base,before){var box=profile.box,obj,v;if(profile.properties.hasPanel&&(obj=profile.root)){obj.addLast(box.subBuild(profile,"panels",data).toDom());if(!(v=this.getUIValue())){this.fireItemClickEvent((v=profile.properties.items[0])&&(v=v.id))}var t=profile.domNode.style;box.resize(profile,v,parseInt(t.width)||null,parseInt(t.height)||null)}},removeItems:function(arr){var self=this,obj,serialId;if(!_.isArr(arr)){arr=[arr]}self.each(function(profile){if(profile.properties.hasPanel){arr.each(function(o){serialId=profile.getSubSerialIdByItemId(o);if(serialId&&!(obj=profile.getSubNode("PANEL",serialId)).isEmpty()){obj.remove()}})}});arguments.callee.upper.apply(self,arguments);self.each(function(profile){if(profile.properties.hasPanel){if(arr.exists(profile.boxing().getUIValue())){var i;profile.boxing().fireItemClickEvent((i=profile.properties.items[0])&&i.id)}profile.box.resize(profile,profile.boxing().getUIValue(),profile.root.width(),profile.root.height())}});return self},clearItems:function(){var self=this;self.each(function(profile){if(profile.properties.hasPanel){profile.getSubNode("PANEL",true).remove()}});self.setValue(null,true);arguments.callee.upper.apply(self,arguments);return self},markDirty:function(item,b,flag){var profile=this.get(0);if(typeof item=="string"){item=profile.getItemByItemId(item)}if((item._dirty!=b)||flag){var id=item.id,caption=profile.getItemByItemId(id).caption;profile.getSubNodeByItemId("CAPTION",id).html(profile.getItemByItemId(id).caption=b?("*"+caption):caption.replace(/^\*/,"")).setStyle("fontStyle",b?"italic":"normal");item._dirty=b}return this}},Static:{cssNone:false,Dropable:["PANEL","KEY","ITEM"],Dragable:["ITEM"],Templates:{"default":{tagName:"div",style:"{_style}",LIST:{$order:0,tagName:"div",style:"{HAlign}",ITEMS:{tagName:"div",text:"{items}"}},PNAELS:{$order:1,tagName:"text",text:"{panels}"},$dynamic:{items:{ITEM:{BOX:{HANDLE:{tagName:"a",href:"{href}",tabindex:"{_tabindex}",RULER:{},ICON:{style:"background:url({icon}) transparent  no-repeat {iconPos};{iconDisplay}",$order:0},CAPTION:{text:"{caption}",className:"{disabled}",$order:1},CMDS:{$order:2,LAND:{style:"{landDisplay}",$order:1},CLOSE:{style:"{closeDisplay}",$order:2}}}}}},panels:{PANEL:{tagName:"div",text:linb.UI.$childTag}}}}},Appearances:{"default":{KEY:{position:"absolute",overflow:"hidden"},LIST:{position:"relative"},ITEMS:{"padding-left":"4px","padding-right":"4px",position:"relative",background:linb.UI.getCSSImgPara("dot.gif"," repeat-x center bottom",null,"linb.UI.Public")},ITEM:{$order:0,"font-family":'"Verdana", "Helvetica", "sans-serif"',cursor:"pointer","padding-right":"6px","vertical-align":"top","border-bottom":"1px solid #91A7B4",background:linb.UI.getCSSImgPara("top.gif"," no-repeat right top")},"ITEM-mouseover":{$order:1,"background-position":"right -100px"},"ITEM-mousedown":{$order:2,"background-position":"right -200px","border-bottom":"1px solid #fff"},"ITEM-checked":{$order:3,"background-position":"right -200px","border-bottom":"1px solid #fff"},BOX:{$order:0,padding:"6px 0 2px 6px",border:0,"vertical-align":"top","text-align":"center",background:linb.UI.getCSSImgPara("top.gif"," no-repeat left -50px")},"BOX-mouseover":{$order:1,"background-position":"left -150px"},"BOX-mousedown":{$order:2,"background-position":"left -250px"},"BOX-checked":{$order:3,"background-position":"left -250px"},HANDLE:{cursor:"pointer","vertical-align":"middle",display:linb.browser.gek?["-moz-inline-block","-moz-inline-box"]:"inline-block","font-size":"12px"},RULER:{height:"16px",width:"1px"},ICON:{cursor:"pointer",width:"16px",height:"16px","vertical-align":"middle",margin:"0 4px 0 0"},"CLOSE, LAND":{cursor:"pointer",width:"15px",height:"15px","vertical-align":"middle"},CLOSE:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -64px 0",null,"linb.UI.Public")},"CLOSE-mouseover":{$order:1,"background-position":"-64px -16px"},"CLOSE-mousedown":{$order:2,"background-position":"-64px -32px"},LAND:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -220px 0",null,"linb.UI.Public")},"LAND-mouseover":{$order:1,"background-position":"-220px -16px"},"LAND-mousedown":{$order:2,"background-position":"-220px -32px"},PANEL:{position:"absolute",visibility:"hidden",top:"-10000px",left:"-10000px",overflow:"auto","background-color":"#fff"}}},Behaviors:{"default":{_hoverEffect:{ITEM:["ITEM","BOX"],CLOSE:"CLOSE",LAND:"LAND"},_clickEffect:{ITEM:["ITEM","BOX"],CLOSE:"CLOSE",LAND:"LAND"},onRewh:function(profile,e,src){var o=profile.domNode.style,w=null,h=null;if(e.height){h=parseInt(o.height)||null}if(e.width){w=parseInt(o.width)||null}profile.box.resize(profile,profile.properties.$UIvalue,w,h)},CAPTION:{onMousedown:function(profile,e,src){if(linb.event.getBtn(e)!="left"){return }var properties=profile.properties,item=profile.getItemByDom(src),box=profile.boxing();if(properties.disabled){return false}if(box.getUIValue()==item.id){profile.boxing().onItemActive(profile,profile.getItemByDom(src),src)}}},ITEM:{onClick:function(profile,e,src){return false},onMousedown:function(profile,e,src){if(linb.event.getBtn(e)!="left"){return }var properties=profile.properties,itemId=profile.getSubSerialId(src.id),item=profile.getItemByDom(src),box=profile.boxing();if(properties.disabled){return false}if(box.getUIValue()==item.id){return }profile.getSubNode("HANDLE",itemId).focus();box.updateUIValue(item.id);if(box.getUIValue()==item.id){box.onItemSelected(profile,item,src);return false}}},HANDLE:{onClick:function(profile,e,src){return profile.box.cancelLink(e)},onKeydown:function(profile,e,src){var keys=linb.event.getKey(e),key=keys[0],shift=keys[2];if(key=="space"||key=="enter"){profile.getSubNode("ITEM",profile.getSubSerialId(src.id)).onMousedown();return false}var cur=linb([src]),target=profile.getSubNode("ITEMS"),first=target.nextFocus(true,true,false),last=target.nextFocus(false,true,false);switch(key){case"tab":if(shift){if(src!=first.get(0)){first.focus();return false}}else{if(src!=last.get(0)){last.focus();return false}}break;case"left":case"up":var next=cur.nextFocus(false,true,false);if(cur.get(0)==first.get(0)){last.focus()}else{cur.nextFocus(false)}return false;break;case"right":case"down":var next=cur.nextFocus(true,false,false);if(cur.get(0)==last.get(0)){first.focus()}else{cur.nextFocus()}return false;break}}},CLOSE:{onClick:function(profile,e,src){var properties=profile.properties,item=profile.getItemByDom(src),bak;if(properties.disabled){return }var instance=profile.boxing();if(false===instance.beforePageClose(profile,item,src)){return }bak=_.copy(item);instance.removeItems(item.id);instance.afterPageClose(profile,bak);profile.box.resize(profile,profile.properties.$UIvalue,profile.root.width(),profile.root.height());return false}},LAND:{onClick:function(profile,e,src){var properties=profile.properties,item=profile.getItemByDom(src),id=item.id;if(properties.disabled){return }var panel=profile.boxing().getPanel(id),pos=profile.root.absPos(),size=profile.root.cssSize(),pro=linb.UI.Dialog.getDefaultProp();_.merge(pro,item,"with");_.merge(pro,{dragKey:item.dragkey||properties.dragKey,dock:"none",tag:item.tag||item.id,width:size.width,height:size.height,left:pos.left,top:pos.top},"all");var dialog=new linb.UI.Dialog(pro);linb(document.body).attach(dialog);profile.children.each(function(o){if(o[1]==id){dialog.attach(o[0])}},null,true);profile.boxing().removeItems(id);return false}}}},DataModel:{dataBinder:null,dataField:null,dock:"fill",hasPanel:true,width:200,height:200,position:"absolute",HAlign:{ini:"left",listbox:["left","right"],action:function(value){if(this.domNode){this.getSubNode("LIST").setStyle("textAlign",value)}}},tabindex:{action:function(value){if(this.domNode){this.getSubNode("HANDLE",true).tabIndex(value)}}},dragKey:"",dropKeysPanel:"",value:{ini:"a"},items:{set:function(v){return this.each(function(o){if(o.domNode){var box=o.boxing(),p,temp=linb.dom.getMatix(),children=o.children.copy();o.children.length=0;children.each(function(o){delete o[0].$dockParent;temp.addLast(o[0].root)});var value=o.properties.value;box.clearItems();linb.dom.$gc();box.insertItems(v);children.each(function(v){box.attach.apply(box,v)});temp.empty();box.setValue(value,true);var size=o.root.cssSize();o.box.resize(o,o.properties.$UIvalue,size.width,size.height)}else{o.properties.items=v}})}}},EventHandlers:{beforeNextFocus:null,beforePageClose:function(profile,item,src){},afterPageClose:function(profile,item,src){},onItemSelected:function(profile,item,src){},onItemActive:function(profile,item,src){}},createdTrigger:function(){if(this.properties.value){this.boxing().updateUIValue(this.properties.value)}},prepareData:function(profile){arguments.callee.upper.call(this,profile);var data=profile.data;data.panels=data.items;data.HAlign=data.HAlign=="right"?"text-align:right;":""},prepareItem:function(profile,item){item.closeDisplay=item.closeBtn?"":"display:none";item.landDisplay=item.landBtn?"":"display:none";item.href=item.href||"javascript:;"},getDropKeys:function(profile,node){var key=profile.getKey(node.id);if(key==profile.keys.PANEL){return profile.properties.dropKeys}else{return profile.properties.dropKeysPanel}},showTips:function(profile,node,pos){var id=node.id;if(!id){return false}if(profile.getKey(id)==profile.keys.PANEL){return true}return arguments.callee.upper.apply(this,arguments)},resize:function(profile,key,w,h){var t=profile.properties,temp,o=profile.boxing().getPanel(key),item=profile.getItemByItemId(key),l=profile.getSubNode("LIST"),lc=false;if(!o||o.isEmpty()){return }if(!parseInt(profile.domNode.style.height)){h=null}var wc=null,hc=null;if(w&&item._w!=w){wc=item._w=w;lc=true}if(lc){t._listH=l.get(0).offsetHeight||l.offsetHeight()}temp=t._listH;if((h&&item._h!=h)||lc){item._h=h;h=h-temp+(linb.browser.ie6?2:1);if(h>0){hc=h}}if(wc||hc){o.setRegion({width:wc?wc-2:null,height:hc?hc-2:null},true)}}}});Class("linb.UI.Stacks","linb.UI.Tabs",{Static:{Dropable:["PANEL","KEY","ITEM"],Appearances:{"default":{LIST:{position:"static"},ITEMS:{position:"static"},ITEM:{$order:0,display:"block",position:"absolute",cursor:"pointer",background:linb.UI.getCSSImgPara("barvbg.gif"," repeat-x left top",null,"linb.UI.Public"),height:"22px",width:"100%",left:0},BOX:{display:"block"},"ITEM-mouseover":{$order:1,"background-position":"right -22px"},"ITEM-mousedown":{$order:1,"background-position":"right -44px"},"ITEM-checked":{$order:1,"background-position":"right -44px"},HANDLE:{cursor:"pointer",display:"block","font-size":"12px",height:"100%","padding-left":"6px"},ICON:{cursor:"pointer",width:"16px",height:"16px",margin:"3px 4px 0 0"},CAPTION:{margin:"2px"},PANEL:{position:"absolute",visibility:"hidden",top:"-10000px",left:"-10000px",overflow:"auto","background-color":"#fff"},CMDS:{position:"absolute",top:0,right:0,"text-align":"right","vertical-align":"middle",height:"100%",cursor:"default"},"CMDS  span":{position:"relative",margin:"5px 4px 2px 0",width:"15px",height:"15px","vertical-align":"middle",cursor:"default"},CLOSE:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -64px 0",null,"linb.UI.Public")},"CLOSE-mouseover":{$order:1,"background-position":"-64px -16px"},"CLOSE-mousedown":{$order:2,"background-position":"-64px -32px"},LAND:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -220px 0",null,"linb.UI.Public")},"LAND-mouseover":{$order:1,"background-position":"-220px -16px"},"LAND-mousedown":{$order:2,"background-position":"-220px -32px"}}},resize:function(profile,key,w,h){var t=profile.properties,temp,t1,t2,obj,top,wc=null,hc=null,o=profile.boxing().getPanel(key);if(!o||o.isEmpty()){return }if(h){t2=t1=0;t.items.each(function(o){obj=profile.getSubNodeByItemId("ITEM",o.id);obj.bottom("auto").top(t1);t1+=obj.height();if(o.id==key){return false}});t.items.each(function(o){if(o.id==key){return false}obj=profile.getSubNodeByItemId("ITEM",o.id);obj.top("auto").bottom(t2);t2+=obj.height()},null,true);temp=h-t1-t2;if(temp>0){top=t1;hc=temp}}if(w){wc=w}o.setRegion({width:wc?wc:null,height:hc?hc:null,top:top,left:0},true);if(wc){profile.getSubNode("LIST").width(wc)}}}});Class("linb.UI.ButtonViews","linb.UI.Tabs",{Instance:{setCtrlValue:function(value){this.each(function(profile){var id=profile.domId,box=profile.boxing(),uiv=box.getUIValue(),properties=profile.properties,itemId=profile.getSubSerialIdByItemId(uiv),temp,t;if(uiv&&profile.getSubSerialIdByItemId(uiv)){profile.removeTagClass("ITEM","-checked",profile.getSubNode("ITEM",itemId));profile.removeTagClass("BOX","-checked",profile.getSubNode("BOX",itemId));box.getPanel(uiv).hide()}itemId=profile.getSubSerialIdByItemId(value);if(itemId){profile.addTagClass("ITEMS","-checked",profile.getSubNode("ITEM",itemId));profile.addTagClass("BOX","-checked",profile.getSubNode("BOX",itemId));box.getPanel(value).show();t=profile.domNode.style;profile.box.resize(profile,value,parseInt(t.width)||null,parseInt(t.height)||null)}})}},Initialize:function(){this.mapKeys(["LEFT","TOP","RIGHT","BOTTOM"])},Static:{Dropable:["PANEL","KEY","ITEM"],Appearances:{"default":{LIST:{"z-index":"2",position:"absolute","background-color":"#F3F3F3"},ITEMS:{"z-index":"2",position:"absolute",left:0,top:0},ITEM:{margin:"2px",position:"relative"},"ITEM-checked":{},LEFT:{"border-right":"1px solid #A7A6AA"},RIGHT:{"border-left":"1px solid #A7A6AA"},TOP:{"border-bottom":"1px solid #A7A6AA"},BOTTOM:{"border-top":"1px solid #A7A6AA"},BOX:{$order:0,border:"solid 1px #F3F3F3","vertical-align":"top"},"BOX-mouseover":{$order:1,border:"solid 1px #A7A6AA","background-color":"#FFFFE0"},"BOX-mousedown, BOX-checked":{$order:1,border:"solid 1px #A7A6AA","background-color":"#fff"},HANDLE:{cursor:"pointer",display:linb.browser.gek?["-moz-inline-block","-moz-inline-box"]:"inline-block","vertical-align":"middle","font-size":"12px",margin:"1px"},ICON:{cursor:"pointer",width:"16px",height:"16px",margin:"1px"}}},DataModel:{dock:"fill",handleDock:{ini:"top",listbox:["top","bottom","left","right"],action:function(v){var self=this,hs=self.getSubNode("LIST"),h=self.getSubNode("ITEM",true),b=self.getSubNode("BOX",true);switch(v){case"left":case"top":hs.setRegion({left:0,top:0,right:"auto",bottom:"auto"});break;case"right":case"bottom":hs.setRegion({left:"auto",top:"auto",right:0,bottom:0});break}switch(v){case"left":case"right":h.display("block");b.display("block");break;case"top":case"bottom":h.inlineBlock();b.inlineBlock();hs.height("auto");break}self.boxing().setHandleSize(self.properties.handleSize,true)}},handleHAlign:{ini:"left",listbox:["left","right"],action:function(v){var hl=this.getSubNode("ITEMS");hl.setStyle("textAlign",v)}},handleVAlign:{ini:"top",listbox:["top","bottom"],action:function(v){var hl=this.getSubNode("ITEMS");if(v=="top"){hl.top(0).bottom("auto")}else{hl.bottom(0).top("auto")}}},handleSize:{ini:50,action:function(v){var self=this,t=self.properties,hs=self.getSubNode("LIST"),hl=self.getSubNode("ITEMS");if(["left","right"].exists(t.handleDock)){hs.add(hl).width(v)}else{hs.height(v)}self.box.resize(self,self.properties.$UIvalue,self.root.width(),self.root.height())}}},renderedTrigger:function(){var pro=this.properties;this.boxing().setHandleDock(pro.handleDock,true).setHandleHAlign(pro.handleHAlign,true).setHandleVAlign(pro.handleVAlign,true)},resize:function(profile,key,w,h){var o=profile.boxing().getPanel(key),t=profile.properties,top,left,hs=profile.getSubNode("LIST"),hl=profile.getSubNode("ITEMS"),wc=null,hc=null;if(["top","bottom"].exists(t.handleDock)){if(w){hs.width(w);hl.width(w);left=0;wc=w}if(h-t.handleSize>0){hc=h-t.handleSize}top=t.handleDock=="top"?t.handleSize:0}else{if(h){hs.height(h);top=0;hc=h}if(w){left=t.handleDock=="left"?t.handleSize:0;wc=w-t.handleSize}}if(o&&!o.isEmpty()){o.setRegion({width:wc?wc:null,height:hc?hc:null,left:left,top:top},true)}}}});Class("linb.UI.RadioBox","linb.UI.List",{Initialize:function(){var t=this.getTemplate("default");t.$dynamic={items:{ITEM:{tagName:"a",href:"javascript:;",tabindex:"{_tabindex}",MARK:{$order:0},ICON:{style:"background:url({icon}) transparent  no-repeat {iconPos};{iconDisplay}",$order:1},CAPTION:{text:"{caption}",className:"{disabled}",$order:2}}}};this.setTemplate("default",t)},Static:{Appearances:{"default":{ITEM:{"font-family":' "Verdana", "Helvetica", "sans-serif"',border:0,margin:"2px",padding:"0 0 0 4px",cursor:"pointer","vertical-align":"middle",display:linb.browser.gek?["-moz-inline-block","-moz-inline-box"]:"inline-block","vertical-align":"middle","font-size":"12px"},"ITEM-checked":{},MARK:{cursor:"pointer",width:"16px",height:"16px",background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -144px top",null,"linb.UI.Public")},"ITEM-mouseover MARK":{$order:1,"background-position":" -144px -17px"},"ITEM-mousedown MARK":{$order:2,"background-position":" -144px -34px"},"ITEM-checked MARK":{$order:3,"background-position":" -128px top"},"ITEM-checked-mouseover MARK":{$order:4,"background-position":" -128px -17px"},"ITEM-checked-mousedown MARK":{$order:5,"background-position":" -128px -34px"},ICON:{cursor:"pointer",width:"16px",height:"16px",margin:"0 4px 0 0"},ITEMS:{overflow:"auto","line-height":"12px",background:"#fff"}}}}});Class("linb.UI.FoldingList",["linb.UI.List"],{Instance:{fillDetail:function(item,obj){var profile=this.get(0);profile.getSubNodeByItemId("BODYI",item.id).html("",false).attach(item._obj=obj)},toggle:function(id,onEnd){var profile=this.get(0),properties=profile.properties,items=properties.items,item=profile.getItemByItemId(id),subId=profile.getSubSerialIdByItemId(id),node=profile.getSubNode("ITEM",subId),nodenext=node.next();if(item._show){if(properties.activeLast&&items.length){if(items[items.length-1].id==item.id){return false}}profile.removeTagClass("ITEM","-checked",node);if(nodenext){profile.removeTagClass("ITEM","-prechecked",nodenext)}}else{profile.addTagClass("ITEM","-checked",node);if(nodenext){profile.addTagClass("ITEM","-prechecked",nodenext)}if(!item._fill){item._fill=true;item._body=profile.onBuildBody?profile.boxing().onBuildBody(profile,item,onEnd):profile.box.buildBody(profile,item,onEnd);if(item._body){profile.getSubNode("BODYI",subId).html(item._body,false)}}}item._show=!item._show},flod:function(id){}},Initialize:function(){var t=this.getTemplate("default");t.$dynamic={items:{ITEM:{tagName:"div",className:"{_checked} {_precheked}",HEAD:{tagName:"div",HL:{tagName:"div"},HR:{tagName:"div"},TITLE:{tagName:"a",href:"javascript:;",TLEFT:{$order:0,tagName:"div",MARK:{$order:0},CAP1:{$order:1,text:"{title}"}},TRIGHT:{$order:1,tagName:"div",style:"{_capDisplay}",CAP2:{$order:0,text:"{caption}"},OPT:{$order:1,style:"{_opt}"}}}},BODY:{$order:1,tagName:"div",BODYI:{$order:0,tagName:"div",text:"{_body}"},CMDS:{$order:1,tagName:"div",text:"{cmds}"}},TAIL:{$order:4,tagName:"div",TL:{tagName:"div"},TR:{tagName:"div"}}}},"items.cmds":{$order:2,CMD:{tagName:"a",href:"javascript:;",text:"{caption}"}}};this.setTemplate("default",t)},Static:{Appearances:{"default":{KEY:{padding:"2px"},ITEMS:{border:0,position:"relative",zoom:linb.browser.ie?1:null,"padding-top":"8px"},ITEM:{border:0,zoom:linb.browser.ie?1:null,"margin-top":"-9px",padding:0,background:"#FFF","font-family":'"Verdana", "Helvetica", "sans-serif"',position:"relative",overflow:"hidden"},"ITEM-mouseover":{},"HEAD, BODY, BODYI, TAIL":{position:"relative"},MARK:{position:"relative",margin:"0 2px 3px 0",width:"15px",height:"15px","vertical-align":"middle",cursor:"default",background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -48px 0",null,"linb.UI.Public")},"ITEM-mouseover MARK":{$order:2,"background-position":"-48px -16px"},"ITEM-mousedown MARK":{$order:3,"background-position":"-48px -32px"},"ITEM-checked MARK":{$order:4,"background-position":" -16px 0"},"ITEM-checked-mouseover MARK":{$order:5,"background-position":" -16px -16px"},"ITEM-checked-mousedown MARK":{$order:6,"background-position":" -16px -32px"},CMDS:{padding:"2px 8px 4px 14px","font-weight":"bold",position:"relative",background:linb.UI.getCSSImgPara("l.gif","repeat-y left top #EEE")},CMD:{margin:"2px 4px 2px 4px"},BODY:{display:"none","border-right":"solid 1px #CCC",zoom:linb.browser.ie?1:null,position:"relative",overflow:"auto",background:linb.UI.getCSSImgPara("l.gif","repeat-y left top")},BODYI:{padding:"2px 8px 0 8px",background:linb.UI.getCSSImgPara("l.gif","repeat-y left top"),position:"relative"},"ITEM-checked":{$order:2,"margin-bottom":"12px"},"ITEM-checked BODY":{$order:2,display:"block"},"HL, HR, TL, TR":{position:"absolute","_font-size":0,"_line-height":0,width:"8px"},"HL, HR":{height:"30px"},"ITEM-prechecked HL":{"background-position":"left top"},"ITEM-prechecked HR":{"background-position":"right top"},"TL, TR":{height:"20px"},HL:{top:0,left:0,background:linb.UI.getCSSImgPara("corner.gif"," no-repeat left -37px")},HR:{top:0,right:0,background:linb.UI.getCSSImgPara("corner.gif"," no-repeat right -37px")},TL:{bottom:0,left:0,background:linb.UI.getCSSImgPara("corner.gif"," no-repeat left bottom")},TR:{bottom:0,right:0,background:linb.UI.getCSSImgPara("corner.gif"," no-repeat right bottom")},HEAD:{position:"relative",zoom:linb.browser.ie?1:null,background:linb.UI.getCSSImgPara("t.gif","repeat-x left top"),overflow:"hidden"},TITLE:{$order:1,height:"24px",display:"block",position:"relative","white-space":"nowrap",overflow:"hidden"},TAIL:{"_font-size":0,"_line-height":0,position:"relative",height:"5px",background:linb.UI.getCSSImgPara("b.gif"," repeat-x left bottom #EEE")},"CAP1, CAP2":{padding:"3px"},CAP1:{color:"#666","white-space":"nowrap",font:"bold 12px arial,sans-serif;",color:"#00681C"},"ITEM-checked CAP1":{$order:2,"font-weight":"normal"},TLEFT:{position:"absolute",left:"4px",top:"2px","white-space":"nowrap",overflow:"hidden"},TRIGHT:{position:"absolute",right:"4px",top:"2px","white-space":"nowrap",overflow:"hidden"},OPT:{margin:"0 3px 3px 2px",width:"15px",height:"15px","vertical-align":"middle",cursor:"default",background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -240px top",null,"linb.UI.Public")},"OPT-mouseover":{$order:2,"background-position":"-240px -16px"},"OPT-mousedown":{$order:3,"background-position":"-240px -32px"}}},Behaviors:{"default":{_hoverEffect:{ITEM:"ITEM",OPT:"OPT"},ITEMS:{},ITEM:{},HEAD:{onClick:function(profile,e,src){return profile.box.cancelLink(e)},onMousedown:function(profile,e,src){profile.boxing().toggle(profile.getItemIdByDom(src))}},CMD:{onClick:function(profile,e,src){if(profile.onCommand){profile.boxing().onCommand(profile,profile.getItemByDom(src),src.id.split("_")[1],src)}return false}},OPT:{onMousedown:function(profile,e,src){if(profile.onOptions){profile.boxing().onOptions(profile,profile.getItemByDom(src),src)}return false}}}},DataModel:({tabindex:{action:function(value){if(this.domNode){this.getSubNode("HEAD",true).tabIndex(value)}}},cmds:{ini:[]},optBtn:{ini:false,action:function(v){this.getSubNode("OPT").display(v?"":"none")}},activeLast:false}),EventHandlers:{onBuildBody:function(profile,item,onEnd){},onCommand:function(profile,item,cmdkey,src){},onOptions:function(profile,item,src){}},prepareData:function(profile){arguments.callee.upper.call(this,profile)},prepareItems:function(profile,arr,pid){if(arr.length){arr[0]._precheked=profile.getClass("ITEM","-prechecked");if(profile.properties.activeLast){var item=arr[arr.length-1];item._show=true;item._fill=true;item._body=profile.onBuildBody?profile.boxing().onBuildBody(profile,item):profile.box.buildBody(profile,item)}}return arguments.callee.upper.apply(this,arguments)},prepareItem:function(profile,item){var p=profile.properties,o,dpn="display:none";item._tabindex=p.tabindex;if(!item.caption){item._capDisplay=dpn}else{item.caption=item.caption.replace(/</g,"&lt;")}item._opt=p.optBt?"":dpn;item._body=item._body||"Loading...";if(item._show){item._checked=profile.getClass("ITEM","-checked")}var cmds=item.cmds||p.cmds;if(cmds&&cmds.length){var sid=linb.UI.subSerialIdTag,a;a=item.cmds=[];for(var i=0,t=cmds,l=t.length;i<l;i++){o=linb.UI.copyItem(t[i]);a.push(o);o[sid]=item[sid]+"_"+o.id}}},buildBody:function(profile,item){return item.text?"<pre>"+item.text.replace(/</g,"&lt;")+"</pre>":""}}});Class("linb.UI.TreeBar",["linb.UI.iWidget","linb.UI.iList","linb.UI.iNavigator"],{Instance:{setCtrlValue:function(value,flag){return this.each(function(profile){if(!profile.domNode){return }var box=profile.boxing(),uiv=box.getUIValue(),properties=profile.properties;if(properties.selMode=="single"){var itemId=profile.getSubSerialIdByItemId(uiv);if(uiv&&itemId){profile.removeTagClass("BAR","-checked",profile.getSubNode("BAR",itemId));profile.removeTagClass("MARK2","-checked",profile.getSubNode("MARK2",itemId))}itemId=profile.getSubSerialIdByItemId(value);if(itemId){profile.addTagClass("BAR","-checked",profile.getSubNode("BAR",itemId));profile.addTagClass("MARK2","-checked",profile.getSubNode("MARK2",itemId))}}else{if(properties.selMode=="multi"){uiv=uiv?uiv.split(";"):[];value=value?value.split(";"):[];if(flag){value.each(function(o){profile.addTagClass("BAR","-checked",profile.getSubNodeByItemId("BAR",o));profile.addTagClass("MARK2","-checked",profile.getSubNodeByItemId("MARK2",o))})}else{uiv.each(function(o){if(!value.exists(o)){profile.removeTagClass("BAR","-checked",profile.getSubNodeByItemId("BAR",o));profile.removeTagClass("MARK2","-checked",profile.getSubNodeByItemId("MARK2",o))}});value.each(function(o){if(!uiv.exists(o)){profile.addTagClass("BAR","-checked",profile.getSubNodeByItemId("BAR",o));profile.addTagClass("MARK2","-checked",profile.getSubNodeByItemId("MARK2",o))}})}}}})},setValue:function(value,flag){var upper=arguments.callee.upper;return this.each(function(profile){if(profile.properties.selMode=="multi"){var arr=value.split(";");arr.sort();value=arr.join(";")}upper.apply(profile.boxing(),[value,flag])})},insertItems:function(arr,pid,base,before){var node,self=this.constructor;return this.each(function(profile){var tar,r,k;if(!pid){k=profile.properties;tar=k.items||(k.items=[])}else{k=profile.getItemByItemId(pid);tar=k.sub||(k.sub=[])}if(!base){tar.insertAny(arr,before?0:-1)}else{var index=tar.subIndexOf(id,base);tar.insertAny(arr,before?index:(index+1))}if(profile.domNode){if(!base){if(!pid){node=profile.getSubNode("ITEMS")}else{k=profile.getItemByItemId(pid);if(k._created){node=profile.getSubNodeByItemId("SUB",pid)}}if(node){r=self.subBuild(profile,"items",profile.box.prepareItems(profile,arr,pid)).toDom();if(before){node.addFirst(r)}else{node.addLast(r)}}}else{k=profile.getItemByItemId(pid);if(k._created){r=self.subBuild(profile,"items",profile.box.prepareItems(profile,arr,pid)).toDom();node=profile.getSubNodeByItemId("ITEM",base);if(before){node.addPre(r)}else{node.addNext(r)}}}}var obj;if(pid){if((obj=profile.getSubNodeByItemId("MARK1",pid)).display()=="none"){obj.inlineBlock()}}if(!profile.properties.iniFold){if(!pid||profile.getItemByItemId(pid)._created){profile.boxing().toggleNodes(arr,true)}}})},updateItem:function(id,name,value){var profile=this.get(0),item=profile.getItemByItemId(id);if(!item){return }item[name]=value;switch(name){case"caption":profile.getSubNodeByItemId("CAPTION",id).html(value,false);break}},moveItems:function(ids,toPid){var profile=this.get(0),t;if(toPid){var domPid=profile.getSubSerialIdByItemId(toPid),pItem=profile.getItemByItemId(toPid),pItemSub=pItem.sub||(pItem.sub=[]),domP=profile.getSubNode("SUB",domPid);if((t=profile.getSubNode("MARK1",domPid)).visibility()=="none"){t.inlineBlock()}}else{var pItemSub=profile.properties.items,domP=profile.root}ids.each(function(id){var domId=profile.getSubSerialIdByItemId(id),iItem=profile.getItemByItemId(id);var sub;if(iItem._pid){sub=profile.getItemByItemId(iItem._pid).sub}else{sub=profile.properties.items}var index=sub.subIndexOf("id",id);sub[index]._pid=toPid;pItemSub.insertAny(sub[index]);sub.remove(index);domP.addLast(profile.getSubNode("ITEM",domId))})},toggleNodes:function(items,flag,recursive){if(items&&items.length){items.each(function(o){if(o.sub&&o.sub.length&&((flag&&!o._checked)||(!flag&&o._checked))){this.toggleNode(o.id,flag)}},this)}},toggleNode:function(id,flag,recursive){var profile=this.get(0),o=profile.getItemByItemId(id);if(o&&((flag&&!o._checked)||(!flag&&o._checked))){profile.box.setSub(profile,o,flag,recursive)}},openToNode:function(id){return this.each(function(profile){var res=false,a=[],fun=function(arr,catId,layer){layer=layer||0;var me=arguments.callee;arr.each(function(o){if(o.id==catId){a.push(o);ref=o.sub;res=true;return false}if(o.sub){res=me.call(me,o.sub,catId,++layer);if(res){a.push(o);return false}}});return res};fun(profile.properties.items,id);if(res){a.reverse();a.pop();a.each(function(o){if(!o._checked){profile.box.setSub(profile,o,true)}})}})},selectItem:function(id){var profile=this.get(0);var node=profile.getSubNodeByItemId("BAR",id);if(!node.isEmpty()){node.onClick();return this}else{return false}}},Initialize:function(){this.mapKeys(["DISABLED"])},Static:{$recursive:true,cssNone:false,Templates:{"default":{tagName:"div",style:"{_style}",BORDER:{tagName:"div",BOX:{tagName:"div",onselectstart:"return false",ITEMS:{tagName:"div",text:"{items}"}}},$dynamic:{items:{ITEM:{tagName:"div",onselectstart:"return false",unselectable:"on",BAR:{$order:0,tagName:"div",className:"{cls_group} ",onselectstart:"return false",unselectable:"on",CMD:{tagName:"a",href:"{href}",tabindex:"{_tabindex}",MARK1:{$order:0,style:"{mark}"},MARK2:{$order:1,style:"{mark2Display}"},ITEMICON:{style:"background:url({icon}) transparent  no-repeat   {iconPos}; {iconDisplay}",$order:2},ITEMCAPTION:{text:"&nbsp;{caption}",className:"{disabled} ",$order:3}}},SUB:{$order:1,tagName:"div",text:linb.UI.$childTag}}}}}},Appearances:{"default":{KEY:{"font-family":"Verdana, Helvetica, sans-serif",border:0},BOX:{left:0,overflow:"auto","overflow-x":(linb.browser.ie||linb.browser.gek)?"hidden":""},ITEMS:{overflow:"hidden","border-bottom":"1px solid #e5e5e5","border-right":"1px solid #e5e5e5"},BORDER:{"background-color":"#fff"},ITEM:{"border-left":"1px solid #e5e5e5","white-space":"nowrap",overflow:"hidden"},BAR:{overflow:"hidden","border-top":"1px solid #e5e5e5",padding:"1px"},DISABLED:{color:"#808080"},"BAR-mouseover":{$order:1,"background-color":"#d9e8fb"},"BAR-checked":{$order:2,"background-color":"#f6f6f6"},"BAR-GROUP":{$order:2,background:linb.UI.getCSSImgPara("group.gif"," repeat-x left top"),padding:"1px"},"BAR-GROUP-mouseover":{$order:3,"background-position":"left -30px"},"BAR-GROUP-checked":{$order:4,"background-position":"left -60px"},CMD:{cursor:"pointer","vertical-align":"middle",display:"block",overflow:"hidden","font-size":"12px"},SUB:{display:"none",overflow:"hidden","margin-left":"12px"},MARK1:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -161px top",null,"linb.UI.Public"),cursor:"pointer",width:"16px",height:"16px",margin:"0 4px 0 0"},"MARK1-mouseover":{$order:2,"background-position":"-161px -15px"},"MARK1-mousedown":{$order:3,"background-position":"-161px -30px"},"MARK1-checked":{$order:4,"background-position":"-176px top"},"MARK1-checked-mouseover":{$order:5,"background-position":"-176px -15px"},"MARK1-checked-mousedown":{$order:6,"background-position":"-176px -30px"},"MARK1-BUSY":{$order:7,background:linb.UI.getCSSImgPara("busy.gif"," no-repeat center center",null,"linb.UI.Public")},MARK2:{cursor:"pointer",width:"16px",height:"16px",margin:"0 4px 0 0"},"MARK2-checked":{$order:2,background:linb.UI.getCSSImgPara("icon.gif"," no-repeat -50px 0",null,"linb.UI.Public")},"ITEMICON, ICON":{cursor:"pointer",width:"16px",height:"16px"}}},Behaviors:{"default":{_hoverEffect:{MARK1:"MARK1",BAR:"BAR"},_clickEffect:{MARK1:"MARK1",BAR:"BAR"},onRewh:function(profile,e,src){var o=profile.root,w=null,h=null;if(e.height){h=o.height()}if(e.width){w=o.width()}profile.box.resize(profile,w,h)},MARK1:{onClick:function(profile,e,src){var properties=profile.properties,item=profile.getItemByDom(src);if(properties.disabled||item.disabled){return false}if(!item.sub){return false}profile.box.setSub(profile,item,!item._checked);return false}},BAR:{onMousedown:function(profile,e,src){var properties=profile.properties,item=profile.getItemByDom(src);if(item.dragable){linb([src],false).startDrag(e,{type:"copy",move:false,key:item.dragKey||profile.properties.dragKey,data:item.id});profile.removeTagClass("BAR","-mouseover",linb([src]))}},onClick:function(profile,e,src){var properties=profile.properties,item=profile.getItemByDom(src),itemId=profile.getSubSerialId(src.id),box=profile.boxing(),rt;if(properties.disabled||item.disabled){return false}if(item.sub&&(item.group!=undefined?item.group:properties.group)){profile.getSubNode("MARK1",itemId).onClick();return false}switch(properties.selMode){case"none":rt=box.onItemSelected(profile,item,src);break;case"multi":var value=box.getUIValue(),arr=value?value.split(";"):[];if(arr.exists(item.id)){arr.removeValue(item.id)}else{arr.push(item.id)}arr.sort();value=arr.join(";");if(box.getUIValue()==value){rt=false}else{box.updateUIValue(value);if(box.getUIValue()==value){rt=box.onItemSelected(profile,item,src)}}break;case"single":if(box.getUIValue()==item.id){rt=false}else{box.updateUIValue(item.id);if(box.getUIValue()==item.id){rt=box.onItemSelected(profile,item,src)}}break}profile.getSubNode("CMD",itemId).focus();return rt}},BOX:{onScroll:function(profile,e,src){if(linb([src]).scrollLeft()!==0){linb([src]).scrollLeft(0)}}},CMD:{onKeydown:function(profile,e,src){var keys=linb.event.getKey(e),key=keys[0],shift=keys[2],cur=linb([src],false),first=profile.root.nextFocus(true,true,false),last=profile.root.nextFocus(false,true,false);switch(linb.event.getKey(e)[0]){case"tab":if(shift){if(src!=first.get(0)){first.focus();return false}}else{if(src!=last.get(0)){last.focus();return false}}break;case"up":var next=cur.nextFocus(false,true,false);if(cur.get(0)==first.get(0)){last.focus()}else{cur.nextFocus(false)}return false;break;case"down":var next=cur.nextFocus(true,false,false);if(cur.get(0)==last.get(0)){first.focus()}else{cur.nextFocus()}return false;break;case"right":case"left":profile.getSubNode("MARK1",profile.getSubSerialId(src.id)).onClick();return false;case"enter":case"space":profile.getSubNode("BAR",profile.getSubSerialId(src.id)).onClick();return false}},onClick:function(e){}}}},EventHandlers:{onRequestData:function(profile,item,threadid){},onItemSelected:function(profile,item,src){}},DataModel:{listKey:null,tabindex:{action:function(value){if(this.domNode){this.getSubNode("CMD",true).tabIndex(value)}}},iniFold:true,fx:false,dragKey:"treeBar",dock:"fill",group:{ini:false,action:function(v){var self=this,items=this.properties.items,results=this.itemsSearch(items,function(o){return o.sub&&o.group==undefined}),nodes=linb([]);results.each(function(o){nodes.add(self.getSubNodeByItemId("BAR",o.id))});var cls1=this.getClass("BAR"),cls2=this.getClass("BAR","-group");if(v){nodes.reClass(new RegExp("(\\b)"+cls1+"([^b]*\\b)","g"),"$1"+cls2+"$2")}else{nodes.reClass(new RegExp("(\\b)"+cls2+"([^b]*\\b)","g"),"$1"+cls1+"$2")}}},selMode:{ini:"single",listbox:["single","none","multi"],action:function(v,ov){var n=this.getSubNode("MARK2",true);if(ov=="none"){n.inlineBlock()}if(v=="none"){n.display("none")}}},singleOpen:false,dynBuild:false,position:"absolute"},createdTrigger:function(){if(linb.browser.ie){this.root.addEvent("ondrag",function(){return false}).addEvent("onselectstart",function(){return false})}if(!this.properties.iniFold){this.boxing().toggleNodes(this.properties.items,true)}},prepareItem:function(profile,item,oitem,pid){var p=profile.properties;if(pid){oitem._pid=pid}item.mark=item.sub?"":"display:none";item.disabled=item.disabled?profile.getClass("KEY","-disabled"):"";item.mark2Display=(p.selMode=="none")?"display:none":"";item._tabindex=p.tabindex;item.href=item.href||"javascript:;";if(item.sub&&(item.group!=undefined?item.group:p.group)){item.cls_group=profile.getClass("BAR","-group");item.mark2Display="display:none"}},setSub:function(profile,item,flag,recursive){var id=profile.domId,itemId=profile.getSubSerialIdByItemId(item.id),properties=profile.properties,barNode=profile.getSubNode("BAR",itemId),markNode=profile.getSubNode("MARK1",itemId),subNs=profile.getSubNode("SUB",itemId);if(linb.thread.exists(profile.key+profile.id)){return }if(item._checked){if(!flag){var h=subNs.height();if(properties.fx){subNs.fx({height:[h,0]},function(){subNs.height(h)},function(){subNs.display("none").height("auto")},200,8,"inexp",profile.key+profile.id).start()}else{subNs.display("none").height("auto")}profile.removeTagClass("MARK1","-checked",markNode);if(item.group||properties.group){profile.removeTagClass("BAR","-checked",barNode)}item._checked=false;if(properties.dynBuild){var s=item.sub,arr=[];for(var i=0,l=s.length;i<l;i++){arr.push(s[i].id)}profile.boxing().removeItems(arr);delete item._created}}}else{if(flag){var openSub=function(profile,item,id,markNode,subNs,barNode,sub,recursive){var b=profile.boxing(),p=profile.properties;if(!item._created){delete item.sub;item._created=true;subNs.display("none");b.insertItems(sub,item.id);b.setCtrlValue(b.getUIValue(),true)}if(p.singleOpen){b.toggleNodes(item._pid?profile.getItemByItemId(item._pid).sub:p.items,false)}if(!recursive){var h=subNs.height(true);if(p.fx){subNs.fx({height:[0,h]},function(){subNs.height("0").display("block")},function(){subNs.height("auto")},200,8,"outexp",profile.key+profile.id).start()}else{subNs.display("block").height("auto")}}else{subNs.display("block")}profile.addTagClass("MARK1","-checked",markNode);if(item.group||properties.group){profile.addTagClass("BAR","-checked",barNode)}item._checked=true};var sub=item.sub;if(sub&&sub.length){openSub(profile,item,id,markNode,subNs,barNode,sub,recursive);if(recursive){sub.each(function(o){if(o.sub&&o.sub.length&&!o._checked){profile.box.setSub(profile,o,true,recursive)}})}}else{linb.thread(null,[function(threadId){if(profile.onRequestData){profile.boxing().onRequestData(profile,item,threadId)}else{linb.thread(threadId).abort()}},function(threadId){sub=linb.thread(threadId).getCache("response");if(sub){openSub(profile,item,id,markNode,subNs,barNode,sub,recursive);openSub=null}}],null,null,function(threadId){profile.addTagClass("MARK1","-busy",markNode);linb(id).busy(false)},function(){profile.removeTagClass("MARK1","-busy",markNode);linb(id).free()}).start()}}}},resize:function(profile,w,h){profile.getSubNode("BORDER").cssSize({width:w?w:null,height:h?h:null});profile.getSubNode("BOX").cssSize({width:w?w:null,height:h?h:null})}}});Class("linb.UI.PopMenu",["linb.UI.Widget","linb.UI.iList","linb.UI.iNavigator"],{Instance:{activate:function(){return linb.UI.iList.prototype.activate.call(this)},adjustSize:function(){return this.each(function(profile){var root=profile.root,items=profile.getSubNode("ITEMS"),border=profile.getSubNode("BORDER"),size1=root.cssSize(),size2=border.cssSize(),h=Math.min(profile.properties.maxHeight,items.height()+size1.height-size2.height+2),w=Math.min(profile.properties.maxWidth,items.width()+size1.width-size2.width+2);profile.properties.width=w;profile.properties.height=h;root.cssSize({width:w,height:h},true);profile.boxing().setScrollButtons()})},setScrollButtons:function(){return this.each(function(profile){var o=profile.getSubNode("ITEMS"),t=o.offsetTop(),h=o.offsetHeight(),b=profile.getSubNode("BORDER"),hh=b.offsetHeight();profile.getSubNode("TOP").display(t===0?"none":"block");profile.getSubNode("BOTTOM").display((hh>h+t)?"none":"block")})},scrollToBottom:function(){return this.each(function(profile){var o=profile.getSubNode("ITEMS"),border=profile.getSubNode("BORDER"),y=o.offsetTop(),offset,h=o.offsetHeight(),b=false,bh=border.height();if(bh<h+y){if(!profile.$scrollStep){profile.$scrollStep=1}if(profile.$scrollStep<30){profile.$scrollStep=profile.$scrollStep*1.1}y-=profile.$scrollStep;if(bh>h+y){y=bh-h;b=true}o.top(y);if(b){profile.getSubNode("BOTTOM").display("none");profile.$scrollTobottom=false;profile.$scrollStep=null}else{profile.getSubNode("TOP").display("block");if(profile.$scrollTobottom){_.asyRun(arguments.callee,0,[profile],this)}}}})},scrollToTop:function(){return this.each(function(profile){var o=profile.getSubNode("ITEMS"),y=o.offsetTop(),b=false;if(y<0){if(!profile.$scrollStep){profile.$scrollStep=1}if(profile.$scrollStep<10){profile.$scrollStep=profile.$scrollStep*1.03}y+=profile.$scrollStep;if(y>=-1){y=0;b=true}o.top(y);if(b){profile.getSubNode("TOP").display("none");profile.$scrollToTop=false;profile.$scrollStep=null}else{profile.getSubNode("BOTTOM").display("block");if(profile.$scrollToTop){_.asyRun(arguments.callee,0,[profile],this)}}}})},pop:function(obj,parent,type){var profile=this.get(0);if(!profile.created){profile.boxing().create(true)}if(profile.$highLight){profile.removeTagClass("ITEM","-mouseover",linb([profile.$highLight],false))}profile.root.popToTop(obj,parent,type);var f=function(){var p=arguments.callee.profile;p.boxing().hide();p.$groupPopMenu.length=0};f.profile=profile;if(!profile.$groupPopMenu||!profile.$groupPopMenu.length){profile.$groupPopMenu=[profile.root.get(0)];profile.root.setBlurTrigger(profile.$id,null);profile.root.setBlurTrigger(profile.$id,f,profile.$groupPopMenu)}},hide:function(flag){var t,profile=this.get(0);profile.root.setBlurTrigger(profile.$id,null);if(profile.$hideMenuPool){profile.$hideMenuPool.addLast(profile.root)}else{profile.root.display("none")}var p=profile.$childPopMenu,q;while(p){p.boxing().hide();p=(q=p).$childPopMenu;q.$childPopMenu=q.$subPopMenuShowed=null}profile.$childPopMenu=profile.$subPopMenuShowed=null;if(t=profile.$parentPopMenu){t.$subPopMenuShowed=null}profile.$groupPopMenu.removeValue(profile.root.get(0));if(false!==flag){profile.boxing().onHide(profile)}}},Initialize:function(){var t=this.getTemplate("default");_.merge(t.FRAME.BORDER,{TOP:{},BOTTOM:{},BOX:{tagName:"div",ITEMS:{tagName:"div",text:"{items}"}},POOL:{tagName:"div",style:"display:none;"}},"all");t.$dynamic={items:function(profile,template,v,tag,result){tag=tag+"."+v.type;if(template[tag]){linb.UI.$doTemplate(profile,template,v,tag,result)}},"items.split":{ITEMSPLIT:{tagName:"div",ITEMIN:{style:"width:2px;height:2px;font-size:0;line-height:0;"}}},"items.button":{ITEM:{tagName:"a",href:"javascript:;",tabindex:0,className:"{cls}",ICON:{style:"background:url({icon}) transparent  no-repeat {iconPos};",$order:0},CAPTION:{text:"{caption}",$order:1},RULER:{style:"{displayAdd}",$order:2},ADD:{tagName:"div",style:"{displayAdd}",text:"{add}",$order:2},SUB:{style:"{tagClass}"}}}};this.setTemplate("default",t)},Static:{hasDomRoot:false,Appearances:{"default":{KEY:{"font-size":"12px",visibility:"hidden"},BORDER:{border:"1px solid","border-color":"#fff #cdcdcd #cdcdcd #fff"},BOX:{"background-color":"#F9F8F7",overflow:"hidden",position:"absolute",left:0,top:0,"z-index":"3"},ITEMS:{position:"absolute",top:0,left:0,overflow:"visible",background:linb.UI.getCSSImgPara("bg.gif"," repeat-y left top")},ITEM:{display:"block",position:"relative",overflow:"visible","white-space":"nowrap",color:"#000","font-family":'"Verdana", "Helvetica", "sans-serif"',cursor:"pointer",padding:"2px 20px 2px 2px"},ITEMSPLIT:{display:"block",position:"relative",overflow:"hidden","font-size":0,"line-height":0,margin:"2px 2px 2px 26px",background:linb.UI.getCSSImgPara("hsplit.gif"," repeat-x left top",null,"linb.UI.Public")},"ITEM-mouseover":{$order:1,"background-color":"#B6BDD2"},"ITEM-checked":{$order:2,"background-color":"#B6BDD2"},TOP:{cursor:"pointer",display:"none",position:"absolute","margin-left":"-8px",right:0,height:"16px",width:"16px","z-index":"10",top:0,background:linb.UI.getCSSImgPara("icon.gif"," no-repeat -33px 0",null,"linb.UI.Public")},BOTTOM:{cursor:"pointer",display:"none",position:"absolute","margin-left":"-8px",right:0,height:"16px",width:"16px","z-index":"10",bottom:0,background:linb.UI.getCSSImgPara("icon.gif"," no-repeat -33px -17px",null,"linb.UI.Public")},ICON:{cursor:"pointer",width:"16px",height:"16px",margin:"0 4px 0 0"},CAPTION:{"vertical-align":"bottom","padding-left":"2px"},RULER:{width:"100px","font-size":0,"line-height":0},ADD:{"font-family":'"Verdana", "Helvetica", "sans-serif"',"font-size":"11px",position:"absolute",top:"2px",right:0,width:"80px",padding:"2px 20px 2px 2px","text-align":"right","z-index":"10"},SUB:{position:"absolute",top:"4px",right:0,width:"8px",height:"16px",background:linb.UI.getCSSImgPara("icon.gif"," no-repeat left -16px",null,"linb.UI.Public")}}},Behaviors:{"default":{ITEM:{onMouseover:function(profile,e,src){if(profile.$highLight==src){return }var properties=profile.properties,item=profile.getItemByDom(src),itemId=item.id;var Cancel=false;if(profile.$subPopMenuShowed){if(profile.$subPopMenuShowed==profile.$allRelatedPopMenus[itemId]){Cancel=true}else{profile.$subPopMenuShowed.hide();profile.$subPopMenuShowed=null}}if(!Cancel){if(profile.$highLight){profile.removeTagClass("ITEM","-mouseover",linb([profile.$highLight],false))}profile.$highLight=src;profile.addTagClass("ITEM","-mouseover",linb([profile.$highLight],false));src.focus()}if(!Cancel&&item.sub){var pop;profile.$allRelatedPopMenus=profile.$allRelatedPopMenus||{};if(!(pop=profile.$allRelatedPopMenus[itemId])){pop=(new linb.UI.PopMenu({position:"absolute",items:item.sub})).create(true);pop.onMenuSelected(function(pro,id,item,src){profile.boxing().onMenuSelected(profile,id,item,src)});pop.get(0).$hideMenuPool=profile.$hideMenuPool||profile.getSubNode("POOL");profile.$allRelatedPopMenus[itemId]=pop;profile.$showpops=profile.$showpops||[profile];pop.get(0).$showpops=profile.$showpops;profile.$showpops.push(pop.get(0))}profile.$groupPopMenu.push(pop.get(0).root.get(0));pop.get(0).$groupPopMenu=profile.$groupPopMenu;pop.get(0).$parentPopMenu=profile;profile.$childPopMenu=pop.get(0);pop.pop(src,null,2);profile.$subPopMenuShowed=pop}},onMouseout:function(profile,e,src){var properties=profile.properties,item=profile.getItemByDom(src),itemId=item.id;var action=true;if(profile.$subPopMenuShowed){var node=e.toElement||e.relatedTarget;var target=profile.$subPopMenuShowed.get(0).root.get(0);try{do{if(node==target){return }}while((node&&(node=node.parentNode)))}catch(a){}}else{profile.removeTagClass("ITEM","-mouseover",linb([src],false));profile.$highLight=null;if(profile.$subPopMenuShowed){profile.$subPopMenuShowed.hide();profile.$subPopMenuShowed=null}}},onClick:function(profile,e,src){var properties=profile.properties,item=profile.getItemByDom(src),itemId=item.id;if(item.sub){}else{profile.boxing().onMenuSelected(profile,item.id,item,src);profile.removeTagClass("ITEM","-mouseover",linb(this));var p=profile,q;while(p){p.boxing().hide();p=(q=p).$parentPopMenu;q.$parentPopMenu=q.$subPopMenuShowed=null}profile.$subPopMenuShowed=null;profile.$groupPopMenu.length=0}return false},onFocus:function(profile,e,src){var box=profile.getSubNode("BOX"),top=box.scrollTop(),h=box.scrollHeight(),n=linb(src).offsetTop();if(n<top||n>top+h){linb(src).offsetTop(top)}linb(src).onMouseover()},onKeydown:function(profile,e,src){var item=profile.getItemByDom(src),items=profile.properties.items,itemId=item.id,flag,r,tid,node;var t,key=linb.event.getKey(e)[0];switch(key){case"up":r=true;flag=false;items.each(function(o,i){if(o.type=="split"){return }if(flag){tid=o.id;return r=false}if(o.id==itemId){flag=true}},null,true);if(r){tid=items[items.length-1].id}node=profile.getSubNodeByItemId("ITEM",tid).get(0);if(node){node.focus()}break;case"down":r=true;flag=false;items.each(function(o,i){if(o.type=="split"){return }if(flag){tid=o.id;return r=false}if(o.id==itemId){flag=true}});if(r){tid=items[0].id}node=profile.getSubNodeByItemId("ITEM",tid).get(0);if(node){node.focus()}break;case"left":if(t=profile.$parentPopMenu){if(t=profile.$parentPopMenu.$highLight){node=t}}if(node){node.focus()}break;case"right":if((t=profile.$subPopMenuShowed)&&t==profile.$allRelatedPopMenus[itemId]){t.activate()}break}}},TOP:{onMouseover:function(profile,e,src){profile.$scrollToTop=true;profile.boxing().scrollToTop()},onMouseout:function(profile,e,src){profile.$scrollToTop=false;profile.$scrollStep=null},onClick:function(profile,e,src){profile.$scrollStep=1000}},BOTTOM:{onMouseover:function(profile,e,src){profile.$scrollTobottom=true;profile.boxing().scrollToBottom()},onMouseout:function(profile,e,src){profile.$scrollTobottom=false;profile.$scrollStep=null},onClick:function(profile,e,src){profile.$scrollStep=1000}},ITEMS:{beforeKeydown:function(profile,e){var key=linb.event.getKey(e)[0];if(key=="tab"||key=="enter"){return true}else{if(/^\w$/.test(key)){profile._wordcache=profile._wordcache||"";profile._wordcache+=key;clearTimeout(profile._wordcachetimeout);var arr=profile.properties.items;arr.each(function(o,i){if(o.caption.toLowerCase().startWith(profile._wordcache)){profile.getSubNodeByItemId("ITEM",o.id).focus();return false}});profile._wordcachetimeout=_.asyRun(function(){profile._wordcache=""},300)}else{if(key=="esc"){profile.boxing().onCancelled(profile);do{profile.boxing().hide()}while(profile=profile.$parentPopMenu);return false}else{return false}}}}}}},DataModel:({dataField:null,dataBinder:null,dock:null,tabindex:null,tips:null,icon:null,iconPos:null,caption:null,border:null,$fix:true,shadow:true,resizable:false,maxHeight:500,maxWidth:300,height:100,left:-10000,width:300,position:"absolute",$border:1}),EventHandlers:{beforeNextFocus:null,onCancelled:function(profile){},onMenuSelected:function(profile,id,item,src){},onHide:function(profile){}},renderedTrigger:function(){this.boxing().adjustSize()},prepareItem:function(profile,item){item.add=item.add||"";item.displayAdd=item.add?"":"display:none";item.tagClass=item.sub?"":"display:none";item.type=item.type||"button"},resize:function(profile,w,h){var size=arguments.callee.upper.apply(this,arguments);profile.getSubNode("BOX").cssSize(size)}}});Class("linb.UI.MenuBar",["linb.UI.iWidget","linb.UI.iList","linb.UI.iNavigator"],{Instance:{pop:function(id,src,flag){var menu,profile=this.get(0);if(profile.$currentmenu){this.hide()}profile.addTagClass("ITEM","-mousedown",linb([src],false));profile.$allRelatedPopMenus=profile.$allRelatedPopMenus||{};if(flag||!(menu=profile.$allRelatedPopMenus[id])){var item=profile.getItemByItemId(id),sub=item.sub;sub=sub||[];menu=linb.create("PopMenu",{position:"absolute",items:sub});profile.getSubNode("POOL").attach(menu);var self=this;menu.onHide(function(pro){self.hide(false);self.get(0).properties.$menuPop=null}).onMenuSelected(function(pro,id,item,src){profile.boxing().onMenuSelected(profile,id,item,src)});menu.get(0).$hideMenuPool=profile.getSubNode("POOL");menu.get(0).$allRelatedPopMenus=profile.$allRelatedPopMenus;if(!flag){profile.$allRelatedPopMenus[id]=menu}}var target=linb([src],false);menu.pop(target);profile.$currentmenu=id;profile.$currentNode=src},hide:function(flag){var profile=this.get(0),menu,id=profile.$currentmenu,node=profile.$currentNode;if(menu=profile.$allRelatedPopMenus[id]){if(false!==flag){menu.hide(false)}profile.getSubNode("POOL").addLast(menu.reBoxing());menu=profile.$currentmenu=profile.$currentNode=null;profile.removeTagClass("ITEM","-mousedown",linb([node],false))}},reset:function(){var profile=this.get(0);profile.getSubNode("POOL").empty();profile.$allRelatedPopMenus=profile.$currentmenu=profile.$currentNode=null}},Initialize:function(){linb.SC("linb.UI.PopMenu")},Static:{$recursive:true,cssNone:false,Templates:{"default":{tagName:"div",POOL:{tagName:"div"},BORDER:{tagName:"div",LIST:{tagName:"div",HANDLER:{style:"{handler}"},ITEMS:{$order:1,text:"{items}"}}},$dynamic:{items:{ITEM:{tagName:"a",href:"javascript:;",tabindex:"{_tabindex}",className:" {typeCls} ",ICON:{$order:1,style:"background:url({icon}) transparent no-repeat  {iconPos}; {iconDisplay}"},CAPTION:{$order:2,text:"{caption}",style:"{captionDisplay}"}}}}}},Appearances:{"default":{KEY:{"font-size":0,"line-height":0,position:"absolute",left:0,top:0},POOL:{width:0,height:0,visibility:"hidden",position:"absolute",left:"-10000px"},BORDER:{left:0,top:0,border:"solid 1px","background-color":"#f4f4f4","border-color":"#fff #A7A6AA #A7A6AA #fff","font-size":0,"line-height":0},HANDLER:{height:"22px",width:"6px",background:linb.UI.getCSSImgPara("handler.gif"," left top #f4f4f4 ",null,"linb.UI.Public"),cursor:"move"},LIST:{padding:"1px 4px 1px 2px"},"LIST-disabled":{"background-color":"#E4E4E4"},ITEM:{display:linb.browser.gek?["-moz-inline-block","-moz-inline-box"]:"inline-block","vertical-align":"middle",padding:"1px 4px 1px 4px",border:"solid 1px #f4f4f4"},"ITEM-mouseover":{$order:2,"border-color":"#fff #cdcdcd #cdcdcd #fff"},"ITEM-mousedown":{$order:2,"border-color":"#cdcdcd #fff #fff #cdcdcd","background-color":"#fff"},ICON:{width:"16px",height:"16px","margin-right":"1px","vertical-align":"middle"},CAPTION:{height:"16px","margin-left":"1px","font-size":"12px","line-height":"12px","vertical-align":"middle"}}},Behaviors:{"default":{onMousedown:function(profile,e,src){},ITEM:{onMouseover:function(profile,e,src){var p=profile.properties;if(p.disabled){return }var item=profile.getItemByDom(src),itemId=item.id;if(p.$menuPop){if(p.$menuPop!=itemId){profile.addTagClass("ITEM","-mousedown",linb([this],false));profile.boxing().pop(itemId,this);p.$menuPop=itemId}}else{profile.addTagClass("ITEM","-mouseover",linb([this],false))}},onMouseout:function(profile,e,src){var p=profile.properties;if(p.disabled){return }profile.removeTagClass("ITEM","-mouseover",linb([this],false))},onMousedown:function(profile,e,src){var p=profile.properties;if(p.disabled){return }var item=profile.getItemByDom(src),itemId=item.id;if(p.$menuPop){if(false===_.tryF(profile.onPopMenu,[itemId],profile)){return }p.$menuPop=null;profile.boxing().hide(itemId)}else{if(false===_.tryF(profile.onHideMenu,[itemId],profile)){return }p.$menuPop=itemId;profile.boxing().pop(itemId,this);return false}},onKeydown:function(profile,e,src){var keys=linb.event.getKey(e),key=keys[0],shift=keys[2],cur=linb([src],false),first=profile.root.nextFocus(true,true,false),last=profile.root.nextFocus(false,true,false);switch(linb.event.getKey(e)[0]){case"tab":if(shift){if(src!=first.get(0)){first.focus();return false}}else{if(src!=last.get(0)){last.focus();return false}}break;case"left":case"up":var next=cur.nextFocus(false,true,false);if(cur.get(0)==first.get(0)){last.focus()}else{cur.nextFocus(false)}return false;break;case"right":case"down":var next=cur.nextFocus(true,false,false);if(cur.get(0)==last.get(0)){first.focus()}else{cur.nextFocus()}return false;break;case"space":case"enter":linb(src).onMousedown();return false;break}},onClick:function(){return false}}}},DataModel:{value:null,dataField:null,dataBinder:null,listKey:null,height:null,tabindex:{action:function(value){if(this.domNode){this.getSubNode("ITEM",true).tabIndex(value)}}},$menuPop:null,$border:1,left:0,top:0,handler:{ini:true,action:function(v){this.getSubNode("HANDLER").display(v?"":"none")}},position:"absolute",dock:{ini:"top",listbox:["top","bottom"]}},EventHandlers:{beforeValueUpdated:null,afterValueUpdated:null,beforeValueSet:null,afterValueSet:null,onMenuSelected:function(profile,id,item,src){}},createdTrigger:function(){if(this.properties.disabled){this.boxing().setDisabled(true,true)}},prepareData:function(profile){arguments.callee.upper.call(this,profile);profile.data.handler=profile.data.handler?"":"display:none"}}});Class("linb.UI.ToolBar",["linb.UI.iWidget","linb.UI.iList","linb.UI.iNavigator"],{Instance:{updateItem:function(id,txt){this.get(0).getSubNodeByItemId("CAPTION",id).html(txt,false)},hideItem:function(id){this.get(0).getSubNodeByItemId("ITEM",id).display("none")},disableGroup:function(id,value){return this.each(function(profile){profile.getSubNodeByItemId("GROUP",id).opacity(value?0.5:1);var item=profile.boxing().getItemByItemId(id);item.disabled=value})}},Static:{$recursive:true,cssNone:false,Templates:{"default":{tagName:"div",ITEMS:{tagName:"div",style:"{mode}",text:"{items}"},$dynamic:{items:{GROUP:{HANDLER:{style:"{mode2}"},LIST:{$order:1,tagName:"text",text:"{sub}"}}},"items.sub":function(profile,template,v,tag,result){tag=tag+"."+v.type;if(template[tag]){linb.UI.$doTemplate(profile,template,v,tag,result)}},"items.sub.split":{ITEMSPLIT:{}},"items.sub.button":{ITEM:{$order:1,tagName:"a",href:"javascript:;",tabindex:"{_tabindex}",className:" {typeCls} ",ICON:{$order:1,style:"background:url({icon}) transparent no-repeat  {iconPos}; {iconDisplay}"},CAPTION:{$order:2,text:"{caption}",className:" {disabled}",style:"{captionDisplay}"}}}}}},Appearances:{"default":{KEY:{"font-size":0,"line-height":0,position:"absolute",left:0,top:0},ITEMS:{display:"block",border:"solid 1px","background-color":"#f4f4f4","border-color":"#fff #A7A6AA #A7A6AA #fff","font-size":0,"line-height":0},HANDLER:{height:"22px",width:"6px",background:linb.UI.getCSSImgPara("handler.gif"," left top #f4f4f4 ",null,"linb.UI.Public"),cursor:"move"},GROUP:{"font-size":0,"line-height":0,padding:"1px 4px 1px 2px"},ITEM:{display:linb.browser.gek?["-moz-inline-block","-moz-inline-box"]:"inline-block","vertical-align":"top",margin:"1px",padding:"1px"},ICON:{width:"16px",height:"16px","margin-right":"1px"},"ITEM-BUTTON":{$order:1,border:"solid 1px #f4f4f4"},"ITEM-BUTTON-mouseover":{$order:2,border:"solid 1px #A7A6AA"},"ITEM-BUTTON-mousedown":{$order:2,border:"solid 1px #A7A6AA","background-color":"#FFFFE0"},ITEMSPLIT:{$order:1,width:"6px",height:"16px",background:linb.UI.getCSSImgPara("vsplit.gif"," repeat-y left top",null,"linb.UI.Public")},CAPTION:{height:"16px","margin-left":"1px","margin-right":"3px","font-size":"12px","line-height":"12px"}}},Behaviors:{"default":{_hoverEffect:{ITEM:["ITEM"]},_clickEffect:{ITEM:["ITEM"]},onMousedown:function(profile,e,src){},ITEM:{onClick:function(profile,e,src){if(profile.properties.disabled){return }var id2=src.parentNode.id,item2=profile.getItemByDom(id2);if(item2.disabled){return }var id=src.id,item=profile.getItemByDom(id);if(item.disabled){return }linb(src).focus();profile.boxing().onClick(profile,item.id,item2.id,src);return false},onKeydown:function(profile,e,src){var keys=linb.event.getKey(e),key=keys[0],shift=keys[2],cur=linb([src],false),first=profile.root.nextFocus(true,true,false),last=profile.root.nextFocus(false,true,false);switch(linb.event.getKey(e)[0]){case"tab":if(shift){if(src!=first.get(0)){first.focus();return false}}else{if(src!=last.get(0)){last.focus();return false}}break;case"left":case"up":var next=cur.nextFocus(false,true,false);if(cur.get(0)==first.get(0)){last.focus()}else{cur.nextFocus(false)}return false;break;case"right":case"down":var next=cur.nextFocus(true,false,false);if(cur.get(0)==last.get(0)){first.focus()}else{cur.nextFocus()}return false;break;case"space":case"enter":linb(src).onClick();return false;break}}}}},DataModel:{value:null,dataField:null,dataBinder:null,listKey:null,tabindex:{action:function(value){if(this.domNode){this.getSubNode("ITEM",false).tabIndex(value)}}},height:null,left:0,top:0,handler:{ini:true,action:function(v){this.getSubNode("HANDLER",true).display(v?"":"none")}},position:"absolute",align:{ini:"left",listbox:["left","right"],action:function(v){this.getSubNode("ITEMS",true).setStyle("textAlign",v)}},dock:{ini:"top",listbox:["top","bottom"]}},EventHandlers:{onClick:function(profile,id,groupid,src){},onValueChanged:function(profile,id,ov,v){}},createdTrigger:function(){if(this.properties.disabled){this.boxing().setDisabled(true,true)}},prepareData:function(profile){arguments.callee.upper.call(this,profile);var d=profile.data,p=profile.properties;d.mode=p.align=="right"?"text-align:right;":"";d.items.filter(function(o){return !o.$del})},prepareItem:function(profile,item,sitem){item.mode2=profile.properties.handler?"":"display:none;";var arr=[],t,id;var a=sitem.sub||[];a.each(function(item){t={id:item.id};id=profile.pickSubId("items");t[linb.UI.subSerialIdTag]=profile.ItemIdMapSubSerialId[item.id]=id;profile.SubSerialIdMapItem[id]=item;linb.UI.copyItem(item,t);t.type=t.type||"button";if(t.type.exists(".")){t.$del=true;return }t.captionDisplay=t.caption?"":"display:none";t.typeCls=profile.getClass("ITEM","-"+t.type);arr.push(t)});item.sub=arr}}});Class("linb.UI.Range",["linb.UI.iWidget"],{Instance:{setCtrlValue:function(value){return this.each(function(profile){var p=profile.properties,tpl=p.titleTpl,fun=function(k){return profile.getSubNode(k)},fun1=function(a,i){a.cssPos({left:profile[i],top:box.x2y(profile[i])})},fun2=function(o,v){o.get(0).style.width=v+"px"},title=fun("CAPTION"),a=fun("IND1"),b=fun("IND2"),r1=fun("RULER1"),r3=fun("RULER3"),box=profile.box,arr=box._ensureV(value);profile._rate=300/(p.max-p.min);profile._v1=Math.round((arr[0]-p.min)/(p.max-p.min)*300)-8;profile._v2=Math.round((1-(p.max-arr[1])/(p.max-p.min))*300)-8;title.html(box._buildTpl(p.single,tpl,arr,p.unit),false);fun1(a,"_v1");fun1(b,"_v2");fun2(r1,profile._v1+8);fun2(r3,300-profile._v2-8)})},setValue:function(value,flag){var upper=arguments.callee.upper;return this.each(function(profile){var p=profile.properties,arr=profile.box._ensureV(value),min=p.min,max=p.max,a=[];a[0]=arr[0];a[1]=arr[1];a[0]=a[0]<min?min:a[0];a[1]=a[1]>max?max:a[1];value=a.join(":");upper.apply(profile.boxing(),[value,flag])})},setDirtyMark:function(){return this.each(function(profile){if(!profile.domNode){return }var properties=profile.properties,o=profile.getSubNode("CAPTION"),flag=properties.value!==properties.$UIvalue,cls=linb.UI.$css_tag_dirty;if(o.beforeDirtyMark&&false===o.boxing().beforeDirtyMark(profile,flag)){return }if(flag){o.addClass(cls)}else{o.removeClass(cls)}})}},Static:{Templates:{"default":{style:"{_style}",BOX:{tagName:"div",RULER:{tagName:"div",IND1:{style:"{_single}"},IND2:{},RULER1:{style:"{_single}"},RULER3:{}},TAIL:{tagName:"div",CAPTION:{tagName:"div"},MIN:{text:"{min}"},MAX:{text:"{max}"}}}}},Appearances:{"default":{KEY:{background:"#fff"},"KEY, RULER, IND1, IND1":{"font-size":0,"line-height":0,position:"relative"},BOX:{position:"absolute",left:0,top:0,width:"300px"},"CAPTION, IND1, TAIL, MIN":{"font-size":"12px","line-height":"12px"},RULER:{$order:1,position:"relative",height:"30px",overflow:"visible","margin-bottom":"3px",background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat left -241px",null,"linb.UI.Public")},"RULER1, RULER3":{position:"absolute",top:0,height:"30px",width:"300px"},RULER1:{left:0,background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat left -271px",null,"linb.UI.Public")},RULER3:{right:0,background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat right -271px",null,"linb.UI.Public")},"IND1,IND2":{"z-index":"2",width:"15px",height:"14px",position:"absolute"},IND1:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat left -226px",null,"linb.UI.Public"),left:"-8px",top:"11px"},IND2:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -15px -226px",null,"linb.UI.Public"),left:"268px",top:"1px"},TAIL:{$order:2,width:"300px",position:"relative"},CAPTION:{position:"relative","text-align":"center"},MIN:{position:"absolute",left:0,top:0},MAX:{position:"absolute",right:0,top:0}}},Behaviors:{"default":{IND1:{onMousedown:function(profile,e,src){var p=profile.properties,box=profile.box,arr=box._ensureV(p.$UIvalue);linb([src]).startDrag(e,{type:"move",move:true,horizontal:true,offset_left:Math.floor(profile._v1+8),offset_right:Math.floor(profile._v2-profile._v1),cursor:"default"});linb([src]).zIndex(10);profile.getSubNode("IND2").zIndex(5)},onDrag:function(profile,e,src){profile.box._ondrag.apply(profile.box,[profile,e,src,0])},onDragstop:function(profile,e,src){var p=profile.properties,box=profile.boxing(),rate=profile._rate,d=linb.dragDrop,f,arr=p.$UIvalue.split(":");profile._v1=d.proxyPos.left;arr[0]=(profile._v1+8)/rate+p.min;if(f=profile.onValueFormat){arr[0]=f.call(profile.host,profile,arr[0])}else{arr[0]=Math.floor(arr[0])}box.updateUIValue(arr.join(":"));if(profile._v1==profile._v2){linb([src]).zIndex(10);profile.getSubNode("IND2").zIndex(5)}}},IND2:{onMousedown:function(profile,e,src){var p=profile.properties,box=profile.box,arr=box._ensureV(p.$UIvalue);linb([src]).startDrag(e,{type:"move",move:true,horizontal:true,offset_left:Math.floor(profile._v2-profile._v1),offset_right:Math.floor(300-profile._v2-8),cursor:"default"});linb([src]).zIndex(10);profile.getSubNode("IND1").zIndex(5)},onDrag:function(profile,e,src){profile.box._ondrag.apply(profile.box,[profile,e,src,1])},onDragstop:function(profile,e,src){var p=profile.properties,box=profile.boxing(),rate=profile._rate,d=linb.dragDrop,f,arr=p.$UIvalue.split(":");profile._v2=d.proxyPos.left;arr[1]=(profile._v2+8)/rate+p.min;if(f=profile.onValueFormat){arr[1]=f.call(profile.host,profile,arr[1])}else{arr[1]=Math.floor(arr[1])}box.updateUIValue(arr.join(":"))}}}},DataModel:{position:"absolute",width:300,height:56,min:{ini:0,action:function(){this.boxing().refresh()}},max:{ini:100,action:function(){this.boxing().refresh()}},unit:"",titleTpl:"{1}{u} - {2}{u}",value:"0:100",single:{ini:false,action:function(v){this.boxing().refresh()}}},EventHandlers:{onValueFormat:function(profile,value){return Math.floor(value)}},prepareData:function(profile){arguments.callee.upper.call(this,profile);var d=profile.data,p=profile.properties,arr=profile.box._ensureV(p.value);d._single=p.single?"display:none":"";p.min=parseFloat(p.min);p.max=parseFloat(p.max);d.min=d.min+p.unit;d.max=d.max+p.unit},_ensureV:function(v){var a=v.split(":"),b=[],fun=function(a){return parseFloat(a)};b[0]=fun(a[0]);b[1]=fun(a[1]);return b},_buildTpl:function(single,tpl,arr,unit){return single?arr[1]+unit:tpl.replace(/\{1\}/g,arr[0]).replace(/\{2\}/g,arr[1]).replace(/\{u\}/g,unit)},x2y:function(x){return Math.floor(15+1-(x+8)*(15/300))},_ondrag:function(profile,e,src,tag){var p=profile.properties,d=linb.dragDrop,box=profile.box,fun=function(k){return profile.getSubNode(k)},fun2=function(o,v){o.get(0).style.width=v+"px"},cap=fun("CAPTION"),r1=fun("RULER1"),r3=fun("RULER3"),t,f,arr=this._ensureV(p.$UIvalue);src.style.top=this.x2y(d.proxyPos.left)+"px";t=(d.proxyPos.left+8)/profile._rate+p.min;if(f=profile.onValueFormat){t=f.call(profile.host,profile,t)}else{t=Math.floor(t)}if(tag){arr[1]=t;fun2(r3,300-d.proxyPos.left-8)}else{arr[0]=t;fun2(r1,d.proxyPos.left+8)}cap.html(box._buildTpl(p.single,p.titleTpl,arr,p.unit),false)}}});Class("linb.UI.Layout",["linb.UI.iWidget","linb.UI.iList","linb.UI.iContainer"],{Instance:{getPanel:function(id){return this.get(0).getSubNodeByItemId("PANEL",id)},attach:function(ui,id){var self=this,profile=self.get(0);self.appendChild(ui,id||"main");if(profile.domNode){if(!profile.getSubSerialIdByItemId(id)){id="main"}self.getPanel(id).attach(ui)}return self}},Static:{cssNone:false,Dropable:["PANEL"],Templates:{"default":{tagName:"div",style:"{_style}",text:"{items}",$dynamic:{items:{ITEM:{tagName:"div",className:"{cls1} ",style:"{size}",MOVE:{$order:0,tagName:"div",className:"{cls2} ",style:"{display}"},CMD:{$order:1,tagName:"div",style:"{cmdDisplay}",className:"{cls3} "},PANEL:{tagName:"div",style:"position:absolute;left:0;top:0;",text:linb.UI.$childTag}}}}}},Appearances:{"default":{KEY:{position:"absolute",overflow:"hidden",left:0,top:0,"font-size":linb.browser.ie?0:"","line-height":linb.browser.ie?0:""},MOVE:{$order:0,position:"absolute","background-color":"#f4f4f4","z-index":"10","font-size":linb.browser.ie?0:"","line-height":linb.browser.ie?0:""},"MOVE-mouseover":{$order:1,"background-color":"#f8f8f8"},CMD:{position:"absolute",border:"solid 1px #cdcdcd",cursor:"pointer","z-index":"20","font-size":linb.browser.ie?0:"","line-height":linb.browser.ie?0:""},ITEM:{position:"absolute",overflow:"hidden","background-color":"#fff","border-width":linb.browser.opr?"0px":"","font-size":linb.browser.ie?0:"","line-height":linb.browser.ie?0:""},PANEL:{position:"absolute",overflow:"hidden","border-width":linb.browser.opr?"0px":"","font-size":linb.browser.ie?0:"","line-height":linb.browser.ie?0:""},"ITEM-MAIN":{left:0,right:0,top:0,bottom:0},"ITEM-TOP, ITEM-BOTTOM":{left:0,right:0},"ITEM-LEFT, ITEM-RIGHT":{top:0,bottom:0},"MOVE-TOP":{"border-top":"solid 1px #cdcdcd","border-bottom":"solid 1px #cdcdcd",width:"100%",bottom:0,height:"4px",cursor:"n-resize"},"MOVE-BOTTOM":{"border-top":"solid 1px #cdcdcd","border-bottom":"solid 1px #cdcdcd",width:"100%",top:0,height:"4px",cursor:"n-resize"},"MOVE-LEFT":{"border-left":"solid 1px #cdcdcd","border-right":"solid 1px #cdcdcd",height:"100%",right:0,width:"4px",cursor:"w-resize"},"MOVE-RIGHT":{"border-left":"solid 1px #cdcdcd","border-right":"solid 1px #cdcdcd",height:"100%",left:0,width:"4px",cursor:"w-resize"},"MOVE-TOP-checked, MOVE-BOTTOM-checked, MOVE-LEFT-checked, MOVE-RIGHT-checked":{$order:1,"background-color":"#cdcdcd"},"CMD-TOP":{$order:0,left:"50%","margin-left":"-15px",bottom:0,width:"30px",height:"4px",background:linb.UI.getCSSImgPara("icon.gif"," no-repeat left -52px",null,"linb.UI.Public")},"CMD-TOP-mouseover, CMD-BOTTOM-mouseover, CMD-LEFT-mouseover, CMD-RIGHT-mouseover":{$order:1,"background-color":"#ffff00"},"CMD-TOP-mouseover, CMD-BOTTOM-mouseover, CMD-LEFT-mouseover, CMD-RIGHT-mouseover":{$order:2,"background-color":"#ffff00"},"CMD-BOTTOM":{$order:0,left:"50%","margin-left":"-15px",top:0,width:"30px",height:"4px",background:linb.UI.getCSSImgPara("icon.gif"," no-repeat left -60px",null,"linb.UI.Public")},"CMD-LEFT":{$order:0,top:"50%","margin-top":"-15px",right:0,height:"30px",width:"4px",background:linb.UI.getCSSImgPara("icon.gif"," no-repeat -84px 0px",null,"linb.UI.Public")},"CMD-RIGHT":{$order:0,top:"50%","margin-top":"-15px",left:0,height:"30px",width:"4px",background:linb.UI.getCSSImgPara("icon.gif"," no-repeat -92px -0px",null,"linb.UI.Public")},"MOVE-MAIN":{$order:5,display:"none"},"CMD-MAIN":{$order:5,display:"none"}}},Behaviors:{"default":{_hoverEffect:{MOVE:"MOVE",CMD:"CMD"},onRewh:function(profile,e,src){var o=profile.root;profile.box.resize(profile,e.width?o.width():null,e.height?o.height():null)},MOVE:{onMousedown:function(profile,e,src){var id=src.id,itemId=profile.getSubSerialId(id),item=profile.getItemByDom(src);if(item.hide){return }var main=profile.getItemByItemId("main"),o=profile.getSubNode("ITEM",itemId),m=profile.getSubNodeByItemId("ITEM","main"),cursor=linb([src]).cursor(),t=profile.properties,h,w,mh,mw,offset1,offset2;profile.pos=item.pos;if(t.type=="vertical"){h=profile._cur=o.height();mh=m.height();if(item.pos=="before"){offset1=h-item.min;offset2=item.max?Math.min(parseInt(item.max)-h,(mh-main.min)):(mh-main.min)}else{offset1=item.max?Math.min(parseInt(item.max)-h,(mh-main.min)):(mh-main.min);offset2=h-item.min}linb([src]).startDrag(e,{type:"copy",move:false,target_clone:false,vertical:true,offset_top:offset1,offset_bottom:offset2,cursor:cursor})}else{w=profile._cur=o.width();mw=m.width();if(item.pos=="before"){offset1=w-item.min;offset2=item.max?Math.min(parseInt(item.max)-w,(mw-main.min)):(mw-main.min)}else{offset1=item.max?Math.min(parseInt(item.max)-w,(mw-main.min)):(mw-main.min);offset2=w-item.min}linb([src]).startDrag(e,{type:"copy",move:false,target_clone:false,horizontal:true,offset_left:offset1,offset_right:offset2,cursor:cursor})}profile._limited=0},onDrag:function(profile,e,src){var t=profile.properties,d=linb.dragDrop,b=0;if(t.type=="vertical"){if((d.y<=d.limit_top)||(d.y>=d.limit_bottom)){b=true}}else{if(d.x<=d.limit_left||d.x>=d.limit_right){b=true}}if(b){if(!profile._limited){profile._bg=d.proxyIn.getStyle("backgroundColor");d.proxyIn.setStyle("backgroundColor","#ff6600");profile._limited=true}}else{if(profile._limited){d.proxyIn.setStyle("backgroundColor",profile._bg);profile._limited=0}}},onDragstop:function(profile,e,src){var t=profile.properties,o=linb([src]).parent(),r=profile.root,item=profile.getItemByDom(src);if(t.type=="vertical"){o.height(item.size=profile._cur+(profile.pos=="before"?1:-1)*linb.dragDrop.getOffset().y);profile.box.resize(profile,null,r.height())}else{o.width(item.size=profile._cur+(profile.pos=="before"?1:-1)*linb.dragDrop.getOffset().x);profile.box.resize(profile,r.width(),null)}profile._limited=0}},CMD:{onMousedown:function(profile,e,src){var t=profile.properties,id=src.id,self=linb([src]),itemId=profile.getSubSerialId(id),item=profile.getItemByDom(src),r=profile.root,main=profile.getItemByItemId("main"),m=profile.getSubNodeByItemId("ITEM","main"),o=profile.getSubNode("ITEM",itemId),panel=profile.getSubNode("PANEL",itemId),move=profile.getSubNode("MOVE",itemId);if(t.type=="vertical"){if(item.hide){if(item.size<=m.height()-main.min+t._handlerSize){o.height(item.size);panel.show();item.hide=false;if(item.pos=="before"){self.reClass(/bottom/g,"top")}else{self.reClass(/top/g,"bottom")}if(!item.locked){move.cursor("n-resize")}profile.removeTagClass("MOVE","-checked")}else{linb.message("no enough space!")}}else{o.height(t._handlerSize);panel.hide();item.hide=true;if(item.pos=="before"){self.reClass(/top/g,"bottom")}else{self.reClass(/bottom/g,"top")}if(!item.locked){move.cursor("default")}profile.addTagClass("MOVE","-checked")}profile.box.resize(profile,null,r.height())}else{if(item.hide){if(item.size<=m.width()-main.min+t._handlerSize){o.width(item.size);panel.show();item.hide=false;if(item.pos=="before"){self.reClass(/right/g,"left")}else{self.reClass(/left/g,"right")}if(!item.locked){move.cursor("w-resize")}profile.removeTagClass("MOVE","-checked")}else{linb.message("no enough space!")}}else{o.width(t._handlerSize);panel.hide();item.hide=true;if(item.pos=="before"){self.reClass(/left/g,"right")}else{self.reClass(/right/g,"left")}if(!item.locked){move.cursor("default")}profile.addTagClass("MOVE","-checked")}profile.box.resize(profile,r.width(),null)}return false}}}},DataModel:{dataBinder:null,dataField:null,value:null,disabled:null,position:"absolute",type:{listbox:["vertical","horizontal"],ini:"vertical",action:function(value,ovalue){if(value!=ovalue){var self=this,nodes2=self.getSubNode("ITEM",true),nodes1=self.getSubNode("MOVE",true),nodes3=self.getSubNode("CMD",true);nodes1.add(nodes2).add(nodes3);if(value=="vertical"){nodes1.reClass(/(-left)(\b)/ig,"-top$2");nodes1.reClass(/(-right)(\b)/ig,"-bottom$2");nodes2.each(function(o){linb(o).height(linb(o).width())}).left(0).right("auto").top("auto").bottom("auto")}else{nodes1.reClass(/(-top)(\b)/ig,"-left$2");nodes1.reClass(/(-bottom)(\b)/ig,"-right$2");nodes2.each(function(o){linb(o).width(linb(o).height())}).top(0).bottom("auto").left("auto").right("auto")}var size=self.root.cssSize();self.box.resize(self,size.width,size.height)}}},dock:"fill",listKey:null,width:200,height:200,_handlerSize:6,items:{ini:{},set:function(v){return this.each(function(o){if(o.domNode){var box=o.boxing(),temp=linb.dom.getMatix(),children=o.children.copy(),p;o.children.length=0;children.each(function(o){delete o[0].$dockParent;temp.addLast(o[0].root)});box.clearItems();linb.dom.$gc();v=o.box.prepareDefaultValue(o,v);box.insertItems(v);children.each(function(v){box.attach.apply(box,v)});temp.empty();var size=o.root.cssSize();o.box.resize(o,size.width,size.height)}else{o.properties.items=v}})}}},EventHandlers:{beforeValueSet:null,afterValueSet:null,beforeValueUpdated:null,afterValueUpdated:null,beforeHoverEffect:null,beforeClickEffect:null,beforeNextFocus:null},prepareDefaultValue:function(profile,items){var main,before=[],after=[];items.each(function(o){if(o.id=="main"){main=o}else{if(o.pos=="before"){before.push(o)}else{after.push(o)}}});main=main||{};main.id="main";main.min=main.min||10;items.length=0;items.insertAny(before,0);items.insertAny(main);items.insertAny(after);items.each(function(o){o.id=_.isStr(o.id)?o.id:profile.$id+":"+_.id();o.min=o.min||10;if(o.id!="main"){o.size=parseInt(o.size)||20;o.locked=_.bool(o.locked,false);o.hide=_.bool(o.hide,false);o.cmd=_.bool(o.cmd,true)}});return items},prepareData:function(profile){var prop=profile.properties;if(!prop.items||prop.items.constructor!=Array){prop.items=_.clone([{id:"before",pos:"before",locked:false,size:60,min:50,max:200},{id:"after",pos:"after",locked:false,size:60,min:50,max:200}])}profile.properties.items=this.prepareDefaultValue(profile,profile.properties.items);arguments.callee.upper.call(this,profile)},prepareItem:function(profile,item){if(item.id=="main"){item.cls1=profile.getClass("ITEM","-main");item.cls2=profile.getClass("MOVE","-main");item.cls3=profile.getClass("CMD","-main");return }if(profile.properties.type=="vertical"){item.size="height:"+item.size+"px"}else{item.size="width:"+item.size+"px"}var pos;if(profile.properties.type=="vertical"){if(item.pos=="before"){pos="top"}else{pos="bottom"}}else{if(item.pos=="before"){pos="left"}else{pos="right"}}item.cls1=profile.getClass("ITEM","-"+pos);item.cls2=profile.getClass("MOVE","-"+pos);item.cls3=profile.getClass("CMD","-"+pos);item.display=item.locked?"display:none":"";item.cmdDisplay=item.cmd?"":"display:none"},createdTrigger:function(){var t,profile=this;profile.properties.items.each(function(item){if(item.id!="main"){if(item.hide&&(t=profile.getSubSerialIdByItemId(item.id))){item.hide=false;profile.getSubNode("CMD",t).onMousedown()}}})},resize:function(profile,w,h){var _t,t=profile.properties,m,n,itemId,temp1,temp2,temp,key=profile.keys.ITEM,panel=profile.keys.PANEL;var obj={},obj2={};t.items.each(function(o){itemId=profile.getSubSerialIdByItemId(o.id);obj[itemId]={};obj2[itemId]={}});if(t.type!="vertical"){if(!_.isNull(w)){temp=temp1=temp2=0;t.items.each(function(o){if(o.id=="main"){return }itemId=profile.getSubSerialIdByItemId(o.id);if(o.pos=="before"){n=profile.getSubNode("ITEM",itemId);m=n.width();obj2[itemId].left=temp1;temp1+=m;obj2[itemId].right="auto";obj[itemId].right="auto";obj[itemId].left=0;obj[itemId].width=m-(o.locked?0:t._handlerSize)}});t.items.each(function(o){if(o.id=="main"){return }itemId=profile.getSubSerialIdByItemId(o.id);if(o.pos=="after"){n=profile.getSubNode("ITEM",itemId);m=n.width();obj2[itemId].right=temp2;temp2+=m;obj2[itemId].left="auto";obj[itemId].right=0;obj[itemId].left="auto";obj[itemId].width=m-(o.locked?0:t._handlerSize)}},null,true);temp=temp1+temp2;if(w-temp>=0){_t=profile.getSubSerialIdByItemId("main");obj[_t].width=w-temp;obj2[_t].width=w-temp;obj2[_t].left=temp1}}if(!_.isNull(h)){_.each(obj,function(o,id){o.height=h;obj2[id].height=h})}}else{if(!_.isNull(h)){temp=temp1=temp2=0;t.items.each(function(o){if(o.id=="main"){return }itemId=profile.getSubSerialIdByItemId(o.id);if(o.pos=="before"){n=profile.getSubNode("ITEM",itemId);m=n.height();obj2[itemId].top=temp1;temp1+=m;obj2[itemId].bottom="auto";obj[itemId].top=0;obj[itemId].bottom="auto";obj[itemId].height=m-(o.locked?0:t._handlerSize)}});t.items.each(function(o){if(o.id=="main"){return }itemId=profile.getSubSerialIdByItemId(o.id);if(o.pos=="after"){n=profile.getSubNode("ITEM",itemId);m=n.height();obj2[itemId].bottom=temp2;temp2+=m;obj2[itemId].top="auto";obj[itemId].bottom=0;obj[itemId].top="auto";obj[itemId].height=m-(o.locked?0:t._handlerSize)}},null,true);temp=temp1+temp2;if(h-temp>=0){_t=profile.getSubSerialIdByItemId("main");obj[_t].height=h-temp;obj2[_t].height=h-temp;obj2[_t].top=temp1}}if(!_.isNull(w)){_.each(obj,function(o,id){o.width=w;obj2[id].width=w})}}_.each(obj,function(o,id){profile.getSubNode("PANEL",id).setRegion(o,true)});_.each(obj2,function(o,id){profile.getSubNode("ITEM",id).setRegion(o)})}}});Class("linb.UI.TreeGrid","linb.UI.iWidget",{Instance:{_insertRowsToDom:function(profile,arr,pid,base,before){if(pid){var parent=profile.row_SerialIdMapItem[pid];if(parent&&!parent._created){return }}var obj,hw,self=arguments.callee;var ws=[],hw=profile.getSubNode("HCELL0").width();profile.properties.header.each(function(v){ws.push(profile.getSubNode("HCELL",profile.header_ItemIdMapSerialId[v.id]).width())});arr.each(function(o){o.rowHandlerWidth=hw-o._layer*profile.properties.$subMargin;o.cells.each(function(v,i){v.width=ws[i]})});var nodes=profile.box.subBuild(profile,"rows",arr).toDom();if(!base){if(pid){obj=profile.getSubNode("SUB",pid)}else{obj=profile.getSubNode("BODY")}if(before){obj.addFirst(nodes)}else{obj.addLast(nodes)}}else{obj=profile.getSubNode("CELLS",base);if(before){obj.addPre(nodes)}else{nodes.get().reverse();obj.addNext(nodes)}}arr.each(function(o){o.open=false},this);delete profile.$allrowscache},refreshHeader:function(header){var profile=this.get(0);profile.properties.header=header;var rows=profile.properties.rows.copy();this.removeAllRows();var arr=profile.box.prepareHeader(profile,header);var nodes=profile.box.subBuild(profile,"header",arr).toDom();profile.getSubNode("HCELL",true).remove();profile.getSubNode("HCELLS").addLast(nodes);this.insertRows(rows)},insertRows:function(arr,pid,base,before){var c=this.constructor,profile=this.get(0),pro=profile.properties;pid=profile.row_ItemIdMapSerialId[pid];base=profile.row_ItemIdMapSerialId[base];var rows=c.prepareItems(profile,arr,pid);var tar,b=profile.row_SerialIdMapItem;if(!pid){tar=(pro.rows||(pro.rows=[]))}else{tar=(b[pid].sub||(b[pid].sub=[]))}if(!base){tar.insertAny(arr,before?0:-1)}else{var index=tar.subIndexOf("_serialId",base);tar.insertAny(arr,before?index:(index+1))}this._insertRowsToDom(profile,rows,pid,base,before);if(!profile.properties.iniFold){profile.boxing().openRows(rows,true)}return this},removeRows:function(ids){var profile=this.get(0),cell=profile.cells_SerialIdMapItem,nodes=[];ids=_.isArr(ids)?ids:[ids];ids.each(function(id){if(!(id=profile.row_ItemIdMapSerialId[id])){return }var row;if(row=profile.row_SerialIdMapItem[id]){var tdids=row._cells,rowid=row.id,temp;_.each(tdids,function(o){delete cell[o].header._cells[rowid];delete cell[o];profile.cacheSubId(o._serialId,"cell")});if(temp=row._pid?(temp=profile.row_SerialIdMapItem[row._pid])?temp.sub:null:profile.properties.row){temp.filter(function(o){return o._serialId!=id})}delete profile.row_ItemIdMapSerialId[rowid];delete profile.row_SerialIdMapItem[id];profile.cacheSubId(serialId,"row");nodes.push(profile.getSubNode("CELLS",id));if(row.sub){var arr=[];row.sub.each(function(o){arr.push(o.id)});this.removeRows(arr)}}},this);linb(nodes,false).remove();return this},removeAllRows:function(){var profile=this.get(0);for(var i in profile.cells_SerialIdMapItem){profile.cacheSubId(i,"cell")}for(var i in profile.row_SerialIdMapItem){profile.cacheSubId(i,"row")}_.each(profile.header_SerialIdMapItem,function(o){o._cells={}});profile.row_SerialIdMapItem={};profile.cells_SerialIdMapItem={};profile.row_ItemIdMapSerialId={};profile.properties.rows.length=0;profile.getSubNode("BODY").empty();profile.getSubNode("SCROLL").scrollTop(0).scrollLeft(0);return this},resetContent:function(){var profile=this.get(0);_.each(profile.$cache_editor,function(o,i){o.reBoxing().hide()});this.removeAllRows();return this},updateColumn:function(colId,hashValue){var pro=this.get(0),col=pro.header_SerialIdMapItem[pro.header_ItemIdMapSerialId[colId]];if(!col){return }var cells=col._cells;_.each(hashValue,function(o,i){pro.cells_SerialIdMapItem[cells[i]].value=o;pro.getSubNode("CELLA",cells[i]).html(o,false)})},updateCellbyRowCol:function(rowId,colId,value){var t;if(t=this.constructor.getCellId(this.get(0),rowId,colId)){this.constructor.changeCellValue(this.get(0),t,value)}return this},updateCell:function(cellId,value){this.constructor.changeCellValue(this.get(0),cellId,value);return this},openRows:function(rows,flag){if(rows&&rows.length){rows.each(function(o){if(o.sub&&o.sub.length&&!o.iniFold&&!o._checked){this.openRow(o.id,flag)}},this)}},openRow:function(id,flag){var profile=this.get(0),row=profile.row_SerialIdMapItem[profile.row_ItemIdMapSerialId[id]];if(row&&!row._checked){profile.box.setSub(profile,row,flag)}},scrollTo:function(pos){var profile=this.get(0),scroll=profile.getSubNode("SCROLL");pos=pos=="top"?0:pos=="bottom"?scroll.scrollHeight():pos;scroll.scrollTop(pos)}},Initialize:function(){this.mapKeys(["ALT"]);var b=this.getBehavior("default");b.HCELLA={};b.HCELL0A={};b.CELLA.onKeydown=b.CELL0A.onKeydown=b.HCELLA.onKeydown=b.HCELL0A.onKeydown=function(profile,e,src){var keys=linb.event.getKey(e),key=keys[0],shift=keys[2],cur=linb([src],false),first=profile.root.nextFocus(true,true,false),last=profile.root.nextFocus(false,true,false);switch(key){case"tab":if(shift){if(src!=first.get(0)){first.focus();return false}}else{if(src!=last.get(0)){last.focus();return false}}break;case"left":var next=cur.nextFocus(false,true,false);if(cur.get(0)==first.get(0)){last.focus()}else{cur.nextFocus(false)}return false;break;case"right":var next=cur.nextFocus(true,false,false);if(cur.get(0)==last.get(0)){first.focus()}else{cur.nextFocus()}return false;break;case"up":case"down":var count=1,temp=cur.parent().get(0);var max=temp.parentNode.childNodes.length;while(temp=temp.previousSibling){count++}temp=cur.parent(2).get(0);if(!profile.$allrowscache){var all=[];all.push(profile.getSubNode("HCELLS").get(0));all.insertAny(profile.getSubNode("CELLS",true).get(),-1);all.filter(function(o){return !!o.offsetWidth});profile.$allrowscache=all}var index=profile.$allrowscache.indexOf(temp);var rowLen=profile.$allrowscache.length;if(key=="up"){index--;if(index==-1){index=rowLen-1;count--;if(count==0){count=max}}}else{index++;if(index==rowLen){index=0;count++;if(count==max+1){count=1}}}node=linb(profile.$allrowscache[index]).first().next(count-1).first();if(!node.isEmpty()){node.focus()}return false;break}};this.setBehavior("default",b)},Static:{$recursive:true,Templates:{"default":{tagName:"div",style:"{_style}",BORDER:{tagName:"div",BOX:{tagName:"div",HEADER:{$order:0,tagName:"div",HCELLS:{tagName:"div",style:"height:{headerHeight}px;",HCELL0:{$order:0,style:"{tdfDisplay};width:{rowHandlerWidth}px;",HCELL0A:{tagName:"a",href:"javascript:;",tabindex:"{tabindex}",HCELLHANDLER:{tagName:"div",style:"{thhandlerDisplay}"},ROWHANDLER:{tagName:"div",style:"{tdfhandlerDisplay}"}}},OTHERHCELLS:{$order:1,tagName:"text",text:"{header}"}}},SCROLL:{$order:1,tagName:"div",BODY:{tagName:"div",text:"{rows}"}},FOOTER:{$order:2}}},$dynamic:{header:{HCELL:{style:"width:{width}px",HCELLA:{tagName:"a",href:"javascript:;",tabindex:"{_tabindex}",text:"{caption}",SORT:{style:"{sortDisplay}"},HCELLHANDLER:{$order:2,tagName:"div",style:"{thhandlerDisplay}"}}}},rows:{ROW:{tagName:"div",className:"{cls}",CELLS:{tagName:"div",style:"height:{rowHeight}px;",CELL0:{$order:0,style:"{tdfDisplay};width:{rowHandlerWidth}px;",CELL0A:{tagName:"a",href:"javascript:;",tabindex:"{_tabindex}",MARK:{style:"{display}"},ROWHANDLER:{tagName:"div",style:"{tdfhandlerDisplay}"}}},OTHERCELLS:{tagName:"text",$order:1,text:"{cells}"}},SUB:{$order:1,tagName:"div"}}},"rows.cells":function(profile,template,v,tag,result){if(v.type=="checkbox"){var t=tag+".checkbox"}else{var t=tag+".input"}linb.UI.$doTemplate(profile,template,v,t,result)},"rows.cells.input":{CELL:{style:"width:{width}px;",className:"{cellCls}",CELLA:{tagName:"a",href:"javascript:;",tabindex:"{_tabindex}",text:"{caption}"}}},"rows.cells.checkbox":{CELL:{style:"width:{width}px;",className:"{cellCls}",CELLA:{tagName:"a",href:"javascript:;",tabindex:"{_tabindex}",CHECKBOX:{className:"{checkboxCls}"}}}},MARK:{}}}},Appearances:{"default":{KEY:{display:"block",position:"absolute"},BOX:{display:"block",position:"relative",overflow:"hidden"},HEADER:{position:"absolute",left:0,top:0},SCROLL:{position:"absolute",left:0,overflow:"auto"},BODY:{position:"absolute",display:"block",left:0,top:0,overflow:"visible"},"SORT, SORT-checked":{width:"15px",height:"15px",position:"absolute",right:"0px",bottom:"0px"},SORT:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -191px top",null,"linb.UI.Public")},"HCELL-mouseover SORT":{$order:1,"background-position":"-191px -15px"},"HCELL-mousedown SORT":{$order:2,"background-position":"-191px -30px"},"SORT-checked":{$order:3,"background-position":"-206px top"},"HCELL-mouseover SORT-checked":{$order:4,"background-position":"-206px -15px"},"HCELL-mousedown SORT-checked":{$order:5,"background-position":"-206px -30px"},HCELLHANDLER:{position:"absolute",width:"4px",top:"0px",height:"100%",right:"0px",cursor:"e-resize","font-size":0,"line-height":0,background:linb.UI.getCSSImgPara("handler.v.gif")},"HCELLS, CELLS":{"overflow-y":linb.browser.ie6?"hidden":"",position:linb.browser.ie6||linb.browser.opr?"relative":null,"white-space":"nowrap","padding-bottom":"2px","font-size":0,"line-height":0,display:"block"},"CELLS-mouseover CELL":{$order:4,"background-color":"#d9e8fb"},"CELLS-active CELL, CELL-active":{$order:5,"background-color":"#316AC5"},"CELLS-active CELLA, CELL-active CELLA":{$order:5,color:"white"},"HCELL0, CELL0":{"background-color":"#d4d0c8",height:"100%",border:"1px solid","border-color":"#fff #ACA899 #ACA899 #fff",padding:0},"HCELL0A, CELL0A":{"-moz-box-flex":linb.browser.gek?"1":"",display:"block",position:"relative",overflow:"hidden",height:"100%","font-weight":"bold","font-size":"12px","line-height":"20px"},CELL0A:{"text-align":"left"}," TDFCAPTION":{"font-weight":"bold"},ROWHANDLER:{position:"absolute",height:"4px",left:"0px",width:"100%",bottom:"0px",cursor:"n-resize",background:linb.UI.getCSSImgPara("handler.h.gif"),"font-size":0,"line-height":0},HCELL:{"background-color":" #d4d0c8",height:"100%",border:"1px solid","border-color":"#fff #ACA899 #ACA899 #fff",padding:0},ROW:{_position:"relative","font-size":0,"line-height":0,"background-color":" #fff"},CELL:{"padding-top":"1px","padding-left":"1px","border-bottom":"1px solid #ACA899","border-right":"1px solid #ACA899",height:"100%",overflow:linb.browser.ie6?"hidden":""},"ALT > CELLS":{"background-color":"#f1f1f1"},"CELL-label":{"background-color":"#F3F3F3"},"CELL-input":{},"CELL-number":{"text-align":"right"},"CELL-checkbox":{"text-align":"center"},HCELLA:{position:"relative"},"HCELLA, CELLA":{display:"block",overflow:"hidden","-moz-box-flex":linb.browser.gek?"1":"",height:"100%",width:linb.browser.ie?"100%":"","font-size":"12px","line-height":"20px"},"HCELLA, HCELL0A":{"text-align":"center","font-weight":"bold"},CHECKBOX:{cursor:"pointer",width:"16px",height:"16px",background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -112px top",null,"linb.UI.Public")},"CELL-mouseover CHECKBOX":{$order:1,"background-position":"-112px -17px"},"CELL-mousedown CHECKBOX":{$order:2,"background-position":"-112px -34px"},"CHECKBOX-checked":{$order:3,"background-position":"-96px top"},"CELL-mouseover CHECKBOX-checked":{$order:4,"background-position":"-96px -17px"},"CELL-mousedown CHECKBOX-checked":{$order:5,"background-position":"-96px -34px"},SUB:{_zoom:"1",_position:"relative","margin-left":"16px","font-size":"12px","line-height":"20px",overflow:"hidden",display:"none"},MARK:{width:"16px",height:"16px",background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -161px top",null,"linb.UI.Public")},"CELL0-mouseover MARK":{$order:1,"background-position":"-161px -15px"},"CELL0-mousedown MARK":{$order:2,"background-position":"-161px -30px"},"MARK-checked":{$order:3,width:"16px",height:"16px","background-position":"-176px top"},"CELL0-mouseover MARK-checked":{$order:4,"background-position":"-176px -15px"},"CELL0-mousedown MARK-checked":{$order:5,"background-position":"-176px -30px"},"CELLS-dragover":{"border-top":"solid 2px #ff6600"},"HCELL-dragover":{$order:3,"border-left":"solid 2px #ff6600"}}},Behaviors:{"default":{_hoverEffect:{CELLS:"CELLS",CELL:"CELL",CELL0:"CELL0",HCELL:"HCELL"},_clickEffect:{CELL:"CELL",CELL0:"CELL0",HCELL:"HCELL"},onRewh:function(profile,e,src){var o=profile.root;profile.box.resize(profile,e.width?o.width():null,o.height?o.height():null)},SCROLL:{onScroll:function(profile,e,src){var pos=linb(src).scrollLeft();if(profile.oldPos!=pos){profile.getSubNode("HEADER").left(-pos);profile.oldPos=pos}}},HCELLHANDLER:{onMousedown:function(profile,e,src){var p=profile.properties,o=linb(src),minW=o.parent(2).width()-p.minColW,scroll=profile.getSubNode("SCROLL"),maxW=scroll.absPos().left+scroll.width()-linb.event.getPos(e).left-4,id=profile.getSubSerialId(src.id),col=profile.header_SerialIdMapItem[id];if(p.disabled){return false}if(col&&col.disabled){return false}o.startDrag(e,{horizontal:true,type:"blank",offset_left:minW,offset_right:maxW,move:false})},onDragbegin:function(profile,e,src){linb.dragDrop.proxyIn.setStyle({height:profile.root.height()+"px",width:"4px",backgroundColor:"#ddd",cursor:"e-resize"})},onDrag:function(profile,e,src){var d=linb.dragDrop,b=0;if(d.x<=d.limit_left||d.x>=d.limit_right){b=true}if(b){if(!profile._limited){linb.dragDrop.proxyIn.setStyle("backgroundColor","#ff6600");profile._limited=true}}else{if(profile._limited){linb.dragDrop.proxyIn.setStyle("backgroundColor","#ddd");profile._limited=0}}},onDragstop:function(profile,e,src){var o=linb(src).parent(2),w=o.width()+linb.dragDrop.getOffset().x;o.width(w);var ids=[],ws=[];if(src.parentNode.id.startWith(profile.keys.HCELL0A)){var map=profile.row_SerialIdMapItem,p=profile.properties;_.each(profile.row_ItemIdMapSerialId,function(v){ids.push(profile.getSubNodeId(profile.keys.CELL0,v));ws.push(w-map[v]._layer*p.$subMargin)});ids.each(function(o,i){linb(o).width(ws[i])})}else{var cells=profile.header_SerialIdMapItem[profile.getSubSerialId(src.id)]._cells;_.each(cells,function(o){ids.push(profile.getSubNodeId(profile.keys.CELL,o))});linb(ids).width(w)}profile.getSubNode("SCROLL").onScroll();profile._limited=0}},ROWHANDLER:{onMousedown:function(profile,e,src){var p=profile.properties,row=profile.row_SerialIdMapItem[profile.getSubSerialId(src.id)],o=linb(src),minH=o.parent(3).height()-p.minRowH,scroll=profile.getSubNode("SCROLL"),maxH=scroll.absPos().top+scroll.height()-linb.event.getPos(e).top-4;if(p.disabled||(row&&row.disabled)){return false}o.startDrag(e,{vertical:true,type:"blank",offset_top:minH,offset_bottom:maxH,move:false})},onDragbegin:function(profile,e,src){linb.dragDrop.proxyIn.setStyle({width:profile.root.width()+"px",height:"4px",backgroundColor:"#ddd",cursor:"n-resize"})},onDrag:function(profile,e,src){var d=linb.dragDrop,b=0;if(d.y<=d.limit_top||d.y>=d.limit_bottom){b=true}if(b){if(!profile._limited){linb.dragDrop.proxyIn.setStyle("backgroundColor","#ff6600");profile._limited=true}}else{if(profile._limited){linb.dragDrop.proxyIn.setStyle("backgroundColor","#ddd");profile._limited=0}}},onDragstop:function(profile,e,src){var o=linb(src).parent(3),h=o.height()+linb.dragDrop.getOffset().y;if(linb.browser.ie&&h%2==1){h+=1}o.height(h);if(src.parentNode.id.startWith(profile.keys.HCELL0A)){profile.box.resize(profile,null,profile.root.height())}profile._limited=0}},MARK:{onClick:function(profile,e,src){var p=profile.properties,row=profile.row_SerialIdMapItem[profile.getSubSerialId(src.id)];if(p.disabled||row.disabled){return false}if(!row.sub){return false}profile.box.setSub(profile,row);return false}},HCELL0:{onClick:function(profile,e,src){linb(src).first().focus();return false}},HCELL:{onClick:function(profile,e,src){var p=profile.properties,id=profile.getSubSerialId(src.id),col=profile.header_SerialIdMapItem[id];linb(src).first().focus();if(!p.colSortable||false===col.colSortable){return false}if(p.disabled||col.disabled){return false}var order=col._order||false,type=col.type||"input",index=p.header.indexOf(col),me=arguments.callee,fun=me.fun||(me.fun=function(profile,root,index,type,order){var rows,parent,self=arguments.callee;if(root){rows=root.sub;parent=profile.getSubNode("SUB",root._serialId).get(0)}else{root={_created:true};rows=profile.properties.rows;parent=profile.getSubNode("BODY").get(0)}var a1=[],a2=[],a3=[],a4=[];rows.each(function(row){if(row.sub&&row.sub.length>1){self(profile,row,index,type,order)}a1[a1.length]=row.cells[index].value;a2[a2.length]=a2.length});switch(type){case"number":a2.sort(!order?function(x,y){x=parseFloat(a1[x])||0;y=parseFloat(a1[y])||0;return x>y?1:x==y?0:-1}:function(x,y){x=parseFloat(a1[x])||0;y=parseFloat(a1[y])||0;return x<y?1:x==y?0:-1});break;case"date":a2.sort(!order?function(x,y){x=Date.parse(new Date(a1[x]));y=Date.parse(new Date(a1[y]));return x>y?1:x==y?0:-1}:function(x,y){x=Date.parse(new Date(a1[x]));y=Date.parse(new Date(a1[y]));return x<y?1:x==y?0:-1});break;default:a2.sort(!order?function(x,y){x=a1[x];y=a1[y];return x>y?1:x==y?0:-1}:function(x,y){x=a1[x];y=a1[y];return x<y?1:x==y?0:-1})}var b=root._created,bak=_.copy(rows),c;if(b){a1=parent.childNodes}a2.each(function(o,i){rows[i]=bak[o];if(b){a3[i]=a1[o]}});if(b){a3.each(function(o,i){parent.appendChild(o);if(i%2){a4[a4.length]=o}});if(profile.properties.altRowsBg){var altCls=profile.getClass("ALT");linb(a3,false).removeClass(altCls);linb(a4,false).addClass(altCls)}}});fun(profile,"",index,type,order);profile.getSubNode("SORT",true).display("none");var node=profile.getSubNode("SORT",col._serialId).display("block");if(col._order=!col._order){profile.addTagClass("SORT","-checked",node)}else{profile.removeTagClass("SORT","-checked",node)}delete profile.$allrowscache;return false},onMousedown:function(profile,e,src){if(!profile.properties.colDragable||false===profile.header_SerialIdMapItem[profile.getSubSerialId(src.id)].colDragable){return }if(false===profile.boxing().beforeColumnDrag(profile,profile.getSubSerialId(src.id))){return }var pos=linb.event.getPos(e),o=linb([src],false),itemId=profile.getSubSerialId(src.id);o.startDrag(e,{drop2:true,type:"copy",cursor:"pointer",target_clone:true,target_left:pos.left+12,target_top:pos.top+12,move:false,defer:1,key:(profile.properties.colDragKey||profile.$id)+":col",data:o.id()})},onDragbegin:function(profile,e,src){linb(src).onMouseout(true,{$force:true}).onMouseup(true)},beforeMouseover:function(profile,e,src){if(false===profile.box._colDragCheck(profile,src)){return }linb.dragDrop._current=this;profile.addTagClass("HCELL","-dragover",linb([src]))},beforeMouseout:function(profile,e,src){if(false===profile.box._colDragCheck(profile,src)){return }linb.dragDrop._current=null;profile.removeTagClass("HCELL","-dragover",linb(src))},onDrop:function(profile,e,src){if(false===profile.box._colDragCheck(profile,src)){return }var p=profile.properties,fromId=linb.dragDrop.data&&profile.getSubSerialId(linb.dragDrop.data),toId=profile.getSubSerialId(src.id);if(false===profile.boxing().beforeColumnMoved(profile,fromId,toId)){return }profile.removeTagClass("HCELL","-dragover",linb(src));var fromIndex=p.header.subIndexOf("_serialId",fromId),toIndex=p.header.subIndexOf("_serialId",toId);if(fromIndex===toIndex||fromIndex===toIndex-1){return }var map=profile.header_SerialIdMapItem,fromTh=map[fromId],toTh=map[toId];profile.getSubNode("HCELL",toId).addPre(linb.dragDrop.data);_.each(toTh._cells,function(o,i){profile.getSubNode("CELL",o).addPre(profile.getSubNode("CELL",fromTh._cells[i]))});var temp=p.header[fromIndex];p.header.removeFrom(fromIndex);p.header.insertAny(temp,toIndex);var allitems=profile.itemsSearch(p.rows,true,true);allitems.each(function(o){temp=o.cells[fromIndex];o.cells.removeFrom(fromIndex);o.cells.insertAny(temp,toIndex)});profile.boxing().afterColumnMoved(profile,fromId,toId);delete profile.$allrowscache}},CELL0:{onClick:function(profile,e,src){var p=profile.properties,serialId=profile.getSubSerialId(src.id),row=profile.row_SerialIdMapItem[serialId];if(p.disabled||row.disabled){return false}if(row.sub){profile.getSubNode("MARK",serialId).onClick(true)}linb(src).first().focus();return false},onMousedown:function(profile,e,src){var p=profile.properties,fromId=profile.getSubSerialId(src.id),row=profile.row_SerialIdMapItem[fromId],_layer=row._layer;if(p.disabled||row.disabled){return false}if(!p.rowDragable||row.rowDragable===false){return }if(false===profile.boxing().beforeRowDrag(profile,row)){return }var pos=linb.event.getPos(e),o=linb([src],false).parent(2);linb([src],false).startDrag(e,{drop2:true,type:"copy",cursor:"pointer",target_clone:true,target_left:pos.left+12,target_top:pos.top+12,move:false,defer:1,key:(p.rowDragKey||profile.$id)+":row"+(p.rowDragToAny?"":(":"+_layer)),data:o.id()})},onDragbegin:function(profile,e,src){linb(src).onMouseout(true,{$force:true}).onMouseup(true)},beforeMouseover:function(profile,e,src){if(false===profile.box._rowDragCheck(profile,src)){return }linb.dragDrop._current=this;linb.dragDrop.showDDMark(src)},beforeMouseout:function(profile,e,src){if(false===profile.box._rowDragCheck(profile,src)){return }linb.dragDrop._current=null;linb.dragDrop.showDDMark(null)},onDrop:function(profile,e,src){if(false===profile.box._rowDragCheck(profile,src)){return }linb.dragDrop.showDDMark(null);profile.box._rowDrop(profile,src,true);return false}},CELL0A:{onFocus:function(profile,e,src){if(profile.properties.activeMode=="row"){var src=profile.getSubNode("CELLS",profile.getSubSerialId(src.id)).get(0);if(profile.$activeRow==src.id){return true}profile.box.activeRow(profile,src.id)}}},CELLS:{beforeMouseover:function(profile,e,src){if(false===profile.box._rowDragCheck(profile,src)){return }linb.dragDrop._current=this;profile.addTagClass("CELLS","-dragover",linb([src]))},beforeMouseout:function(profile,e,src){if(false===profile.box._rowDragCheck(profile,src)){return }linb.dragDrop._current=null;profile.removeTagClass("CELLS","-dragover",linb(src))},onDrop:function(profile,e,src){if(false===profile.box._rowDragCheck(profile,src)){return }profile.removeTagClass("CELLS","-dragover",linb(src));profile.box._rowDrop(profile,src);return false},onClick:function(profile,e,src){var p=profile.properties,serialId=profile.getSubSerialId(src.id),row=profile.row_SerialIdMapItem[serialId];if(p.disabled||row.disabled){return false}profile.box.activeRow(profile,src.id);return false},onDblclick:function(profile,e,src){var p=profile.properties,serialId=profile.getSubSerialId(src.id),row=profile.row_SerialIdMapItem[serialId];if(p.disabled||row.disabled){return false}if(profile.onDblClickRow){profile.boxing().onDblClickRow(profile,row,e,src)}return false}},CELL:{onClick:function(profile,e,src){var cell=profile.cells_SerialIdMapItem[profile.getSubSerialId(src.id)],box=profile.box;linb(src).first().focus();if(box.getCellPro(profile,cell,"disabled")){return false}if(box.getCellPro(profile,cell,"editable")){if(box.getCellPro(profile,cell,"type")=="checkbox"){box.changeCellValue(profile,cell,!cell.value)}}return false}},CELLA:{onFocus:function(profile,e,src){var p=profile.properties,box=profile.box,cell=profile.cells_SerialIdMapItem[profile.getSubSerialId(src.id)],mode=p.activeMode,id;if(mode=="cell"){if(box.getCellPro(profile,cell,"disabled")){return false}id=linb(src).parent().id();box.activeCell(profile,id)}else{if(mode=="row"){if(p.disabled||cell._row.disabled){return false}id=linb(src).parent(2).id();box.activeRow(profile,id)}}if(box.getCellPro(profile,cell,"editable")){box.editCell(profile,cell._serialId)}}}}},DataModel:{listKey:null,tabindex:{action:function(value){if(this.domNode){this.root.dig("A").tabIndex(value)}}},dock:"fill",rowDragKey:"",rowDragToAny:true,colDragKey:"",altRowsBg:{ini:true,action:function(value){if(this.domNode){}}},editable:true,$subMargin:16,iniFold:true,left:0,top:0,position:"absolute",width:300,height:200,minColW:5,minRowH:20,rowHandlerWidth:20,headerHeight:{ini:20,action:function(v){this.getSubNode("HCELLS").height(v);this.box.resize(this,this.root.width(),this.root.height())}},rowHeight:{ini:20,action:function(v){this.getSubNode("CELLS",true).height(v)}},cellDfWidth:80,colResizer:{ini:true,action:function(value){this.getSubNode("HCELLHANDLER",true).display(value?"":"none")}},rowHandler:{ini:true,action:function(value){this.getSubNode("HCELL0").display(value?"":"none");this.getSubNode("CELL0",true).display(value?"":"none")}},rowResizer:{ini:true,action:function(value){this.getSubNode("ROWHANDLER",true).display(value?"":"none")}},colSortable:{ini:true,action:function(value){this.getSubNode("SORT",true).display("none")}},header:{ini:{},set:function(v){return this.each(function(o){if(o.domNode){o.boxing().refreshHeader(v)}else{o.properties.header=v}})}},rows:{ini:{},set:function(v){return this.each(function(o){if(o.domNode){o.boxing().removeAllRows().insertRows(v)}else{o.properties.rows=v}})}},colDragable:true,rowDragable:true,activeMode:{ini:"row",listbox:["row","cell"],action:function(value){if(this.domNode){var profile=this;if(profile.$activeCell){profile.removeTagClass("CELL","-active",linb(profile.$activeCell))}if(profile.$activeRow){profile.removeTagClass("CELLS","-active",linb(profile.$activeRow))}}}}},EventHandlers:{onRequestData:function(profile,item,threadid){},beforeColumnSort:function(profile,id,order){},afterColumnSort:function(profile,id,order){},beforeRowDrag:function(profile,id){},beforeRowMoved:function(profile,fromId,toId){},afterRowMoved:function(profile,fromId,toId){},beforeColumnDrag:function(profile,id){},beforeColumnMoved:function(profile,fromId,toId){},afterColumnMoved:function(profile,fromId,toId){},beforeRowActive:function(profile,row){},afterRowActive:function(profile,row){},beforeCellActive:function(profile,cell){},afterCellActive:function(profile,cell){},onDblClickRow:function(profile,row,e,src){}},createdTrigger:function(){if(!this.properties.iniFold){this.boxing().openRows(this.properties.rows,true)}},iniProfile:function(){this.$cache_editor={}},beforeSerialized:function(profile){var t,o=profile.copy();o.properties=_.copy(profile.properties);o.properties.header=linb.UI.pickObj(profile.properties.header);o.properties.rows=linb.UI.pickObj(profile.properties.rows);return o},_clsCache:{},_resetRowHandler:function(profile,row,baseW,subMargin,_layer){var self=arguments.callee,w=baseW-_layer*subMargin;row._layer=_layer;profile.getSubNode("CELL0",row._serialId).width(w);if(row.sub){++_layer;_.each(row.sub,function(r){self(profile,r,baseW,subMargin,_layer)})}},_colDragCheck:function(profile,src){var dd=linb.dragDrop,key=dd.dragKey,data=dd.data;if(!key||!data){return false}var dkey=(profile.properties.colDragKey||profile.$id)+":col";if(key!=dkey){return false}if(profile.getKey(data)!=profile.keys.HCELL){return false}var fromId=linb.dragDrop.data&&profile.getSubSerialId(data),toId=profile.getSubSerialId(src.id);if(fromId==toId){return }},_rowDragCheck:function(profile,src){var dd=linb.dragDrop,key=dd.dragKey,data=dd.data;if(!key||!data){return false}var dkey=(profile.properties.rowDragKey||profile.$id)+":row"+(profile.properties.rowDragToAny?"":(":"+_layer));if(key!=dkey){return false}if(profile.getKey(data)!=profile.keys.ROW){return false}var fromId=linb.dragDrop.data&&profile.getSubSerialId(data),toId=profile.getSubSerialId(src.id),toRow=profile.row_SerialIdMapItem[toId],_layer=toRow._layer;if(fromId==toId){return false}var node=src,target=linb.dom.byId(data);do{if(node==target){return false}}while((node&&(node=node.parentNode)&&node!=profile.domNode))},_rowDrop:function(profile,src,flag){var map=profile.row_SerialIdMapItem,fromId=linb.dragDrop.data&&profile.getSubSerialId(linb.dragDrop.data),fromRow=map[fromId],toId=profile.getSubSerialId(src.id),toRow=map[toId],_layer=flag?toRow._layer+1:toRow._layer;if(false===profile.boxing().beforeRowMoved(profile,fromId,toId,flag)){return }var toParentId,toParent,toIndex,fromParentId=fromRow._pid,fromParent=fromParentId?map[fromParentId].sub:profile.properties.rows,fromIndex=fromParent.subIndexOf("_serialId",fromId);if(flag){toParentId=toRow._serialId,toParent;if(toRow.sub){toParent=toRow.sub}else{toParent=toRow.sub=[];profile.getSubNode("MARK",toRow._serialId).display("block")}toIndex=-1}else{toParentId=toRow._pid;toParent=toParentId?map[toParentId].sub:profile.properties.rows;toIndex=toParent.subIndexOf("_serialId",toId)}if(toParentId==fromParentId&&(toIndex==fromIndex||toIndex==fromIndex+1)){return }if(flag&&!toRow._created){profile.box.setSub(profile,toRow,true);toRow._created=true}if(profile.properties.rowHandler){if(toParentId!==fromParentId){fromRow._pid=toParentId;profile.box._resetRowHandler(profile,fromRow,profile.getSubNode("HCELL0").width(),profile.properties.$subMargin,_layer||0)}}fromParent.removeFrom(fromIndex);toParent.insertAny(fromRow,toIndex);if(flag){profile.getSubNode("SUB",toId).addLast(linb.dragDrop.data)}else{profile.getSubNode("ROW",toId).addPre(linb.dragDrop.data)}profile.boxing().afterRowMoved(profile,fromId,toId,flag);delete profile.$allrowscache},prepareData:function(profile){profile.row_ItemIdMapSerialId={};profile.row_SerialIdMapItem={};profile.cells_SerialIdMapItem={};var data=profile.data,pro=profile.properties;data.thhandlerDisplay=pro.colResizer?"":"display:none";data.tdfhandlerDisplay=pro.rowResizer?"":"display:none";data.tdfDisplay=pro.rowHandler?"":"display:none";if(pro.header&&pro.header.constructor!=Array){pro.header=_.clone([{id:"col1",caption:"col1",type:"input",width:50},{id:"col2",caption:"col2",type:"input",width:80}])}if(pro.rows&&pro.rows.constructor!=Array){pro.rows=_.clone([{id:"row1",cells:["cell11","cell12"]},{id:"row2",cells:[{value:"cell21",type:"label"},"cell22"],sub:[{id:"row21",cells:["cell31",{value:"cell32",type:"number"}]}]}])}data.header=this.prepareHeader(profile,pro.header);arguments.callee.upper.call(this,profile);data.rows=this.prepareItems(profile,pro.rows)},prepareHeader:function(profile,arr){var a=profile.header_ItemIdMapSerialId={},b=profile.header_SerialIdMapItem={},SubID=linb.UI.subSerialIdTag,pro=profile.properties,header=[],temp,t;arr.each(function(o,i){temp=profile.pickSubId("header");o._cells={};o[SubID]=temp;b[temp]=o;t={width:o.width||pro.cellDfWidth,sortDisplay:"display:none",tdfDisplay:pro.rowHandler?"":"display:none"};t[SubID]=temp;t._tabindex=pro.tabindex;t.thhandlerDisplay=pro.colResizer?"":"display:none";linb.UI.copyItem(o,t);a[o.id]=temp;header.push(t)});return header},prepareItems:function(profile,arr,pid){var pro=profile.properties,a=profile.row_ItemIdMapSerialId,b=profile.row_SerialIdMapItem,d=profile.cells_SerialIdMapItem,_layer=pid?b[pid]?(b[pid]._layer+1):0:0,SubID=linb.UI.subSerialIdTag,getPro=profile.box.getCellPro,self=arguments.callee,rows=[],altCls=profile.getClass("ALT"),temp,cells,t,row,listKey,headCell,n,render;for(var i=0,l=arr.length;i<l;i++){temp=profile.pickSubId("row");row=arr[i];row._pid=pid;row._cells={};row._layer=_layer;row[SubID]=temp;row._tabindex=pro.tabindex;b[temp]=row;t={id:row.id};t.rowHeight=pro.rowHeight;t.rowHandlerWidth=pro.rowHandlerWidth;t.tdfDisplay=pro.rowHandler?"":"display:none";t.tdfhandlerDisplay=pro.rowResizer?"":"display:none";if(pro.altRowsBg){t.cls=i%2?altCls:""}cells=t.cells=[];t[SubID]=temp;t.display=row.sub?"":"display:none";a[row.id]=temp;row.cells.each(function(g,j){headCell=pro.header[j];n={width:headCell.width};if(typeof g=="object"){linb.UI.copyItem(g,n)}else{n.value=g;g=row.cells[j]={value:g}}g._row=row;g._header=headCell;n.type=getPro(profile,g,"type")||"input";render=getPro(profile,g,"render");n.caption=render?render(n.value):n.value;g[SubID]=n[SubID]=profile.pickSubId("cell");n.cellCls=this._clsCache[n.type]||(this._clsCache[n.type]=profile.getClass("CELL","-"+n.type));switch(n.type){case"checkbox":n.checkboxCls=this._clsCache[n.type+":"+n.value]||(this._clsCache[n.type+":"+n.value]=profile.getClass("CHECKBOX",n.value?"-checked":""));break}n._tabindex=pro.tabindex;cells.push(n);d[n[SubID]]=g;row._cells[headCell.id]=n[SubID];headCell._cells[row.id]=n[SubID]},this);linb.UI.copyItem(row,t);rows.push(t)}return rows},setSub:function(profile,item,flag){var id=profile.domId,key1=profile.keys.MARK,key2=profile.keys.SUB,serialId=profile.row_ItemIdMapSerialId[item.id],markNode=profile.getSubNode("MARK",serialId),getSubNode=profile.getSubNode("SUB",serialId);if(linb.thread.exists(profile.key+profile.id)){return }if(item._checked){var h=getSubNode.height();getSubNode.fx({height:[h,0]},function(){getSubNode.height(h)},function(){getSubNode.display("none").height("auto")},200,8,"inexp",profile.key+profile.id).start();profile.removeTagClass("MARK","-checked",markNode);item._checked=false}else{var openSub=function(profile,item,id,markNode,getSubNode,sub,flag){var p=profile.properties;if(!item._created){delete item.sub;item._created=true;getSubNode.display("none");profile.boxing().insertRows(sub,item.id)}if(!flag){var h=getSubNode.height(true);getSubNode.fx({height:[0,h]},function(){getSubNode.setStyle({height:"0px",display:"block"})},function(){getSubNode.setStyle({height:"auto"})},200,8,"outexp",profile.key+profile.id).start()}else{getSubNode.display("block")}if(p.rowHandler){var w1=profile.getSubNode("HCELL0").width(),w2=(item._layer+2)*p.$subMargin;if(w1<w2){profile.getSubNode("HCELL0").width(w2);profile.getSubNode("CELL0",true).widthBy(w2-w1)}}profile.addTagClass("MARK","-checked",markNode).addTagClass("MARK","-mouseover",markNode);item._checked=true};var sub=item.sub;if(sub&&sub.length){openSub(profile,item,id,markNode,getSubNode,sub,flag);if(flag){sub.each(function(o){if(o.sub&&o.sub.length&&!o.iniFold&&!o._checked){profile.box.setSub(profile,o,true)}})}}else{linb.thread(null,[function(threadId){if(profile.onRequestData){profile.boxing().onRequestData(profile,item,threadId)}else{linb.thread(threadId).abort()}},function(threadId){sub=linb.thread(threadId).getCache("response");if(sub){openSub(profile,item,id,markNode,getSubNode,sub,flag);openSub=null}}],null,null,function(threadId){profile.addTagClass("MARK","-busy",markNode);linb(id).busy(false)},function(){profile.removeTagClass("MARK","-busy",markNode);linb(id).free()}).start()}}delete profile.$allrowscache},getCellId:function(profile,rowId,colId){var rowItemId=profile.row_ItemIdMapSerialId[rowId],row=profile.row_SerialIdMapItem[rowItemId];return row&&row._cells&&row._cells[colId]},changeCellValue:function(profile,cellId,value){var cell;if(typeof cellId=="string"){cell=profile.cells_SerialIdMapItem[cellId]}else{cell=cellId;cellId=cell._serialId}if(!cell){return }var type=profile.box.getCellPro(profile,cell,"type")||"input",render=profile.box.getCellPro(profile,cell,"render");if(cell.value!=value){if(false===profile.boxing().beforeValueUpdated(profile,cell,cell.value,value)){return }switch(type){case"checkbox":if(value){profile.addTagClass("CHECKBOX","-checked",profile.getSubNode("CHECKBOX",cellId))}else{profile.removeTagClass("CHECKBOX","-checked",profile.getSubNode("CHECKBOX",cellId))}break;case"number":value=parseFloat(value);case"listbox":case"timepicker":case"datepicker":case"colorpicker":default:profile.getSubNode("CELLA",cellId).text(render?render(value):value)}cell.value=value;profile.boxing().afterValueUpdated(profile,cell,cell.value,value)}},activeCell:function(profile,id){if(profile.properties.activeMode!="cell"){return }var targetId=profile.getSubSerialId(id),map=profile.cells_SerialIdMapItem,targetCell=map[targetId];if(false===profile.boxing().beforeCellActive(profile,targetCell)){return }if(profile.$activeCell){profile.removeTagClass("CELL","-active",linb(profile.$activeCell))}profile.addTagClass("CELL","-active",linb(id));profile.$activeCell=id;profile.boxing().afterCellActive(profile,targetCell)},activeRow:function(profile,id){if(profile.properties.activeMode!="row"){return }var targetId=profile.getSubSerialId(id),map=profile.row_SerialIdMapItem,targetRow=map[targetId];if(false===profile.boxing().beforeRowActive(profile,targetRow)){return }if(profile.$activeRow){profile.removeTagClass("CELLS","-active",linb(profile.$activeRow))}profile.addTagClass("CELLS","-active",linb(id));profile.$activeRow=id;profile.boxing().afterRowActive(profile,targetRow)},getCellPro:function(profile,cell,key){return cell[key]||cell._row[key]||cell._header[key]||profile.properties[key]},editCellbyRowCol:function(profile,rowId,colId){return this.editCell(profile,this.getCellId(profile,rowId,colId))},editCell:function(profile,cellId){var cell=typeof cellId=="string"?profile.cells_SerialIdMapItem[cellId]:cellId;if(!cell){return }var grid=this;var cellNode=profile.getSubNode("CELL",cellId),baseNode=profile.getSubNode("SCROLL"),absPos=cellNode.absPos(null,baseNode),size=cellNode.cssSize(),type=profile.box.getCellPro(profile,cell,"type")||"input",format=profile.box.getCellPro(profile,cell,"format"),widget,t;if(type=="checkbox"){cellNode.first().focus();return }if(profile.$cache_editor[type]){widget=profile.$cache_editor[type]}else{switch(type.split(":")[0]){case"label":return ;break;case"number":case"input":case"textarea":linb.SC("linb.UI.Input");break;case"checkbox":break;case"listbox":case"combobox":case"popbox":case"getter":case"helpinput":case"cmdbox":case"popbox":case"timepicker":case"datepicker":case"colorpicker":linb.SC("linb.UI.ComboInput");break;case"button":linb.SC("linb.UI.Button");break;default:}switch(type.split(":")[0]){case"label":return ;break;case"number":case"input":widget=linb.create("Input");break;case"textarea":widget=linb.create("Input",{inputArea:"textarea"});break;case"listbox":case"combobox":case"helpinput":case"timepicker":case"datepicker":case"colorpicker":widget=new linb.UI.ComboInput;widget.setType(type);widget.create();break;case"getter":case"popbox":case"cmdbox":case"popbox":widget=new linb.UI.ComboInput;widget.setType(type).onClickButton(function(pro){var cell=pro.$cell;if(typeof cell.event=="function"){cell.event.call(profile._host||profile,profile,cell,pro)}});widget.create();break;case"checkbox":break;case"button":widget=linb.create("Button",{caption:"..."},{onClick:function(pro){var cell=pro.$cell;if(typeof cell.event=="function"){cell.event.call(profile._host||profile,profile,cell,pro)}}});break;default:}widget.reBoxing().setStyle({position:"absolute",display:"none"});baseNode.attach(widget);profile.$cache_editor[type]=widget}widget.get(0).$cell=cell;if(cell.items){widget.setItems(cell.items)}if(t=profile.box.getCellPro(profile,cell,"listKey")){widget.setListKey(t)}widget.setValue(cell.value,true);if(cell.$tag){if(widget.setCaption){widget.setCaption(cell.$tag)}else{if(widget.setValue){widget.setValue(cell.$tag)}}}var undo=function(){if(widget){widget.updateUIValue(widget.getCtrlValue());widget.beforeValueUpdated(null).beforeNextFocus(null);if(widget.onFormatCheck){widget.onFormatCheck(null)}if(widget.setValueFormat){widget.setValueFormat("")}widget.setValue("",true);widget.reBoxing().hide();widget=null}};widget.beforeValueUpdated(function(pro,oV,nV){grid.changeCellValue(profile,cellId,nV)}).beforeNextFocus(function(pro,key,shift,e){undo();var hash=linb.event.getEventPara(e);if(hash.keyCode=="enter"){hash.keyCode="down"}profile.getSubNode("CELLA",cell._serialId).onKeydown(true,hash);return false});if(format){if(typeof format=="function"){if(widget.onFormatCheck){widget.onFormatCheck(format)}}else{if(widget.setValueFormat){widget.setValueFormat(format)}}t=profile.box.getCellPro(profile,cell,"tipsErr");if(t&&widget.setTipsErr){widget.setTipsErr(t)}}widget.reBoxing().setBlurTrigger(widget.get(0).$id,function(){undo();return false});if(type=="textarea"){widget.reBoxing().width(200).height(100).popToTop(cellNode,baseNode,4)}else{widget.reBoxing().width(size.width+3).height(size.height+3).setStyle({display:"block"});widget.reBoxing().show((absPos.left-1)+"px",(absPos.top-1)+"px")}_.asyRun(function(){if(widget){widget.activate()}})},showTips:function(profile,node,pos){var id=node.id;if(profile.properties.disabled){return }if(profile.getKey(id)!=profile.keys.CELLA){return }var item=profile.cells_SerialIdMapItem[profile.getSubSerialId(id)];if(item&&item.value){linb.UI.Tips.show(pos,{tips:item.value});return true}else{return false}},resize:function(profile,w,h){profile.getSubNode("BORDER").cssSize({width:w,height:h});var rh;if(h){rh=profile.getSubNode("HEADER").realHeight()}profile.getSubNode("BOX").cssSize({width:w?w:null,height:h?h:null});profile.getSubNode("SCROLL").setRegion({top:rh?rh:null,width:w?w:null,height:h?(h-rh):null}).onScroll()}}});Class("linb.UI.Dialog",["linb.UI.Widget","linb.UI.iContainer"],{Instance:{html:function(html){this.get(0).getSubNode("PANEL").html(html)},show:function(parent,modal,left,top){parent=parent||linb(document.body);return this.each(function(profile){if(profile.$show){return }var t,pro=profile.properties,instance=profile.boxing(),fun=function(){profile.$show=true;parent.attach(profile.boxing());var t1=profile.root.topZindex(),t2=profile.root.zIndex();profile.root.zIndex(t1>t2?t1:t2).show(left?(parseInt(left)||0)+"px":null,top?(parseInt(top)||0)+"px":null);if(modal&&!profile.$inModal){profile.box.modal(profile)}profile.box.active(profile);profile.root.nextFocus()};if(t=pro.fromRegion){linb.dom.fxProxy(t,pro,null,fun,240,8,"inexp").start()}else{fun()}})},hide:function(){this.each(function(profile){delete profile.$show;if(profile.$inModal){profile.box.unModal(profile)}if(profile.properties.status=="max"||profile.properties.status=="min"){profile.box.restore(profile)}profile.root.hide();var t=profile.properties.fromRegion;if(t){linb.dom.fxProxy(profile.properties,t,null,null,240,8,"outexp").start()}});return this},close:function(){return this.each(function(profile){if(profile.beforeClose&&false===profile.boxing().beforeClose(profile)){return }var t=profile.properties.fromRegion,fun=function(){profile.boxing().destroy()};if(t){linb.dom.fxProxy(profile.properties,t,null,fun,240,8,"outexp").start()}else{fun()}})},removePanel:function(){this.destroy()},getPanelPara:function(){return _.copy(this.get(0).properties)},getPanelChildren:function(){return this.get(0).children}},Initialize:function(){var t=this.getTemplate("default");_.merge(t.FRAME.BORDER,{TITLE:{tagName:"div",style:"height:{_titleHeight}px;",ICON:{$order:0},CAPTION:{$order:1,text:"{caption}"},CMDS:{$order:2,OPT:{style:"{optDisplay}",$order:0},MIN:{$order:1,style:"{minDisplay}"},RESTORE:{$order:2,style:"display:none;"},MAX:{$order:3,style:"{maxDisplay}"},CLOSE:{$order:4,style:"{closeDisplay}"},PIN:{$order:5,style:"{pinDisplay}"},LAND:{$order:6,style:"{landDisplay}"}}},PANEL:{tagName:"div",$order:2,text:linb.UI.$childTag},STATUS:{tagName:"div",$order:3}},"all");this.setTemplate("default",t)},Static:{Dropable:["PANEL"],Dragable:["LAND"],Appearances:{"default":{BORDER:{"border-left":"solid 1px #EEE","border-top":0,"border-right":"solid 1px #BBB","border-bottom":"solid 1px #BBB","background-color":"#F3F3F3"},PANEL:{position:"absolute",left:0,overflow:"auto"},STATUS:{position:"absolute",left:0,bottom:0,height:0,"*font-size":0,"*line-height":0},TITLE:{position:"absolute",left:0,top:0,height:0,"white-space":"nowrap",background:linb.UI.getCSSImgPara("barvbg.gif"," repeat-x left top",null,"linb.UI.Public"),"*font-size":0,"*line-height":0},"TITLE-focus":{$order:1,"background-position":"right -22px"},ICON:{height:"16px",width:"16px",margin:"4px 0 0 4px"},CAPTION:{margin:"4px 0 0 4px",color:"#555","font-weight":"bold","font-size":"12px"},CMDS:{position:"absolute",top:0,right:0,"text-align":"right","vertical-align":"middle",background:linb.UI.getCSSImgPara("barvbg.gif"," repeat-x left top",null,"linb.UI.Public"),height:"100%",cursor:"default"},"CMDS-focus":{$order:1,"background-position":"right -22px"},"CMDS span":{position:"relative",margin:"4px 4px 2px 0",width:"15px",height:"15px","vertical-align":"middle",cursor:"default"},OPT:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat -240px top",null,"linb.UI.Public")},"OPT-mouseover":{$order:2,"background-position":"-240px -16px"},"OPT-mousedown":{$order:3,"background-position":"-240px -32px"},MIN:{background:linb.UI.getCSSImgPara("cmds.gif"," -16px 0",null,"linb.UI.Public"),$order:0},"MIN-mouseover":{$order:1,"background-position":" -16px -16px"},"MIN-mousedown":{$order:2,"background-position":"-16px -32px"},RESTORE:{background:linb.UI.getCSSImgPara("cmds.gif"," -32px 0",null,"linb.UI.Public")},"RESTORE-mouseover":{$order:1,"background-position":"-32px -16px"},"RESTORE-mousedown":{$order:2,"background-position":"-32px -32px"},MAX:{background:linb.UI.getCSSImgPara("cmds.gif"," -48px 0",null,"linb.UI.Public")},"MAX-mouseover":{$order:1,"background-position":"-48px -16px"},"MAX-mousedown":{$order:2,"background-position":"-48px -32px"},PIN:{background:linb.UI.getCSSImgPara("cmds.gif"," 0 0",null,"linb.UI.Public")},"PIN-mouseover":{$order:1,"background-position":"0 -16px"},"PIN-mousedown":{$order:2,"background-position":" 0 -32px"},"PIN-checked, PIN-checked-mouseover":{$order:2,"background-position":"0 -32px"},CLOSE:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat  -64px 0",null,"linb.UI.Public")},"CLOSE-mouseover":{$order:1,"background-position":"-64px -16px"},"CLOSE-mousedown":{$order:2,"background-position":"-64px -32px"},LAND:{background:linb.UI.getCSSImgPara("cmds.gif"," no-repeat  -80px 0",null,"linb.UI.Public")},"LAND-mouseover":{$order:1,"background-position":"-80px -16px"},"LAND-mousedown":{$order:2,"background-position":"-80px -32px"}}},Behaviors:{"default":{_hoverEffect:{OPT:"OPT",PIN:"PIN",MIN:"MIN",MAX:"MAX",RESTORE:"RESTORE",CLOSE:"CLOSE",LAND:"LAND"},_clickEffect:{OPT:"OPT",PIN:"PIN",MIN:"MIN",MAX:"MAX",RESTORE:"RESTORE",CLOSE:"CLOSE",LAND:"LAND"},onMousedown:function(profile,e){profile.box.active(profile)},onDragstop:function(profile){var pos=profile.root.cssPos(),p=profile.properties;p.left=pos.left;p.top=pos.top},TITLE:{onMousedown:function(profile,e,src){if(profile.getKey(linb.event.getSrc(e).parentNode.id)==profile.keys.CMDS){return }if(profile.properties.movable&&!profile._locked){profile.box.active(profile);var hash={defer:1,target_parent:profile.root.parent()};if(profile.properties.dragKey){hash.data={data:[profile.$id],domId:src.id}}profile.root.startDrag(e,hash)}},onDblclick:function(profile,e,src){if(profile.getKey(linb.event.getSrc(e).parentNode.id)==profile.keys.CMDS){return }if(!profile.properties.maxBtn){return }if(profile.properties.status=="max"){profile.box.restore(profile)}else{profile.box.max(profile)}}},PIN:{onClick:function(profile,e,src){var key=profile.keys.PIN,t=profile.properties;t.pinned=!t.pinned;if(t.pinned){profile.addTagClass("PIN","-checked",null,true)}else{profile.removeTagClass("PIN","-checked")}profile._locked=t.pinned;if(t.resizable){if(!t.pinned){if(t.status!="min"&&profile.$resizer){profile.$resizer.show()}}else{if(profile.$resizer){profile.$resizer.hide()}}}}},MIN:{onClick:function(profile,e,src){profile.box.min(profile)}},MAX:{onClick:function(profile,e,src){profile.box.max(profile)}},RESTORE:{onClick:function(profile,e,src){profile.box.restore(profile)}},OPT:{onClick:function(profile,e,src){profile.boxing().onTriggerOption(profile,e,src)}},CLOSE:{onClick:function(profile,e,src){profile.boxing().close()}}}},DataModel:{$border:1,value:null,tips:null,dataField:null,dataBinder:null,border:null,disabled:null,dock:{hidden:true},shadow:true,resizable:true,movable:true,minBtn:{ini:true,action:function(v){var o=this.getSubNode("MIN");if(v){o.inlineBlock()}else{o.display("none")}}},maxBtn:{ini:true,action:function(v){var o=this.getSubNode("MAX");if(v){o.inlineBlock()}else{o.display("none")}}},optBtn:{ini:false,action:function(v){this.getSubNode("OPT").display(v?"":"none")}},closeBtn:{ini:true,action:function(v){var o=this.getSubNode("CLOSE");if(v){o.inlineBlock()}else{o.display("none")}}},pinBtn:{ini:true,action:function(v){var o=this.getSubNode("PIN");if(v){o.inlineBlock()}else{o.display("none")}}},landBtn:{ini:false,action:function(v){var o=this.getSubNode("LAND");if(v){o.inlineBlock()}else{o.display("none")}}},width:300,height:300,minWidth:200,minHeight:100,_titleHeight:22,position:"absolute",fromRegion:{hidden:true,ini:null},status:{ini:"normal",listbox:["normal","min","max"],action:function(v,o){var self=this,b=self.box;if(v=="min"){b.min(self,o)}else{if(v=="max"){b.max(self,o)}else{b.restore(self,o)}}}}},EventHandlers:{beforeValueSet:null,afterValueSet:null,beforeValueUpdated:null,afterValueUpdated:null,beforeHoverEffect:null,beforeClickEffect:null,beforeNextFocus:null,beforeClose:function(profile){},onTriggerOption:function(profile,e,src){}},createdTrigger:function(){this.destroyTrigger=function(){var s=this;if(s.$inModal){s.box.unModal(s)}}},renderedTrigger:function(){var self=this,t=self.properties,b=self.box;if(t.status=="min"){b.min(self)}else{if(t.status=="max"){b.max(self)}else{b.resize(self,t.width,t.height)}}},prepareData:function(profile){arguments.callee.upper.call(this,profile);var data=profile.data,nodisplay="display:none";data.minDisplay=data.minBtn?"":nodisplay;data.maxDisplay=data.maxBtn?"":nodisplay;data.optDisplay=data.optBtn?"":nodisplay;data.closeDisplay=data.closeBtn?"":nodisplay;data.pinDisplay=data.pinBtn?"":nodisplay;data.landDisplay=data.landBtn?"":nodisplay;data.iconDisplay=data.icon?"":nodisplay;var status=profile.properties.status;if(status=="min"||status=="max"){profile.$noR=profile.$noS=1}},min:function(profile,ov){var o=profile.boxing().reBoxing(),box=profile.box,p=o.parent(),t=profile.properties;if((ov||t.status)=="max"){box.unMax(profile)}else{box.refreshRegion(profile)}profile.getSubNodes(["PANEL","STATUS"]).display("none");if(t.minBtn){profile.getSubNode("RESTORE").inlineBlock();profile.getSubNode("MIN").display("none")}if(t.resizable&&profile.$resizer){profile.$resizer.hide()}if(t.shadow){profile.boxing()._unShadow(false)}t.status="min";var h1=o.height(),h2=profile.getSubNode("BORDER").height(),h=profile.getSubNode("TITLE").height();o.cssSize({width:t.minWidth,height:h+h1-h2},true)},max:function(profile,ov){var o=profile.boxing().reBoxing(),p=o.parent(),t=profile.properties;if((ov||t.status)=="min"){profile.box.unMin(profile)}else{profile.box.refreshRegion(profile)}if(t.pinBtn){profile.getSubNode("PIN").display("none")}if(t.maxBtn){profile.getSubNode("MAX").display("none");profile.getSubNode("RESTORE").inlineBlock()}profile.old_m=t.movable;t.movable=false;if(t.resizable&&profile.$resizer){profile.$resizer.hide()}if(t.shadow){profile.boxing()._unShadow(false)}t.status="max";profile.boxing().setDock("fill")},restore:function(profile,ov){var o=profile.boxing().reBoxing();var t=profile.properties;if((ov||t.status)=="max"){profile.box.unMax(profile)}if((ov||t.status)=="min"){profile.box.unMin(profile)}profile.getSubNode("RESTORE").display("none");t.status="normal"},unMax:function(profile){var t=profile.properties;profile.getSubNode("MAX").inlineBlock();if(t.pinBtn){profile.getSubNode("PIN").inlineBlock()}t.movable=profile.old_m;if(t.shadow){profile.boxing()._shadow()}if(t.resizable&&!t.pinned&&profile.$resizer){profile.$resizer.show()}profile.boxing().setDock("none");profile.box.resize(profile,t.width,t.height)},unMin:function(profile){var t=profile.properties;profile.getSubNodes(["PANEL","STATUS"]).display("block");profile.getSubNode("MIN").inlineBlock();if(t.shadow){profile.boxing()._shadow()}if(t.resizable&&!t.pinned&&profile.$resizer){profile.$resizer.show()}profile.root.cssSize({width:t.width,height:t.height});profile.box.resize(profile,t.width,t.height)},active:function(profile){var self=this;if(self.activeWndId==profile.$id){return }self.deActive();var o=linb(self.activeWndId=profile.domId),t1=o.topZindex(),t2=o.zIndex();o.zIndex(t1>t2?t1:t2);profile.addTagClass("TITLE","-focus");profile.addTagClass("CMDS","-focus");self.activeWndId=profile.$id},deActive:function(profile){var profile;if(profile=linb.UI._cache[this.activeWndId]){profile.removeTagClass("TITLE","-focus");profile.removeTagClass("CMDS","-focus")}delete this.activeWndId},modal:function(profile){var s=profile.root,temp,p=s.parent(),cover;if(!p.isEmpty()){if(!profile.$inModal){if(!profile.$modalDiv){profile.$modalDiv=new linb.UI.Div({position:"absolute"}).setCustomAppearance({KEY:"overflow:hidden;display:block;z-index:0;cursor:wait;background-image:url("+linb.ini.path+"bg.gif)"})}cover=profile.$modalDiv;p.attach(cover);cover.setDock("cover",true);cover=cover.reBoxing();cover.display("block").onMousedown(function(){return false}).topZindex(true);s.zIndex((parseInt(cover.zIndex())||0)+1);var hash={},a=profile.root.dig("*",function(o){return o.tabIndex>0}).get();for(var i=0,o;o=a[i++];){(hash[o.tabIndex]=hash[o.tabIndex]||[]).push(o);o.tabIndex=-1}var h=profile.$focusHash={},b=linb([document.body]).dig("*",function(o){return o.tabIndex>0}).get();for(var i=0,o;o=b[i++];){(h[o.tabIndex]=h[o.tabIndex]||[]).push(o);o.tabIndex=-1}for(var i in hash){h=hash[i];for(var j in h){h[j].tabIndex=i}}linb.event.focusHook.push([profile.domNode,function(){linb([profile.domNode]).nextFocus()}]);profile.$inModal=true}}},unModal:function(profile){if(profile.$inModal){profile.$modalDiv.setDock("none");profile.getSubNode("BORDER").addLast(profile.$modalDiv.reBoxing().display("none"));profile.$inModal=false;var hash=profile.$focusHash,h;for(var i in hash){h=hash[i];for(var j in h){h[j].tabIndex=i}}_.breakO(profile.$focusHash,2);linb.event.focusHook.pop()}},refreshRegion:function(profile){if(!profile.root){return }return _.merge(profile.properties,profile.root.getRegion(),"all")},_adjust:function(dialog,caption,content){caption=caption||"";if(!content){content=caption;caption=""}var node=dialog.$div.reBoxing(),ID="linb:temp:dialog",me=arguments.callee;if(!linb.dom.byId(ID)){n2=me._cache=node.clone(false);linb([document.body]).addLast(n2);n2.setStyle({width:"auto",height:"auto",overflow:"visible",position:"absolute",visibility:"visible",left:linb.dom.hide_value}).id(ID,true)}var n2=me._cache;n2.html(content,false);var size=n2.cssSize();node.html(content);if(size.width>500){size.width=500;node.width(500);size.height=node.offsetHeight()+10}if(size.height>400){size.height=400}if(size.width<100){size.width=100}if(size.height<30){size.height=30}node.cssSize(size).overflow("auto").show();dialog.setCaption(caption).setWidth(size.width+30).setHeight(size.height+80);dialog.$cmd.reBoxing().left((size.width+30-dialog.$cmd.reBoxing().width())/2)},alert:function(caption,content,onOK){var me=arguments.callee,dialog=me.dialog;me.onOK=onOK;if(!dialog){dialog=me.dialog=new linb.UI.Dialog({caption:caption||"Alert",minBtn:false,maxBtn:false,pinBtn:false,resizable:false,left:200,top:200},{beforeClose:function(){dialog.$div.reBoxing().html("",false);dialog.hide();_.tryF(me.onOK);me.onOK=null;return false}});linb.SC("linb.UI.Button");var cmd=new linb.UI.Div({bottom:10,width:60,height:24,CA:{KEY:"overflow:visible"}});dialog.$cmd=cmd;var btn=new linb.UI.Button({caption:"OK",width:60,tabindex:1},{onClick:function(){dialog.$div.reBoxing().html("",false);dialog.hide();_.tryF(onOK)}});cmd.attach(btn);dialog.$btn=btn;var div=new linb.UI.Div({left:10,top:10,CA:{KEY:"overflow:visible"}});dialog.$div=div;dialog.attach(cmd).attach(div).create()}this._adjust(dialog,caption,content);dialog.show(linb([document.body]),true);_.asyRun(function(){dialog.$btn.activate()})},confirm:function(caption,content,onYes,onNo){var me=arguments.callee,dialog=me.dialog;me.onYes=onYes,me.onNo=onNo;if(!dialog){dialog=me.dialog=new linb.UI.Dialog({caption:caption||"Alert",minBtn:false,maxBtn:false,pinBtn:false,resizable:false,left:200,top:200},{beforeClose:function(){dialog.$div.reBoxing().html("",false);dialog.hide();_.tryF(me.onNo);me.onNo=null;return false}});linb.SC("linb.UI.Button");var cmd=new linb.UI.Div({bottom:10,width:140,height:24});dialog.$cmd=cmd;var btn=new linb.UI.Button({caption:"Yes",width:60,tabindex:1,left:0},{onClick:function(){dialog.$div.reBoxing().html("",false);_.tryF(me.onYes);me.onYes=null;dialog.hide()}});cmd.attach(btn);btn=new linb.UI.Button({caption:"No",tabindex:1,width:60,left:80},{onClick:function(){dialog.$div.reBoxing().html("",false);_.tryF(me.onNo);me.onNo=null;dialog.hide()}});cmd.attach(btn);dialog.$btn=btn;var div=new linb.UI.Div({left:10,top:10}).setCustomAppearance({KEY:"overflow:visible"});dialog.$div=div;dialog.attach(cmd).attach(div).create()}this._adjust(dialog,caption,content);dialog.show(linb([document.body]),true);_.asyRun(function(){dialog.$btn.activate()})},pop:function(caption,content,cmdStr,left,top){var me=arguments.callee,dialog=me.dialog;if(!dialog){dialog=new linb.UI.Dialog({caption:caption||"Alert",minBtn:false,maxBtn:false,pinBtn:false,resizable:false,left:200,top:200});linb.SC("linb.UI.Button");var cmd=new linb.UI.Div({bottom:10,width:60,height:24});dialog.$cmd=cmd;var btn=new linb.UI.Button({caption:cmdStr||"OK",tabindex:1,width:60},{onClick:function(){dialog.destroy()}});cmd.attach(btn);dialog.$btn=btn;var div=new linb.UI.Div({left:10,top:10}).setCustomAppearance({KEY:"overflow:visible"});dialog.$div=div;dialog.attach(cmd).attach(div).create()}this._adjust(dialog,caption,content);dialog.show(linb([document.body]),false,left,top);_.asyRun(function(){dialog.$btn.activate()});return dialog},prompt:function(caption){},resize:function(profile,w,h){var size=arguments.callee.upper.apply(this,arguments),region={},v1=profile.getSubNode("TITLE"),v2=profile.getSubNode("PANEL"),v3=profile.getSubNode("STATUS"),bh,bw,h1,h3;if(h){bh=size.height,h1=v1.height(),h3=v3.height();region.top=h1;if(bh-h1-h3>0){region.height=bh-h1-h3}}if(w){bw=size.width;region.width=bw}v2.setRegion(region,true);if(bw){v1.add(v3).width(bw)}}}});Class("linb.UI.TextEditor",["linb.UI.Widget","linb.UI.iForm"],{Instance:{activate:function(){var profile=this.get(0);profile.getSubNode("INPUT").focus();return this},setCtrlValue:function(value){if(_.isNull(value)||!_.exists(value)){value=""}return this.each(function(profile){var node=profile.getSubNode("INPUT").get(0);if(node.value.replace(/(\r\n|\r)/g,"\n")!=value.replace(/(\r\n|\r)/g,"\n")){var st=node.scrollTop;node.value=value;node.scrollTop=st}})},getCtrlValue:function(value){var profile=this.get(0);return profile.getSubNode("INPUT").value().replace(/(\r\n|\r)/g,"\n").replace(/( +)(\n)/g,"$2").replace(/\t/g,"    ")},prepareMaps:function(){return this.each(function(profile){profile._maps=profile._maps||{}})},setTempMaps:function(h){return this.each(function(profile){profile._maps2=h||{}})},disabled:function(value){arguments.callee.upper.call(this,value);return this.each(function(o){o.getSubNode("INPUT").disabled(value)})},readonly:function(value){return this.each(function(profile){profile.getSubNode("INPUT").readonly(value).background(value?"#F4F4F4":"")})}},Initialize:function(){var t=this.getTemplate("default");_.merge(t.FRAME.BORDER,{BOX:{tagName:"div",INPUT:{tagName:"textarea",tabindex:"{tabindex}"}},BAK1:{},BAK2:{tagName:"div"}},"all");this.setTemplate("default",t)},Static:{Appearances:{"default":{KEY:{overflow:"hidden"},BOX:{display:"block",position:"absolute",width:"100%",height:"100%",left:0,top:0,overflow:linb.browser.gek?"auto":""},INPUT:{"font-family":"Courier New, Courier, monospace","font-size":"12px",position:"relative",left:0,top:0,border:0,margin:0,padding:0,overflow:"auto","overflow-y":(linb.browser.gek||linb.browser.ie)?"auto":"","overflow-x":(linb.browser.gek||linb.browser.ie)?"hidden":""},"BAK1, BAK2":{"font-family":"Courier New, Courier, monospace","font-size":"12px",position:"absolute",visibility:"hidden",left:"-10000px",top:"-10000px"}}},Behaviors:{"default":{INPUT:{onChange:function(profile,e,src){profile.boxing().updateUIValue(src.value)},afterKeydown:function(profile,e,src){if(profile.properties.disabled||profile.properties.readonly){return }if(profile.$change){delete profile.$change}var key=linb.event.getKey(e),k=key[0];switch(k){case"tab":profile.box.insertAtCaret(profile,"    ");profile.$pos=profile.box.getParas(profile)[0];return false;case"enter":var paras=profile.box.getParas(profile);str=paras[1];var len=str.length-str.ltrim().length;if(str.charAt(str.length-1)=="{"){len+=4}if(len){profile.box.insertAtCaret(profile,((linb.browser.ie||linb.browser.opr)?"\r\n":"\n")+" ".repeat(len));profile.$enter=true;return false}break;default:if(profile.tips){profile.tips.destroy();profile.tips=null}}},afterKeypress:function(profile,e,src){if(profile.properties.disabled||profile.properties.readonly){return }var key=linb.event.getKey(e),k=key[0];var me=arguments.callee,map=me.map||(me.map={space:1,enter:1,backspace:1,tab:1,"delete":1});if(k.length==1||map[k]){profile.$change=true}switch(k){case"tab":if(linb.browser.opr){_.asyRun(function(){profile.box.setCaretTo(src,profile.$pos)})}return false;case"enter":if(profile.$enter){delete profile.$enter;return false}case"}":if(key[2]){var paras=profile.box.getParas(profile);var loc=paras[0],str=paras[1],pos=paras[2],input=paras[3];if(/ {4}$/.test(str)){var st=linb(src).scrollTop();input.value=input.value.substr(0,loc).replace(/ {4}$/,"}")+input.value.substr(loc,input.value.length);linb(input).onChange();profile.box.setCaretTo(input,loc-4+1,st);return false}}break}},afterKeyup:function(profile,e,src){var key=linb.event.getKey(e),k=key[0];var me=arguments.callee,map=me.map||(me.map={space:1,enter:1,backspace:1,tab:1,"delete":1});if(k.length==1||map[k]){profile.$change=true}if(profile.$change){delete profile.$change;if(profile.onKeyPress){profile.boxing().onKeyPress(profile,e,src)}}}}}},DataModel:{icon:null,iconPos:null,tabindex:{action:function(value){if(this.domNode){this.getSubNode("INPUT").tabIndex(value)}}},left:0,top:0,width:200,height:200,position:"absolute",readonly:{ini:false,action:function(v){this.boxing().readonly(v)}}},EventHandlers:{onKeyPress:function(profile,e,src){}},createdTrigger:function(){if(this.properties.readonly){this.boxing().readonly(true)}},resize:function(profile,w,h){var size=arguments.callee.upper.apply(this,arguments);profile.getSubNode("BOX").cssSize(size);profile.getSubNode("INPUT").cssSize(size)},insertAtCaret:function(profile,text){var start,end,input=profile.getSubNode("INPUT"),scrollTop;scrollTop=input.scrollTop()||null;input.onChange();input=input.get(0);if(linb.browser.ie){linb(input).focus();var range=document.selection.createRange();if(range.parentElement()!=input){return false}range.text="";var loc=linb.UI.getCaretPos(input);input.value=input.value.substr(0,loc[0])+text+input.value.substr(loc[0],input.value.length);start=loc[0]}else{start=input.selectionStart;end=input.selectionEnd;input.value=input.value.substr(0,start)+text+input.value.substr(end,input.value.length)}if(start!=null){this.setCaretTo(input,start+text.length,scrollTop)}else{input.value+=text}},setCaretTo:function(input,pos,scrollTop){linb(input).focus();var s,c,h,o=linb(input);if(_.isNumb(scrollTop)){o.scrollTop(scrollTop)}if(scrollTop===true){if(o.tagName().toLowerCase()=="textarea"&&o.scrollHeight()!==o.offsetHeight()){s=o.value().substr(0,pos);c=o.clone().id("").setStyle({visibility:"hidden",position:"absolute",left:5000+"px"}).value(s);linb([document.body],false).addLast(c);h=Math.max((c.scrollHeight()>c.offsetHeight())?c.scrollHeight()-30:0,0);o.scrollTop(h);c.remove()}}if(linb.browser.ie){pos=input.value.substr(0,pos).replace(/\r\n/g,"\n").length;var range=input.createTextRange();range.move("character",pos);range.select()}else{try{input.setSelectionRange(pos,pos)}catch(e){}}},getParas:function(profile){var o=profile.getSubNode("INPUT"),me=arguments.callee,reg=me.reg||(me.reg=/\r\n/g);v=o.get(0).value;loc=linb.UI.getCaretPos(o.get(0));if(loc[0]<0){loc[0]=0}var l=0,m=v.substr(0,loc[0]).match(reg);if(m){l=m.length}v=v.replace(reg,"\n");var txt=v.substr(0,loc[0]-l);var li=txt.lastIndexOf("\n"),line=txt.substr(li+1,loc[0]-li),w=o.clientWidth(),bak1=profile.getSubNode("BAK1"),bak2=profile.getSubNode("BAK2");if(txt.charAt(txt.length-1)=="\n"){txt+="*"}bak2.width(w);var x=bak1.html(line.replace(/ /g,"&nbsp;"),false).width(),y=bak2.html(txt.replace(/\n/g,"<br />"),false).height()-o.scrollTop();if(x>w){bak2.html(line,false);var lbak=line;var bl=bak2.height();while(lbak){lbak=lbak.replace(/ [^ ]*$/,"");bak2.html(lbak,false);if(bak2.height()!=bl){break}}lbak=line.substr(lbak.length,line.length-lbak.length);x=bak1.html(lbak,true).width()}bak1.html("",false);bak2.html("",false);var pos=profile.root.absPos();pos.left+=x;pos.top+=y;return[loc[0],line,pos,o.get(0),txt]}}});Class("linb.UI.Calendar","linb.UI.DatePicker",{Instance:{},Initialize:function(){var self=this,e=linb.event.eventhandler,e2=linb.event.eventhandler2,id=linb.UI.$ID,cls=linb.UI.$CLS,key=self.KEY;self.mapKeys(["H","W","D","TD"]);var colgroup='<colgroup><col width="2%"/><col width="14%"/><col width="14%"/><col width="14%"/><col width="14%"/><col width="14%"/><col width="14%"/><col width="14%"/></colgroup>',thead1='<thead><tr height="1%"><th id="'+key+"-H:"+id+':7" class="'+cls+'-h #H_CC#"></th>',thead2="</tr></thead>",th='<th id="'+key+"-H:"+id+':@" class="'+cls+'-h #H_CC#">@</th>',tbody1="<tbody>",tbody2="</tbody>",tr1="<tr>",tr2="</tr>",td1='<th id="'+key+"-W:"+id+':@"  class="'+cls+'-w #W_CC#">@</th>',td2='<td id="'+key+"-TD:"+id+':@" class="'+cls+'-td #TD_CC#"  unselectable="on" onclick="'+e+'" ><div id="'+key+"-D:"+id+':@" class="'+cls+'-d #D_CC#" unselectable="on" onmouseover="'+e2+'" onmouseout="'+e2+'" ondrop="'+e2+'" ></div></td>',body,i,j,k,l,a=[],b=[];for(i=0;i<7;i++){b[b.length]=th.replace(/@/g,i)}k=l=0;for(i=0;i<48;i++){j=i%8;a[a.length]=(j==0?tr1:"")+(j==0?td1:td2).replace(/@/g,j==0?l:k)+(j===7?tr2:"");if(j!==0){k++}else{l++}}body=colgroup+thead1+b.join("")+thead2+tbody1+a.join("")+tbody2;self.setTemplate("default",{tagName:"div",style:"{_style}",onselectstart:"return false",BORDER:{tagName:"div",BODY:{$order:1,tagName:"table",cellpadding:"0",cellspacing:"0",width:"100%",text:body}}})},Static:{Dropable:["D"],Behaviors:{"default":{_hoverEffect:{},_clickEffect:{},onRewh:function(profile,e,src){var o=profile.domNode.style,f=parseInt,n=null,w=n,h=n;if(e.height){h=f(o.height)||n}if(e.width){w=f(o.width)||n}if(h||w){profile.box.resize(profile,w,h)}}}},DataModel:{handleHeight:null,tipsHeight:null,closeBtn:null,dock:"fill",dropKeys:"iEvent",$borderW:1},_getDayNodes:function(profile){return profile.$day||(profile.$day=profile.getSubNode("D",true))},Appearances:{"default":{D:{position:"relative"}}},EventHandlers:{},prepareData:function(profile){linb.UI.iWidget.prepareData.call(this,profile)},resize:function(profile,w,h){var p=profile.properties,f=function(k){return profile.getSubNode(k)},off=2*p.$borderW,t;if(h&&h!=p.height){f("BORDER").height(t=h-off);f("BODY").height(t);t=t-p.headHeight-6;profile.box._getDayNodes(profile).height(t/6)}}}});Class("linb.UI.IFrame",["linb.UI.iWidget","linb.UI.iMisc"],{Instance:{_start:false,submit:function(action,data,fdata,method,enctype){var self=this,fun=function(){self.get(0)._start=true;data=_.hash(data);method=_.str(method,"get").toUpperCase();action=_.str(action);var prof=self.get(0),_t=[];_.each(data,function(o,i){_t.push('<textarea id="'+i+'" name="'+i+'">'+(typeof o=="object"?_.serialize(o):o)+"</textarea>")});var formStr='<form target="'+self.get(0).domId+'" action="'+action+'" method="'+method+'">'+_t.join("")+"</form>";var form=prof._form=formStr.toDom(false);linb.dom.getMatix().addLast(form);_.each(fdata,function(o,i){o.get(0).id=i;o.get(0).name=i;form.addLast(o)});var formdom=form.get(0);if(enctype){if(formdom.encoding){formdom.encoding="multipart/form-data"}formdom.enctype="multipart/form-data"}if(linb.browser.ie6){linb.temp.cancelBeforeload=true}formdom.submit();prof._time=_.asyRun(function(){self.clear();self.onTimeout(prof)},prof.properties.timeout)};if(linb.browser.opr){_.asyRun(fun,10)}else{fun()}},clear:function(){var prof=this.get(0);prof._start=false;if(prof._form){prof._form.remove()}clearTimeout(prof._time)}},Initialize:function(){},Static:{cssNone:true,Templates:{"default":{style:"{_style}",frameborder:"0",marginheight:"0",marginwidth:"0",tagName:"iFrame",name:"{name}",src:"{src}"}},Behaviors:{"default":{onLoad:function(prof){if(!prof._start){return }var s=prof.box.getBody(prof.domNode).innerHTML;prof.boxing().clear();if(prof.onResponse){if(linb.browser.opr){s=s.replace(/&quot;/g,'"')}prof.boxing().onResponse(prof,s)}}}},Appearances:{"default":{}},DataModel:{timeout:30000,width:100,height:100,src:{ini:"about:blank",action:function(v){if(this.domNode){this.root.src(v)}}}},EventHandlers:{onResponse:function(profile,response){},onTimeout:function(profile){}},prepareData:function(profile){arguments.callee.upper.apply(this,arguments);var data=profile.data;data.name=profile.key+":"+linb.UI.$ID+":"},getBody:function(i){return(i.contentWindow||i).document.body}}});